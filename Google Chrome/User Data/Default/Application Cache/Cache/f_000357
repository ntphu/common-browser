// JavaScript Document
/*
 * Created by DungNT11
 * User: DungNT11.Fsoft
 * Date: 7/4/14
 * Time: 5:05 PM
 */
var gIntroCusManageObjs;
var defaultChoice;
var genderId = "";
var enterId ="";
var nationalId = "";
var incomerId  = 1;
var tmpArray1 = [];
var tmpArray2 = [];
var isCompletedCheckingMobile;
var isValidMobile;
var invalidMobileMsg;
var isSendReq = false;
var gUtiConditions = {	"amount":
						{
							"allow":"[,.0-9]",
							"notallow":"",
							"minlength":"0",
							"maxlength":"18",
							"func":""
						},
						"content":
						{
							"allow":"[a-zA-Z0-9]",
							"notallow":"",
							"minlength":"0",
							"maxlength":"200",
							"func":""
						},
						"date":
						{
							"allow":"",
							"notallow":"",
							"minlength":"1",
							"maxlength":"10",
							"func":"isValidDateCTV"
						},
						"mobile":
						{
							"allow":"[0-9]",
							"notallow":"",
							"minlength":"0",
							"maxlength":"18",
							"func":""
						},
						"email":
						{
							"allow":"",
							"notallow":"",
							"minlength":"0",
							"maxlength":"200",
							"func":""
						},						
						"gender":
						{
							"allow":"[1-2]",
							"notallow":"",
							"minlength":"0",
							"maxlength":"200",
							"func":""
						},
					 }

function showCal(objid,spanid) {
	
	var obj = document.getElementById(objid);
	var spanobj = document.getElementById(spanid);
	
	var fromDate;
	var strBwd = gUserInfo.lang == 'VN' ? 'Trước' : 'Previous';
	var strFwd = gUserInfo.lang == 'VN' ? 'Sau' : 'Next';
	var strHide = gUserInfo.lang == 'VN' ? 'Đóng' : 'Close';
	var strMotu = gUserInfo.lang == 'VN' ? 'T2;T3;T4;T5;T6;T7;CN' : 'Mo;Tu;We;Th;Fr;Sa;Su';
	var strFull = gUserInfo.lang == 'VN' ? 'Tháng 1;Tháng 2;Tháng 3;Tháng 4;Tháng 5;Tháng 6;Tháng 7;Tháng 8;Tháng 9;Tháng 10;Tháng 11;Tháng 12' : 'January;Feburary;March;April;May;June;July;August;September;October;November;December';
 	
	fromDate = new DatePicker(					
		{				
			show : function(data) {},			
			hide : function(data) {},			
			seek : function(data) {},			
			select : function(data, fn) {
				obj.value = HumanDate.human(data, 'd/m/Y'); //node nhan gia tri
				fromDate.hide();
				}			
		},				
		{				
			tmpl_field   : 'd/m/Y',			
			range_min    : '01-01-1900',			
			range_max    : '12-31-9999',			
			//dom_id       : obj.id,			
			//dom_field    : obj,			
			
			dom_field    : spanobj, //node make action
			async_selection : true,		
			dictionaries : {			
				'custom' : {		
					common : {	
						bwd  : strBwd,
						fwd  : strFwd, 
						hide : strHide
					},	
					weekdays : {	
						motu : strMotu
					},	
					monthes : {	
						full : strFull
					},	
				}		
			}			
		}				
	);	
}

function loadInitXML() {
   var docXml = getReviewXmlStore();
   logInfo(docXml);
   return docXml;
}

function viewDidLoadSuccess() {
	//add datetime picker
	/*
	var dob = document.getElementById("id.dateOfBirth");
	showCal(dob);
	var doi = document.getElementById("id.dateOfIssue");
	showCal(doi);
	*/
		document.getElementById("btnFile").value = CONST_STR.get('TRANSFER_LIST_CHOICE_FILE');

	showCal('id.dateOfBirth','span.dateOfBirth');	
	showCal('id.dateOfIssue','span.dateOfIssue');
	
    var lengthcountries	= countries.data.length;
	
	logInfo("----- start sort -----");
    countries.data.sort(dynamicSort("description"));
	
	for (var i=0; i<lengthcountries; i++) {
		if (countries.data[i].countryCode == 'VN')
		{		
			tmpArray1.push(countries.data[i].description);
			tmpArray2.push(countries.data[i].countryCode);	
			break;
		}
	}
	for (var i=0; i<lengthcountries; i++) {
		if (countries.data[i].countryCode != 'VN')
		{		
			tmpArray1.push(countries.data[i].description);
			tmpArray2.push(countries.data[i].countryCode);				
		}
	}
	logInfo("----- finish sort -----");
	
	for (var i=0; i<lengthcountries; i++) {
		/*
		tmpArray1.push(countries.data[i].description);
		tmpArray2.push(countries.data[i].countryCode);	
		*/
		
		var naName = document.getElementById("id.introCusNation").value;
		if(naName == countries.data[i].description)	{
			nationalDisplayName = countries.data[i].description;
			var tagAccNo = document.getElementById("id.nationality");
			tagAccNo.value = nationalDisplayName;
			nationalId = countries.data[i].countryCode;
		}			
	}
}

function dynamicSort(property) {
    var sortOrder = 1;
    if(property[0] === "-") {
        sortOrder = -1;
        property = property.substr(1);
    }
    return function (a,b) {
        var result = (a[property] < b[property]) ? -1 : (a[property] > b[property]) ? 1 : 0;
        return result * sortOrder;
    }
}

function goBack() {
	navController.popView(true);
}

// Fill data for gender
function showChoiceGenderInfo(){
	var tmpArray1 = (gUserInfo.lang == 'EN')? CONST_KEY_CHANGE_INFO_GENDER_EN: CONST_KEY_CHANGE_INFO_GENDER_VN;
	var tmpArray2 = CONST_KEY_CHANGE_INFO_GENDER_ID;
	document.addEventListener("evtSelectionDialog", showChoiceGenderInfoPre, false);
	document.addEventListener("evtSelectionDialogClose", showChoiceGenderInfoPreClose, false);
	showDialogList(CONST_STR.get('GENDER_BGN_CHOICE'), tmpArray1, tmpArray2 , false);
}

function showChoiceGenderInfoPre(e) {
	if (currentPage == "introducexsl/introduce_new_customer_edit_ctv") {
		showChoiceGenderInfoPreClose();
		if ((e.selectedValue1 != undefined) && (e.selectedValue1 != null)) {		
			var tagAccNo = document.getElementById("id.genderInfo");
			if (tagAccNo.nodeName == "INPUT") {
				tagAccNo.value = e.selectedValue1;
			}
			else {
				tagAccNo.innerHTML = e.selectedValue1;
			}
		}
		if ((e.selectedValue2 != undefined) && (e.selectedValue2 != null)) {
			genderId = e.selectedValue2;
		}
	}
}

function showChoiceGenderInfoPreClose() {
	if (currentPage == "introducexsl/introduce_new_customer_edit_ctv") {
		document.removeEventListener("evtSelectionDialogClose", showChoiceGenderInfoPreClose, false);
		document.removeEventListener("evtSelectionDialog", showChoiceGenderInfoPre, false);
	}
}

// Fill data for nationality
function showChoiceNationalityInfo(){
 	document.addEventListener("evtSelectionDialog",showChoiceNationalityInfoPre, false);
	document.addEventListener("evtSelectionDialogClose", showChoiceNationalityInfoPreClose, false);
    showDialogList(CONST_STR.get('NATIONALITY_BGN_CHOICE'), tmpArray1, tmpArray2 , false);
}

function showChoiceNationalityInfoPre(e) {
	if (currentPage == "introducexsl/introduce_new_customer_edit_ctv") {
		showChoiceNationalityInfoPreClose();
		if ((e.selectedValue1 != undefined) && (e.selectedValue1 != null)) {
			defaultChoice = e.selectedValue1;
			
			var tagAccNo = document.getElementById("id.nationality");
			if (tagAccNo.nodeName == "INPUT") {
				tagAccNo.value = e.selectedValue1;
			}
			else {
				tagAccNo.innerHTML = e.selectedValue1;
			}
		}
	    if ((e.selectedValue2 != undefined) && (e.selectedValue2 != null)) {
			nationalId = e.selectedValue2;
		}
	}
}

function showChoiceNationalityInfoPreClose() {
	if (currentPage == "introducexsl/introduce_new_customer_edit_ctv") {
		document.removeEventListener("evtSelectionDialogClose", showChoiceNationalityInfoPreClose, false);
		document.removeEventListener("evtSelectionDialog", showChoiceNationalityInfoPre, false);
	}
}

// Fill data for nationality
function showChoiceIncomeInfo(){
	var tmpArray1 = (gUserInfo.lang == 'EN')? CONST_KEY_CHANGE_INFO_INCOME_EN: CONST_KEY_CHANGE_INFO_INCOME_VN;
	var tmpArray2 = CONST_KEY_CHANGE_INFO_INCOME_ID;
	document.addEventListener("evtSelectionDialog",showChoiceIncomeInfoPre, false);
	document.addEventListener("evtSelectionDialogClose", showChoiceIncomeInfoPreClose, false);
	showDialogList(CONST_STR.get('INCOME_BGN_CHOICE'), tmpArray1, tmpArray2 , false);
}

function showChoiceIncomeInfoPre(e) {
	if (currentPage == "introducexsl/introduce_new_customer_edit_ctv") {
		showChoiceIncomeInfoPreClose();
		if ((e.selectedValue1 != undefined) && (e.selectedValue1 != null)) {
			defaultChoice = e.selectedValue1;
			
			var tagAccNo = document.getElementById("id.incomeInfo");
			if (tagAccNo.nodeName == "INPUT") {
				tagAccNo.value = e.selectedValue1;
			}
			else {
				tagAccNo.innerHTML = e.selectedValue1;
			}
		}
		if ((e.selectedValue2 != undefined) && (e.selectedValue2 != null)) {
			incomerId = e.selectedValue2;
		}
	}
}


function showChoiceIncomeInfoPreClose() {
	if (currentPage == "introducexsl/introduce_new_customer_edit_ctv") {
		document.removeEventListener("evtSelectionDialogClose", showChoiceIncomeInfoPreClose, false);
		document.removeEventListener("evtSelectionDialog", showChoiceIncomeInfoPre, false);
	}
}

//event click button send
function sendJSONRequest() {
	isSendReq = false;
	// collect the form data while iterating over the inputs
	var data = {};
	var tmpStr = "";
	var stringInfo= "";
	var arrayArgs = new Array();
	var isValid = true;
	var arrayArgs1 = new Array();
	//arrayArgs.push(gCustomerNo);
	var name = document.getElementById("id.fullName");
	var genderInfo = document.getElementById("id.genderInfo");
	var mobileNumber = document.getElementById("id.mobileNumber");
	var dateOfBirth = document.getElementById("id.dateOfBirth");
	var nationality = document.getElementById("id.nationality");
	var passport = document.getElementById("id.passport");
	var dateOfIssue = document.getElementById("id.dateOfIssue");
	var placeOfIssue = document.getElementById("id.placeOfIssue");
	var homePhone = document.getElementById("id.homePhone");
	var email = document.getElementById("id.email");
	var address = document.getElementById("id.address");
	var company = document.getElementById("id.company");
	var position = document.getElementById("id.position");
	var companyAddress = document.getElementById("id.companyAddress");
	var incomeInfo = document.getElementById("id.incomeInfo");
	var fileUpload01 = document.getElementById("id.fileUpload01");
	
	//Check mobile length 10 - 11 ky tu va bat dau so 0
	if (document.getElementById("id.mobileNumber") != undefined)  
	{
		if (document.getElementById("id.mobileNumber").value.length != 0  
			&& (document.getElementById("id.mobileNumber").value.length < 10 
			|| document.getElementById("id.mobileNumber").value.length > 11 
			|| !document.getElementById("id.mobileNumber").value.lastIndexOf('0', 0) == 0))
		{	
			document.getElementById("id.checkMobile").style.display='';
			document.getElementById("id.lbCheckMobile").innerHTML = CONST_STR.get('K_INTRO_CUSTOMER_INPUT_INVALID_FORMAT');
			isValid = false;
		}
	}
	
	//Check cmnd length 8 - 12 ky tu	
	if (document.getElementById("id.passport") != undefined)  
	{
		if (document.getElementById("id.passport").value.length != 0  
			&& (document.getElementById("id.passport").value.length < 8 
			|| document.getElementById("id.passport").value.length > 12))
		{	
			document.getElementById("id.checkPassport").style.display='';
			document.getElementById("id.lbcheckPassport").innerHTML = CONST_STR.get('K_INTRO_CUSTOMER_INPUT_INVALID_FORMAT');
			isValid = false;
		}
	}	
	
	//Check name
	tmpStr = name.value;
	
	
	if (!validateFunc(tmpStr, gUtiConditions["content"])) {
		
		document.getElementById("id.checkName").style.display = '';
		
	
		document.getElementById("id.lbCheckName").innerHTML = CONST_STR.get('ERR_EMPTY_INPUT');
		
		isValid = false;
	}
	else {
		document.getElementById("id.checkName").style.display = 'none';
	}
	stringInfo += tmpStr+"#";
	
	//check gender
	if(genderId == null || genderId == undefined || genderId == "")
	{
		genderId = document.getElementById("id.introCusSex").value;
	}
	tmpStr = genderId;
	if (!validateFunc(tmpStr, gUtiConditions["gender"])) {
		document.getElementById("id.checkGender").style.display='';
		document.getElementById("id.lbCheckGender").innerHTML = CONST_STR.get('ERR_EMPTY_INPUT');
		isValid = false;
	}
	else {
		document.getElementById("id.checkGender").style.display='none';
	}
	stringInfo += tmpStr+"#";
	
	//Check mobile phone
	tmpStr = mobileNumber.value;
	if (tmpStr.length == 0){
		document.getElementById("id.checkMobile").style.display='';
		document.getElementById("id.lbCheckMobile").innerHTML = CONST_STR.get('ERR_EMPTY_INPUT');
		isValid = false;
	}
	else{
		var curMobileNum = document.getElementById("id.introCusMobile").value;
		if(tmpStr != curMobileNum){
			document.getElementById("id.checkMobile").style.display='none';	
			if (!isCompletedCheckingMobile) {
				//showAlertText("please wait for checking mobile");
				checkMobileValid();
				return;
			//if completed checking passport
			} else if (!isValidMobile) {
				showAlertText(invalidMobileMsg);
				return;
			}
		}
	}
	stringInfo += tmpStr+"#";
	
	//Check date of birth
	tmpStr = dateOfBirth.value;
	var filter = /(((0[1-9]|[12][0-9]|3[01])([//])(0[13578]|10|12)([//])(\d{4}))|(([0][1-9]|[12][0-9]|30)([//])(0[469]|11)([//])(\d{4}))|((0[1-9]|1[0-9]|2[0-8])([//])(02)([//])(\d{4}))|((29)(\.|-|\/)(02)([//])([02468][048]00))|((29)([//])(02)([//])([13579][26]00))|((29)([//])(02)([//])([0-9][0-9][0][48]))|((29)([//])(02)([//])([0-9][0-9][2468][048]))|((29)([//])(02)([//])([0-9][0-9][13579][26])))/;
	if (tmpStr.length < 1)
	{
		document.getElementById("id.checkDateOfBirth").style.display = '';
		document.getElementById("id.lbcheckDateOfBirth").innerHTML = CONST_STR.get('ERR_EMPTY_INPUT');
		isValid = false;
	}
	else {
	/*	if (!filter.test(tmpStr)){
		document.getElementById("id.checkDateOfBirth").style.display = '';
		document.getElementById("id.lbcheckDateOfBirth").innerHTML = CONST_STR.get('ERR_INPUT_EMAIL_VALUE');
		isValid = false;
	    }
	    else{
		    if (!validateFunc(tmpStr, gUtiConditions["date"])){
				//document.getElementById("id.checkDateOfBirth").style.display='';
				//document.getElementById("id.lbcheckDateOfBirth").innerHTML = CONST_STR.get('ERR_INPUT_DATEOFBIRTH');
				
				showAlertText(CONST_STR.get('ERR_INPUT_DATEOFBIRTH'));
				
				isValid = false;
			}
			else {
				document.getElementById("id.checkDateOfBirth").style.display = 'none';
			}
		}*/
			
		if (!checkDate1())
			{
				if(flagdatebirth ==2)
				{
					//alert("e da vao day");
					document.getElementById("id.checkDateOfBirth").style.display = '';
					document.getElementById("id.lbcheckDateOfBirth").innerHTML = CONST_STR.get('ERR_INPUT_EMAIL_VALUE');
					isValid = false;
					}
				if(flagdatebirth ==3)
				{
					document.getElementById("id.checkDateOfBirth").style.display = '';
					document.getElementById("id.lbcheckDateOfBirth").innerHTML = CONST_STR.get('ERR_EMPTY_INPUT');
					isValid = false;
					}
				
				//return false;
			}
			else
			{
				document.getElementById("id.checkDateOfBirth").style.display = 'none';
			}
			if(Kiemtratuoi())
			{
				//alert("e da vao day;Kiemtratuoi");
				}
			else
			{
				//alert("e da vao day;Kiemtratuoi-false");
				document.getElementById("id.checkDateOfBirth").style.display = '';
				document.getElementById("id.lbcheckDateOfBirth").innerHTML = CONST_STR.get('ERR_INPUT_DATEOFBIRTH');
				isValid = false;
				}
		
	}
	stringInfo += tmpStr+"#";
	
	//check nationality
	if(nationalId == null || nationalId == undefined || nationalId == "")
	{
		nationalId = document.getElementById("id.introCusNation").value;
	}
	tmpStr = nationalId;
	if (!validateFunc(tmpStr, gUtiConditions["content"])){
		document.getElementById("id.checkNationality").style.display='';
		document.getElementById("id.lbcheckNationality").innerHTML = CONST_STR.get('ERR_EMPTY_INPUT');
		isValid = false;
	}else{
		document.getElementById("id.checkNationality").style.display='none';
	}
	stringInfo += tmpStr + "#";
	
	//check passport
	tmpStr = passport.value;
	if (!validateFunc(tmpStr, gUtiConditions["mobile"])){
		document.getElementById("id.checkPassport").style.display='';
		document.getElementById("id.lbcheckpp").innerHTML = CONST_STR.get('ERR_EMPTY_INPUT');
		isValid = false;
	}
	else{
		stringInfo += tmpStr+"#";
	}
	
	tmpStr = dateOfIssue.value;
	if (tmpStr.length < 1){
		document.getElementById("id.checkDateOfIssue").style.display='';
		document.getElementById("id.lbcheckDateOfIssue").innerHTML = CONST_STR.get('ERR_EMPTY_INPUT');
		isValid = false;
	}
	else{
		if (!filter.test(tmpStr)){
		document.getElementById("id.checkDateOfIssue").style.display = '';
		document.getElementById("id.lbcheckDateOfIssue").innerHTML = CONST_STR.get('ERR_INPUT_EMAIL_VALUE');
		isValid = false;
	    }
		else{
			document.getElementById("id.checkDateOfIssue").style.display='none';
		}
	}
	stringInfo += tmpStr+"#";
	
 	tmpStr = placeOfIssue.value;
	if (!validateFunc(tmpStr, gUtiConditions["content"])){
		document.getElementById("id.checkPlaceOfIssue").style.display='';
		document.getElementById("id.lbcheckPlaceOfIssue").innerHTML = CONST_STR.get('ERR_EMPTY_INPUT');
		isValid = false;
	}else{
		document.getElementById("id.checkPlaceOfIssue").style.display='none';
	}
	stringInfo += tmpStr+"#";
	
	//check home phone
	tmpStr = homePhone.value;
	stringInfo += tmpStr+"#";

	//check email	
	tmpStr = email.value;
	if (tmpStr.length < 1){
		document.getElementById("id.checkEmail").style.display='';
		document.getElementById("id.lbcheckEmailCTV").innerHTML = CONST_STR.get('ERR_EMPTY_INPUT');
		isValid = false;
	}
	else {
	    var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
		if (!filter.test(tmpStr))		
		{
			document.getElementById("id.checkEmail").style.display='';
			document.getElementById("id.lbcheckEmailCTV").innerHTML = CONST_STR.get('ERR_INPUT_EMAIL_VALUE');
			isValid = false;
		}
		else {
			document.getElementById("id.checkEmail").style.display='none';
		}
	} 			
	stringInfo += tmpStr+"#";
	
	//check anddress
	tmpStr = address.value;
	if (!validateFunc(tmpStr, gUtiConditions["content"])){
		document.getElementById("id.checkAddress").style.display='';
		document.getElementById("id.lbcheckAddress").innerHTML = CONST_STR.get('ERR_EMPTY_INPUT');
		isValid = false;
	}else{
		document.getElementById("id.checkAddress").style.display='none';
	}
	stringInfo += tmpStr+"#";
	
	//check company
	tmpStr = company.value;
	if (!validateFunc(tmpStr, gUtiConditions["content"])){
		document.getElementById("id.checkCompany").style.display='';
		document.getElementById("id.lbcheckCompany").innerHTML = CONST_STR.get('ERR_EMPTY_INPUT');
		isValid = false;
	}else{
		document.getElementById("id.checkCompany").style.display='none';
	}
	stringInfo += tmpStr+"#";
	
	tmpStr = position.value;
	if (!validateFunc(tmpStr, gUtiConditions["content"])){
		document.getElementById("id.checkPosition").style.display='';
		document.getElementById("id.lbcheckPosition").innerHTML = CONST_STR.get('ERR_EMPTY_INPUT');
		isValid = false;
	}else{
		document.getElementById("id.checkPosition").style.display='none';
	}
	stringInfo += tmpStr+"#";
	
	tmpStr = companyAddress.value;
	stringInfo += tmpStr+"#";
	
	// check income
	if(incomerId == null || incomerId == undefined || incomerId == "")
	{
		//alert("em da vao day");
		incomerId = document.getElementById("id.introCusRevenue").value;
	}	
	tmpStr = incomeInfo.value;
	//14: chieu dai cua chu vui long chon
	if (tmpStr.length < 14){
		
		document.getElementById("id.checkIncome").style.display='';
		document.getElementById("id.lbcheckIncome").innerHTML = CONST_STR.get('ERR_EMPTY_INPUT');
		isValid = false;
	}else{
		
		document.getElementById("id.checkIncome").style.display='none';
	}
	stringInfo += incomerId+"#";
	
	tmpStr = fileUpload01.value;
	var checkImage = tmpStr.split('.');
	var checkTypeImage = checkImage[checkImage.length-1];
	if (checkTypeImage != "" && checkTypeImage != "jpg" && checkTypeImage != "png" && checkTypeImage != "JPG" && checkTypeImage != "PNG" ){
		document.getElementById("id.checkFile").style.display='';
		document.getElementById("id.lbCheckFile").innerHTML = CONST_STR.get('ERR_INPUT_EMAIL_VALUE');	
		isValid = false;	
	}
	else{
		document.getElementById("id.checkFile").style.display='none';
	}
	isSendReq = false;
	if(!isValid) {
		return;
	}
	
	//check file image upload
    if ( fileUpload01.files && fileUpload01.files[0] ) {
        var FR = new FileReader();
        FR.onload = function(e) {
         var base64string = e.target.result;
			var nameImg= document.getElementById("id.fileUpload01").value;
			var nameImage = nameImg.split('\\');
			var tmpStr = nameImage[nameImage.length-1];
			stringInfo += tmpStr+"#";
			//cusId			
			var introCusId = document.getElementById("id.introCusId").value;
			stringInfo += introCusId;
			stringInfo += "#" + gCustomerNo;			
			arrayArgs.push(stringInfo); 
		 	var gprsCmd = new GprsCmdObj(CONSTANTS.get("CMD_TYPE_UPDATE_INTRO_CUS"), "", "", gUserInfo.lang, gUserInfo.sessionID,arrayArgs,encodeURIComponent(base64string));
			data = getDataFromGprsCmd(gprsCmd);
			requestMBService(data, true, 0, requestMBServiceSuccess, requestMBServiceFail);
		};
		  FR.readAsDataURL( fileUpload01.files[0] );
	}
	else{
			//Truyen vao tham so khach hang
			stringInfo += ""+"#";
			//cusId			
			var introCusId = document.getElementById("id.introCusId").value;
			stringInfo += introCusId;
			stringInfo += "#" + gCustomerNo;
		 	arrayArgs.push(stringInfo);
		 	var gprsCmd = new GprsCmdObj(CONSTANTS.get("CMD_TYPE_UPDATE_INTRO_CUS"), "", "", gUserInfo.lang, gUserInfo.sessionID,arrayArgs);
			data = getDataFromGprsCmd(gprsCmd);
			requestMBService(data, true, 0, requestMBServiceSuccess, requestMBServiceFail);
	}
	
}
	
//event listener: http request success
function requestMBServiceSuccess(e){   
	gprsResp = parserJSON(e);
	setRespObjStore(gprsResp); //store response
	if ((gprsResp.respCode == '0') && (parseInt(gprsResp.responseType) == parseInt(CONSTANTS.get("CMD_TYPE_UPDATE_INTRO_CUS")))) {
		navController.pushToView('introducexsl/success-introduce-customer-edit', true,'xsl');
	}	
};


//add by anhnn

function checkDate1()
 			 {
  
   			//alert("e da vao day roi nhe");
    		 re = /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/;
    		var _temp1 = document.getElementById("id.dateOfBirth").value;
			//alert("_temp1:"+_temp1);
			//alert("_temp1"+_temp1);
    		if(_temp1 != '') {
				//alert("_temp12"+_temp1);
     		 if(regs = _temp1.match(re)) {
        	//alert("regs[1]:"+regs[1]);
			//alert("regs[2]:"+regs[2]);
			//alert("regs[3]:"+regs[3]);
       		 if(regs[1] < 1 || regs[1] > 31) {
         		 //alert("Sai giá trị ngày: " + regs[1]);
		  		//OpenPopUp('%%K_CARNONAME_DATE_D%%'+regs[1])
				flagdatebirth = 2;
				//alert("flagdatebirth = 2:");
          		return false;
       			 }
       
        	if(regs[2] < 1 || regs[2] > 12) {
         		
				 //OpenPopUp('%%K_CARNONAME_DATE_M%%'+regs[2])
				 flagdatebirth = 2;
				// alert("flagdatebirth32 = 2:");
         		 return false;
       			 }
      
       		
     		 } else {
 				 //OpenPopUp('%%K_CARNONAME_DATE_F%%'+_temp1)
				 flagdatebirth = 2;
				// alert("flagdatebirt2345h = 2:");
         		 return false;     		 }
		
  		  }
		  else
		  {
			  //alert("_temp3"+_temp1);
			  flagdatebirth = 3;
			 // alert("flagdatebirt34634h = 2:");
			  return false;}
	//alert("e toi day roi nhe");
    return true;
  }
  
 function Kiemtratuoi()
  {
	  
	   re = /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/;
    		var _temp1 = document.getElementById("id.dateOfBirth").value;
			
    		if(_temp1 != '') {
     		 if(regs = _temp1.match(re)) {
        
     		 } else {
 				 //OpenPopUp('%%K_CARNONAME_DATE_F%%'+_temp1)
         		 return false;     		 }
  		  }
		  //alert("_temp1:"+_temp1);
		 	var localTime = new Date();
		  	var year= localTime.getFullYear();
			var month= localTime.getMonth();
			var date = localTime.getDate(); 
			//alert("year:"+year);
			if(year - regs[3] < 22)
			{
				 //alert("_temp2:"+year - regs[3]);
				 return false;
				}
			if (year - regs[3] == 22)
				{
					 //alert("_temp3:"+year - regs[3]);
					//neu thang nho hon thang hien tai
					if (regs[2] > month)
					{
						 //alert("_temp4:"+year - regs[3]);
						return false;
						}
					//neu thang bang thang hien tai
					if (regs[2] == month)
					{
						 //alert("_temp5:"+year - regs[3]);
						//neu ngay nho hon ngay hien tai
						if (regs[1] > date)
						{
							//alert("_temp6:"+year - regs[3]);
							return false;
							}
						}
					}
    return true;
	
	  }
	  

//event listener: http request fail
function requestMBServiceFail(){	
};

function isNumberKey(evt){
    var charCode = (evt.which) ? evt.which : event.keyCode
    if (charCode > 31 && (charCode < 48 || charCode > 57))
        return false;
    return true;
}

function checkCusCardNum(currCardNum){	
    var arrayArgsCm = new Array();
    var cardNum = document.getElementById("id.passport");
	if(cardNum != null || cardNum != undefined){
		if(cardNum.value != currCardNum){
			arrayArgsCm.push("QSIDNO");
			arrayArgsCm.push(cardNum.value);
			var gprsCmd = new GprsCmdObj(CONSTANTS.get("SC_CHECK_CUSTOMER"), "", "", gUserInfo.lang, gUserInfo.sessionID, arrayArgsCm);
			data = getDataFromGprsCmd(gprsCmd);
			requestMBService(data, true, 0, requestMBServiceSuccessPassport, requestMBServiceFailPassport);
		}
	}
}

function requestMBServiceSuccessPassport(e){   
	gprsResp = parserJSON(e);
	setRespObjStore(gprsResp); //store response
	if ((gprsResp.respCode == '0') && (parseInt(gprsResp.responseType) == parseInt(CONSTANTS.get("SC_CHECK_CUSTOMER")))) {
		var  gIntroCusManageObjs = new Array();
		 gIntroCusManageObjs = gprsResp.arguments;
		var tempArrStr =  gIntroCusManageObjs[0].split("#");
		if(tempArrStr[0] == "QSIDNO" && tempArrStr[1] != null)
		{
			if (tempArrStr[2] == "2"){
				showAlertText(CONST_STR.get('ERR_PASSPORT_MSG_INTRO'));
		    	return;
			}
			if (tempArrStr[2] == "1"){
				showAlertText(CONST_STR.get('ERR_PASSPORT_MSG_RE'));
		    	return;
			}
		}
		if (isSendReq == true){
			sendJSONRequestCustomer();
			isSendReq = false;
		}
	}		
}

//event listener: http request fail
function requestMBServiceFailPassport(){
	isSendReq = false;
}

//Su dung ham common
function isValidDateCTV(){
	var dateOfBirth = document.getElementById("id.dateOfBirth");
	var tmpStr = dateOfBirth.value;
	return isValidDate(tmpStr);
	/*var checkAge = tmpStr.split("/");
	var currentTime = new Date();
	var month = currentTime.getMonth()+ 1;
	var day = currentTime.getDate();
	var year = currentTime.getFullYear();
	
	if ((year - checkAge[2])*12 + (month - checkAge[1]) < 264){
		return false;
	}
	else{
		if ((year - checkAge[2])*12 + (month - checkAge[1]) == 264){
			if (day < checkAge[0]){
				return false;
			}
		}
		else{
			return true;
		}
	}	*/
}

function checkMobileValid(curMobileNum) {
	isCompletedCheckingMobile = false;
	isValidMobile = false;
	invalidMobileMsg = "";
	
	var arrayArgsMb = new Array();
	var mobileNum = document.getElementById("id.mobileNumber");
	if(mobileNum != null || mobileNum != undefined){
		if(mobileNum.value != curMobileNum){
			arrayArgsMb.push("QSPHONENUM");
			var mobile = document.getElementById("id.mobileNumber");
			arrayArgsMb.push(mobile.value);
			requestBacgroundMBService("SC_CHECK_CUSTOMER", arrayArgsMb, requestMBServiceSuccessMobile, requestMBServiceFailMobile);
		}
	}
}

function requestMBServiceSuccessMobile(e){   
	isCompletedCheckingMobile = true;
	gprsResp = parserJSON(e);
	setRespObjStore(gprsResp); //store response
	if ((gprsResp.respCode == '0') && (parseInt(gprsResp.responseType) == parseInt(15))) {
		var gLoyaltyManageObjs = new Array();
		gLoyaltyManageObjs = gprsResp.arguments;
		var tempArrStr = gLoyaltyManageObjs[0].split("#");
		if(tempArrStr[0] == "QSPHONENUM" && tempArrStr[1] != null)
		{
			if (tempArrStr[2] == "2"){
				invalidMobileMsg = CONST_STR.get('ERR_MOBILE_MSG_INTRO');
				showAlertText(invalidMobileMsg);
		    	return;
			}
			if (tempArrStr[2] == "1"){
				invalidMobileMsg = CONST_STR.get('ERR_MOBILE_MSG_RE');
				showAlertText(invalidMobileMsg);
		    	return;
			}
		} 
		isValidMobile = true;
		if (isSendReq == true){
			sendJSONRequestCustomer();
			isSendReq = false;
		}
	}		
}

//event listener: http request fail
function requestMBServiceFailMobile(){
	isCompletedCheckingMobile = true;
	invalidMobileMsg = "Không thực hiện được giao dịch";
	//navController.initWithRootView('accountxsl/account-scr');	
	var tmpPageName = navController.getDefaultPage();
	var tmpPageType = navController.getDefaultPageType();
	navController.initWithRootView(tmpPageName, true, tmpPageType);
	isSendReq = false;
}
/*upload file*/
function fnChange(obj) {
	var objTmp = document.getElementById("btnFile");
	if(obj.value.trim().length > 0)  {
	objTmp.value = obj.value;
	} else {
		objTmp.value = '';
	}

}