
require=function e(t,a,r){function s(i,o){if(!a[i]){if(!t[i]){var l="function"==typeof require&&require;if(!o&&l)return l(i,!0);if(n)return n(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var d=a[i]={exports:{}};t[i][0].call(d.exports,function(e){var a=t[i][1][e];return s(a?a:e)},d,d.exports,e,t,a,r)}return a[i].exports}for(var n="function"==typeof require&&require,i=0;i<r.length;i++)s(r[i]);return s}({4:[function(e,t,a){"use strict";var r=e("../core/tips"),s=e("../core/feed"),n=e("../core/search");window.feed=s,window.search=n,r.init()},{"../core/feed":97,"../core/search":100,"../core/tips":101}],101:[function(e,t,a){"use strict";var r=e("babel-runtime/core-js/object/keys")["default"],s=e("react/addons"),n=e("jquery"),i=e("../core/i18n"),o=e("../components/tips/Tip"),l=null,c={tipsOnLoad:{playerfocus:!0},init:function(){try{var e=null;for(var t in c.tipsOnLoad)if(c.tipsOnLoad.hasOwnProperty(t)&&c.tipsOnLoad[t]===!0){if(e=c.load(t),c.check(e))break;e=null}Events.subscribe(Events.tips.close,function(e,t){c.close(t)}),Events.subscribe(Events.tips.draw,function(e,t){"string"==typeof t?c.draw(t):"object"==typeof t&&c.draw(t.name,t.check)}),Events.ready(Events.player.playerReady,function(){Events.subscribeOnce(Events.player.displayCurrentSong,function(){setTimeout(function(){null!==e&&e.hasOwnProperty("active")&&e.active===!0&&d.draw(e)},500)},"tips")},"tips"),p.init()}catch(a){error.log(a)}},load:function(e){return(e=d.element[e]||function(){return{}})()},check:function(e){return e.hasOwnProperty("active")&&e.active===!0&&"function"==typeof e.trigger&&e.trigger()===!0},draw:function(e,t){t=t||!1,e=c.load(e),t===!0&&!c.check(e)||null!==l||d.draw(e)},close:function(e){try{l=null;var t=document.getElementById(d.overlayName);null!==t&&document.body.removeChild(t);var a=c.load(e);if(a.hasOwnProperty("name")){var r=document.getElementById("tips_"+a.name);null!==r&&document.body.removeChild(r)}Events.unsubscribeAll("tips"),a.hasOwnProperty("overlay")&&a.overlay.hasOwnProperty("className")&&n("body").removeClass("has-focus "+a.overlay.className)}catch(s){error.log(s)}}},d={overlayName:"tips-overlay",draw:function(e){try{var t,a=e.name;if(l=a,"undefined"==typeof d.element[a])return!1;"function"==typeof e.callback&&e.callback(),"object"==typeof e.overlay&&(t=document.createElement("div"),t.id=d.overlayName,t.className=d.overlayName,t.style.display="none",document.body.appendChild(t).addEventListener("click",function(){c.close(a)}),n("body").addClass("has-focus "+e.overlay.className));var i=document.createElement("div");i.id="tips_"+a,i.className="tips",i.style.visibility="hidden",document.body.appendChild(i),s.render(s.createElement(o,e),document.getElementById("tips_"+a),function(){if(e.hasOwnProperty("user_settings")){var a={};r(e.user_settings).map(function(t){a[t]=e.user_settings[t]}),userSetting.set({tips:a})}e.hasOwnProperty("tracking")&&tracking.track(e.tracking.key,{context:e.tracking.context}),this.setPosition(e,i),"undefined"!=typeof t&&(t.style.display="block"),i.style.visibility="visible"}.bind(this))}catch(p){error.log(p)}},setPosition:function(e,t){if("function"==typeof e.style){var a=e.style();for(var r in a)a.hasOwnProperty(r)&&(t.style[r]=a[r]);USER.OPTIONS.ads_display&&Events.subscribeOnce(Events.layout.adsBanner,function(){this.setPosition(e,t)}.bind(this),"tips")}},element:{playlist_assistant:function(){return{active:!0,name:"playlist_assistant",title:i.gettext("Rajoutez des titres à votre playlist !"),body:i.gettext("Besoin d'inspiration ? On vous recommande des titres à ajouter à votre playlist."),closeBtn:!0,direction:"right-bottom",user_settings:{playlist_assistant:!1},overlay:{className:"has-focus-playlist-assistant"},trigger:function(){return Boolean(USER.SETTING.tips.playlist_assistant)},style:function e(){var t=document.getElementById("naboo_datagrid_add_track"),e={top:t.getBoundingClientRect().top-t.getBoundingClientRect().height/2+"px",left:t.getBoundingClientRect().left+t.getBoundingClientRect().width+6+"px"};return e}}},playlist_assistant_suggest:function(){return{active:!0,name:"playlist_assistant_suggest",title:i.gettext("Vous avez compris le principe ?"),body:i.gettext('Vous pouvez stopper à tout moment. Il suffit de cliquer sur "Terminé !".'),closeBtn:!0,user_settings:{playlist_assistant_suggest:!1},trigger:function(){return Boolean(USER.SETTING.tips.playlist_assistant_suggest)},style:function e(){var t=document.getElementById("modal_playlist_assistant_submit"),a=document.getElementById("tips_playlist_assistant_suggest"),e={"z-index":8e3,top:t.getBoundingClientRect().top+1.5*t.getBoundingClientRect().height-a.getBoundingClientRect().height+"px",left:t.getBoundingClientRect().left+t.getBoundingClientRect().width+10+"px"};return e}}},playerfocus:function(){return{active:!0,name:"playerfocus",play:!0,body:i.gettext("Écoutez vite la musique que vous avez choisie !"),closeBtn:!0,direction:"right",tracking:{key:"onboarding_feed_display",context:"onboarding"},overlay:{className:"has-focus-player"},user_settings:{player:!1},callback:function(){Events.ready(Events.user.userReady,function(){var e=userData.data;return"undefined"==typeof e.FAVORITES_ARTISTS.data[0]?void userData.loadData("genre"):void dzPlayer.play({type:"artist",id:e.FAVORITES_ARTISTS.data[0].ART_ID,autoplay:!1})}),Events.subscribeOnce(Events.user.userLoadData,function(e,t){if("genre"===t.type){var a=userData.data.FAVORITES_GENRES.data;"undefined"!=typeof a[0]&&api.call({method:"deezer.pageTops",data:{nb:1,type:"track",genre_id:a[0].GENRE_ID},success:function(e){"undefined"!=typeof e.ITEMS.data[0]&&dzPlayer.play({type:"track",id:[e.ITEMS.data[0].SNG_ID],autoplay:!1})}})}})},trigger:function(){return Boolean(USER.SETTING.tips.player)},style:function e(){var t=document.getElementById("player-cover"),a=document.getElementById("tips_"+this.name);if(null===t)return c.close(this.name),{};var r=t.getBoundingClientRect(),s=a.getBoundingClientRect(),e={top:r.top+s.height/2-8+"px"};return e.left="rtl"===window.DIRECTION?r.left-s.width-15+"px":r.left+r.width+15+"px",e}}},flow:function(){return{active:!0,name:"flow",title:i.gettext("Toute la musique que vous avez envie d'écouter"),body:i.gettext("Votre Flow : un mix basé sur vos goûts, qui s'adapte continuellement à vous. "),direction:"bottom-right",overlay:{className:"has-focus-flow"},user_settings:{flow:!1},trigger:function(){var e=document.getElementById("flow_content");return Boolean(USER.SETTING.tips.flow&&e)},style:function e(){var t=document.getElementById("flow-love");if(null===t)return c.close(this.name),{};var a=t.childNodes[0].getBoundingClientRect(),e={top:a.top+a.height+20+"px",left:a.left+4+"px"};return e}}},lyrics:function(){return{active:!0,name:"lyrics",title:i.gettext("Vous avez repéré le micro ?"),body:i.gettext("Les paroles sont disponibles, cliquez et commencez à chanter."),direction:"right-top",overlay:{className:"has-focus-lyrics"},user_settings:{lyrics:0},trigger:function(){return USER.SETTING.tips.lyrics<=0?!1:0===dzPlayer.getCurrentSong("LYRICS_ID")?!1:USER.SETTING.tips.lyrics>1?(userSetting.set({tips:{lyrics:Math.round(USER.SETTING.tips.lyrics-1)}}),!1):!0},style:function e(){var t=document.getElementById("player-lyrics"),a=document.getElementById("tips_lyrics");if(null===t)return c.close(this.name),{};var r=t.getBoundingClientRect(),s=a.getBoundingClientRect(),e={top:r.top-s.height+42+"px"};return e.left="rtl"===window.DIRECTION?r.left-s.width-15+"px":r.left+r.width+15+"px",e}}},add_to_library:function(){return{active:!0,name:"add_to_library",title:"",body:"",direction:"bottom",overlay:{className:"has-focus-add-library"},user_settings:{add_to_library:!1},callback:function(){var e=naboo.getCurrentClass(),t=window[e].data;"playlist"===e?(this.title=i.gettext("Vous avez envie de retrouver cette playlist ?"),this.body=i.gettext("Ajoutez-la à votre bibliothèque, vous pouvez la réécouter à tout moment.")):"album"===e?(this.title=i.gettext("%1$s vous a plu ?",{sprintf:[t.ALB_TITLE]}),this.body=i.gettext("Vous aimez, vous nous le dites, il est directement ajouté à vos favoris.")):"artist"===e&&(this.title=i.gettext("Envie d'écouter %1$s plus tard ?",{sprintf:[t.DATA.ART_NAME]}),this.body=i.gettext("Retrouvez vos artistes préférés rapidement en les ajoutant à vos favoris."))},trigger:function(){var e=naboo.getCurrentClass();if("object"!=typeof window[e])return!1;var t=window[e].id;if(0===t||!e.match(/^(playlist|album|artist)$/i))return!1;if(userData.isFavorite(e,t))return!1;var a=document.getElementById("add_to_library");return a&&USER.SETTING.tips.add_to_library!==!1?!0:!1},style:function e(){var t=document.getElementById("add_to_library"),a=document.getElementById("tips_"+this.name);if(null===t)return c.close(this.name),{};var r=t.getBoundingClientRect(),s=a.getBoundingClientRect(),e={top:r.top+r.height+15+"px",left:r.left-s.width/2+42+"px"};return e}}}}},p={init:function(){USER.SETTING.tips.flow===!0&&Events.ready(Events.flow.playerDisplay,function(){setTimeout(function(){c.draw("flow",!0)},1e3)}),USER.SETTING.tips.lyrics>0&&Events.subscribe(Events.player.play,function(){setTimeout(function(){c.draw("lyrics",!0)},1e3)},"tips"),USER.SETTING.tips.add_to_library===!0&&Events.subscribe(Events.navigation.page_displayed,function(){setTimeout(function(){c.draw("add_to_library",!0)},1e3)})}};t.exports=c},{"../components/tips/Tip":95,"../core/i18n":98,"babel-runtime/core-js/object/keys":103,jquery:"jquery","react/addons":"react/addons"}],95:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("../../core/i18n"),n=r.createClass({displayName:"Tip",propTypes:{name:r.PropTypes.string,title:r.PropTypes.string,body:r.PropTypes.string.isRequired,play:r.PropTypes.bool,closeBtn:r.PropTypes.bool,direction:r.PropTypes.string},getDefaultProps:function(){return{title:"",play:!1,closeBtn:!1,direction:"right-top"}},componentDidMount:function(){this.props.play===!0&&Events.subscribeOnce(Events.player.play,this._close)},componentWillUnmount:function(){this.props.play===!0&&Events.unsubscribe(Events.player.play)},render:function(){return r.createElement("div",{className:"popover popover-"+this.props.direction,role:"dialog","aria-labelledby":"tipTitle","aria-describedby":"tipBody"},this.props.closeBtn===!0?r.createElement("a",{className:"popover-close",role:"button",onClick:this._close},r.createElement("span",{className:"icon icon-cancel"})):null,r.createElement("div",{className:"popover-body"},""!==this.props.title?r.createElement("div",{className:"popover-header",id:"tipTitle"},this.props.title):null,r.createElement("p",{className:"highlight",id:"tipBody"},this.props.body),r.createElement("a",{className:"btn btn-primary btn-block",role:"button",onClick:this.props.play===!0?this._play:this._close},r.createElement("span",{className:"label"},s.gettext(this.props.play===!0?"Écouter maintenant":"J'ai compris")))))},_close:function(){Events.trigger(Events.tips.close,this.props.name)},_play:function(){dzPlayer.control.play()}});t.exports=n},{"../../core/i18n":98,"react/addons":"react/addons"}],100:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("jquery"),n=e("../core/i18n"),i=e("../components/search/Search"),o={query:"",template_noresult:"naboo/noresult",containers:{album:"search_page_albums",artist:"search_page_artists",track:"search_page_tracks"},display:function(e){o.fetch(e,function(e,t){return e?error.log(e):void Events.trigger(Events.search.loaded,t)})},leave:function(){r.unmountComponentAtNode(document.getElementById("naboo_content"))},fetch:function(e,t){if(o.query=window.encodeHTMLEntities(decodeURIComponent(e.query)),e.data===Object(e.data))return setTimeout(t.bind(this,null,e.data),0);if(!o.query)return setTimeout(t(new Error("Missing query parameter")),0);try{var a=e.tags?"deezer.tagSearch":"deezer.pageSearch";api.call({method:a,data:{query:o.query,start:0,nb:40,suggest:!0,artist_suggest:!0,top_tracks:!0},error:t,success:t.bind(this,null)})}catch(r){var s="string"==typeof r?new Error(r):r;setTimeout(t(s),0)}return!0},render:function(e,t){return Events.subscribeOnce(Events.layout.adsBackground,o.resizeCover,"search"),t.TRACK.count||t.ARTIST.count||t.ALBUM.count||t.PLAYLIST.count?(t.tab=o._tabName||"all",t.TRACK.count||t.ARTIST.count||t.ALBUM.count||(t.tab="playlist"),r.render(r.createElement(i,t),document.getElementById("naboo_content")),void naboo.afterLoad(!0)):t.TRACK_SUGGEST||t.ARTIST_SUGGEST||t.ALBUM_SUGGEST||t.PLAYLIST_SUGGEST?o.renderEmptyResults(t):o.renderEmptyResults(t,!1,!0)},renderEmptyResults:function(e,t,a){try{t=Boolean(t),a=Boolean(a),templating.load(o.template_noresult);var r=t?"":"_SUGGEST",i={albums:e["ALBUM"+r]?e["ALBUM"+r].data:[],artists:e["ARTIST"+r]?e["ARTIST"+r].data:[],tracks:e["TRACK"+r]?e["TRACK"+r].data:[]};if(i.total=i.albums.length+i.artists.length+i.tracks.length,0===i.total||a===!0)return t===!0?!1:api.call("deezer.pageTops",{genre_id:0,type:"all"},function(e){e=e.ITEMS;var t={};for(var a in e)e.hasOwnProperty(a)&&(t[a.toUpperCase()]=e[a]);return o.renderEmptyResults(t,!0)});s("#search_noresult_query").html(n.gettext("Aucun résultat pour «<strong>%s</strong>»",{sprintf:[" "+o.query+" "]})),s("#search_noresult_looking").text(n.gettext(t===!0?"Découvrez ce qui cartonne sur Deezer en ce moment :":"Essayez donc ceci :"));for(var l in o.containers)if(o.containers.hasOwnProperty(l)){var c=document.getElementById(o.containers[l]);null!==c&&(c.innerHTML="",s(c.parentNode.firstElementChild).hasClass("heading-2")&&c.parentNode.removeChild(c.parentNode.firstElementChild),c.style.display="none",o.appendCover(c,l,i[l+"s"]))}return tracking.track("search_results",{query:o.query,total_result:t||a?0:i.total}),naboo.afterLoad(!0),!0}catch(d){error.log(d)}},resizeCover:function(){for(var e in o.containers)if(o.containers.hasOwnProperty(e)){var t=document.getElementById(o.containers[e]);null!==t&&(t=s(t),t.responsiveCover_update()&&o.createCover(t,e))}},appendCover:function(e,t,a){if(!a||0===a.length||"undefined"==typeof t)return!1;var r={artist:!0,album:!0,track:!0};if("undefined"==typeof r[t])return!1;if(e=s(e).show(),0===e.length)return!1;var i=Handlebars.templates["common_"+t],l={data:a,play_context:"search_"+(t+"s")};"artist"===t&&(l.trad_nb_fan=n.gettext("fan")),e.append(i(l));var c;c="artist"===t?n.ngettext("Artiste","Artistes",{count:a.length}):"album"===t?n.ngettext("Album","Albums",{count:a.length}):n.ngettext("Titre","Titres",{count:a.length});var d='<h3 class="heading-2">'+c+"</h3>";d=s(d),d.insertBefore(e),o.createCover(e,t)},createCover:function(e,t){e.responsiveCover({cover_width:250,cover_height:"artist"===t?320:250,gap:15,max_line:1})},getAdsArgs:function(){return{element_id:"ALL",element_data:o.query}}};Events.subscribe(Events.search.loaded,o.render),t.exports=o},{"../components/search/Search":85,"../core/i18n":98,jquery:"jquery","react/addons":"react/addons"}],85:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("../../core/i18n"),n=e("./_elements/Header"),i=e("./_elements/Suggest"),o=e("./_elements/NavBar"),l=e("./_elements/DataGrid"),c=e("../common/grid/Grid"),d=r.createClass({displayName:"Search",propTypes:{tab:r.PropTypes.string,QUERY:r.PropTypes.string.isRequired,TRACK:r.PropTypes.object.isRequired,ARTIST:r.PropTypes.object.isRequired,ALBUM:r.PropTypes.object.isRequired,PLAYLIST:r.PropTypes.object.isRequired,SHOW:r.PropTypes.object.isRequired,TAG:r.PropTypes.array,FILTER:r.PropTypes.string},getDefaultProps:function(){return{tab:"all",allFilled:!0,artistFilled:!1,albumFilled:!1,playlistFilled:!1,showlistFilled:!1,FILTER:"all",TAG:[]}},getInitialState:function(){return this.props.ARTIST.total=Math.min(this._maxResults,this.props.ARTIST.total),this.props.ALBUM.total=Math.min(this._maxResults,this.props.ALBUM.total),this.props.PLAYLIST.total=Math.min(this._maxResults,this.props.PLAYLIST.total),this.props.SHOW.total=Math.min(this._maxResults,this.props.SHOW.total),{query:this.props.QUERY,tab:this.props.tab,track:this.props.TRACK,artist:this.props.ARTIST,album:this.props.ALBUM,playlist:this.props.PLAYLIST,show:this.props.SHOW,tag:this.props.TAG,allFilled:!0,artistFilled:!1,albumFilled:!1,playlistFilled:!1}},componentWillReceiveProps:function(e){e.ARTIST.total=Math.min(this._maxResults,e.ARTIST.total),e.ALBUM.total=Math.min(this._maxResults,e.ALBUM.total),e.PLAYLIST.total=Math.min(this._maxResults,e.PLAYLIST.total),e.SHOW.total=Math.min(this._maxResults,e.SHOW.total),this.setState({query:e.QUERY,tab:e.tab,track:e.TRACK,artist:e.ARTIST,album:e.ALBUM,playlist:e.PLAYLIST,show:e.SHOW,tag:e.TAG||[]})},render:function(){var e=[{id:"all",label:s.gettext("Tout"),action:this._onTabClick},{id:"artist",label:s.gettext("Artistes"),action:this._onTabClick},{id:"album",label:s.gettext("Albums"),action:this._onTabClick},{id:"playlist",label:s.gettext("Playlists"),action:this._onTabClick},{id:"show",label:s.gettext("Podcasts"),action:this._onTabClick}],t={minHeight:document.querySelector("#page_content").offsetHeight+70+324};return r.createElement("div",{className:"page-naboo-search",id:"page_naboo_search",style:t},r.createElement(n,{ref:"header",query:this.state.query,tags:this.state.tag,filter:this.props.FILTER}),r.createElement(o,{ref:"navbar",items:e,active:this.state.tab}),this._renderTabContent())},_onTabClick:function(e){this._changeTab(e.id)},_maxResults:40,_renderTabContent:function(){if(this._loadTab(this.state.tab),"all"===this.state.tab)return[r.createElement(i,{key:"suggest",artist:this.state.artist,album:this.state.album,playlist:this.state.playlist,shows:this.state.show,onTitleClick:this._changeTab}),r.createElement(l,{key:"tracklist",track:this.state.track,query:this.state.query})];var e,t=this.state[this.state.tab].total,a={artist:s.ngettext("Artiste","Artistes",{count:t}),album:s.ngettext("Album","Albums",{count:t}),playlist:s.ngettext("Playlist","Playlists",{count:t}),show:s.ngettext("Podcast","Podcasts",{count:t})};switch(this.state.tab){case"artist":e=r.createElement(c,{data:this.state.artist.data,options:["name","fans","favorite"]});break;case"album":e=r.createElement(c,{data:this.state.album.data,options:["name","artist","favorite"],context:"search_album"});break;case"playlist":e=r.createElement(c,{data:this.state.playlist.data,options:["name","favorite"],context:"search_playlist"});break;case"show":e=r.createElement(c,{data:this.state.show.data,options:["title","name","favorite"],context:"search_show"})}return r.createElement("div",{className:"search-results"},r.createElement("h2",{className:"heading-2","data-target":"title-"+this.state.tab+"s","data-total":"0"},r.createElement("span",{className:"color-primary"},t)," ",a[this.state.tab]),e)},_changeTab:function(e){this.setState({tab:e})},_loadTab:function(e){this.state[e+"Filled"]||this._fetchTabData(e,function(t,a){if(t)return error.log(t);var r={};a.total=Math.min(this._maxResults,a.total),r[e]=a,r[e+"Filled"]=!0,this.setState(r)}.bind(this))},_fetchTabData:function(e,t){api.call({method:"search.music",data:{query:this.state.query,filter:this.props.FILTER,output:e.toUpperCase(),start:0,nb:this._maxResults},error:t,success:t.bind(this,null)})}});t.exports=d},{"../../core/i18n":98,"../common/grid/Grid":34,"./_elements/DataGrid":86,"./_elements/Header":87,"./_elements/NavBar":88,"./_elements/Suggest":89,"react/addons":"react/addons"}],89:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("../../../core/i18n"),n=e("./suggest/Column"),i=r.createClass({displayName:"Suggest",propTypes:{artist:r.PropTypes.object,album:r.PropTypes.object,playlist:r.PropTypes.object,shows:r.PropTypes.object,onTitleClick:r.PropTypes.func,limit:r.PropTypes.number},getDefaultProps:function(){return{artist:{data:[],length:0},album:{data:[],length:0},playlist:{data:[],length:0},limit:USER.OPTIONS.mobile_offline?2:1}},render:function(){if(this.props.artist.data.length+this.props.album.data.length+this.props.playlist.data.length===0)return null;var e=0;return["artist","album","playlist","shows"].forEach(function(t){this.props[t].data.length>0&&e++}.bind(this)),r.createElement("div",{className:"search-suggest clearfix"},r.createElement(n,{key:"artist",title:s.ngettext("Artiste","Artistes",{count:this.props.artist.total}),onTitleClick:this.props.onTitleClick,items:this.props.artist.data,count:this.props.artist.total,limit:this.props.limit}),r.createElement(n,{key:"album",title:s.ngettext("Album","Albums",{count:this.props.album.total}),onTitleClick:this.props.onTitleClick,items:this.props.album.data,count:this.props.album.total,limit:this.props.limit}),r.createElement(n,{key:"playlist",title:s.ngettext("Playlist","Playlists",{count:this.props.playlist.total}),onTitleClick:this.props.onTitleClick,items:this.props.playlist.data,count:this.props.playlist.total,limit:this.props.limit}),3>=e?r.createElement(n,{key:"shows",title:s.ngettext("Podcast","Podcasts",{count:this.props.shows.total}),onTitleClick:this.props.onTitleClick,items:this.props.shows.data,count:this.props.shows.total,limit:this.props.limit}):"")}});t.exports=i},{"../../../core/i18n":98,"./suggest/Column":92,"react/addons":"react/addons"}],92:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("classnames"),n=e("./Artist"),i=e("./Album"),o=e("./Playlist"),l=e("./Show"),c=r.createClass({displayName:"Column",propTypes:{title:r.PropTypes.string,onTitleClick:r.PropTypes.func,items:r.PropTypes.array,count:r.PropTypes.number,limit:r.PropTypes.number},getDefaultProps:function(){return{title:"",items:[],count:0,limit:2}},getInitialState:function(){return{type:this.props.items.length?this.props.items[0].__TYPE__:""}},componentWillReceiveProps:function(e){this.setState({type:e.items.length?e.items[0].__TYPE__:""})},render:function(){if(!this.props.items.length)return null;var e=s({"suggest-column":!0,"column-artists":"artist"===this.state.type,"column-albums":"album"===this.state.type,"column-playlists":"playlist"===this.state.type});return r.createElement("dl",{className:e},r.createElement("dt",{className:"suggest-title"},r.createElement("a",{onClick:this._onTitleClick,"data-type":this.state.type},r.createElement("span",{className:"color-primary"},this.props.count)," ",this.props.title,r.createElement("span",{className:"icon icon-arrow-right-long"}))),this._renderItems())},_renderItems:function(){for(var e,t=[],a=0;a<this.props.limit;a++)if("undefined"==typeof this.props.items[a])t.push(r.createElement("dd",{className:"nano-card-item invisible","aria-hidden":"true",key:"blank_"+a}));else switch(e=this.props.items[a],e.__TYPE__){case"artist":t.push(r.createElement(n,{data:e,key:e.__TYPE__+e.ART_ID}));break;case"album":t.push(r.createElement(i,{data:e,key:e.__TYPE__+e.ALB_ID}));break;case"playlist":t.push(r.createElement(o,{data:e,key:e.__TYPE__+e.PLAYLIST_ID}));break;case"show":t.push(r.createElement(l,{data:e,key:e.__TYPE__+e.SHOW_ID}));break;default:error.log(new Error('Unknown "'+e.__TYPE__+'" item type'))}return t},_onTitleClick:function(e){"function"==typeof this.props.onTitleClick&&this.props.onTitleClick(e.currentTarget.getAttribute("data-type"))}});t.exports=c},{"./Album":90,"./Artist":91,"./Playlist":93,"./Show":94,classnames:"classnames","react/addons":"react/addons"}],94:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("../../../common/Thumbnail"),n=r.createClass({displayName:"Show",propTypes:{data:r.PropTypes.object.isRequired},render:function(){return r.createElement("dd",{className:"nano-card-item"},r.createElement("div",{className:"nano-card-picture"},r.createElement(s,{id:Number(this.props.data.SHOW_ID),type:"show",picture_type:"talk",md5:this.props.data.SHOW_ART_MD5,height:110,width:110,height_img:120,width_img:120,context:"search_show",play:!0,play_link:!0})),r.createElement("aside",{className:"nano-card-info"},r.createElement("h2",{className:"heading-4 ellipsis"},r.createElement("a",{className:"evt-click",href:"/show/"+this.props.data.SHOW_ID,"data-instance":"show_name"},this.props.data.SHOW_NAME))))}});t.exports=n},{"../../../common/Thumbnail":33,"react/addons":"react/addons"}],93:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("../../../common/Thumbnail"),n=e("../../../../core/i18n"),i=r.createClass({displayName:"Playlist",propTypes:{data:r.PropTypes.object.isRequired},render:function(){return r.createElement("dd",{className:"nano-card-item"},r.createElement("div",{className:"nano-card-picture"},r.createElement(s,{id:Number(this.props.data.PLAYLIST_ID),type:"playlist",md5:this.props.data.PLAYLIST_PICTURE,picture_type:this.props.data.PICTURE_TYPE,height:110,width:110,height_img:180,width_img:180,context:"search_playlist",play:!0,preview:!0,play_link:!0,multi_cover:!0,overlay:!1})),r.createElement("aside",{className:"nano-card-info"},r.createElement("h2",{className:"heading-4 ellipsis"},r.createElement("a",{className:"evt-click",href:"/playlist/"+this.props.data.PLAYLIST_ID,"data-instance":"playlist_name"},this.props.data.TITLE)),this._renderInfos()))},_renderInfos:function(){return this.props.data.PARENT_USER_ID!==window.USER.USER_ID?r.createElement("h3",{className:"heading-4-sub ellipsis"},n.gettext("par")+" ",r.createElement("a",{className:"evt-click",href:"/profile/"+this.props.data.PARENT_USER_ID,"data-instance":"user_name"},this.props.data.PARENT_USERNAME)," - ",this.props.data.NB_SONG+" "+n.ngettext("titre","titres",{count:this.props.data.NB_SONG})):r.createElement("h3",{className:"heading-4-sub ellipsis"},this.props.data.NB_SONG+" "+n.ngettext("titre","titres",{count:this.props.data.NB_SONG}))}});t.exports=i},{"../../../../core/i18n":98,"../../../common/Thumbnail":33,"react/addons":"react/addons"}],91:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("../../../common/Thumbnail"),n=e("../../../../core/i18n"),i=r.createClass({displayName:"Artist",propTypes:{data:r.PropTypes.object.isRequired},render:function(){return r.createElement("dd",{className:"nano-card-item"},r.createElement("div",{className:"nano-card-picture"},r.createElement(s,{id:Number(this.props.data.ART_ID),type:"artist",md5:this.props.data.ART_PICTURE,height:110,width:86,height_img:320,width_img:250,overlay:!1})),r.createElement("aside",{className:"nano-card-info"},r.createElement("h2",{className:"heading-4 ellipsis"},r.createElement("a",{className:"evt-click",href:"/artist/"+this.props.data.ART_ID},this.props.data.ART_NAME)),r.createElement("h3",{className:"heading-4-sub ellipsis"},window.breakUpThousands(this.props.data.NB_FAN)," ",n.ngettext("fan","fans",{count:this.props.data.NB_FAN}))))}});t.exports=i},{"../../../../core/i18n":98,"../../../common/Thumbnail":33,"react/addons":"react/addons"}],90:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("../../../common/Thumbnail"),n=e("../../../../core/i18n"),i=r.createClass({displayName:"Album",propTypes:{data:r.PropTypes.object.isRequired},render:function(){return r.createElement("dd",{className:"nano-card-item"},r.createElement("div",{className:"nano-card-picture"},r.createElement(s,{id:Number(this.props.data.ALB_ID),type:"album",md5:this.props.data.ALB_PICTURE,height:110,width:110,height_img:120,width_img:120,context:"search_album",play:!0,preview:!0,overlay:!1})),r.createElement("aside",{className:"nano-card-info"},r.createElement("h2",{className:"heading-4 ellipsis"},r.createElement("a",{className:"evt-click",href:"/album/"+this.props.data.ALB_ID,"data-instance":"album_name"},this.props.data.ALB_TITLE)),r.createElement("h3",{className:"heading-4-sub ellipsis"},n.gettext("par")+" ",r.createElement("a",{className:"evt-click",href:"/artist/"+this.props.data.ART_ID,"data-instance":"artist_name"},this.props.data.ART_NAME))))}});t.exports=i},{"../../../../core/i18n":98,"../../../common/Thumbnail":33,"react/addons":"react/addons"}],88:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("classnames"),n=r.createClass({displayName:"NavBar",propTypes:{items:r.PropTypes.arrayOf(r.PropTypes.shape({id:r.PropTypes.string.isRequired,action:r.PropTypes.oneOfType([r.PropTypes.string,r.PropTypes.func]).isRequired,label:r.PropTypes.string.isRequired})).isRequired,active:r.PropTypes.string},render:function(){return r.createElement("div",{className:"search-navbar"},r.createElement("nav",{className:"navbar"},r.createElement("ul",{className:"navbar-nav"},this._renderItems())))},_renderItems:function(){for(var e,t,a=[],n=0,i=this.props.items.length;i>n;n++)e=this.props.items[n],t=s({active:this.props.active===e.id}),a.push(r.createElement("li",{key:e.id,className:t},"string"==typeof e.action?r.createElement("a",{href:this.props.items[n].action},e.label):r.createElement("a",{onClick:this._onItemClick.bind(this,e)},e.label)));return a},_onItemClick:function(e){e.action(e)}});t.exports=n},{classnames:"classnames","react/addons":"react/addons"}],87:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("../../../core/i18n"),n=e("../../common/TagList"),i=r.createClass({displayName:"Header",propTypes:{filter:r.PropTypes.string.isRequired,query:r.PropTypes.string.isRequired,tags:r.PropTypes.array.isRequired},render:function(){if("TAG"===this.props.filter){var e=[];return this.props.query.split(" ").map(function(t){e.push({LABEL:"#"+t,selected:!0})}),r.createElement("div",{className:"search-header"},r.createElement(n,{tags:e,selected:!0,min:1,showLabel:!0}),r.createElement(n,{tags:this.props.tags,query:this.props.query,showLabel:!0}))}var t=s.gettext("Résultats de recherche pour «<strong>%s</strong>»",{sprintf:[this.props.query]});return r.createElement("div",{className:"search-header"},r.createElement("h1",{className:"heading-1 ellipsis",dangerouslySetInnerHTML:{__html:t}}))}});t.exports=i},{"../../../core/i18n":98,"../../common/TagList":32,"react/addons":"react/addons"}],86:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("jquery"),n=r.createClass({displayName:"DataGrid",propTypes:{query:r.PropTypes.string.isRequired,track:r.PropTypes.shape({count:r.PropTypes.number.isRequired,total:r.PropTypes.number.isRequired,no_fuzzy_count:r.PropTypes.number,data:r.PropTypes.array.isRequired})},componentDidMount:function(){this._createDatagrid()},componentDidUpdate:function(){this._createDatagrid()},componentWillUnmount:function(){this._destroyDatagrid()},componentWillUpdate:function(){this._destroyDatagrid()},render:function(){return this.props.track.total?r.createElement("div",{ref:"datagrid",className:"search-datagrid"}):null},_createDatagrid:function(){var e=this.refs.datagrid&&s(this.refs.datagrid.getDOMNode());e&&e.createDatagrid({type:"search",id:this.props.query,songs:this.props.track})},_destroyDatagrid:function(){var e=this.refs.datagrid&&s(this.refs.datagrid.getDOMNode());e&&(Events.unsubscribeAll(e.getData("event_group")),e.destroy())}});t.exports=n},{jquery:"jquery","react/addons":"react/addons"}],97:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("jquery"),n=e("./i18n"),i=e("../components/flow/Header"),o={id:0,template:"naboo/feed",card_id:0,nb_card:10,unread:0,loadComplete:!1,initialized:!1,ads_position:0,non_displayed_cards:{},waveform_id:[],current_yscroll:0,current_play_sng_id:0,last_play_sng_id:0,total_cards_height:0,total_cards:0,on_scroll:!1,timeout_id:0,nb_scroll:1,current_separator_timestamp:0,first_week_separator_added:!1,first_day_separator_added:!1,storage:[],nb_cards_noads:0,nb_cards_noads_on_prepend:0,next_refresh_timeout_id:0,is_webview:!1,comment_height:{},comment_height_total:0,waveform_selector:["#content > .card-edito-track > .info > .info-down > .progress_bar","#content > .share-song > .info > .card-follow > .track > .info > .progress_bar","#content > .card-social > .info > .card-follow > .track > .info > .progress_bar","#content > .card-trending > .info > .info-down .progress_bar"].join(","),more_friend_selector:"#content > .card-social > .info .show-more-friends",comment_button_selector:"#content > .card > footer > .btn-comment",init:function(){try{return o.registerHelper(),o.initialized=!0,o.first_week_separator_added=!1,o.first_day_separator_added=!1,o.updateUnread(0),s(document).on("click",o.waveform_selector,function(e){var t=s(this).data(),a=s("#"+t.cardId),r=s((a.hasClass("share-song")?".card-follow ":"")+"figure > a",a);if(o.current_play_sng_id===t.id){if(0===dzPlayer.position||o.current_play_sng_id!==dzPlayer.getCurrentSong("SNG_ID"))return r.trigger("click"),!0;var n=(e.pageX-s(this).offset().left)/s(this).width();dzPlayer.control.seek(n)}else r.trigger("click")}),s(document).on("click",o.more_friend_selector,function(e){e.preventDefault();var t=s(this).parent().parent();s(".hide",t).removeClass("hide"),s(".btn",t).hide()}),s(document).on("click",o.comment_button_selector,function(){var e=s(this),t=e.data(),a=e.parent().next(),r=a.outerHeight()+e.offset().top+e.parent().outerHeight();a.commentbox({type:t.type,nb:10,start:4,element_id:t.elementId,content_id:t.trackingId,infinite_scroll:!1,publish_on_enter:!0,adjust_onscroll:!0,display:!1,counter:e,addCallback:o.addToStorageComment,displayCallback:o.displayCommentCallback,template:"feed"}),!a.is(":visible")&&r>client_height&&s("#page_content").animate({scrollTop:o.current_yscroll+r-client_height},"slow"),a.finish().slideToggle(function(){o.displayCommentCallback(t.trackingId)})}),"undefined"!=typeof live&&o.is_webview===!0&&0!==USER.USER_ID&&(live.addInternalChannel(USER.USER_ID+"_"+USER.USER_ID+"_STREAM"),live.addInternalChannel("-1_"+USER.USER_ID+"_USERFEED_"+USER.USER_ID)),o.initEventsSubscribe(),!0}catch(e){error.log(e)}},initEventsSubscribe:function(){try{var e=s("body > .page-wrapper > .page-header").height(),t=o.current_feed_window_bottom=client_height-e;Events.subscribe(Events.layout.resize,function(){t=client_height-e},"feed"),Events.subscribe(Events.player.playerLoaded,function(){o.current_play_sng_id=dzPlayer.getCurrentSong("SNG_ID")},"feed"),Events.subscribe(Events.layout.scroll,function(e,a){0!==a.yscroll&&(o.current_yscroll=a.yscroll),o.current_feed_window_bottom=a.yscroll+t,o.timeout_id>0||(o.timeout_id=setTimeout(function(){o.timeout_id=0;var e=o.current_yscroll-a.yscroll;Math.abs(e)>1500||o.logDisplayedCard()},1e3))},"feed"),Events.subscribe(Events.player.play,function(){0!==o.current_play_sng_id&&jQuery.inArray(o.current_play_sng_id,o.waveform_id)>-1&&s(".waveform_"+o.current_play_sng_id,"#content").css("width","0%"),o.current_play_sng_id=dzPlayer.getCurrentSong("SNG_ID"),o.current_play_sng_duration=dzPlayer.getCurrentSong("DURATION")},"feed"),Events.subscribe(Events.player.position,function(e,t){jQuery.inArray(o.current_play_sng_id,o.waveform_id)>-1&&o.current_play_sng_id===dzPlayer.getCurrentSong("SNG_ID")&&o.setWaveformPosition(o.current_play_sng_id,t)},"feed")}catch(a){error.log(a)}},display:function(){try{o.initialized||o.init();var e=["song","album","artist","playlist","radio"];o.is_webview||e.push("promo");var t=function(){api.call("musicfeed.getList",{last_card_id:o.card_id,nb:o.nb_card,filter_types:e},o.draw,{api_called:!0})};return o.on_scroll?t():(templating.load(o.template),o.is_webview===!1&&naboo.afterLoad(!0),o.card_id=0,o.total_cards=0,o.ads_position=0,o.nb_cards_noads=0,ads.feed_ads_position=0,o.current_separator_timestamp=0,o.loadComplete=!1,o.storage.length>0&&(t=function(){o.draw(o.storage,!1)}),gatekeeper.isAllowed("new_home")&&o.is_webview!==!0?t():o.drawFlowHeader(t)),!0}catch(a){error.log(a)}},displayNextCard:function(){try{var e="feed"!==www.getCurrentPath()&&o.is_webview===!1?o.addToStorage:o.draw;api.call("musicfeed.getList",{last_card_id:0,nb:1},e,{api_called:!0,prepend_data:!0})}catch(t){error.log(t)}},addToStorage:function(e){try{if("undefined"!=typeof e.data&&e.count>0){var t=e.data[0];o.storage.unshift(t),o.updateUnread(),"undefined"!=typeof e.next_refresh&&o.setNextRefresh(e.next_refresh)}}catch(a){error.log(a)}},addToStorageComment:function(e,t){try{for(var a in o.storage)if(o.storage.hasOwnProperty(a)&&o.storage[a].CARD_ID===e){delete t.DISPLAY,o.storage[a].COMMENTS.data.unshift(t),o.storage[a].COMMENTS.count++,o.storage[a].COMMENTS.total++;break}}catch(r){error.log(r)}},displayCommentCallback:function(e){try{o.comment_height[e]=0;var t=s("#"+e+" > .comments");t.is(":visible")&&(o.comment_height[e]=t.height()),o.comment_height_total=0;for(var a in o.comment_height)o.comment_height.hasOwnProperty(a)&&(o.comment_height_total+=o.comment_height[a])}catch(r){error.log(r)}},setNextRefresh:function(e){try{var t=1e3*e||2147483647;t=t>=2147483647?2147483647:t,o.next_refresh_timeout_id>0&&clearTimeout(o.next_refresh_timeout_id),o.next_refresh_timeout_id=setTimeout(function(){o.displayNextCard()},t)}catch(a){error.log(a)}},updateUnread:function(e){try{o.unread="undefined"==typeof e?o.unread+1:e,0===o.unread?s("#feed_counter").text("").hide():s("#feed_counter").text(o.unread).fadeIn()}catch(t){error.log(t)}},drawFlowHeader:function(e){try{if(o.is_webview)return o.drawWebviewFlowHeader(e);e=e||null;var t=new Date,a=t.getTimezoneOffset(),s=(0>a?Math.abs(a):-1*a)/60;api.call({method:"flow.getPlayer",data:{lang:SETTING_LANG,timezone_offset:s,from_onboarding:FROM_ONBOARDING},success:function(t){var a=document.getElementById("flow_content");a&&r.render(r.createElement(i,t),a,e)}})}catch(n){error.log(n)}},drawWebviewFlowHeader:function(e){try{var t=Handlebars.templates.webview_feed_flow,a=t({USER_ID:USER.USER_ID,USER_PICTURE:USER.USER_PICTURE,TITLE:n.gettext("Bonjour %s !",{sprintf:[USER.BLOG_NAME]})});s("#content").append(a).find('[data-target="flow"]').replaceWith(button_multi_state.draw({id:USER.USER_ID,action:"play",type:"user",radio:!0,wording:"full",color:"primary",color_equalizer:"inverse",play_context:"feed_user_radio",tracking:1,tracking_tag:"flow_click",tracking_params:"{'type': 'flow', 'instance': 'feed'}"})),"function"==typeof e&&e()}catch(r){error.log(r)}},draw:function(e,t){try{var a,r,n="",i=t.api_called||!1,l=t.prepend_data||!1;if(i){if("undefined"!=typeof e.end&&(o.loadComplete=!0),"undefined"!=typeof e.next_refresh&&(o.card_id<=0||l)&&o.setNextRefresh(e.next_refresh),a=e.data,o.storage=o.storage.concat(a),null===a||a.length<=0)return!1}else a=e;for(var c=a.length,d=0;c>d;d++)if(r="",USER.OPTIONS.ads_display&&(l&&o.nb_cards_noads_on_prepend%5===0||0!==o.total_cards&&o.nb_cards_noads%5===0)&&"undefined"!=typeof Handlebars.templates.feed_ads&&(r=o.drawAdsCard()),"PROMO"===a[d].TYPE&&(a[d].data.img_small=a[d].data.img370x300||a[d].data.img730x300,a[d].data.img_big=a[d].data.img578x300||a[d].data.img1028x300,a[d].data.img_drive=a[d].data.img302x244||a[d].data.img1028x300),"undefined"!=typeof a[d]&&null!==a[d]&&""!==a[d]&&"undefined"!=typeof a[d].typ&&("undefined"!=typeof Handlebars.templates[a[d].TEMPLATE]||"undefined"!=typeof Handlebars.templates["webview_"+a[d].TEMPLATE])){if(a[d].USER_PICTURE=USER.USER_PICTURE,a[d].USER_ID=USER.USER_ID,"undefined"!=typeof a[d].COMMENTS&&a[d].COMMENTS.count>0)for(var p=a[d].COMMENTS.count,u=0;p>u;u++){var _=a[d].COMMENTS.data[u];_.TYPE=a[d].TYPE.toLowerCase(),_.ELEMENT_ID=_.USER_ID===USER.USER_ID?o.getIdFromType(a[d].TYPE,a[d].DATA):!1,_.COMMENT=s("<div/>").html(_.COMMENT).text()}l?(n+=o.drawCard(a[d])+r,o.nb_cards_noads_on_prepend+=1):(n+=r+o.drawCard(a[d]),o.card_id=a[d].CARD_ID,o.nb_cards_noads+=1),i&&(o.non_displayed_cards[a[d].CARD_ID]={}),o.total_cards++}if(l){var h=s(n);h.hide();var m=s("#content > .divider:eq(0)");m.after(h),h.fadeIn("slow")}else s("#content").append(n),s("#page_content").scrollTop(o.current_yscroll),o.activeScroll(),o.on_scroll=!1,o.nb_card=10;if(Events.trigger(Events.navigation.page_updated),jQuery.inArray(o.current_play_sng_id,o.waveform_id)>-1&&dzPlayer.getCurrentSong("SNG_ID")===o.current_play_sng_id&&o.setWaveformPosition(o.current_play_sng_id,dzPlayer.position),calculeTime(),i){var y,f;for(var g in o.non_displayed_cards)o.non_displayed_cards.hasOwnProperty(g)&&(y=s("#"+g),f=s("aside > span > figure",y).height(),y.length>0&&(o.non_displayed_cards[g]={t:y.position().top+20-o.comment_height_total,h:f}));0===o.current_yscroll&&o.logDisplayedCard()}}catch(v){error.log(v)}},drawCard:function(e){try{var t="",a=o.is_webview===!0?"webview_"+e.TEMPLATE:e.TEMPLATE,r=Handlebars.templates[a];return("snge"===e.typ||"sngf"===e.typ||"sngt"===e.typ||"sngs"===e.typ)&&("undefined"!=typeof e.DATA.FALLBACK&&(e.DATA=e.DATA.FALLBACK),-1===jQuery.inArray(e.DATA.SNG_ID,o.waveform_id)&&o.waveform_id.push(e.DATA.SNG_ID),thumbnails.current_song_id===e.DATA.SNG_ID&&(o.current_play_sng_id=dzPlayer.getCurrentSong("SNG_ID"),o.current_play_sng_duration=dzPlayer.getCurrentSong("DURATION"))),t+=o.drawSeparator(e.TIMESTAMP),t+=r(e)}catch(s){error.log(s)}},drawAdsCard:function(){try{var e="",t=Handlebars.templates.feed_ads;return e+=t({ads_position:o.ads_position}),o.ads_position++,advertising.call("multiple_feed",o.ads_position),e}catch(a){error.log(a)}},drawSeparator:function(e){try{var t="",a=o.is_webview===!0?"webview_feed_separator":"feed_separator",r="undefined"!=typeof Handlebars.templates[a]?Handlebars.templates[a]:"";if("undefined"==typeof e||""===e||0>e)return t;var s=localTimeStamp()-e;if(518400>=s)if(86400>s&&o.first_day_separator_added===!1&&(o.first_day_separator_added=!0,t=r({date:n.gettext("Recommandé pour vous aujourd'hui")})),s>=86400&&172800>=s){var i=Math.floor(s/86400);i!==Math.floor(o.current_separator_timestamp/86400)&&(o.current_separator_timestamp=s,t=r({date:getAgoTime(s)}))}else s>172800&&o.first_week_separator_added===!1&&(o.first_week_separator_added=!0,t=r({date:n.gettext("Il y a quelques jours")}));else if(s>518400&&2592e3>=s){var l=Math.round(s/604800);l!==Math.round(o.current_separator_timestamp/604800)&&(o.current_separator_timestamp=s,t=r({date:getAgoTime(s)}))}else{var c=Math.round(e/2592e3),d=new Date(1e3*e);if(Math.round(s/2592e3)>12){var p=Math.round(e/31536e3);p!==Math.round(o.current_separator_timestamp/31536e3)&&(o.current_separator_timestamp=e,t=r({date:d.getFullYear()}))}else if(c!==Math.round(o.current_separator_timestamp/2592e3)){var u=c>1?getShortMonthName((parseInt(d.getMonth(),10)+1).toString())+" "+d.getFullYear():getAgoTime(s);o.current_separator_timestamp=e,t=r({date:u})}}return t}catch(_){error.log(_)}},setWaveformPosition:function(e,t){try{var a=100*t/o.current_play_sng_duration;s(".waveform_"+e,"#content").css("width",a+"%")}catch(r){error.log(r)}},activeScroll:function(){try{infinite_scroll.disable(),o.loadComplete||(Events.subscribeOnce(Events.layout.infiniteScroll,function(){o.on_scroll=!0,o.nb_scroll+=1,o.display()},"feed"),infinite_scroll.active(s("#content")))}catch(e){error.log(e)}},flushCache:function(){o.storage=[],o.current_yscroll=0},tracking:function(e,t,a){try{return o.is_webview===!1&&"function"==typeof a&&(a(),a=null),api.call("musicfeed.log",{action:e,params:{card_id:t,dev:{v:STATIC_VERSION,t:o.is_webview===!0?"6":"0"}}},a),!0}catch(r){error.log(r)}},leave:function(){try{return Events.subscribeOnce(Events.navigation.page_displayed,function(){r.unmountComponentAtNode(document.getElementById("flow_content"))}),s(document).off("click",o.waveform_selector),s(document).off("click",o.more_friend_selector),s(document).off("click",o.comment_button_selector),s(document).off("keypress keydown keyup"),Events.unsubscribeAll("header_flow"),!0}catch(e){error.log(e)}},logDisplayedCard:function(){try{for(var e in o.non_displayed_cards)if(o.non_displayed_cards.hasOwnProperty(e)){var t=o.non_displayed_cards[e].t+o.comment_height_total,a=o.non_displayed_cards[e].h,r=t+Math.round(a/2);o.current_yscroll<t&&o.current_feed_window_bottom>r&&(o.tracking("display",e),delete o.non_displayed_cards[e])}return!0}catch(s){error.log(s)}},getIdFromType:function(e,t){try{return"undefined"==typeof e||"undefined"==typeof t?!1:"ALBUM"===e?t.ALB_ID:"PLAYLIST"===e?t.PLAYLIST_ID:!0}catch(a){error.log(a)}},registerHelper:function(){try{return Handlebars.registerHelper("sticker",function(e,t,a){if("undefined"==typeof e||"undefined"==typeof t)return!1;var r=new Date(e).getFullYear(),s=t.match(/\d{4}/);return s=null!==s?Number(s[0]):r,s===r&&dateToTimestamp(CURRENT_DATE)-dateToTimestamp(e)<=2678400?a.fn():a.inverse()}),Handlebars.registerHelper("formatDate",function(e){return"undefined"==typeof e?!1:formatDate(e,"/")}),Handlebars.registerHelper("textSizeLimit",function(e,t){return"undefined"==typeof e||"undefined"==typeof t||isNaN(t)?!1:e.length>t?e.substr(0,t)+"...":e}),Handlebars.registerHelper("favorite_status",function(e){var t=e.hash.id+("song"===e.hash.type?"_0":"");return userData.isFavorite(e.hash.type,t)?e.fn():e.inverse()}),Handlebars.registerHelper("artistsList",function(e,t){if(!e)return!1;if(!e.ARTISTS||!e.ARTISTS.length)return t.fn(e);for(var a,r=e.ARTISTS,n=[],i=[],o=0,l=r.length;l>o;o++)a=r[o],"0"!==a.ROLE_ID&&"5"!==a.ROLE_ID||-1!==s.inArray(a.ART_ID,n)||(n.push(a.ART_ID),i.push(t.fn(a)));return i.join(", ")}),Handlebars.registerHelper("tracksList",function(e,t){if("undefined"==typeof e||"undefined"==typeof t.hash.length)return!1;for(var a=e.length,r=t.hash.length,s="",n=0,i=0;a>i;i++)if(right.checkSongAvailable(e[i])===right.READABLE){if(e[i].track_index=i,s+=t.fn(e[i]),n>=r-1)return s;n++}return s}),Handlebars.registerHelper("friendsList",function(e,t){if("undefined"==typeof e||"undefined"==typeof t.hash.length)return!1;for(var a,r=e.length,s=3>=r?e.length:2,i=15,o=[],l="",c=0;s>c;c++)2!==r&&3!==r||c+1!==s?o.push(t.fn(e[c])):l=" "+n.gettext("et")+" "+t.fn(e[c]);if(1===r)a=n.gettext("a écouté ce titre.");else if(r>1&&4>r)a=n.gettext("ont écouté ce titre.");else{var d,p,u=Math.round(r-s);r>i?(d='<a class="link-primary show-more-friends">',p="</a>"):(d="<strong>",p="</strong>"),a=n.ngettext("et %s%s autre%s de vos amis ont écouté ce titre.","et %s%s autres%s de vos amis ont écouté ce titre.",{sprintf:[d,u,p],count:u})}return o.join(", ")+l+" "+a}),Handlebars.registerHelper("enum",function(e,t){if("undefined"==typeof e)return!1;for(var a,r=t.hash.length&&t.hash.length<=e.length?t.hash.length:e.length,s="",n=0;r>n;n++)null!==e[n]&&(a=e[n],s=s+t.fn(a)+(n>=r-1?".":", "));var i=("alba"===this.typ||"albr"===this.typ||"albe"===this.typ)&&this.DISCOGRAPHY.total>r,o=("plse"===this.typ||"plsa"===this.typ)&&this.PLAYLIST_ARTISTS.total>r;return i||o?s.substring(0,s.length-1):s}),!0}catch(e){error.log(e)}}};Events.subscribe(Events.live.events,function(e,t){return 0===t.length?!1:"undefined"!=typeof t[0].ACTION&&"MUSICFEED_NEW"!==t[0].ACTION?!1:void("feed"!==www.getCurrentPath()&&o.is_webview===!1?o.updateUnread():o.displayNextCard())}),t.exports=o},{"../components/flow/Header":41,"./i18n":98,jquery:"jquery","react/addons":"react/addons"}],41:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("classnames"),n=e("./_elements/ProgressBar"),i=e("./_elements/Launcher"),o=e("./_elements/BackgroundCanvas"),l=e("./_elements/Player"),c=r.createClass({displayName:"Header",propTypes:{PICTURES:r.PropTypes.array,RECOS:r.PropTypes.object,MESSAGE:r.PropTypes.string},getInitialState:function(){return{player_launched:!1,launcher_fade_active:!1,player_fade_active:!1,seek_position:0}},componentDidMount:function(){Events.subscribe(Events.player.tracklist_changed,this._onTrackListChanged,"header_flow"),this._checkFlowStatus()},componentWillUnmount:function(){Events.unsubscribeAll("header_flow")},render:function(){var e=s({"flow-control play":!0,active:this.state.player_fade_active}),t=s({"flow-control stop":!0,active:this.state.launcher_fade_active});return r.createElement("div",{id:"feed_flow",className:"flow-feed-v2"},r.createElement(o,{loop_pictures:this.props.PICTURES}),this.state.player_launched?r.createElement(n,null):"",r.createElement("div",{className:"flow-overlay"}),this.state.player_launched?r.createElement("div",{className:e},r.createElement(l,null)):r.createElement("div",{className:t},r.createElement(i,{recos:this.props.RECOS,message:this.props.MESSAGE})))},_onTrackListChanged:function(e,t){return"undefined"==typeof t||"set"===t.type&&!t.first?(this._checkFlowStatus(),!0):!1},_checkFlowStatus:function(){var e=dzPlayer.helper.isPlayingUserFlow();if(this.state.player_launched)return e||this._switchToLauncher(),!1;if(!this.state.player_launched&&e){if(this.state.launcher_fade_active)return this._switchToPlayer(),!1;this.setState({player_launched:!0,player_fade_active:!0})}if(!this.state.player_launched&&!e){if(this.state.launcher_fade_active)return!1;this._switchToLauncher()}},_switchToLauncher:function(){this.setState({player_fade_active:!1},function(){window.setTimeout(function(){this._loadLauncher()}.bind(this),400)})},_switchToPlayer:function(){this.setState({launcher_fade_active:!1},function(){window.setTimeout(function(){this._loadPlayer()}.bind(this),600)})},_loadLauncher:function(){this.setState({launcher_fade_active:!1},function(){window.setTimeout(function(){this.setState({player_launched:!1,launcher_fade_active:!0})}.bind(this),600)})},_loadPlayer:function(){this.setState({player_fade_active:!1},function(){window.setTimeout(function(){this.setState({player_launched:!0,player_fade_active:!0})}.bind(this),600)})}});t.exports=c},{"./_elements/BackgroundCanvas":42,"./_elements/Launcher":43,"./_elements/Player":44,"./_elements/ProgressBar":45,classnames:"classnames","react/addons":"react/addons"}],45:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("classnames"),n=e("jquery"),i=r.createClass({displayName:"ProgressBar",getInitialState:function(){return{position:dzPlayer.getPosition()}},componentDidMount:function(){Events.subscribe(Events.player.position,this._setPlayerPosition,"header_flow")},componentWillUnmount:function(){Events.unsubscribe(Events.player.position,this._setPlayerPosition)},render:function(){var e=s({"flow-progress-bar":!0,seek:!USER.OPTIONS.ads_display});return r.createElement("div",{role:"progressbar",className:e,onClick:this._seek},r.createElement("div",{className:"flow-progress-bar-overlay",style:{width:this._getPercentPosition()+"%"}}))},_setPlayerPosition:function(e,t){this.setState({position:t})},_getPercentPosition:function(){return 100*this.state.position/dzPlayer.getCurrentSong("DURATION")},_seek:function(e){if(!dzPlayer.control.canSeek())return void e.preventDefault();var t=n("#flow_content"),a=(e.pageX-t.offset().left)/t.width();dzPlayer.control.seek(a)}});t.exports=i},{classnames:"classnames",jquery:"jquery","react/addons":"react/addons"}],44:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("classnames"),n=e("../../../core/i18n"),i=e("../../_mixins/notification"),o=e("../../common/Thumbnail"),l=e("../../common/Favorite"),c=e("../../common/Dislike"),d=r.createClass({displayName:"Player",mixins:[i],getInitialState:function(){return{pictures_index:0,player_type:"radio",radio_skip_blocked:!dzPlayer.skipRadioAllowed(),hasLyrics:dzPlayer.hasLyrics()}},componentWillMount:function(){this._preloaded_data=[dzPlayer.getCurrentSong(),dzPlayer.getNextSong()]},componentDidMount:function(){this._setOnair(),Events.resolve(Events.flow.playerDisplay),Events.subscribe(Events.player.displayCurrentSong,this._setPlayerState,"header_flow"),Events.subscribe(Events.player.changePlayerType,this._setPlayerTypeState,"header_flow")},componentWillUpdate:function(e,t){this.state.pictures_index!==t.pictures_index&&this._closeContextMenu()},componentDidUpdate:function(){this._setOnair()},componentWillUnmount:function(){Events.unsubscribe(Events.player.displayCurrentSong,this._setPlayerState),Events.unsubscribe(Events.player.changePlayerType,this._setPlayerTypeState)},render:function(){var e=[],t=[],a=[];this._preloaded_data.map(function(n,i){var l=this.state.pictures_index===i,c=n.SNG_ID+"_"+i,d=s({cover:!0,active:l}),p=s({active:l});e.push(r.createElement("div",{key:"cover_"+c,className:d},r.createElement(o,{id:USER.USER_ID,type:"user",picture_type:"cover",md5:n.ALB_PICTURE,play:!0,cover_play:!0,context:"feed_user_radio",width:250,height:250,context_menu:n}))),t.push(r.createElement("span",{key:"title_"+c,className:p},n.SNG_TITLE)),a.push(r.createElement("span",{key:"artist_"+c,className:p},n.ART_NAME))}.bind(this));var i=this._preloaded_data[this.state.pictures_index],d=s({"evt-over evt-out":this.state.hasLyrics,invisible:!this.state.hasLyrics});return r.createElement("div",{className:"flow-play"},r.createElement("div",{className:"flow-thumbnail"},e),r.createElement("div",{className:"flow-play-info"},r.createElement("p",{className:"flow-label"},r.createElement("span",{className:"sticker sticker-flow"},n.gettext("Flow"))),r.createElement("p",{className:"flow-title heading-1 heading-inverse"},r.createElement("a",{className:"link evt-click",href:"/album/"+i.ALB_ID},t)),r.createElement("p",{className:"flow-txt heading-1-sub heading-inverse"},r.createElement("span",{className:"by"},n.gettext("par"))," ",r.createElement("a",{className:"pull-left link evt-click",href:"/artist/"+i.ART_ID},a))),r.createElement("ul",{className:"flow-action"},r.createElement("li",null,r.createElement(c,{style:"heart_large",tooltip:!0,elId:"flow-unlove",id:i.SNG_ID,onClickCallback:this._onDislikeClick})),r.createElement("li",null,r.createElement(l,{type:"song",style:"heart_large",context:"flow_header",elId:"flow-love",tooltip:!0,id:i.SNG_ID,onClickCallback:this._onFavoriteClick})),r.createElement("li",null,r.createElement("a",{className:d,"data-tooltip":"1","data-tooltip-gravity":"s","data-tooltip-delay":"400",title:n.gettext("Écouter avec les paroles"),onClick:this._openLyrics,role:"button"},r.createElement("span",{className:"icon-64 icon-stack icon-stack-hover icon-stack-circle"},r.createElement("span",{className:"icon icon-lyrics"})))),r.createElement("li",null,r.createElement("button",{type:"button",className:"icon icon-24 icon-next",disabled:"ads"===this.state.player_type,onClick:this._next}))))},_preloaded_data:[],_setPlayerTypeState:function(){this.setState({player_type:dzPlayer.getPlayerType()})},_setPlayerState:function(){if(!dzPlayer.helper.isPlayingUserFlow())return!1;var e={player_type:dzPlayer.getPlayerType()},t=this.state.pictures_index>=2?0:this.state.pictures_index+1,a=t>=2?0:t+1,r=dzPlayer.getNextSong()||{};this._preloaded_data[a]=r,e.pictures_index=t,e.radio_skip_blocked=!dzPlayer.skipRadioAllowed(),e.hasLyrics=dzPlayer.hasLyrics(),this.setState(e)},_setOnair:function(){window.setTimeout(function(){dzPlayer.isPlaying()&&onair.onPlay()},0)},_next:function(e){e&&e.stopPropagation&&e.stopPropagation(),this.state.radio_skip_blocked?notificationBar.display("flow_skip_push",{}):dzPlayer.control.nextSong()},_closeContextMenu:function(){window.context_menu.close("feed_user_radio")},_onDislikeClick:function(){this.displayNotification("dislike"),setTimeout(this._next,300)},_onFavoriteClick:function(e,t,a){a&&this.displayNotification("like")},_openLyrics:function(){menu.openPanel("lyrics")}});t.exports=d},{"../../../core/i18n":98,"../../_mixins/notification":20,"../../common/Dislike":26,"../../common/Favorite":27,"../../common/Thumbnail":33,classnames:"classnames","react/addons":"react/addons"}],43:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("../../../core/i18n"),n=r.createClass({displayName:"Launcher",propTypes:{recos:r.PropTypes.object,message:r.PropTypes.string},render:function(){var e=this.props.recos.DATA.map(function(e,t){var a=e[this._reco_key[e.__TYPE__].title],n=e[this._reco_key[e.__TYPE__].id],i=e.__TYPE__.toLowerCase(),o=this._reco_key[e.__TYPE__].context,l=0,c="radio"===e.__TYPE__||"artist"===e.__TYPE__;return"playlist"===e.__TYPE__&&4===Number(e.TYPE)&&(l=4,o="loved_page",a=s.gettext("Coups de cœur")),r.createElement("button",{type:"button",key:"launcher_"+t,className:"flow-btn-grey","data-radio":c,"data-id":n,"data-play-context":o,"data-type":i,"data-playlist-type":l,"data-redirect":"true","data-tracking":"true","data-tracking-tag":this._reco_key[e.__TYPE__].tracking_tag,onClick:this._onRecoClick},r.createElement("p",null,r.createElement("span",{className:"icon icon-play-circle"}),r.createElement("span",{className:"flow-reco ellipsis"},a),r.createElement("span",{className:"flow-labels ellipsis"},e.__TYPE__)))}.bind(this));return r.createElement("div",{className:"flow-stop active"},r.createElement("div",{className:"container-flow"},r.createElement("p",{className:"flow-txt",dangerouslySetInnerHTML:{__html:this.props.message}}),r.createElement("button",{type:"button",className:"flow-btn-white","data-id":USER.USER_ID,"data-type":"user","data-radio":"true","data-tracking":"true","data-tracking-tag":"flow",onClick:this._onLaunchClick},r.createElement("span",{className:"icon icon-play-circle"}),s.gettext("LANCER FLOW")),this.props.recos.DATA.length>0?r.createElement("section",{className:"divider-flow btn-more"},r.createElement("span",{className:"col col-divider"},r.createElement("span",{className:"divider"})),r.createElement("span",{className:"col col-label"},this.props.recos.WORDING),r.createElement("span",{className:"col col-divider"},r.createElement("span",{className:"divider"}))):"",e))},_player_launched:!1,_reco_key:{playlist:{id:"PLAYLIST_ID",title:"TITLE",context:"feed_playlist",tracking_tag:"suggested_playlist"},album:{id:"ALB_ID",title:"ALB_TITLE",context:"feed_album",tracking_tag:"suggested_album"},radio:{id:"RADIO_ID",title:"TITLE",context:"feed_radio",tracking_tag:"suggested_radio"},artist:{id:"ART_ID",title:"ART_NAME",context:"feed_smartradio",tracking_tag:"suggested_radio"}},_onLaunchClick:function(e){return this._player_launched===!0?void e.preventDefault():(this._player_launched=!0,void this._onRecoClick(e))},_onRecoClick:function(e){var t=dom.dataset(e.currentTarget);if("string"!=typeof t.type||"string"!=typeof t.id)return void e.preventDefault();if(dzPlayer.play({radio:"true"===t.radio,type:t.type,id:t.id,context:{ID:t.id,TYPE:"user"===t.type&&"true"===t.radio?"feed_user_radio":t.playContext}}),"true"===t.tracking&&"string"==typeof t.trackingTag&&tracking.track("flow_click",{type:t.trackingTag,instance:"feed"}),"true"===t.redirect){var a="/"+t.type+"/"+t.id;4===Number(t.playlistType)&&(a="/profile/me/loved"),loadBox(a)}}});t.exports=n},{"../../../core/i18n":98,"react/addons":"react/addons"}],42:[function(e,t,a){"use strict";var r=e("react/addons"),s=e("../../../core/Blurred"),n=r.createClass({displayName:"BackgroundCanvas",propTypes:{loop_pictures:r.PropTypes.array},getInitialState:function(){var e=dzPlayer.helper.isPlayingUserFlow();return{transition_start:!1,pictures_index:e?this.props.loop_pictures.length:0,background_top:0,player_launched:e,preloaded_pictures:this._getPreloadedPictures()}},componentDidMount:function(){this.props.loop_pictures.length>0&&!this.state.player_launched&&this._setLoopPicturesInterval(),this._renderBlur(),Events.subscribe(Events.player.play,this._setPlayerBackground,"header_flow")},componentDidUpdate:function(){this._renderBlur()},componentWillUnmount:function(){this._clearLoopPicturesInterval(),Events.unsubscribe(Events.player.play,this._setPlayerBackground)},render:function(){var e,t=this.state.preloaded_pictures.map(function(t,a){return e=this.state.pictures_index===a?" active"+(this.state.transition_start===!0?"_sup":""):"",r.createElement("div",{key:t+"_"+a,ref:t+"_"+a,className:"background-position"+e})}.bind(this));return r.createElement("div",{className:"flow-cover"},t)},_background_loop_interval:0,_preloaded_pictures:[],_renderBlur:function(){this.state.preloaded_pictures.map(function(e,t){var a=this.refs[e+"_"+t];return new s(a.getDOMNode()).setUrl(window.SETTING_DOMAIN_IMG+"/cover/"+e+"/500x500.jpg").setBlurStrength(3).render()}.bind(this))},_setPlayerBackground:function(){var e=dzPlayer.helper.isPlayingUserFlow();if(!this.state.player_launched&&e)return this._clearLoopPicturesInterval(),this._setBackgroundTransition(),!1;if(this.state.player_launched&&!e)return this._setBackgroundTransition(),this._setLoopPicturesInterval(),!1;if(!this.state.player_launched&&!e)return!1;var t=dzPlayer.getNextSong()||{},a=this.state.pictures_index>=this.state.preloaded_pictures.length-1?this.props.loop_pictures.length:this.state.pictures_index+1,r=a>=this.state.preloaded_pictures.length-1?this.props.loop_pictures.length:a+1;this._preloaded_pictures[r]=t.ALB_PICTURE,this.setState({pictures_index:a,preloaded_pictures:this._preloaded_pictures,player_launched:!0})},_setBackgroundTransition:function(){var e=dzPlayer.helper.isPlayingUserFlow();this.setState({player_launched:e,transition_start:!0,preloaded_pictures:e?this._getPreloadedPictures():this.state.preloaded_pictures},this._setBackgroundTransitionCallback)},_setBackgroundTransitionCallback:function(){window.setTimeout(function(){this.setState({transition_start:!1},function(){this._renderBlur(),window.setTimeout(function(){this.setState({pictures_index:dzPlayer.helper.isPlayingUserFlow()?this.props.loop_pictures.length:0})}.bind(this),400)})}.bind(this),400)},_clearLoopPicturesInterval:function(){clearInterval(this._background_loop_interval)},_setLoopPicturesInterval:function(){this.props.loop_pictures.length>0&&(this._clearLoopPicturesInterval(),this._background_loop_interval=window.setInterval(this._setLoopPicturesBackground,4e3))},_setLoopPicturesBackground:function(){var e=this.state.pictures_index>=this.props.loop_pictures.length-1?0:this.state.pictures_index+1;this.setState({pictures_index:e,player_launched:!1})},_getPreloadedPictures:function(){var e=this.props.loop_pictures.slice();return dzPlayer.helper.isPlayingUserFlow()&&e.push(dzPlayer.getCurrentSong().ALB_PICTURE,dzPlayer.getNextSong().ALB_PICTURE,""),this._preloaded_pictures=e,e}});t.exports=n},{"../../../core/Blurred":96,"react/addons":"react/addons"}]},{},[4]);;
require=function e(t,i,s){function r(a,o){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!o&&l)return l(a,!0);if(n)return n(a,!0);var p=new Error("Cannot find module '"+a+"'");throw p.code="MODULE_NOT_FOUND",p}var c=i[a]={exports:{}};t[a][0].call(c.exports,function(e){var i=t[a][1][e];return r(i?i:e)},c,c.exports,e,t,i,s)}return i[a].exports}for(var n="function"==typeof require&&require,a=0;a<s.length;a++)r(s[a]);return r}({3:[function(e,t,i){"use strict";var s,r=e("../components/home"),n={id:0,display:function(e){s=document.getElementById("naboo_content");var t="object"==typeof e&&e.data&&e.data.sections?e.data.sections:[];React.render(React.createElement(r,{sections:t}),s,function(){naboo.afterLoad(!0)})},leave:function(){React.unmountComponentAtNode(s)}};window.home=n},{"../components/home":46}],46:[function(e,t,i){"use strict";var s=e("babel-runtime/helpers/object-without-properties")["default"],r=e("babel-runtime/helpers/extends")["default"],n=e("react/addons"),a={highlight:e("./layouts/Highlight"),"deeplink-list":e("./layouts/DeeplinkList"),list:e("./layouts/List"),grid:e("./layouts/Grid")},o=n.createClass({displayName:"Home",propTypes:{sections:n.PropTypes.array},getDefaultProps:function(){return{sections:[]}},getInitialState:function(){return{sections:this.props.sections}},componentDidMount:function(){0===this.state.sections.length&&this._getSections()},render:function(){return n.createElement("div",{className:"home-container"},this._renderSections())},_renderSections:function(){for(var e=[],t=0,i=this.state.sections.length;i>t;t++){var a=this.state.sections[t],o=a.layout,l=s(a,["layout"]),p=this._getLayout(o);e.push(n.createElement(p,r({key:t},l)))}return e},_getLayout:function(e){if("undefined"==typeof a[e])throw new Error('Layout "'+e+'" cannot be found');return a[e]},_getSections:function(){api.call({method:"home.getHome",success:function(e){this.setState({sections:e.sections})}.bind(this)})}});t.exports=o},{"./layouts/DeeplinkList":57,"./layouts/Grid":58,"./layouts/Highlight":59,"./layouts/List":60,"babel-runtime/helpers/extends":104,"babel-runtime/helpers/object-without-properties":105,"react/addons":"react/addons"}],105:[function(e,t,i){"use strict";i["default"]=function(e,t){var i={};for(var s in e)t.indexOf(s)>=0||Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s]);return i},i.__esModule=!0},{}],60:[function(e,t,i){(function(i){"use strict";var s=e("babel-runtime/helpers/extends")["default"],r=e("react"),n=e("../../items/lib/standardize"),a=e("../../items/List"),o=i.live,l=["radio","track","playlist","album","artist","show","app","user"],p=r.createClass({displayName:"ListLayout",propTypes:{title:r.PropTypes.string,subtitle:r.PropTypes.string,separator:r.PropTypes.bool,items:r.PropTypes.array.isRequired,section_id:r.PropTypes.string.isRequired},componentDidMount:function(){this._logDisplay()},render:function(){var e=this.props.items.slice(0,this._getItemsLimit());return r.createElement("div",{className:"home-tops"},this._renderTitle(),r.createElement("div",{className:"home-list home-list-"+e.length+" clearfix"},this._renderItems(e)))},_renderTitle:function(){return"undefined"==typeof this.props.title?null:r.createElement("div",{className:"home-title"},r.createElement("h3",{className:"heading-3"},this.props.title),this._renderSubTitle())},_renderSubTitle:function(){return"undefined"==typeof this.props.subtitle?null:r.createElement("h4",{className:"heading-4-sub"},this.props.subtitle)},_renderItems:function(e){return e.map(this._renderItem)},_renderItem:function(e,t){if(-1===l.indexOf(e.type))throw new Error('Items of type "'+e.type+'" are not handled by the List layout.');return r.createElement(a,s({key:t},n(e)))},_getItemsLimit:function(){var e=window.matchMedia||function(e){var t=window.styleMedia||window.media;return{matches:t?t.matchMedium(e||"all"):!0,media:e||"all"}};return e("(max-width: 1340px)").matches?2:3},_logDisplay:function(){o.log.send("navigation",{event:"onDisplay",properties:{section:this.props.section_id}})}});t.exports=p}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../items/List":54,"../../items/lib/standardize":56,"babel-runtime/helpers/extends":104,react:"react"}],54:[function(e,t,i){"use strict";var s=e("react"),r=e("../../../common/Thumbnail"),n=e("./../lib/navigate"),a=s.createClass({displayName:"ListItem",propTypes:{id:s.PropTypes.number,type:s.PropTypes.string.isRequired,pictures:s.PropTypes.arrayOf(s.PropTypes.shape({md5:s.PropTypes.string.isRequired,type:s.PropTypes.string.isRequired})).isRequired,play_button:s.PropTypes.bool,title:s.PropTypes.string.isRequired,target:s.PropTypes.string,subtitle:s.PropTypes.string,caption:s.PropTypes.string,data:s.PropTypes.object,item_id:s.PropTypes.string.isRequired},getDefaultProps:function(){return{play_button:!1,weight:1,tags:[]}},render:function(){return s.createElement("div",{className:"home-list-item"},this._renderItem())},_renderItem:function(){return s.createElement("div",{className:"nano-card-item"},s.createElement("div",{className:"nano-card-picture"},this._renderThumbnail()),s.createElement("div",{className:"nano-card-infos"},s.createElement("p",{className:"heading-3 ellipsis"},s.createElement("a",{onClick:n.bind(this)},this.props.title)),this._renderSubtitle(),this._renderCaption()))},_renderThumbnail:function(){return this.props.pictures instanceof Array==!1||0===this.props.pictures.length?null:s.createElement(r,{id:this.props.id,type:this.props.type,picture_type:this.props.pictures[0].type,md5:this.props.pictures[0].md5,multi_cover:!0,height:110,width:110,context:"feed",play:this.props.play_button,link:this.props.play_button===!1,zoom:!1,preview:!0,overlay:!1,onClick:this._onClick})},_renderSubtitle:function(){return"string"!=typeof this.props.subtitle?null:s.createElement("p",{className:"heading-2-sub ellipsis"},this.props.subtitle)},_renderCaption:function(){return"string"!=typeof this.props.caption?null:s.createElement("p",{className:"heading-2-sub ellipsis release-date"},this.props.caption)}});t.exports=a},{"../../../common/Thumbnail":33,"./../lib/navigate":55,react:"react"}],59:[function(e,t,i){(function(i){"use strict";var s=e("babel-runtime/helpers/extends")["default"],r=e("react"),n=e("../../items/lib/standardize"),a=e("../../items/Highlight"),o=i.live,l=["radio","track","artist","playlist","album","show","generic","user"],p=r.createClass({displayName:"HighlightLayout",propTypes:{title:r.PropTypes.string,subtitle:r.PropTypes.string,separator:r.PropTypes.bool,items:r.PropTypes.array.isRequired,section_id:r.PropTypes.string.isRequired},componentDidMount:function(){this._logDisplay()},render:function(){return r.createElement("div",null,this._renderTitle(),this._renderItems())},_renderTitle:function(){return"undefined"==typeof this.props.title?null:r.createElement("div",{className:"home-title"},r.createElement("h3",{className:"heading-3"},this.props.title),this._renderSubTitle())},_renderSubTitle:function(){return"undefined"==typeof this.props.subtitle?null:r.createElement("h4",{className:"heading-4-sub"},this.props.subtitle)},_renderItems:function(){return this.props.items.map(this._renderItem)},_renderItem:function(e,t){if(-1===l.indexOf(e.type))throw new Error('Items of type "'+e.type+'" are not handled by the Highlight layout.');return r.createElement(a,s({key:t},n(e)))},_logDisplay:function(){o.log.send("navigation",{event:"onDisplay",properties:{section:this.props.section_id}})}});t.exports=p}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../items/Highlight":53,"../../items/lib/standardize":56,"babel-runtime/helpers/extends":104,react:"react"}],53:[function(e,t,i){"use strict";var s=e("react"),r=e("classnames"),n=e("./ProgressBar"),a=e("./Launcher"),o=e("./Player"),l=e("./Background"),p=s.createClass({displayName:"Highlight",propTypes:{id:s.PropTypes.number,type:s.PropTypes.string,pictures:s.PropTypes.array,title:s.PropTypes.string.isRequired,subtitle:s.PropTypes.string.isRequired,target:s.PropTypes.string},getInitialState:function(){return{player_launched:!1,launcher_fade_active:!1,player_fade_active:!1,seek_position:0}},componentDidMount:function(){"user"===this.props.type&&Events.subscribe(Events.player.tracklist_changed,this._onTrackListChanged,"header_flow"),this._checkFlowStatus()},componentWillUnmount:function(){Events.unsubscribeAll("header_flow")},render:function(){var e=r({"flow-container":!0,active:this.state.player_fade_active}),t=r({"flow-container":!0,active:this.state.launcher_fade_active});return s.createElement("div",{className:"home-flow"},s.createElement(l,{pictures:this.props.pictures,type:this.props.type}),this.state.player_launched?s.createElement(n,null):"",s.createElement("div",{className:"flow-overlay"}),this.state.player_launched?s.createElement("div",{className:e},s.createElement(o,null)):s.createElement("div",{className:t},s.createElement(a,this.props)))},_onTrackListChanged:function(e,t){return"undefined"==typeof t||"set"===t.type&&!t.first?(this._checkFlowStatus(),!0):!1},_checkFlowStatus:function(){var e=dzPlayer.helper.isPlayingUserFlow();if(this.state.player_launched)return e||this._switchToLauncher(),!1;if(!this.state.player_launched&&e){if(this.state.launcher_fade_active)return this._switchToPlayer(),!1;this.setState({player_launched:!0,player_fade_active:!0})}if(!this.state.player_launched&&!e){if(this.state.launcher_fade_active)return!1;this._switchToLauncher()}},_switchToLauncher:function(){this.setState({player_fade_active:!1},function(){window.setTimeout(function(){this._loadLauncher()}.bind(this),400)})},_switchToPlayer:function(){this.setState({launcher_fade_active:!1},function(){window.setTimeout(function(){this._loadPlayer()}.bind(this),600)})},_loadLauncher:function(){this.setState({launcher_fade_active:!1},function(){window.setTimeout(function(){this.setState({player_launched:!1,launcher_fade_active:!0})}.bind(this),600)})},_loadPlayer:function(){this.setState({player_fade_active:!1},function(){window.setTimeout(function(){this.setState({player_launched:!0,player_fade_active:!0})}.bind(this),600)})}});t.exports=p},{"./Background":49,"./Launcher":50,"./Player":51,"./ProgressBar":52,classnames:"classnames",react:"react"}],52:[function(e,t,i){"use strict";var s=e("react"),r=e("classnames"),n=s.createClass({displayName:"ProgressBar",getInitialState:function(){return{position:dzPlayer.getPosition()}},componentDidMount:function(){Events.subscribe(Events.player.position,this._setPlayerPosition,"home_flow")},shouldComponentUpdate:function(e,t){return t.position!==this.state.position},componentWillUnmount:function(){Events.unsubscribe(Events.player.position,this._setPlayerPosition)},render:function(){var e=r({"flow-progress-bar":!0,seek:USER.OPTIONS.ads_display===!1}),t={width:this.state.position+"%"};return s.createElement("div",{ref:"progressBar",role:"progressbar",className:e,onClick:this._seek},s.createElement("div",{className:"flow-progress-bar-overlay",style:t}))},_setPlayerPosition:function(e,t){this.setState({position:Math.round(1e4*t/dzPlayer.getCurrentSong("DURATION"))/100})},_seek:function(e){if(!dzPlayer.control.canSeek())return void e.preventDefault();var t=this.refs.progressBar.getDOMNode(),i=(e.pageX-t.getBoundingClientRect().left+document.body.scrollLeft)/t.offsetWidth;dzPlayer.control.seek(i)}});t.exports=n},{classnames:"classnames",react:"react"}],51:[function(e,t,i){"use strict";var s=e("react"),r=e("classnames"),n=e("../../../../core/i18n"),a=e("../../../_mixins/notification"),o=e("../../../common/Thumbnail"),l=e("../../../common/Favorite"),p=e("../../../common/Dislike"),c=s.createClass({displayName:"Player",mixins:[a],getInitialState:function(){return{pictures_index:0,player_type:"radio",radio_skip_blocked:!dzPlayer.skipRadioAllowed(),hasLyrics:dzPlayer.hasLyrics()}},componentWillMount:function(){this._preloaded_data=[dzPlayer.getCurrentSong(),dzPlayer.getNextSong()]},componentDidMount:function(){this._setOnair(),Events.resolve(Events.flow.playerDisplay),Events.subscribe(Events.player.displayCurrentSong,this._setPlayerState,"header_flow"),Events.subscribe(Events.player.changePlayerType,this._setPlayerTypeState,"header_flow")},componentWillUpdate:function(e,t){this.state.pictures_index!==t.pictures_index&&this._closeContextMenu()},componentDidUpdate:function(){this._setOnair()},componentWillUnmount:function(){Events.unsubscribe(Events.player.displayCurrentSong,this._setPlayerState),Events.unsubscribe(Events.player.changePlayerType,this._setPlayerTypeState)},render:function(){var e=[],t=[],i=[];this._preloaded_data.map(function(n,a){var l=this.state.pictures_index===a,p=n.SNG_ID+"_"+a,c=r({"flow-thumbnail":!0,active:l});e.push(s.createElement("div",{className:c,key:"cover_"+p},s.createElement(o,{id:USER.USER_ID,type:"user",picture_type:"cover",md5:n.ALB_PICTURE,play:!0,cover_play:!0,context:"feed_user_radio",width:180,height:180,context_menu:n}))),t.push(s.createElement("span",{className:"flow-play-track ellipsis"+(l?" active":""),key:"title_"+p},n.SNG_TITLE)),i.push(s.createElement("span",{className:"flow-play-track ellipsis"+(l?" active":""),key:"artist_"+p},n.ART_NAME))}.bind(this));var a=this._preloaded_data[this.state.pictures_index],c=r({"evt-over evt-out":this.state.hasLyrics,invisible:!this.state.hasLyrics});return s.createElement("div",{className:"flow-content"},e,s.createElement("div",{className:"flow-play-info"},s.createElement("p",{className:"sticker sticker-flow"},n.gettext("FLOW")),s.createElement("p",{className:"heading-1 heading-inverse"},s.createElement("a",{className:"evt-click",href:"/album/"+a.ALB_ID},t)),s.createElement("p",{className:"heading-1-sub heading-inverse"},s.createElement("span",{className:"flow-by"},n.gettext("par")),s.createElement("a",{className:"evt-click",href:"/artist/"+a.ART_ID},i)),s.createElement("ul",{className:"flow-action-list clearfix"},s.createElement("li",{className:"flow-action"},s.createElement(p,{style:"heart_medium",tooltip:!0,elId:"flow-unlove",id:a.SNG_ID,onClickCallback:this._onDislikeClick})),s.createElement("li",{className:"flow-action"},s.createElement(l,{type:"song",style:"heart_medium",context:"flow_header",elId:"flow-love",tooltip:!0,id:a.SNG_ID,onClickCallback:this._onFavoriteClick})),s.createElement("li",{className:"flow-action"},s.createElement("a",{className:c,"data-tooltip":"1","data-tooltip-gravity":"s","data-tooltip-delay":"400",title:n.gettext("Afficher les paroles"),onClick:this._openLyrics,role:"button"},s.createElement("span",{className:"icon-52 icon-stack icon-stack-hover icon-stack-circle"},s.createElement("span",{className:"icon icon-lyrics"})))),s.createElement("li",{className:"flow-action next"},s.createElement("a",{className:"icon icon-24 icon-next",disabled:"ads"===this.state.player_type,role:"button",onClick:this._next})))))},_onDislikeClick:function(){this.displayNotification("dislike"),setTimeout(this._next,300)},_onFavoriteClick:function(e,t,i){i&&this.displayNotification("like")},_setPlayerTypeState:function(){this.setState({player_type:dzPlayer.getPlayerType()})},_setPlayerState:function(){if(!dzPlayer.helper.isPlayingUserFlow())return!1;var e={player_type:dzPlayer.getPlayerType()},t=this.state.pictures_index>=2?0:this.state.pictures_index+1,i=t>=2?0:t+1,s=dzPlayer.getNextSong()||{};this._preloaded_data[i]=s,e.pictures_index=t,e.radio_skip_blocked=!dzPlayer.skipRadioAllowed(),e.hasLyrics=dzPlayer.hasLyrics(),this.setState(e)},_setOnair:function(){window.setTimeout(function(){dzPlayer.isPlaying()&&onair.onPlay()},0)},_next:function(e){e&&e.stopPropagation&&e.stopPropagation(),this.state.radio_skip_blocked?notificationBar.display("flow_skip_push",{}):dzPlayer.control.nextSong()},_closeContextMenu:function(){window.context_menu.close("feed_user_radio")},_openLyrics:function(){menu.openPanel("lyrics")}});t.exports=c},{"../../../../core/i18n":98,"../../../_mixins/notification":20,"../../../common/Dislike":26,"../../../common/Favorite":27,"../../../common/Thumbnail":33,classnames:"classnames",react:"react"}],50:[function(e,t,i){"use strict";var s=e("react"),r=s.createClass({displayName:"Launcher",propTypes:{id:s.PropTypes.number.isRequired,type:s.PropTypes.string.isRequired,title:s.PropTypes.string.isRequired,subtitle:s.PropTypes.string.isRequired,target:s.PropTypes.string},player_launched:!1,render:function(){return s.createElement("div",{className:"flow-content"},s.createElement("div",{className:"flow-btn",role:"button",onClick:this._onClickFlow},s.createElement("span",{className:"icon-52 icon-stack icon-stack-circle icon-stack-hover"},s.createElement("span",{className:"icon icon-play"}))),s.createElement("h1",{className:"heading-1 heading-inverse"},this.props.title),s.createElement("h2",{className:"heading-2 heading-inverse"},this.props.subtitle))},_onClickFlow:function(){return"user"!==this.props.type&&"string"==typeof this.props.target?void www.navigate(this.props.target):void(this.player_launched!==!0&&(this.player_launched=!0,dzPlayer.play({radio:!0,type:"user",id:this.props.id,context:{ID:this.props.id,TYPE:"feed_user_radio"}}),tracking.track("flow_click",{type:"user",instance:"feed"})))}});t.exports=r},{react:"react"}],49:[function(e,t,i){"use strict";var s=e("react/addons"),r=e("../../../../core/Blurred"),n=s.createClass({displayName:"Background",propTypes:{type:s.PropTypes.string,pictures:s.PropTypes.array},getInitialState:function(){var e=dzPlayer.helper.isPlayingUserFlow();return{transition_start:!1,pictures_index:e?this.props.pictures.length:0,background_top:0,player_launched:e,preloaded_pictures:this._getPreloadedPictures()}},componentDidMount:function(){this.props.pictures.length>0&&!this.state.player_launched&&this._setLoopPicturesInterval(),this._renderBlur(),"user"===this.props.type&&Events.subscribe(Events.player.play,this._setPlayerBackground,"header_flow")},componentDidUpdate:function(){this._renderBlur()},componentWillUnmount:function(){this._clearLoopPicturesInterval(),Events.unsubscribe(Events.player.play,this._setPlayerBackground)},render:function(){var e,t=this.state.preloaded_pictures.map(function(t,i){return e=this.state.pictures_index===i?" active"+(this.state.transition_start===!0?"_sup":""):"",s.createElement("div",{key:t.md5+"_"+i,ref:t.md5+"_"+i,className:"background-position"+e})}.bind(this));return s.createElement("div",{className:"flow-cover"},t)},_renderBlur:function(){this.state.preloaded_pictures.map(function(e,t){var i=this.refs[e.md5+"_"+t];return new r(i.getDOMNode()).setUrl(window.SETTING_DOMAIN_IMG+"/"+e.type+"/"+e.md5+"/500x500.jpg").setBlurStrength(3).render()}.bind(this))},_background_loop_interval:0,_preloaded_pictures:[],_setPlayerBackground:function(){var e=dzPlayer.helper.isPlayingUserFlow();if(!this.state.player_launched&&e)return this._clearLoopPicturesInterval(),this._setBackgroundTransition(),!1;if(this.state.player_launched&&!e)return this._setBackgroundTransition(),this._setLoopPicturesInterval(),!1;if(!this.state.player_launched&&!e)return!1;var t=dzPlayer.getNextSong()||{},i=this.state.pictures_index>=this.state.preloaded_pictures.length-1?this.props.pictures.length:this.state.pictures_index+1,s=i>=this.state.preloaded_pictures.length-1?this.props.pictures.length:i+1;this._preloaded_pictures[s]={md5:t.ALB_PICTURE,type:t.TYPE},this.setState({pictures_index:i,preloaded_pictures:this._preloaded_pictures,player_launched:!0})},_setBackgroundTransition:function(){var e=dzPlayer.helper.isPlayingUserFlow();this.setState({player_launched:e,preloaded_pictures:e?this._getPreloadedPictures():this.state.preloaded_pictures},this._setBackgroundTransitionCallback)},_setBackgroundTransitionCallback:function(){window.setTimeout(function(){this.setState({transition_start:!1},function(){this._renderBlur(),window.setTimeout(function(){this.setState({pictures_index:dzPlayer.helper.isPlayingUserFlow()?this.props.pictures.length:0})}.bind(this),400)})}.bind(this),400)},_clearLoopPicturesInterval:function(){clearInterval(this._background_loop_interval)},_setLoopPicturesInterval:function(){this.props.pictures.length>0&&(this._clearLoopPicturesInterval(),this._background_loop_interval=window.setInterval(this._setLoopPicturesBackground,4e3))},_setLoopPicturesBackground:function(){var e=this.state.pictures_index>=this.props.pictures.length-1?0:this.state.pictures_index+1;this.setState({pictures_index:e,player_launched:!1})},_getPreloadedPictures:function(){var e=this.props.pictures.slice();return dzPlayer.helper.isPlayingUserFlow()&&e.push({md5:dzPlayer.getCurrentSong().ALB_PICTURE,type:"cover"},{md5:dzPlayer.getNextSong().ALB_PICTURE,type:"cover"},{}),this._preloaded_pictures=e,e}});t.exports=n},{"../../../../core/Blurred":96,"react/addons":"react/addons"}],58:[function(e,t,i){(function(i){"use strict";var s=e("babel-runtime/helpers/extends")["default"],r=e("react"),n=e("../../items/lib/standardize"),a=e("../../items/Grid"),o=i.live,l=["radio","track","artist","playlist","album","show","generic"],p=r.createClass({displayName:"GridLayout",propTypes:{title:r.PropTypes.string,subtitle:r.PropTypes.string,separator:r.PropTypes.bool,items:r.PropTypes.array.isRequired,section_id:r.PropTypes.string.isRequired},componentDidMount:function(){this._logDisplay()},render:function(){return r.createElement("div",{className:"home-mix"},this._renderTitle(),r.createElement("ul",{className:"thumbnail-grid"},this._renderItems()))},_renderTitle:function(){return"undefined"==typeof this.props.title?null:r.createElement("div",{className:"home-title"},r.createElement("h3",{className:"heading-3"},this.props.title),this._renderSubTitle())},_renderSubTitle:function(){return"undefined"==typeof this.props.subtitle?null:r.createElement("h4",{className:"heading-4-sub"},this.props.subtitle)},_renderItems:function(){return this.props.items.map(this._renderItem)},_renderItem:function(e,t){if(-1===l.indexOf(e.type))throw new Error('Items of type "'+e.type+'" are not handled by the Grid layout.');return r.createElement(a,s({key:t},n(e)))},_logDisplay:function(){o.log.send("navigation",{event:"onDisplay",properties:{section:this.props.section_id}})}});t.exports=p}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../items/Grid":48,"../../items/lib/standardize":56,"babel-runtime/helpers/extends":104,react:"react"}],48:[function(e,t,i){"use strict";var s=e("react"),r=e("../../../common/Thumbnail"),n=e("../../../common/TagList"),a=e("./../lib/navigate"),o=s.createClass({displayName:"GridItem",propTypes:{id:s.PropTypes.number,type:s.PropTypes.string.isRequired,target:s.PropTypes.string,pictures:s.PropTypes.arrayOf(s.PropTypes.shape({md5:s.PropTypes.string.isRequired,type:s.PropTypes.string.isRequired})).isRequired,play_button:s.PropTypes.bool,title:s.PropTypes.string.isRequired,subtitle:s.PropTypes.string,weight:s.PropTypes.number,data:s.PropTypes.object,tags:s.PropTypes.arrayOf(s.PropTypes.string),item_id:s.PropTypes.string.isRequired},getDefaultProps:function(){return{play_button:!1,weight:1,tags:[]}},render:function(){var e=[this._renderThumbnail(),s.createElement("div",{key:"infos",className:"thumbnail-infos"},this._renderInfos())];return s.createElement("li",null,s.createElement("div",{className:"thumbnail-col"},e))},_renderThumbnail:function(){return this.props.pictures instanceof Array==!1||0===this.props.pictures.length?null:s.createElement("div",{key:"thumbnail",className:"thumbnail-wrapper"},s.createElement(r,{id:this.props.id,md5:this.props.pictures[0].md5,type:this.props.type,picture_type:this.props.pictures[0].type,multi_cover:!0,width:250,height:250,play:this.props.play_button,preview:!0,radio:!0,title:this.props.title,context_menu:this.props.data,context:"home_radio",onClick:a.bind(this)}))},_renderInfos:function(){var e=this.props.tags.length>0,t="string"==typeof this.props.subtitle;if(!e&&t)return s.createElement("p",{className:"heading-2-sub"},this.props.subtitle);var i=this.props.tags.map(function(e){return{LABEL:e}});return s.createElement(n,{tags:i,type:"text"})}});t.exports=o},{"../../../common/TagList":32,"../../../common/Thumbnail":33,"./../lib/navigate":55,react:"react"}],57:[function(e,t,i){(function(i){"use strict";var s=e("babel-runtime/helpers/extends")["default"],r=e("react"),n=e("../../items/lib/standardize"),a=e("../../items/DeeplinkList"),o=i.live,l=r.createClass({displayName:"DeeplinkListLayout",propTypes:{title:r.PropTypes.string,subtitle:r.PropTypes.string,separator:r.PropTypes.bool,items:r.PropTypes.array.isRequired,section_id:r.PropTypes.string.isRequired},componentDidMount:function(){this._logDisplay()},render:function(){return r.createElement("div",{className:"home-nav home-list home-list-"+this.props.items.length+" clearfix"},this._renderTitle(),r.createElement("div",null,this._renderItems()))},_renderTitle:function(){return"undefined"==typeof this.props.title?null:r.createElement("div",{className:"home-title"},r.createElement("h3",{className:"heading-3"},this.props.title),this._renderSubTitle())},_renderSubTitle:function(){return"undefined"==typeof this.props.subtitle?null:r.createElement("h4",{className:"heading-4-sub"},this.props.subtitle)},_renderItems:function(){return this.props.items.map(this._renderItem)},_renderItem:function(e,t){switch(e.type){case"deeplink":return r.createElement(a,s({key:t},n(e)));default:throw new Error('Items of type "'+e.type+'" are not handled by the DeeplinkList layout.')}},_logDisplay:function(){o.log.send("navigation",{event:"onDisplay",properties:{section:this.props.section_id}})}});t.exports=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../items/DeeplinkList":47,"../../items/lib/standardize":56,"babel-runtime/helpers/extends":104,react:"react"}],56:[function(e,t,i){"use strict";var s=e("babel-runtime/core-js/object/assign")["default"],r=function(e){e=s({},e);var t={album:"ALB_ID",app:"APP_ID",artist:"ART_ID",playlist:"PLAYLIST_ID",radio:"RADIO_ID",show:"SHOW_ID",track:"SNG_ID",user:"USER_ID"};return t[e.type]&&(e.id=Number(e.data[t[e.type]])),e};t.exports=r},{"babel-runtime/core-js/object/assign":102}],47:[function(e,t,i){"use strict";var s=e("react"),r=e("classnames"),n=e("./../lib/navigate"),a=s.createClass({displayName:"DeeplinkListItem",propTypes:{type:s.PropTypes.string.isRequired,target:s.PropTypes.string.isRequired,icon:s.PropTypes.string.isRequired,title:s.PropTypes.string.isRequired,item_id:s.PropTypes.string.isRequired},render:function(){var e=r({"icon icon-home":!0,"icon-top-playlist":"top"===this.props.icon,"icon-new-releases":"new_release"===this.props.icon,"icon-hear-this":"feed"===this.props.icon,"icon-mix":"mix"===this.props.icon,"icon-podcast":"show"===this.props.icon,"icon-user":"profile"===this.props.icon,"icon-download":"download"===this.props.icon,"icon-album":"album"===this.props.icon,"icon-playlist":"playlist"===this.props.icon,"icon-love":"favorite"===this.props.icon,"icon-app":"app"===this.props.icon,"icon-link":"default"===this.props.icon});return s.createElement("div",{className:"home-list-item"},s.createElement("div",{className:"nano-card-item",onClick:n.bind(this)},s.createElement("span",{className:e}),s.createElement("span",{className:"heading-4"},this.props.title),s.createElement("span",{className:"icon icon-16 icon-arrow-right pull-right"})))}});t.exports=a},{"./../lib/navigate":55,classnames:"classnames",react:"react"}],55:[function(e,t,i){(function(e){"use strict";var i=e.live,s=function(){return"string"==typeof this.props.target?(i.log.send("navigation",{event:"onClick",properties:{id:this.props.item_id,type:this.props.type}}),/^\//.test(this.props.target)?void www.navigate(this.props.target):void(document.location=this.props.target)):void 0};t.exports=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[3]);;
(function(){'use strict';if(window.PLATFORM==='web'){var detectFlashCallback=function(){var player=document.getElementById('audioPlayerSWF');util.detectFlash(player,function(err){if(err){modal.open('/lightbox/flash_detect?type='+
encodeURIComponent(err)+'&browser='+encodeURIComponent(BrowserDetect.browser)+'&os='+encodeURIComponent(BrowserDetect.OS),true);}else{Events.unsubscribe(Events.player.play,detectFlashCallback);$('.page-sidebar').off('click',detectFlashCallback);$(document).off('click','#flash_detect a');}});};$(window).load(function(){setTimeout(function(){$(document).on('click','#flash_detect a',function(){var type=$(this).data('type');var clickType=$(this).data('click-type');if(type&&clickType){tracking.track('navigation',{event:'onClick',properties:{notification:'flash_detect',message:type}});}
modal.close();});Events.subscribe(Events.player.play,detectFlashCallback);$('.page-sidebar').on('click',detectFlashCallback);detectFlashCallback();},5000);});}})();;
var biography={display:function(args){if(artist.data.BIO===false){return false;}
var content=$('#tab_biography_content');$('[data-target="intro"]',content).html(artist.data.BIO.RESUME);$('[data-target="title"]',content).html(artist.data.DATA.ART_NAME);$('[data-target="text"]',content).html(artist.data.BIO.BIO);Events.trigger(Events.navigation.tab_displayed,{type:args.type,id:args.id});}};
(function(){'use strict';var track_list={display:function(args){if(gatekeeper.isAllowed('datagrid')){ReactComponent.require('trackList/trackList',function(trackList){track_list.component=React.render(trackList({id:args.data.id,personnal:args.data.playlist_personnal||args.data.playlist_collab,tracks:args.data.playlist_private?{data:[],total:0,count:0}:args.data.songs}),document.getElementById('tab_track_list_content'));});Events.trigger(Events.navigation.tab_displayed,args);}else{$('#tab_track_list_content').createDatagrid($.extend(args.data,{event_group:'track_list'}));}},onDisplay:function(){if(gatekeeper.isAllowed('datagrid')){return;}
track_list.activeScroll();},activeScroll:function(){if(gatekeeper.isAllowed('datagrid')){return;}
datagrid.action($('#tab_track_list_content'),['activeInfiniteScroll']);}};window.track_list=track_list;})();;
(function(){'use strict';var discography_catalog={initialized:false,loadComplete:false,last_album_type:'',last_role:0,format:'big',start:0,nb:{big:10,small:15},total:0,art_id:0,coverSize:250,init:function(){try{if(discography_catalog.initialized){return true;}
Handlebars.registerHelper('discographyDatagrid',function(item){var cds=[];var disk_number=0;var seven_tracks={data:[],count:0,total:0};var currentArtName;var currentUrlRewritting;var track_number;if(item.SONGS!=null&&item.SONGS.count!=null&&item.SONGS.count>0){for(var track_item in item.SONGS.data){if(!item.SONGS.data.hasOwnProperty(track_item)){continue;}
var track=item.SONGS.data[track_item];disk_number=parseInt(track.DISK_NUMBER,10)-1;track_number=parseInt(track.TRACK_NUMBER,10)-1;if(typeof cds[disk_number]==='undefined'){cds[disk_number]=[];}
if(typeof cds[disk_number][track_number]==='undefined'||right.checkSongAvailable(track)==right.READABLE){cds[disk_number][track_number]=track;currentArtName=track.ART_NAME;currentUrlRewritting=track.URL_REWRITING;}}
disk_number=cds.length;for(var disk in cds){if(!cds.hasOwnProperty(disk)){continue;}
for(var t_number in cds[disk]){if(!cds[disk].hasOwnProperty(t_number)){continue;}
seven_tracks.data.push(cds[disk][t_number]);}}
seven_tracks.data=seven_tracks.data.splice(0,20);seven_tracks.count=seven_tracks.total=seven_tracks.data.length;}
var mainArtistHash={};for(var artists in item.ARTISTS){if(!item.ARTISTS.hasOwnProperty(artists)){continue;}
if(item.ARTISTS[artists].ROLE_ID==0){mainArtistHash[item.ARTISTS[artists].ART_ID]=true;}}
var template=Handlebars.templates.components_discography_datagrid;var html=template({id:item.ALB_ID,songs:JSON.stringify(seven_tracks),main_artist_hash:JSON.stringify(mainArtistHash),disk_number:disk_number});return html;});Handlebars.registerHelper('eachDiscographyCatalog',function(data,options){var str='';var nb_data=data.length;var item;var album_type_name;var new_container;for(var i=0;i<nb_data;i++){item=data[i];item.currentClass=naboo.getCurrentClass();item.isCurrentAlbumPage=(naboo.getCurrentClass()==='album'&&album.id==data[i].ALB_ID);item.isFirst=(str==='');album_type_name='';new_container=false;if(i===0||(discography_catalog.last_album_type!=item.TYPE&&discography_catalog.last_role==0)){new_container=true;}
if(item.TYPE!=null&&item.TYPE!=discography_catalog.last_album_type&&discography_catalog.last_role==0){album_type_name=discography_catalog.getAlbumType(item.TYPE);discography_catalog.last_album_type=item.TYPE;}
if(typeof item.ROLE_ID!=='undefined'&&item.ROLE_ID!=discography_catalog.last_role&&discography_catalog.last_role==0){album_type_name=gettext('Apparaît dans');discography_catalog.last_role=item.ROLE_ID;}
if(album_type_name!==''){item.album_type_name=album_type_name;}
str+=options.fn(item);}
return str;});discography_catalog.initialized=true;return true;}catch(e){error.log(e);}},destroy:function(){Events.unsubscribeAll('discography_catalog');discography_catalog.start=0;},display:function(args){try{discography_catalog.init();discography_catalog.art_id=args.art_id;if(typeof args.start!=='undefined'){discography_catalog.start=args.start;}
if(discography_catalog.start==0){discography_catalog.loadComplete=false;discography_catalog.last_album_type='';discography_catalog.last_role=0;discography_catalog.total=0;}
if(typeof args.data==='object'){discography_catalog.displayCallback({results:args.data,error:[]});return true;}
api.call({method:'album.getDiscography',data:{art_id:discography_catalog.art_id,start:discography_catalog.start,nb:discography_catalog.nb[discography_catalog.format],filter_role_id:[0,1,5]},success:discography_catalog.displayCallback});return true;}catch(e){error.log(e);}},displayCallback:function(result){try{discography_catalog.displayCatalogMessage();var currentClass=naboo.getCurrentClass();if(result.count>0){if(typeof result.data[0].DEFAULT_ALBUM!=='undefined'){result.data.shift();}
var $root=$('#catalog_component_discography_'+discography_catalog.format).show();if(discography_catalog.format=='big'){$root.append(Handlebars.templates.catalog_components_discography(result.data));}else{var albumData={data:result.data,button_favorite:true};if(currentClass==='artist'){albumData.context_menu_excludes='["go_to_artist"]';}
if(currentClass==='album'){for(var i=0;i<albumData.data.length;i++){if(album.id==albumData.data[i].ALB_ID){albumData.data[i].isCurrentAlbumPage=true;break;}}}
var html=Handlebars.templates.common_album(albumData);$('> ul',$root).append(html);var refresh=$('ul',$root).responsiveCover_update();if(refresh===false){$('> ul',$root).responsiveCover({cover_width:discography_catalog.coverSize,cover_height:discography_catalog.coverSize,gap:15});}}}else if(currentClass==='artist'){if(typeof artist.data.DATA.DATA==='undefined'||!artist.data.DATA.DATA.DISABLE_CATALOG){$('#naboo_discography_empty').show();}}else{$('#naboo_discography_empty').show();}
discography_catalog.total=result.total;discography_catalog.loadComplete=(result.total<=parseInt(discography_catalog.start+discography_catalog.nb[discography_catalog.format],10));discography_catalog.onDisplay();Events.trigger(Events.navigation.tab_displayed,{id:discography_catalog.art_id,type:'discography_catalog'});return true;}catch(e){error.log(e);}},onDisplay:function(){Events.subscribe(Events.layout.adsBackground,discography_catalog.displayAds,'discography_catalog');discography_catalog.activeScroll();},activeScroll:function(){try{infinite_scroll.disable();if(discography_catalog.loadComplete){return true;}
Events.subscribeOnce(Events.layout.infiniteScroll,function(){if(discography_catalog.total>discography_catalog.start){discography_catalog.display({art_id:discography_catalog.art_id,start:discography_catalog.start+discography_catalog.nb[discography_catalog.format]});}},'discography_catalog');infinite_scroll.active($('#tab_discography_content'));return true;}catch(e){error.log(e);}},switchModele:function(format){try{Events.unsubscribeAll('discography_catalog');if(format==='small'){$('#catalog_component_discography_big').empty().hide();}else{$('#catalog_component_discography_small').hide().children('ul').empty();}
discography_catalog.format=format;discography_catalog.start=0;discography_catalog.display({art_id:discography_catalog.art_id,start:discography_catalog.start});return true;}catch(e){error.log(e);}},displayCatalogMessage:function(){try{if(naboo.getCurrentClass()=='artist'){if(typeof artist.data.DATA.DATA!=='undefined'&&artist.data.DATA.DATA.DISABLE_CATALOG){$('#naboo_discography_disable_catalog').show();return true;}}
$('#naboo_discography_disable_catalog').hide();return false;}catch(e){error.log(e);}},getAlbumType:function(type){try{var labels=[gettext('Singles'),gettext('Albums'),gettext('Splits'),gettext('EPs')];var index=parseInt(type,10);if(index<0||index>=labels.length){return false;}
return labels[index];}catch(e){error.log(e);}},displayAds:function(){try{if(discography_catalog.format==='small'){$('#component_discography > .thumbnail-grid').responsiveCover_update();}
return true;}catch(e){error.log(e);}}};window.discography_catalog=discography_catalog;})();;
(function(){'use strict';var related_track={display:function(args){if(typeof args.album_list==='undefined'||countObject(args.album_list)===0){return false;}
var list=[];for(var t=0;t<args.album_list.length;t++){if(right.checkSongAvailable(args.album_list[t])===right.READABLE){list.push(args.album_list[t]);}}
var grid=React.createFactory(window.DzrComponents.Grid);React.render(grid({data:list,type:'album',context:'track_page',options:['name','artist']}),document.getElementById('related_content_top'));Events.trigger(Events.navigation.tab_displayed,args);return true;},leave:function(){React.unmountComponentAtNode(document.getElementById('related_content_top'));}};window.related_track=related_track;})();;
(function(){'use strict';var related_playlist={id:0,type:0,initialized:false,destroy:function(){_related_playlist.start=0;related_playlist.initialized=false;_related_playlist.grid=false;React.unmountComponentAtNode(document.getElementById('naboo_related_playlist_list'));},display:function(args){try{_related_playlist.init();related_playlist.id=args.id;related_playlist.type=args.type;if(typeof args.start!=='undefined'){_related_playlist.start=args.start;}
api.call({method:related_playlist.type+'_getRelatedPlaylist',data:{id:related_playlist.id,start:_related_playlist.start,nb:_related_playlist.nb},success:_related_playlist.displayCallback});return true;}catch(e){error.log(e);}},onDisplay:function(){_related_playlist.init();_related_playlist.activeInfiniteScroll();}};var _related_playlist={start:0,nb:15,loadComplete:false,grid:false,init:function(){try{if(related_playlist.initialized===true){return false;}
related_playlist.initialized=true;return related_playlist.initialized;}catch(e){error.log(e);}},displayCallback:function(result){try{_related_playlist.loadComplete=(result.total<=parseInt(_related_playlist.start+_related_playlist.nb,10));if(_related_playlist.grid===false){var grid=React.createFactory(window.DzrComponents.Grid);_related_playlist.grid=React.render(grid({data:result.data,type:'playlist',context:'artist_page',tab:'related_playlists',options:['name','creator','fans']}),document.getElementById('naboo_related_playlist_list'),_related_playlist.activeInfiniteScroll);}else{_related_playlist.grid.setProps({data:_related_playlist.grid.props.data.concat(result.data)},function(){_related_playlist.activeInfiniteScroll();});}
Events.trigger(Events.navigation.tab_displayed,{type:'related_playlist',id:related_playlist.id});return true;}catch(e){error.log(e);}},activeInfiniteScroll:function(){if(_related_playlist.loadComplete){infinite_scroll.disable();return false;}
Events.subscribeOnce(Events.layout.infiniteScroll,function(){infinite_scroll.disable();related_playlist.display({id:related_playlist.id,type:related_playlist.type,start:_related_playlist.start+_related_playlist.nb});},'related_playlist');infinite_scroll.active();}};window.related_playlist=related_playlist;})();;
var lyrics={display:function(args){api.call({method:'song.getLyrics',data:{SNG_ID:args.sng_id},success:function(data){var container=$('#tab_lyrics_content');var lyricsData=data.LYRICS_TEXT.split(/\r\n|\r|\n/g);var fragment=document.createDocumentFragment();var para;var lyric;for(var i=0,len=lyricsData.length;i<len;i++){lyric=lyricsData[i];para=document.createElement('p');para.innerHTML=lyric||'&nbsp;';fragment.appendChild(para);}
$('.lyrics-content',container).append(fragment);$('.copyrights',container).html(data.LYRICS_COPYRIGHTS);$('.writers',container).html(data.LYRICS_WRITERS);var btn=$('.btn-karaoke',container);btn.on('click',function(){if(dzPlayer.getPlayerType()!=='ads'){if(dzPlayer.getCurrentSong('SNG_ID')!==args.sng_id){dzPlayer.play({id:args.sng_id,type:'track'});Events.subscribeOnce(Events.player.play,function(){menu.openPanel('lyrics');});}else{menu.openPanel('lyrics');}}});if(data.LYRICS_SYNC_JSON&&data.LYRICS_SYNC_JSON.length){btn.addClass('has-sync');}else{btn.addClass('has-text');}
btn.removeClass('hide');Events.trigger(Events.navigation.tab_displayed,args);lyrics.log({action:{type:'display'},container:'page_track',sng:args.sng_id,ts:SERVER_TIMESTAMP,type:(data.LYRICS_SYNC_JSON&&data.LYRICS_SYNC_JSON.length)?'synchro':'full_text'});}});return true;},log:function(params){api.call({method:'log_central.log',data:{BATCH:[{channel:'lyrics',params:params}]}});}};;
(function(){'use strict';var fan={type:'',element_id:0,nb:20,start:0,loadComplete:false,grid:false,destroy:function(){fan.start=0;fan.grid=false;React.unmountComponentAtNode(document.getElementById('naboo_fan_list'));},display:function(args){try{fan.type=args.type;fan.element_id=args.id;if(typeof args.start!=='undefined'){fan.start=args.start;}
var params={start:fan.start,nb:fan.nb,country_name:true};var method_name;switch(fan.type){case'playlist':method_name='playlist.getFans';params.playlist_id=fan.element_id;break;case'artist':method_name='artist.getFans';params.art_id=fan.element_id;break;case'album':method_name='album.getFans';params.alb_id=fan.element_id;break;default:break;}
api.call(method_name,params,fan.displayCallback);return true;}catch(e){error.log(e);}},displayCallback:function(result){try{fan.loadComplete=result.total<=parseInt(fan.start+fan.nb,10);if(fan.grid===false){var grid=React.createFactory(window.DzrComponents.Grid);fan.grid=React.render(grid({data:result.data,type:'user',context:'artist_page',tab:'fan_tab',options:['name','follow']}),document.getElementById('naboo_fan_list'),fan.activeInfiniteScroll);}else{fan.grid.setProps({data:fan.grid.props.data.concat(result.data)},function(){fan.activeInfiniteScroll();});}
if(result.count>0){var title=$('#naboo_fan_title');if(title.length===1&&fan.start===0){title.append(ngettext('Fan','Fans',{count:window[fan.type].data.NB_FAN})).children('span').text(breakUpThousands(window[fan.type].data.NB_FAN));}}
Events.trigger(Events.navigation.tab_displayed,{type:fan.type,id:fan.element_id});return true;}catch(e){error.log(e);}},onDisplay:function(){fan.activeInfiniteScroll();},activeInfiniteScroll:function(){if(fan.loadComplete){infinite_scroll.disable();return false;}
Events.subscribeOnce(Events.layout.infiniteScroll,function(){infinite_scroll.disable();fan.display({id:fan.element_id,type:fan.type,start:fan.start+fan.nb});},'fan');infinite_scroll.active();}};window.fan=fan;})();;
if(typeof comment=="undefined"){var comment={type_id:{artist:1,album:2,user:3,playlist:4,radio:5,video:6},remove:function(data,callback){if(typeof data!=='object'){return false;}
var type_id=comment.type_id[data.type]||0;api.call({method:'comment.delete',data:{comment_id:data.id,type:type_id,element_id:data.elementId},success:callback});},flag:function(data,callback){if(typeof data!=='object'){return false;}
var type_id=comment.type_id[data.type]||0;api.call({method:'comment.flag',data:{comment_id:data.id,type:type_id},success:callback});},post:function(data,callback){if(typeof data!=='object'){return false;}
var type_id=comment.type_id[data.type]||0;api.call({method:'comment.add',data:{comment:data.comment_txt,element_id:data.element_id,type:type_id,lang:SETTING_LANG},success:callback});},display:function(data,callback){if(typeof data!=='object'){return false;}
var type_id=comment.type_id[data.type]||0;api.call({method:'comment.getList',data:{element_id:data.element_id,type:type_id,start:data.start,nb:data.nb},success:callback});},getData:function(data,callback){if(typeof data!=='object'){return false;}
api.call({method:'comment.getData',data:{comment_id:data.comment_id},success:callback});}};};
(function(){'use strict';var related={art_id:0,start:0,nb:15,loadComplete:false,grid:false,initialized:false,init:function(){try{if(related.initialized===true){return false;}
return true;}catch(e){error.log(e);}},destroy:function(){related.start=0;related.initialized=false;related.grid=false;React.unmountComponentAtNode(document.getElementById('naboo_related_list'));},display:function(args){try{related.init();related.art_id=args.art_id;if(typeof args.start!=='undefined'){related.start=args.start;}
var params={art_id:related.art_id,start:related.start,nb:related.nb};api.call('artist.getRelated',params,related.displayCallback);return true;}catch(e){error.log(e);}},displayCallback:function(result){try{related.loadComplete=(result.total<=parseInt(related.start+related.nb,10));if(related.grid===false){var grid=React.createFactory(window.DzrComponents.Grid);related.grid=React.render(grid({data:result.data,type:'artist',context:'artist_page',tab:'related_artists',options:['name','fans','favorite']}),document.getElementById('naboo_related_list'),related.activeInfiniteScroll);}else{related.grid.setProps({data:related.grid.props.data.concat(result.data)},function(){related.activeInfiniteScroll();});}
Events.trigger(Events.navigation.tab_displayed,{type:'related',id:related.art_id});return true;}catch(e){error.log(e);}},onDisplay:function(){related.init();related.activeInfiniteScroll();},activeInfiniteScroll:function(){if(related.loadComplete){infinite_scroll.disable();return false;}
Events.subscribeOnce(Events.layout.infiniteScroll,function(){infinite_scroll.disable();related.display({art_id:related.art_id,start:related.start+related.nb});},'related');infinite_scroll.active();}};window.related=related;})();;
(function(){'use strict';var replace={sng_id:0,div:'',playlist_id:0,songs_list:[],current_selected_id:0,init:function(sng_id,playlist_id,songs,div){try{replace.sng_id=sng_id;replace.playlist_id=playlist_id;replace.songs_list=songs;replace.div=div;window.setTimeout(function(){$('#hovercard_content_tracks').tinyscrollbar();},100);return true;}catch(e){error.log(e);}},replaceTrack:function(){try{if(replace.current_selected_id===0||typeof replace.sng_id==='undefined'||typeof replace.playlist_id==='undefined'){return false;}
var params={new_sng_id:replace.current_selected_id,old_sng_id:replace.sng_id,playlist_id:replace.playlist_id};api.call('playlist.recoverSong',params,replace.replaceTrackCallback);return true;}catch(e){error.log(e);}},replaceTrackCallback:function(result){try{if(result===true){if(gatekeeper.isAllowed('datagrid')){window.track_list.component.replaceItem(replace.sng_id,replace.getNewSongInfo(Number(replace.current_selected_id)));}else{datagrid.action($('#'+replace.div),['onReplaced',replace.sng_id,replace.getNewSongInfo(Number(replace.current_selected_id))]);}
hovercard.remove();}
return true;}catch(e){error.log(e);}},deleteTrack:function(){try{if(confirm(gettext('Voulez-vous vraiment effacer ce morceau ?'))){if(typeof replace.sng_id==='undefined'){return false;}
if(typeof replace.playlist_id==='undefined'){return false;}
api.call('playlist.deleteSongs',{playlist_id:replace.playlist_id,songs:[[replace.sng_id,0]]},replace.deleteTrackCallback);}
return true;}catch(e){error.log(e);}},deleteTrackCallback:function(result){try{if(result===true){if(gatekeeper.isAllowed('datagrid')){window.track_list.component.removeItems([replace.sng_id]);}else{datagrid.action($('#'+replace.div),['onRemoved',result,{sng_list:[[replace.sng_id,0]]}]);}
hovercard.remove();userData.removePlaylistSong(replace.playlist_id,[{SNG_ID:replace.sng_id}]);}
return true;}catch(e){error.log(e);}},getNewSongInfo:function(sngId){try{if(replace.songs_list===0){return false;}
for(var t=0;t<replace.songs_list.length;t++){if(Number(replace.songs_list[t].SNG_ID)===Number(sngId)){return replace.songs_list[t];}}
return true;}catch(e){error.log(e);}},play:function(sngId){try{dzPlayer.play({data:[replace.getNewSongInfo(sngId)]});return true;}catch(e){error.log(e);}},selectTrack:function($line){try{replace.current_selected_id=$line.attr('data-id');$line.parents('dl').parent().children('dl').removeClass('selected');$line.parents('dl').addClass('selected');$('#hovercard_replace_button').show();return true;}catch(e){error.log(e);}}};window.replace=replace;})();;
if(typeof genre==='undefined'){var genre={loaded:false,list:[],hash_list:{},hash_sub_list:{},load:function(){try{if(genre.loaded){return false;}
api.call({method:'deezer.getGenres',success:genre.build});return true;}catch(e){error.log(e);}},build:function(data){try{genre.list=data.slice(0);var nb_genres=data.length;for(var i=0;i<nb_genres;i++){var current_genre=jQuery.extend({},data[i]);genre.hash_list[current_genre.GENRE_ID]=current_genre;genre.hash_list[current_genre.GENRE_ID].INDEX=i;if(typeof current_genre.CHILDREN!=='undefined'){var nb_children=current_genre.CHILDREN.length;for(var j=0;j<nb_children;j++){var sub_genre=current_genre.CHILDREN[j];if(typeof genre.hash_list[current_genre.GENRE_ID].SUB_GENRE==='undefined'){genre.hash_list[current_genre.GENRE_ID].SUB_GENRE={};}
genre.hash_list[current_genre.GENRE_ID].SUB_GENRE[sub_genre.GENRE_ID]=sub_genre;genre.hash_sub_list[sub_genre.GENRE_ID]=current_genre.GENRE_ID;}
delete current_genre.CHILDREN;}}
genre.loaded=true;Events.resolve(Events.genre.loaded);}catch(e){error.log(e);}},getData:function(id){try{if(!genre.loaded){return false;}
var index=0;if(typeof genre.hash_list[id]!=='undefined'){index=genre.hash_list[id].INDEX;return genre.list[index];}
if(typeof genre.hash_list[genre.getParentId(id)]!=='undefined'){return genre.hash_list[genre.getParentId(id)].SUB_GENRE[id];}
return false;}catch(e){error.log(e);}},isMain:function(id){try{if(!genre.loaded){return false;}
return(typeof genre.hash_list[id]!=='undefined');}catch(e){error.log(e);}},getParentId:function(child_id){try{if(!genre.loaded){return false;}
if(genre.isMain(child_id)){return false;}
return genre.hash_sub_list[child_id];}catch(e){error.log(e);}}}};
if(typeof(talk_genre)==='undefined'){var talk_genre={loaded:false,list:[],hash_list:{},hash_sub_list:{},load:function(){try{if(talk_genre.loaded){return false;}
api.call('deezer.getGenres',{HAS_FILTERS_TALK:1},talk_genre.build);return true;}catch(e){error.log(e);}},build:function(data){try{talk_genre.list=data.slice(0);var nb_genres=data.length;for(var i=0;i<nb_genres;i++){var current_genre=jQuery.extend({},data[i]);talk_genre.hash_list[current_genre.GENRE_ID]=current_genre;talk_genre.hash_list[current_genre.GENRE_ID].INDEX=i;if(typeof(current_genre.CHILDREN)!=='undefined'){var nb_children=current_genre.CHILDREN.length;for(var j=0;j<nb_children;j++){var sub_genre=current_genre.CHILDREN[j];if(typeof(talk_genre.hash_list[current_genre.GENRE_ID].SUB_GENRE)==='undefined'){talk_genre.hash_list[current_genre.GENRE_ID].SUB_GENRE={};}
talk_genre.hash_list[current_genre.GENRE_ID].SUB_GENRE[sub_genre.GENRE_ID]=sub_genre;talk_genre.hash_sub_list[sub_genre.GENRE_ID]=current_genre.GENRE_ID;}
delete current_genre.CHILDREN;}}
talk_genre.loaded=true;Events.resolve(Events.talk_genre.loaded);}catch(e){error.log(e);}},getData:function(id){try{if(!talk_genre.loaded){return false;}
var index=0;if(typeof(talk_genre.hash_list[id])!=='undefined'){index=talk_genre.hash_list[id].INDEX;return talk_genre.list[index];}
if(typeof(talk_genre.hash_list[talk_genre.getParentId(id)])!=='undefined'){return talk_genre.hash_list[talk_genre.getParentId(id)].SUB_GENRE[id];}
return false;}catch(e){error.log(e);}},isMain:function(id){try{if(!talk_genre.loaded){return false;}
return(typeof(talk_genre.hash_list[id])!=='undefined');}catch(e){error.log(e);}},getParentId:function(child_id){try{if(!talk_genre.loaded){return false;}
if(talk_genre.isMain(child_id)){return false;}
return talk_genre.hash_sub_list[child_id];}catch(e){error.log(e);}}}};
(function($){$.selectgenre=$.selectgenre||{};$.selectgenre.options={id:0,callback:function(){},displaySubGenre:true,dataSource:genre};$.selectgenre.selected={id_main:null,id_sub:null};$.fn.selectGenre=function(opt){if($(this).data('stg')){if(opt.id===$.selectgenre.selected.id_main||opt.id===$.selectgenre.selected.id_sub){return false;}}
var options=$.extend({},$.selectgenre.options,opt);this.each(function(){$(this).data('stg',new SelectGenre($(this),options));});return this;};$.fn.updateGenre=function(id){if(!$(this).data('stb')){return false;}
$(this).data('stb').update(id);return this;};function SelectGenre(root,options){var oRoot=root;var parentGenre='';var childGenre='';var currentSelectedId='';function create(){parentGenre=$('[data-target="genre-parents"]',oRoot);childGenre=$('[data-target="genre-children"]',oRoot);var current_genre_id=options.id;var main_genre_id=(options.dataSource.isMain(current_genre_id))?current_genre_id:options.dataSource.getParentId(current_genre_id);var child_genre_id=(options.dataSource.isMain(current_genre_id))?0:current_genre_id;if(!parentGenre.selectItem(main_genre_id)){parentGenre.createSelectbox({data:options.dataSource.list,id:'GENRE_ID',label:'GENRE_NAME',selectedId:main_genre_id,callback:parentSelect});$.selectgenre.selected.id_main=main_genre_id;}
var sub_genre_data=options.dataSource.getData(main_genre_id);if(typeof(sub_genre_data.CHILDREN)!=='undefined'&&options.displaySubGenre){if(!childGenre.selectItem(child_genre_id)){childGenre.createSelectbox({data:sub_genre_data.CHILDREN,id:'GENRE_ID',label:'GENRE_NAME',selectedId:child_genre_id,callback:childSelect});$.selectgenre.selected.id_sub=child_genre_id;}}else{childGenre.hide();}}
function parentSelect(data){try{var parent_genre=options.dataSource.getData(data.GENRE_ID);if(typeof parent_genre.CHILDREN!=='undefined'&&parent_genre.CHILDREN.length>0&&options.displaySubGenre){childGenre.createSelectbox({data:parent_genre.CHILDREN,id:'GENRE_ID',label:'GENRE_NAME',selectedId:0,callback:childSelect}).show();}else{childGenre.hide();}
$.selectgenre.selected.id_main=data.GENRE_ID;options.callback(data);}catch(e){error.log(e);}}
function childSelect(data){try{$.selectgenre.selected.id_sub=data.GENRE_ID;options.callback(data);}catch(e){error.log(e);}}
this.update=function(id){for(var d=0;d<options.data.length;d++){if(options.data[d][options.id]==id){label.text(options.data[d][options.label]);currentSelectedId=id;break;}}}
return create();}})(jQuery);;
if(typeof placeholder=="undefined"){var placeholder={draw:function(options){if(typeof options!=='object'){return false;}
var returnFormat='object';if(typeof options.hash==='undefined'){returnFormat='string';options={hash:options};}
var data={picture:options.hash.picture||'nocontent',wording:options.hash.wording||'Wording'};var generatePlaceholder=new Handlebars.SafeString(Handlebars.templates['placeholder'](data));return(returnFormat==='string')?generatePlaceholder.string:generatePlaceholder;}}};
(function($){$.grid=$.grid||{};$.grid.datagrid={template:{option:{},track:{},header:{},colgroup:{}},options:{songs:0,type:"",id:0,checksum:"",skin:{},disk_number:0,selectable:true,playlist_private:false,playlist_personnal:false,art_id:0,externalLoadingDataClass:'',autoplay:false,allowMoveToPlaylist:true,scrollInfinite:true,scrollAutoOnAir:false,main_artist_hash:{},offline_data:{},event_group:'datagrid'},skinDefault:{displayLovedColumn:true,displayPlayColumn:true,displaySongColumn:true,displayArtistColumn:true,displayAlbumColumn:true,displayDurationColumn:true,displayNoteColumn:true,displayCheckColumn:true,displayDateColumn:false,displayListenColumn:false,displayDownloadColumn:false,displaySongNumber:false,displayOrderNumber:false,displayCdNumber:false,displayHeader:true,displayOptionsToggle:true,displayFilter:true,displayEdit:false,displayListen:true,displaySyncOffline:(BrowserDetect.OS==='Mac'||BrowserDetect.OS==='Windows'),displayRemove:false,displayOrder:false,displayAdd:true,displayPlaylistAssistant:false,displayHistoric:false,displayPlaylistAdd:true,displaySubresult:false,displayDownload:false,displayExtendBackground:true,displaySelectAll:false,displayLoved:true,displayMultiArtistSong:false,displayFallbackIcon:false,backgroundColor:'',displayOptionPosition:'top',displayFanOnly:'hovercard',reverseBackgroundColor:false,reverseColor:false,rightClic:true},skinType:{'playlist':{displayNoteColumn:false,displayDateColumn:true,displayPlaylistAssistant:true},'history':{displaySyncOffline:false,displayHistoric:false,displayNoteColumn:false,displayListenColumn:true},'lovedpersonal':{displaySyncOffline:false,displayDateColumn:true,displayNoteColumn:false},'loved':{displaySyncOffline:false,displayDateColumn:false,displayNoteColumn:true},'search':{displaySubresult:true,displaySyncOffline:false,displayListen:false,displayFilter:false},'personal_song':{displayEdit:true,displaySyncOffline:false,displayRemove:true,displayNoteColumn:false},'downloads':{displayNoteColumn:false,displayDownloadColumn:true,displaySyncOffline:false,displayDownload:true,displayPlaylistAdd:false},'album':{displayArtistColumn:false,displayAlbumColumn:false,displaySongNumber:true,displayCdNumber:true,displayHeader:false,displayFilter:false,displayExtendBackground:false,displaySelectAll:true,displayMultiArtistSong:true,displayFallbackIcon:true},'artist_top':{displaySyncOffline:false,displayHeader:false,displayListen:false,displayFilter:false,displayArtistColumn:false,displayAlbumColumn:false,displayOrderNumber:true,displayMultiArtistSong:true,displayExtendBackground:false,displayOptionPosition:'hide',displayNoteColumn:false,displayCheckColumn:false,displayFanOnly:'text',reverseBackgroundColor:true},'artist_exclu':{displaySyncOffline:false,displayHeader:false,displayListen:false,displayFilter:false,displayArtistColumn:false,displayAlbumColumn:false,displayOrderNumber:true,displayExtendBackground:false,displayOptionPosition:'hide',displayNoteColumn:false,displayCheckColumn:false,displayFanOnly:'text',reverseBackgroundColor:true},'discography_album':{displaySyncOffline:false,displayHeader:false,displayListen:false,displayFilter:false,displayArtistColumn:false,displayAlbumColumn:false,displaySongNumber:true,displayCdNumber:true,displayExtendBackground:false,displayOptionPosition:'bottom',displayMultiArtistSong:true,displayFallbackIcon:true,displayOptionsToggle:false,reverseBackgroundColor:true,backgroundColor:'datagrid-white'}}};$.fn.createDatagrid=function(options){if(typeof $(this).data('dgd')=='undefined'){var options=$.extend({},$.grid.datagrid.options,options);this.each(function(){$(this).data('dgd',new Datagrid($(this),options));});return this;}};$.fn.actionDatagrid=function(params){try{if(typeof $(this).data('dgd')[params[0]]=='function'){return $(this).data('dgd')[params[0]].apply(this,Array.prototype.slice.call(params,1));}else{console.log('La method n existe pas:',params[0]);}}catch(e){error.log(e);}};$.fn.getData=function(param){try{return $(this).data('dgd').getData(param);}catch(e){error.log(e);}};$.fn.destroy=function(){try{$(this).data('dgd')['unsubscribe']();$(this).empty().removeClass('datagrid_master').removeClass('datagrid_'+$(this).data('dgd').getData('type'));$(this).removeData('dgd');}catch(e){error.log(e);}};function Datagrid(root,options){var oSelf=this;var oWrapper=root;var oDatagrid=null;var oBody=null;var oTable=null;var oHead=null;var oOption=null;var oColGroup=null;var isDisplay=false;var currentDisk=0;var filterInterval=300;var filterId=0;var filterActif=false;var filterResult=[];var unavailableList=[];var waitingAllTrackForDownload=false;var waitingAllTrackForFilter=false;var waitingAllTrackForReplaceProcess=false;var waitingAllTrackForTotalPlay=false;var waitingAllTrackForSort=false;var creationStartIndex=0;var creationEndIndex=0;var creationGroup=40;var creationInterval=100;var loadGroup=0;var removedTrackBeforeLoadComplete=0;var resizeStartIndex=0;var resizeEndIndex=0;var resizeGroup=40;var resizeInterval=50;var filterLabel='';var resizeMinPercent=8;var orderableBar=null;var cache_dom={};var lastColSort=false;var lastSort={};var artistOnlyEvent=false;var lastOnAirTrack=false;var favoriteSongEvent=false;var progressBar=null;var currentTrackNumber=0;var previousHierarchicalTitle='';var pageContent='';var scrollInterval=0;var contributor_model='';var upload_model='';var artist_model=$('<a class="evt-click" href=""></a>');var offline_mobile_model='';var offline_tablet_model='';var gridTrad={downloads:gettext('Rechercher dans mes achats'),playlist:gettext('Rechercher dans la playlist'),personal_song:gettext('Rechercher dans mes MP3'),folder:gettext('Rechercher dans le dossier'),loved:gettext('Rechercher parmi les titres'),loved_personal:gettext('Rechercher parmi les titres'),history:gettext('Rechercher dans l\'historique')};function create(){try{oWrapper.empty();templating.load('naboo/components/datagrid',oWrapper);if(USER.USER_ID===0){oSelf.initialize();return false;}
Events.ready(Events.user.userReady,function(){oSelf.initialize();});}catch(e){error.log(e);}};this.getData=function(param){return options[param];};this.initialize=function(){try{oWrapper.addClass('datagrid_master').css('height','auto');oDatagrid=$('.datagrid',oWrapper);oTable=$('.datagrid > table',oWrapper);oBody=$('.datagrid > table > tbody',oWrapper);oHead=$('.datagrid > table > thead',oWrapper);oColGroup=$('.datagrid > table > colgroup',oWrapper);oOption=$('#naboo_datagrid_options',oWrapper);pageContent=$('#page_content');isDisplay=true;if(options.songs.total==0){options.songs.count=0;options.songs.data=[];}
Events.subscribe(Events.player.displayCurrentSong,oSelf.displayPlayingTrack);Events.subscribe(Events.player.playing,oSelf.displayPlayingIcon);Events.subscribe(Events.player.finishTrackList,oSelf.displayPlayingIcon);if(USER.USER_ID!=0){Events.ready(Events.user.userReady,function(){Events.subscribe(Events.user.addFavorite,oSelf.displayChangeFavoriteTrack);Events.subscribe(Events.user.deleteFavorite,oSelf.displayChangeFavoriteTrack);});}
if(typeof $.grid.datagrid.skinType[options.type]=='object'){options.skin=$.extend(true,{},$.grid.datagrid.skinDefault,$.grid.datagrid.skinType[options.type]);if(options.type=='playlist'||options.type=='lovedpersonal'){options.skin.displayRemove=options.skin.displayOrder=options.skin.displayDateColumn=options.playlist_personnal;options.skin.displayNoteColumn=!options.playlist_personnal;}else if(options.type=='artist_exclu'){oSelf.subscribeEventFanOnly();}}else{options.skin=$.grid.datagrid.skinDefault;console.log('datagrid type unknown :',options.type);}
if(options.skin.reverseColor){oDatagrid.addClass('datagrid-inverse');}
oSelf.templateHeader();oSelf.templateOption();oSelf.templateOtherElements();oSelf.templateLineTrack();if(options.skin.displayHeader){oSelf.setHeaderColumnSize();}
if(options.songs.total==0){options.songs.count=0;options.songs.data=[];}
if(options.playlist_private){$("#naboo_datagrid_private",oWrapper).show();oTable.remove();oOption.remove();options.songs.total=0;options.songs.count=0;options.songs.data=[];}else{$("#naboo_datagrid_private",oWrapper).remove();}
if(OFFLINE){options.selectable=false;options.skin.displayRemove=false;$('[data-target="checkall"]',oHead).hide();}
if(options.skin.displayHeader){oDatagrid.addClass('datagrid-header');}
if(options.skin.reverseBackgroundColor&&options.disk_number<2){oDatagrid.addClass('datagrid-alt');}
if(options.skin.backgroundColor!=''){oDatagrid.addClass(options.skin.backgroundColor);}
loadGroup=1;creationStartIndex=0;if(options.skin.displayCdNumber){var songsCleaner=[];for(var i in options.songs.data){if(!options.songs.data.hasOwnProperty(i)){continue;}
if(options.songs.data[i]!==null){songsCleaner.push(options.songs.data[i]);}}
options.songs.data=songsCleaner;options.songs.total=songsCleaner.length;options.songs.count=songsCleaner.length;}
oSelf.createDatagridLines();if(options.skin.rightClic){oDatagrid.bind('contextmenu',function(){return false;});;oSelf.rightClic(oBody);}
if(options.autoplay){Events.ready(Events.player.playerReady,function(){oSelf.play();});}
Events.subscribe(Events.playlist.addSong,oSelf.liveAddSong);Events.trigger(Events.datagrid.displayed,{type:options.type,id:options.id,start:0});return oSelf;}catch(e){error.log(e);}};this.templateHeader=function(){try{if($.grid.datagrid.template.header[options.type]!=null&&$.grid.datagrid.template.colgroup[options.type]!=null){if(!options.skin.displayHeader){oHead.remove();}else{oHead.empty();oHead.show();oHead.append($.grid.datagrid.template.header[options.type].clone());}
oColGroup.empty();oColGroup.append($.grid.datagrid.template.colgroup[options.type].clone());oSelf.setHeaderLink();return true;}
if(!options.skin.displayLovedColumn){$('.loved',oHead).remove();$('.loved',oColGroup).remove();}
if(!options.skin.displayPlayColumn){$('.position',oHead).remove();$('.position',oColGroup).remove();}
if(!options.skin.displaySongColumn){$('.track',oHead).remove();$('.track',oColGroup).remove();}
if(!options.skin.displayArtistColumn){$('.artist',oHead).remove();$('.artist',oColGroup).remove();}
if(!options.skin.displayAlbumColumn){$('.album',oHead).remove();$('.album',oColGroup).remove();}
if(!options.skin.displayDurationColumn){$('.length',oHead).remove();$('.length',oColGroup).remove();}
if(!options.skin.displayNoteColumn){$('.popularity',oHead).remove();$('.popularity',oColGroup).remove();}
if(!options.skin.displayDateColumn){$('.added',oHead).remove();$('.added',oColGroup).remove();}
if(!options.skin.displayListenColumn){$('.listen',oHead).remove();$('.listen',oColGroup).remove();}
if(!options.skin.displayDownloadColumn){$('.download',oHead).remove();$('.download',oColGroup).remove();}
if(!options.skin.displayCheckColumn){$('.check',oHead).remove();$('.check',oColGroup).remove();}
if(!options.skin.displayHeader){oHead.remove();}else{oHead.show();}
$.grid.datagrid.template.header[options.type]=$('tr',oHead).clone();$.grid.datagrid.template.colgroup[options.type]=$('col',oColGroup).clone();oSelf.setHeaderLink();}catch(e){error.log(e);}};this.templateOption=function(){try{if(($.grid.datagrid.template.option[options.type])!=null){$("#naboo_datagrid_options",oDatagrid).remove();if(options.skin.displayOptionPosition=='bottom'){oDatagrid.append($.grid.datagrid.template.option[options.type].clone());}else if(options.skin.displayOptionPosition=='top'){oDatagrid.prepend($.grid.datagrid.template.option[options.type].clone());}
oOption=$('#naboo_datagrid_options',oDatagrid);oSelf.setOptionLink();return true;}
if(options.skin.displayFilter){$('#naboo_datagrid_filter',oOption).show();oSelf.setFilterLabel();}else{$('#naboo_datagrid_filter',oOption).remove();}
if(options.skin.displayListen){$('#naboo_datagrid_listen',oOption).show();}else{$('#naboo_datagrid_listen',oOption).remove();}
if(options.skin.displaySyncOffline){$('#naboo_datagrid_offline',oOption).show();$('#naboo_datagrid_offline [data-target="offline-mobile"]',oOption).attr('data-tooltip',gettext('sur %s',{sprintf:[gettext('mon mobile')]}));$('#naboo_datagrid_offline [data-target="offline-tablet"]',oOption).attr('data-tooltip',gettext('sur %s',{sprintf:[gettext('ma tablette')]}));}else{$('#naboo_datagrid_offline',oOption).remove();}
if(options.skin.displayPlaylistAssistant&&options.playlist_personnal){$('#naboo_datagrid_add_track',oOption).show();}else{$('#naboo_datagrid_add_track',oOption).hide();}
if(options.skin.displaySelectAll&&!options.skin.displayHeader){$('#naboo_datagrid_select_all',oOption).show();}else{$('#naboo_datagrid_select_all',oOption).remove();}
if(!options.skin.displayDownload){$('#naboo_datagrid_download',oOption).remove();}
if(!options.skin.displayAdd){$('#naboo_datagrid_add',oOption).remove();}
if(!options.skin.displayRemove){$('#naboo_datagrid_remove',oOption).hide();}
$.grid.datagrid.template.option[options.type]=$('#naboo_datagrid_options',oDatagrid).clone();$('#naboo_datagrid_options',oDatagrid).remove();if(options.skin.displayOptionPosition=='bottom'){oDatagrid.append($.grid.datagrid.template.option[options.type].clone());}else if(options.skin.displayOptionPosition=='top'){oDatagrid.prepend($.grid.datagrid.template.option[options.type].clone());}
if(options.skin.displayOptionPosition!='hide'){oOption=$('#naboo_datagrid_options',oDatagrid);}
oSelf.setOptionLink();}catch(e){error.log(e);}};this.templateLineTrack=function(){try{if(($.grid.datagrid.template.track[options.type])!=null){options.$line_model=$.grid.datagrid.template.track[options.type];$("tr",oBody).remove();return true;}
options.$line_model=$(".song",oBody).show();$(".song",oBody).remove();if(!options.skin.displayLoved){$('.loved',options.$line_model).remove();}
if(!options.skin.displayPlayColumn){$('.position [data-target="play"]',options.$line_model).remove();}
if(!options.skin.displaySongNumber&&!options.skin.displayOrderNumber){$('.position [data-target="position"]',options.$line_model).remove();}
if(!options.skin.displaySongColumn){$('.track',options.$line_model).remove();}else{if(!options.skin.displayPlaylistAdd){$('.track [data-target="icon-playlist-add"]',options.$line_model).remove();}
if(!options.skin.displayMultiArtistSong){$('.track [data-target="featuring"]',options.$line_model).remove();}
if(!options.skin.displayEdit){$('.track [data-target="icon-edit"]',options.$line_model).remove();}
if(!options.skin.displaySubresult){$('.track [data-target="icon-similar"]',options.$line_model).remove();}
if(!options.skin.displayHistoric){$('.track [data-target="icon-historic"]',options.$line_model).remove();}}
if(!options.skin.displayArtistColumn){$('.artist',options.$line_model).remove();}
if(!options.skin.displayAlbumColumn){$('.album',options.$line_model).remove();}
if(!options.skin.displayDurationColumn){$('.length',options.$line_model).remove();}
if(!options.skin.displayCheckColumn){$('.check',options.$line_model).css('display','none');}
if(!options.skin.displayNoteColumn){$('.popularity',options.$line_model).remove();}
if(!options.skin.displayDateColumn){$('.added',options.$line_model).remove();}
if(!options.skin.displayListenColumn){$('.listen',options.$line_model).remove();}
if(!options.skin.displayDownloadColumn){$('.download',options.$line_model).remove();}
if(OFFLINE){$('.track [data-target="icon-add"]',options.$line_model).remove();}
$.grid.datagrid.template.track[options.type]=options.$line_model.clone();}catch(e){error.log(e);}};this.templateOtherElements=function(){try{ghost_single_model=$("#naboo_datagrid_ghost_single",oWrapper).clone().removeAttr('id').show();$("#naboo_datagrid_ghost_single",oWrapper).remove();ghost_multi_model=$("#naboo_datagrid_ghost_multi",oWrapper).clone().removeAttr('id').show();$("#naboo_datagrid_ghost_multi",oWrapper).remove();progressBar=$(".progress",oBody).clone().show();$(".progress",oBody).remove();fillerBar=$(".filler",oBody).clone().show();$(".filler",oBody).remove();dividerBar=$(".divider",oBody).clone().show();$(".divider",oBody).remove();if(options.skin.displayCdNumber){$(".caption > td",oBody).attr('colspan',oColGroup.children().length);disk_model=$(".caption",oBody).show().clone();}
$(".caption",oBody).remove();contributor_model=$(".contributors",oBody).show().clone();contributor_model=oSelf.addTdInLine(contributor_model,'.track',{before:true});$(".contributors",oBody).remove();if(options.type=='personal_song'){upload_model=$(".upload",oBody).show().clone();upload_model=oSelf.addTdInLine(upload_model,'.track',{before:true,after:true});}
$(".upload",oBody).remove();}catch(e){error.log(e);}};this.setHeaderLink=function(){try{$('.sortable > .label',oHead).click(function(){oSelf.sort($(this).parents('th'));});$('.check > input',oHead).click(function(){oSelf.selectAll($(this));});}catch(e){error.log(e);}};this.setHeaderColumnSize=function(){try{var lineSize=oHead.width();var trackSize=Math.floor(($('.track',oHead).width()/lineSize)*100);var artistSize=Math.floor(($('.artist',oHead).width()/lineSize)*100);if(trackSize+artistSize>100){trackSize=40;artistSize=20;}
$('.track',oHead).css('width',trackSize+'%');$('.artist',oHead).css('width',artistSize+'%');}catch(e){error.log(e);}};this.setOptionLink=function(){try{$listen=$(button_multi_state.draw({id:options.id,type:(options.type==='lovedpersonal')?'loved':options.type,action:'play',color_equalizer:'dark',wording:'full',play_context:oSelf.getContextName(),enable_delegation:false})).click(function(){$(this).data('cancelHover',true);oSelf.play($(this));});;$('#naboo_datagrid_listen',oOption).replaceWith($listen);$('#naboo_datagrid_select_all > input',oOption).click(function(){oSelf.selectAll($(this));});$('#naboo_datagrid_add',oOption).click(function(evt){oSelf.addMusicBox($(this));evt.stopPropagation();}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$('#naboo_datagrid_download',oOption).click(function(){oSelf.storeAction($(this),'download');}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$('#naboo_datagrid_remove',oOption).click(function(){oSelf.removeTrack();}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$('#naboo_datagrid_filter_text',oOption).keyup(function(){oSelf.startFilter(this.value);}).focus(function(){oSelf.onFilterFocus();});$('#naboo_datagrid_filter_clear',oOption).click(function(){$(this).prev().val('').focus();oSelf.startFilter('');});$('#naboo_datagrid_offline [data-target^="offline-"]',oOption).click(function(){oSelf.download($(this));}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});if(options.skin.displayPlaylistAssistant&&(options.playlist_personnal||options.playlist_collab)){$('#naboo_datagrid_add_track',oOption).click(function(){modal.open('/lightbox/playlist_assistant?type=add_song&playlist_id='+options.id);}).show();}else{$('#naboo_datagrid_add_track',oOption).hide();}
if(options.skin.displayOptionsToggle){oOption.show();}}catch(e){error.log(e);}};this.setLineLink=function($line){try{$line.dblclick(function(a){if($(a.target).is('i')||$(a.target).is('input')){return false;}
oSelf.play($(this));return false;});$line.find('[data-target="play"]').click(function(){oSelf.play($(this));return false;});$line.find('[data-target="track"]').click(function(){oSelf.play($(this));return false;});$line.find('[data-target="icon-add"]').click(function(){oSelf.addMusicBox($(this));return false;});$line.find('[data-target="icon-contributors"]').click(function(){oSelf.openContributor($(this));return false;}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="icon-lyrics"]').click(function(){oSelf.playWithLyrics($(this));}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="icon-edit"]').click(function(){modal.open('/lightbox/edit_personal_song.php?sng_id='+$(this).parents('tr').data('song').SNG_ID);return false;}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="icon-download"]').click(function(){oSelf.storeAction($(this),'download');return false;}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="icon-playlist-add"]').click(function(){oSelf.addMusicBox($(this),'playlist');return false;}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="download-one"]').click(function(){oSelf.storeAction($(this),'download');return false;}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="icon-link"]').mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="icon-replace"]').click(function(){hovercard.init($(this),0);return false;});$line.find('[data-target="icon-historic"]').click(function(){console.log('TODO : link');return false;}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="icon-similar"]').click(function(){oSelf.openSubResult($(this));return false;}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('.popularity').mouseover(function(){if($(this).attr('data-tooltip')==null){if($(this).parents('tr').data('song').RANK_SNG==null){return false;}
var rank_sng=($(this).parents('tr').data('song').RANK_SNG/100000);$(this).attr('data-tooltip',gettext('Popularité : ')+rank_sng.toFixed(2)+' / 10');}
oSelf.tipsy($(this),'over','e');}).mouseout(function(){if($(this).attr('data-tooltip')!=null){oSelf.tipsy($(this),'out');}});$line.find('[data-target="download-one"]').click(function(){oSelf.storeAction($(this),'download');return false;});$line.find('[data-target="check"]').click(function(){oSelf.selectOne($(this));});}catch(e){error.log(e);}};this.load=function(status,div,id,nb){try{if(creationEndIndex<options.songs.total){start=(loadGroup*creationGroup)-removedTrackBeforeLoadComplete;switch(options.type){case"playlist":var parameters={playlist_id:options.id,lang:SETTING_LANG,start:start,nb:nb,header:false,tags:false};api.call('deezer.pagePlaylist',parameters,oSelf.onLoaded,{nb:nb});break;case"lovedpersonal":case"loved":var parameters={start:start,nb:nb,user_id:options.id};api.call('favorite_song_getList',parameters,oSelf.onLoaded,{nb:nb});break;case"search":var filter='ALL';if(naboo.current_config.args&&naboo.current_config.args.tags){filter='TAG';}
var parameters={query:id,filter:filter,output:'TRACK',start:start,nb:nb};api.call('search.music',parameters,oSelf.onLoaded,{nb:nb});break;case"personal_song":var parameters={start:start,nb:nb};api.call('personal_song.getList',parameters,oSelf.onLoaded,{nb:nb});break;case"downloads":var parameters={start:start,nb:nb,order:7};api.call('store.getList',parameters,oSelf.onLoaded,{nb:nb});break;case"history":var parameters={start:start,nb:nb};api.call('user.getSongsHistory',parameters,oSelf.onLoaded,{nb:nb});break;default:console.log("datagrid.load : unknown type");}}else{if(options.scrollInfinite){infinite_scroll.disable();}}
return true;}catch(e){error.log(e);}};this.loadAllTracks=function(){try{if(options.songs.count<options.songs.total){if(options.scrollInfinite){infinite_scroll.disable();}
oSelf.load(false,"naboo_"+options.type+"_tracks",options.id,creationGroup);}
return true;}catch(e){error.log(e);}};this.onLoaded=function(result,callbackParameters){try{if(!isDisplay){return false;}
loadGroup++;switch(options.type){case"playlist":$.merge(options.songs.data,result.SONGS.data);var nbNewTrack=result.SONGS.count;if(nbNewTrack<callbackParameters.nb)options.songs.total-=(callbackParameters.nb-nbNewTrack);break;case"loved":case"lovedpersonal":$.merge(options.songs.data,result.data);var nbNewTrack=result.count;if(nbNewTrack<callbackParameters.nb)options.songs.total-=(callbackParameters.nb-nbNewTrack);break;case"search":$.merge(options.songs.data,result.data);var nbNewTrack=result.count;if(nbNewTrack<callbackParameters.nb)options.songs.total-=(callbackParameters.nb-nbNewTrack);break;case"downloads":case"personal_song":case"history":$.merge(options.songs.data,result.data);var nbNewTrack=result.count;if(nbNewTrack<callbackParameters.nb)options.songs.total-=(callbackParameters.nb-nbNewTrack);break;}
options.songs.count=options.songs.data.length;if(options.externalLoadingDataClass!=''){if(window[options.externalLoadingDataClass].isAllElementLoaded())
options.songs.total=options.songs.count;}
var oldStartInsert=creationStartIndex;oSelf.createDatagridLines(nbNewTrack);Events.trigger(Events.datagrid.displayed,{type:options.type,id:options.id,start:oldStartInsert});return true;}catch(e){error.log(e);}};this.createDatagridLines=function(addTrack){try{if(creationStartIndex+creationGroup>options.songs.count)creationEndIndex=options.songs.count;else creationEndIndex=creationStartIndex+((typeof addTrack=='undefined')?creationGroup:addTrack);$lines=$('<p></p>');for(j=creationStartIndex;j<creationEndIndex;j++){if(typeof options.songs.data[j].FALLBACK!='undefined'&&typeof options.songs.data[j].FALLBACK.SNG_ID!='undefined'){options.songs.data[j].SNG_ID_ORIGIN=options.songs.data[j].SNG_ID;delete options.songs.data[j].FALLBACK.TRACK_NUMBER;delete options.songs.data[j].FALLBACK.DISK_NUMBER;options.songs.data[j]=$.extend({},options.songs.data[j],options.songs.data[j].FALLBACK);delete options.songs.data[j].FALLBACK.SNG_ID;}
var currentData=options.songs.data[j];if(typeof currentData=='undefined')continue;if(options.skin.displayOrderNumber){currentTrackNumber++;}
if(options.skin.displayCdNumber){if(options.disk_number>1&&currentDisk<currentData.DISK_NUMBER){$disk=disk_model.clone();$('[data-target="cd"]',$disk).text('CD '+currentData.DISK_NUMBER);$lines.append($disk);currentDisk++;}}
var TYPE="";if(options.type!='search'){TYPE="SEARCH_";}
if(cache_dom["SONG_"+currentData.SNG_ID]!=null){$cache_line=$(cache_dom["SONG_"+currentData.SNG_ID]);$lines.append($cache_line);continue;}
$line=options.$line_model.clone();oSelf.setLineLink($line);oSelf.refreshLineContent($line,currentData);cache_dom["SONG_"+currentData.SNG_ID]=$line.removeClass('active').attr('outerHTML');$lines.append($line);}
oSelf.createDatagridDrag($lines.children('.song'));oBody.append($lines.children());creationStartIndex=creationEndIndex;if(creationEndIndex>=options.songs.count){oSelf.createDatagridResize();oSelf.unAvailableDisplay();oSelf.displayPlayingTrack(null,dzPlayer.getCurrentSong());if(waitingAllTrackForDownload)
oSelf.download($('#naboo_datagrid_offline_local',oOption));if(waitingAllTrackForFilter)
oSelf.onFilterFocus();if(waitingAllTrackForTotalPlay)
oSelf.playAllTracks();if(waitingAllTrackForSort)
oSelf.sort(lastSort.link,lastSort.columnIndex);if(creationStartIndex>=options.songs.total){if(options.scrollInfinite){infinite_scroll.disable();}
Events.trigger(Events.datagrid.allTracksDisplayed,{duration:oSelf.getTotalDuration(),nbSong:options.songs.total});}else{oSelf.activeInfiniteScroll();}
oSelf.extendBackground();}else{setTimeout(oSelf.createDatagridLines,creationInterval);}
if(options.skin.displayDateColumn||options.skin.displayListenColumn){calculeTime();}
return true;}catch(e){error.log(e);}};this.loadNextTrack=function(){try{oSelf.load(false,"naboo_"+options.type+"_tracks",options.id,creationGroup);}catch(e){error.log(e);}};this.refreshSongNumber=function(){try{$('tr:visible',oBody).each(function(index,item){$('.position [data-target="position"]',$(item)).text(pad(index+1,2));});}catch(e){error.log(e);}};this.refreshLineContent=function($line,currentData,subResult){try{if(typeof currentData=='undefined')return false;var isDeezerTrack=oSelf.isDeezerTrack(currentData);var isFallbackTrack=(typeof currentData.FALLBACK!='undefined');var sngId=oSelf.getSongId(currentData);var unavailableType=right.checkSongAvailable(currentData);var data={id:"naboo_datagrid_track_"+sngId};if(currentData.SNG_ID<0){data['data-fan-only']=currentData.FAN_ONLY;}
$line.attr(data).removeClass('active');$line.data('song',currentData);var onClikAlbum=(currentData.ALB_ID>0&&!OFFLINE)?"/album/"+currentData.ALB_ID:'';var sngTitle=currentData.SNG_TITLE;if(typeof currentData.VERSION!='undefined'&&currentData.VERSION!=''){sngTitle+=' '+currentData.VERSION;}
if(options.skin.displayMultiArtistSong){oSelf.displayArtistName($('.track [data-target="featuring"]',$line),currentData,options.main_artist_hash);}else{oSelf.displayArtistName($('.artist > div',$line),currentData);}
oSelf.displaySongTitle($('.track [data-target="track"]',$line),currentData);$('.album [data-target="album"]',$line).attr("href",onClikAlbum).text(currentData.ALB_TITLE);if(options.skin.displaySongNumber){var nb=pad(currentData.TRACK_NUMBER,2);$('.position [data-target="position"]',$line).text(nb);}
if(options.skin.displayOrderNumber){var nb=pad(currentTrackNumber,2);$('.position [data-target="position"]',$line).text(nb);}
if(unavailableType!==right.READABLE||typeof currentData.LYRICS_ID==='undefined'||currentData.LYRICS_ID===0){$('.track [data-target="icon-lyrics"]',$line).hide();}
if(isDeezerTrack&&options.skin.displayDownload){$('.track [data-target="icon-download"]',$line).show();}else{$('.track [data-target="icon-download"]',$line).hide();}
if(isDeezerTrack&&options.skin.displayPlaylistAdd){$('.track [data-target="icon-playlist-add"]',$line).show();}else{$('.track [data-target="icon-playlist-add"]',$line).hide();}
if(options.skin.displayHistoric){$('.track [data-target="icon-historic"]',options.$line_model).show().attr('href','/');}else{$('.track [data-target="icon-historic"]',options.$line_model).hide();}
if(currentData.DURATION==undefined)currentData.DURATION=0;$('[data-target="length"]',$line).text(secToMin(currentData.DURATION));if(options.skin.displayNoteColumn){$('.popularity [data-target="note"]',$line).attr('class','note');if(isDeezerTrack){if(currentData.RANK_SNG==undefined){currentData.RANK_SNG=0;}
$('.popularity [data-target="note"]',$line).addClass("note-"+Math.round(currentData.RANK_SNG/100000));}else{$('.popularity [data-target="note"]',$line).addClass("note-0");}
$('.popularity',$line).removeAttr('data-tooltip');}
if(options.skin.displayDateColumn){$('.added [data-target="added"]',$line).data('timestamp',currentData.DATE_ADD);}
if(options.skin.displayListenColumn){$('.listen [data-target="listen"]',$line).data('timestamp',currentData.TS);}
if(isFallbackTrack&&options.skin.displayFallbackIcon){$('.track [data-target="icon-link"]',$line).attr('href','/album/'+currentData.FALLBACK.ALB_ID).show();}else{$('.track [data-target="icon-link"]',$line).hide();}
if(options.skin.displaySubresult){if(typeof subResult=='object'){$line.addClass("similar").attr("data-parent-id",subResult.parentId).removeClass('song');if(subResult.isLastSubResult)$line.addClass('similar-last');}
if(typeof currentData.SUB_RESULT!='undefined'){$('.track [data-target="icon-similar"]',$line).show();}else{$('.track [data-target="icon-similar"]',$line).hide();}}else{$('.track [data-target="icon-similar"]',$line).hide();}
if(options.type!='search'&&typeof currentData.SNG_CONTRIBUTORS!='undefined'&&(oSelf.getContributor(currentData.SNG_CONTRIBUTORS,'author')!=false||oSelf.getContributor(currentData.SNG_CONTRIBUTORS,'composer')!=false||oSelf.getContributor(currentData.SNG_CONTRIBUTORS,'misc')!=false)){$('.track [data-target="icon-contributors"]',$line).show();}else{$('.track [data-target="icon-contributors"]',$line).hide();}
if(options.skin.displayLoved&&!OFFLINE){favorite.drawButton($('.loved [data-target="lovetrack"]',$line),{type:'song',id:sngId});}
if(OFFLINE){$('.track .icons',$line).hide();$('.loved [data-target="lovetrack"]',$line).hide();}
$(".check > input",$line).attr('disabled',!options.selectable);if(unavailableType==right.NOT_RELEASE_FREE||unavailableType==right.NOT_RELEASE_PREMIUM){oTable.addClass('has-calendar');$line.addClass('soon');var releaseDate=(unavailableType==right.NOT_RELEASE_FREE)?currentData.RIGHTS.STREAM_ADS.split('-'):currentData.RIGHTS.STREAM_SUB.split('-');$('.position [data-target="calendar"] .month',$line).text(getShortMonthName(releaseDate[1]));$('.position [data-target="calendar"] .day',$line).text(releaseDate[2]);}else{$line.removeClass('soon');$('.position [data-target="calendar"] .month',$line).text('');$('.position [data-target="calendar"] .day',$line).text('');}
if(unavailableType!=right.READABLE){$line.addClass('unavailable');$line.attr('data-unavailable',unavailableType);}else{$line.removeClass('unavailable').removeAttr('data-unavailable').removeAttr('data-tooltip').unbind('mouseover mouseout');}
if(options.type=='playlist'&&unavailableType>0)unavailableList.push(oSelf.getSongId(currentData));return true;}catch(e){error.log(e);}};this.unAvailableDisplay=function(){var trackUnavailableList=$(".unavailable",oBody);var globalBlockedType=0;var fanOnlyTrackFound=false;trackUnavailableList.each(function(){var trackUnavailable=parseInt($(this).attr('data-unavailable'));globalBlockedType+=trackUnavailable;if(trackUnavailable==right.FAN_ONLY){fanOnlyTrackFound=true;}
if(trackUnavailable!=right.LOCALITY||!options.playlist_personnal){$(this).find('[data-target="icon-replace"]').hide();}
if(trackUnavailable==right.FAN_ONLY&&options.skin.displayFanOnly=='hovercard'){}else{$(this).attr('data-tooltip',right.getMessage(trackUnavailable)).mouseover(function(){$(this).find('[data-target="track"]').tipsy({trigger:'manual',gravity:'sw',space:8,fallback:$(this).attr('data-tooltip')}).tipsy('show');}).mouseout(function(){$(this).find('[data-target="track"]').tipsy('hide');});}
if(trackUnavailable==right.FAN_ONLY){oSelf.subscribeEventFanOnly();}
oSelf.replace($(this));});if(fanOnlyTrackFound){Events.ready(Events.user.userReady,oSelf.refreshFanOnlyList);}};this.updatedPersonalSong=function(params){try{$editedLine=$('#naboo_datagrid_track_'+params.upload_id);if($editedLine.length==1){$('[data-target="track"]',$editedLine).text(params.data.SNG_TITLE);$('[data-target="artist"]',$editedLine).text(params.data.ART_NAME);$('[data-target="album"]',$editedLine).text(params.data.ALB_TITLE);$editedLine.data('song').SNG_TITLE=params.data.SNG_TITLE;$editedLine.data('song').ART_NAME=params.data.ART_NAME;$editedLine.data('song').ALB_TITLE=params.data.ALB_TITLE;var renameIndex=$('.song',oBody).index($editedLine);if(renameIndex>-1){options.songs.data[renameIndex]['SNG_TITLE']=params.data.SNG_TITLE;options.songs.data[renameIndex]['ART_NAME']=params.data.ART_NAME;options.songs.data[renameIndex]['ALB_TITLE']=params.data.ALB_TITLE;}}
return true;}catch(e){error.log(e);}};this.createDatagridDrag=function($lines){try{if(!OFFLINE&&options.skin.displayOrder){var draggableOptions={refreshPositions:true,cursorAt:{top:25,left:0},helper:function(event,ui){try{if($(event.target).is('a')||$(event.target).is('i'))return false;var parent=$(event.target).is('tr')?$(event.target):$(event.target).parents('tr');parent.children(".check").children("input").prop("checked",true);var selectedSongId=oSelf.getSelectedTrackId(true);var selectedSongData=oSelf.getSelectedTrackData();var img=(typeof selectedSongData[0].ALB_PICTURE!='undefined')?selectedSongData[0].ALB_PICTURE:'';oSelf.closeAllContributor();if(selectedSongId.length==1){$ghost=ghost_single_model.clone();$('img',$ghost).attr('src',SETTING_DOMAIN_IMG+'/cover/'+img+'/30x30-000000-80-0-0.jpg');$('.cell-track > div:eq(0) > strong',$ghost).text(selectedSongData[0].SNG_TITLE);$('.cell-track > div:eq(1)',$ghost).text(selectedSongData[0].ALB_TITLE);$('.cell-length',$ghost).text(secToMin(selectedSongData[0].DURATION));var rank=(selectedSongData[0].RANK_SNG>0)?((Math.floor((selectedSongData[0].RANK_SNG/100000))*100)/100):'0';$('.cell-popularity > span',$ghost).addClass('note-'+rank);}else{$ghost=ghost_multi_model.clone();$('span > strong',$ghost).text(selectedSongId.length+" "+ngettext('titre','titres',{count:selectedSongId.length}));$('.picture > img',$ghost).attr('src',SETTING_DOMAIN_IMG+'/cover/'+img+'/30x30-000000-80-0-0.jpg');}
$ghost.css('top',-24)
$ghost.data('value',selectedSongId);$ghost.data('element-type','0');$ghost.data('allow-move-to-playlist',options.allowMoveToPlaylist);if(options.skin.displayOrder){$(".contributor",oBody).remove();}
return $ghost;}catch(e){error.log(e);}},stop:oSelf.stopDragTrack,drag:oSelf.dragTrack};$lines.draggable(draggableOptions);}}catch(e){error.log(e);}};this.dragTrack=function(event,ui){try{if(typeof menu!=='undefined'){menu.autoScroll(event,ui);}
if(options.skin.displayOrder&&oBody.length>0){var rowHeight=30;var minLeft=USER.SETTING.site.menu_width||0;if(ui.offset.left>minLeft){if(ui.offset.top+ui.helper.height()+25>$(window).height()){if(scrollInterval===0){scrollInterval=setInterval(function(){if($(page_content).children().height()-$(page_content).scrollTop()>$(page_content).height()){$(page_content).scrollTop($(page_content).scrollTop()+rowHeight);oSelf.dragTrack(event,ui);return false}
clearInterval(scrollInterval);scrollInterval=0;},150);}}else if(ui.offset.top<=playercontrol.heightPlayer){if(scrollInterval===0){scrollInterval=setInterval(function(){if($(page_content).scrollTop()>0){$(page_content).scrollTop($(page_content).scrollTop()-rowHeight);oSelf.dragTrack(event,ui);return false;}
clearInterval(scrollInterval);scrollInterval=0;},150);}}else if(scrollInterval>0){clearInterval(scrollInterval);scrollInterval=0;}
var datagrid_top=oBody.offset().top;var gridPosition=ui.offset.top-datagrid_top+25;gridPosition=(Math.round(gridPosition/rowHeight)*rowHeight);if(gridPosition/rowHeight>options.songs.count){gridPosition=(options.songs.count)*rowHeight;}
options.dropPosition=gridPosition/rowHeight;if(options.dropPosition!=options.dropPositionLast){if(gridPosition>=0){$('.divider',oBody).remove();separator=dividerBar.clone();separator.insertBefore($('tr:eq('+options.dropPosition+')',oBody));options.dropPositionLast=options.dropPosition;}else if(gridPosition<0){options.dropPosition=-1;$('.datagrid > table > tbody > .divider').remove();}}}else{options.dropPosition=-1;$('.datagrid > table > tbody > .divider').remove();}}}catch(e){error.log(e);}};this.stopDragTrack=function(event,ui){try{if(options.skin.displayOrder&&oBody.length>0){$('.divider',oBody).remove();clearInterval(scrollInterval);scrollInterval=0;if(ui.position.left>0)
oSelf.onDrop(event,ui);}
oSelf.onStopDrag();}catch(e){error.log(e);}};this.onDrop=function(event,ui){try{var selectedTrack=$(".song > .check > input:checked",oBody);if(selectedTrack.length>0){var moved=false;$destinationItem=$(this);if(options.dropPosition==-1)return false;if(selectedTrack.length>1){var orderedSelectedTracks=[];var initialPosition;selectedTrack.each(function(index,item){orderedSelectedTracks.unshift(item);var currentPosition=$(".song:visible",oBody).index($(this).parents('tr'));if(typeof initialPosition=='undefined'||currentPosition<initialPosition){initialPosition=currentPosition;}});if(initialPosition>options.dropPosition){selectedTrack=$(orderedSelectedTracks);}}
selectedTrack.each(function(index){$movedItem=$(this).parents('tr');var movedIndex=$(".song:visible",oBody).index($movedItem);var destinationIndex=options.dropPosition;if(movedIndex+1==destinationIndex)destinationIndex=movedIndex;if(movedIndex!=destinationIndex){var movedElement=options.songs.data[movedIndex];options.songs.data.splice(movedIndex,1);if(movedIndex<destinationIndex)options.songs.data.splice(destinationIndex-1,0,movedElement);else options.songs.data.splice(destinationIndex,0,movedElement);if(options.dropPosition==0)
oBody.prepend($movedItem);else
$('tr:eq('+(options.dropPosition-1)+')',oBody).after($movedItem);moved=true;}else{console.log("ERROR : same place");}});if(moved){if(options.type=='playlist'){api.call('playlist.updateOrder',{playlist_id:options.id,position:'0',order:oSelf.getOrderTrack()},function(){});}
if(options.type=='lovedpersonal'){api.call('favorite_song.updateOrder',{position:'0',order:oSelf.getOrderTrack()},function(){});}}
if(options.skin.displaySongNumber){oSelf.refreshSongNumber();}}
return true;}catch(e){error.log(e);}};this.onStopDrag=function(){try{if(options.skin.displayHeader){$("#naboo_datagrid_header_check input",oOption).prop("checked",false);}
if(options.skin.displaySelectAll){$("#naboo_datagrid_select_all input",oOption).prop("checked",false);}
oSelf.unSelectedTrack();return true;}catch(e){error.log(e);}};this.createDatagridResize=function(){try{if(options.skin.displayHeader&&DIRECTION!=='rtl'){$("tr > .track",oHead).resizable(oSelf.getResizableOption('track'));$("tr > .artist",oHead).resizable(oSelf.getResizableOption('artist'));}
return true;}catch(e){error.log(e);}};this.getResizableOption=function(columns){try{return{minWidth:110,handles:{'e':$("tr > ."+columns+' > .handler',oHead)},start:function(event,ui){$(this).resizable("option","maxWidth",oBody.width()/3);}};}catch(e){error.log(e);}};this.startFilter=function(query){try{if(!options.playlist_private){if(query!==''){if(filterId>0)clearTimeout(filterId);filterId=setTimeout(oSelf.filter,filterInterval);}else{$("#naboo_datagrid_filter_text",oOption).removeClass('clear');$(".song",oBody).show();oSelf.closeAllContributor();oSelf.closeAllSubResult();options.skin.displayOrder=options.playlist_personnal;filterActif=false;}}
return true;}catch(e){error.log(e);}};this.filter=function(){try{query=rewriting($("#naboo_datagrid_filter_text",oOption).val().toUpperCase());if(query!=""){oSelf.closeAllContributor();oSelf.closeAllSubResult();$("#naboo_datagrid_filter_text",oOption).addClass('clear');$(".song",oBody).hide();filterActif=true;filterResult=[];for(j=0;j<options.songs.count;j++){if(typeof options.songs.data[j].SEARCH_STR!="undefined"){search_str=options.songs.data[j].SEARCH_STR;}else{search_str=rewriting(options.songs.data[j].SNG_TITLE.toUpperCase()+" "+options.songs.data[j].ART_NAME.toUpperCase()+" "+options.songs.data[j].ALB_TITLE.toUpperCase());options.songs.data[j].SEARCH_STR=search_str;}
if(search_str.indexOf(query)>-1){filterResult.push(options.songs.data[j]);$("#naboo_datagrid_track_"+oSelf.getSongId(options.songs.data[j]),oBody).show();}}
if(options.skin.displayOrder){options.skin.displayOrder=false;}
oSelf.extendBackground();}
return true;}catch(e){error.log(e);}};this.setFilterLabel=function(){try{if(gridTrad[options.type]){filterLabel=gridTrad[options.type];}else{filterLabel=gettext('Rechercher dans les résultats');}
$('#naboo_datagrid_filter_text',oOption).attr('placeholder',filterLabel);return true;}catch(e){error.log(e);}};this.onFilterFocus=function(){try{if(options.songs.count<options.songs.total){waitingAllTrackForFilter=true;oSelf.loadAllTracks();}else{waitingAllTrackForFilter=false;}
return true;}catch(e){error.log(e);}};this.sort=function($link){try{if(options.songs.count<options.songs.total){lastSort.link=$link;lastSort.columnIndex=columnIndex;waitingAllTrackForSort=true;oSelf.loadAllTracks();}else{waitingAllTrackForSort=false;}
if(waitingAllTrackForSort){return false;}
$lines=oBody;oSelf.closeAllSubResult();oSelf.closeAllContributor();oSelf.unSelectedTrack();var sortType=(($('.label > .sort',$link).is('.sort-asc'))?"DESC":"ASC");$('.label > .sort',$link).removeClass('sort-asc sort-desc').addClass('sort-'+sortType.toLowerCase());var columnIndex=($link.is('.track'))?'SNG_TITLE':'';columnIndex=($link.is('.artist'))?'ART_NAME':columnIndex;columnIndex=($link.is('.album'))?'ALB_TITLE':columnIndex;columnIndex=($link.is('.length'))?'DURATION':columnIndex;columnIndex=($link.is('.popularity'))?'RANK_SNG':columnIndex;columnIndex=($link.is('.added'))?'DATE_ADD':columnIndex;options.songs.data.sort(function(a,b){if(typeof a['ORDER_'+columnIndex]!='undefined'&&typeof b['ORDER_'+columnIndex]!='undefined'){var compA=a['ORDER_'+columnIndex];var compB=b['ORDER_'+columnIndex];}else{if(columnIndex=="DURATION"||columnIndex=="RANK_SNG"||columnIndex=="DATE_ADD"){var compA=parseInt(a[columnIndex]);var compB=parseInt(b[columnIndex]);}else{var compA=rewriting(a[columnIndex].toLowerCase());var compB=rewriting(b[columnIndex].toLowerCase());}
a['ORDER_'+columnIndex]=compA;b['ORDER_'+columnIndex]=compB;}
if(sortType=="ASC")return(compA<compB)?-1:(compA>compB)?1:0;else return(compA>compB)?-1:(compA<compB)?1:0;});$lines.children('tr').each(function(index){if($(this).attr('unavailable')!=null){$(this).unbind('mouseenter').removeAttr('unavailable');}
oSelf.refreshLineContent($(this),options.songs.data[index]);});if(options.skin.displayDateColumn){calculeTime();}
oSelf.unAvailableDisplay();options.skin.displayOrder=false;if(lastColSort!==false&&lastColSort.attr('class')!=$link.attr('class')){$('.label > .sort',lastColSort).removeClass('sort-asc sort-desc');}
lastColSort=$link;oSelf.displayPlayingTrack(null,dzPlayer.getCurrentSong());return true;}catch(e){error.log(e);}};this.play=function($line){try{if(!$line.is('tr')&&!$line.is('button')){$line=$line.parents('tr');}
if(typeof $line!='undefined'&&$line.is('.unavailable')){return false;}
if($line.is('tr.active')){dzPlayer.control.togglePause();return false;}
if($line.is('button')&&oSelf.isSameContext(dzPlayer.getContext())&&dzPlayer.getContext('ID')==options.id){dzPlayer.control.togglePause();return false;}
var index=(typeof $line!='undefined')?$line.parent().children('.song:visible').index($line):-1;var songsList=(filterActif)?filterResult:options.songs.data;if(songsList.length>0){if((typeof $line!='undefined')&&options.type=="search"){if($line.is('.similar')&&!$line.is('.similar-parent')){index=(typeof $line!='undefined')?$line.parent().children('.similar').index($line):-1;$parentLine=$('#naboo_datagrid_track_'+$line.attr('data-parent-id'),oBody);var indexParent=(typeof $parentLine!='undefined')?$parentLine.parent().children('.song:visible').index($parentLine):0;var subTracks=songsList[indexParent].SUB_RESULT;for(var s=0;s<subTracks.length;s++){songsList.splice((indexParent+1)+s,0,songsList[indexParent].SUB_RESULT[s]);}
index+=indexParent;}}
var type=options.type;switch(options.type){case"playlist":oSelf.playAllTracks(true);break;case"history":case"personal_song":case"loved":case"lovedpersonal":index=(index==-1)?0:index;break;case"discography_album":type='album';songsList=[];break;}
dzPlayer.play({id:options.id,type:type,data:songsList,index:index,context:oSelf.getContext()});}
return true;}catch(e){error.log(e);}};this.playAllTracks=function(init){try{if(typeof init!='undefined'&&init){options.startAllLoaded=options.songs.count;}
if(options.songs.count<options.songs.total){waitingAllTrackForTotalPlay=true;oSelf.loadAllTracks();}else{if(waitingAllTrackForTotalPlay){var addedTracks=options.songs.data.slice();dzPlayer.enqueueTracks(addedTracks.splice(options.startAllLoaded,options.songs.total),oSelf.getContext());}
waitingAllTrackForTotalPlay=false;}}catch(e){error.log(e);}};this.playWithLyrics=function($line){Events.subscribeOnce(Events.player.tracklist_changed,function(){dzPlayer.control.nextSong();menu.togglePanel('lyrics');});var params={type:'track',id:$line.parents('tr').data('song').SNG_ID,radio:false,context:oSelf.getContext()};if(dzPlayer.getPlayerType()!=='radio'){params.addNext=true;}
dzPlayer.play(params);},this.openSubResult=function($icon){try{$line=$icon.parents('tr');if(!$icon.children().is('.icon-chevron-up')){$icon.children().removeClass('icon-chevron-down').addClass('icon-chevron-up');var currentData=$line.data('song').SUB_RESULT;if(typeof currentData[0].SNG_TITLE!='undefined'){oSelf.drawSubResult($line,currentData);return;}
api.call('song.getListData',{'sng_ids':currentData},function(result){if(typeof result.data!='undefined'){currentData=result.data;oSelf.drawSubResult($line,currentData);var indexTrack=$line.parent().children('.song:visible').index($line);if(indexTrack>-1){options.songs.data[indexTrack].SUB_RESULT=currentData;}}});}else{$icon.children().addClass('icon-chevron-down').removeClass('icon-chevron-up');$line.removeClass('similar-parent similar');$('[data-parent-id="'+oSelf.getSongId($line.data('song'))+'"]',oBody).remove();}
return true;}catch(e){error.log(e);}};this.drawSubResult=function($line,currentData,parent_id){try{$blockSub=$('<p></p>');for(var s=0;s<currentData.length;s++){$lineSub=options.$line_model.clone();$lineSub.show();oSelf.refreshLineContent($lineSub,currentData[s],{isLastSubResult:((s)==currentData.length-1),parentId:oSelf.getSongId($line.data('song'))});oSelf.setLineLink($lineSub);$blockSub.append($lineSub);}
$line.addClass('similar-parent similar');$line.after($blockSub.children());oSelf.createDatagridDrag($line.nextAll('.similar'));return true;}catch(e){error.log(e);}};this.closeAllSubResult=function(){try{if(options.type=="search"){var currentSubResult=$(".similar",oBody);if(currentSubResult.length>0){currentSubResult.each(function(){$(this).prev().find('[data-target="icon-similar"] > i').removeClass('opened');});$('.similar-parent',oBody).removeClass('similar-parent similar');currentSubResult.remove();}}
return false;}catch(e){error.log(e);}};this.openContributor=function($btn){try{$line=$btn.parents('tr');if(!$btn.children().is('.opened')){var contributorData=$line.data('song').SNG_CONTRIBUTORS;var contributorListing=[];if(oSelf.getContributor(contributorData,'author')!=false){contributorListing.push(gettext('Auteur :')+' '+oSelf.getContributor(contributorData,'author'));}
if(oSelf.getContributor(contributorData,'composer')!=false){contributorListing.push(gettext('Compositeur :')+' '+oSelf.getContributor(contributorData,'composer'));}
if(oSelf.getContributor(contributorData,'misc')!=false){contributorListing.push(gettext('Autres contributeurs :')+' '+oSelf.getContributor(contributorData,'misc'));}
if(contributorData!=''){var line_contributors=contributor_model.clone();$('[data-target="contributors"]',line_contributors).text(contributorListing.join(' / '));$line.after(line_contributors);if(line_contributors.outerHeight()>30){line_contributors.outerHeight(Math.ceil(line_contributors.outerHeight()/30)*30);}}
$btn.children().removeClass('icon-chevron-down').addClass('icon-chevron-up');$btn.children().addClass('opened');}else{$btn.children().removeClass('icon-chevron-up').addClass('icon-chevron-down');$btn.children().removeClass('opened');$line.next('.contributors').remove();}
return true;}catch(e){error.log(e);}};this.getContributor=function(list,key){try{if(typeof list[key]!='undefined'){return list[key].join(' - ');}
return false;}catch(e){error.log(e);}};this.closeAllContributor=function(){try{var currentContributor=$(".contributors",oBody);if(currentContributor.length>0){currentContributor.each(function(){$(this).prev().find('[data-target="icon-contributors"] > .icon').removeClass('icon-chevron-up').addClass('icon-chevron-down');});currentContributor.remove();}
return false;}catch(e){error.log(e);}};this.addMusicBox=function($add,view){try{if(options.selectable){var songData=[];var songId=[];if($add.attr("id")=="naboo_datagrid_add"){songData=oSelf.getSelectedTrackData();songId=oSelf.getSelectedTrackId();}else{songData.push($add.parents('tr').data('song'));songId.push($add.parents('tr').data('song').SNG_ID);oSelf.unSelectedTrack();}
if(songData.length>0){context_menu.open({target:$add,position:'left',type:'song',view:view,data:{SONG:songData.length===1?songData[0]:{},PLAYLIST_ID:(options.type==='playlist')?options.id:0,PLAYLIST_PERSONNAL:options.playlist_personnal},id:songId,context:(options.type==='discography_album'||options.type==='artist_top')?'artist':options.type,listen_context:{TYPE:oSelf.getContextName(),ID:options.id}});}}
return true;}catch(e){error.log(e);}};this.storeAction=function($btn,action){try{if(options.selectable){var songId=[];if($btn.attr('data-target')=="download-multi"||$btn.attr('data-target')=="buy-multi"){songId=oSelf.getSelectedTrackId(false);}else{songId.push(oSelf.getSongId($btn.parents('tr').data('song')));}
if(songId.length>0){storeSongsDownload(songId);}}
return true;}catch(e){error.log(e);}};this.replace=function($replace){try{if(options.playlist_personnal){if($replace.attr('data-unavailable')==right.LOCALITY){var sng_id=oSelf.getSongId($replace.data('song'));var art_id=$replace.data('song').ART_ID;var sng_name=$replace.data('song').SNG_TITLE;var art_name=$replace.data('song').ART_NAME;$('.track [data-target="icon-replace"]',$replace).attr({'id':'btn_replace_'+art_id+"_"+sng_id,'data-hovercard':'/ajax/hovercard/page.php?card=replace&art_id='+art_id+'&sng_id='+sng_id+'&playlist_id='+options.id+'&art_name='+escape(art_name)+'&sng_name='+escape(sng_name)+'&div='+oWrapper.attr('id')});}}
return true;}catch(e){error.log(e);}};this.onReplaced=function(old_id,sng_obj){try{$line=$("#naboo_datagrid_track_"+old_id,oBody);if($line.length==0){return false;}
if($line.attr('data-unavailable')!=null){$line.removeAttr('data-unavailable');$line.unbind('mouseover mouseout');}
if(options.type=='lovedpersonal'){userData.data.FAVORITES_SONGS_HASH[old_id+'_0']=false;userData.data.FAVORITES_SONGS_HASH[oSelf.getSongId(sng_obj)+'_0']=true;}
oSelf.refreshLineContent($line,sng_obj);var indexData=$(".song:visible",oBody).index($line);options.songs.data[indexData]=sng_obj;}catch(e){error.log(e);}};this.removeTrack=function(removeId,forceRemove){try{if(options.skin.displayRemove){var selectedTrackId=(typeof removeId=='undefined')?oSelf.getSelectedTrackId(true):removeId;if(selectedTrackId.length==0){return false;}
forceRemove=forceRemove||false;if(forceRemove||confirm(ngettext('Êtes-vous sûr de vouloir supprimer le titre sélectionné ?','Êtes-vous sûr de vouloir supprimer les titres sélectionnés ?',{count:selectedTrackId.length}))){switch(options.type){case"lovedpersonal":var i;var song_ids=[];for(i=0;i<selectedTrackId.length;i++){song_ids.push(selectedTrackId[i][0]);}
api.call('favorite_song.removeMulti',{SNG_IDS:song_ids},oSelf.onRemoved,{sng_list:selectedTrackId});break;case"playlist":var params={playlist_id:options.id,songs:selectedTrackId};api.call('playlist.deleteSongs',params,oSelf.onRemoved,{sng_list:selectedTrackId});break;case"personal_song":for(var i=0;i<selectedTrackId.length;i++){var params={upload_id:selectedTrackId[i][0]};api.call('personal_song.delete',params,oSelf.onRemoved,{sng_list:[selectedTrackId[i][0]]});}
break;}}}
return true;}catch(e){error.log(e);}};this.onRemoved=function(result,params){try{if(result==true){var nbSong=params.sng_list.length;var duration=0;userData.removePlaylistSong(options.id,params.sng_list);for(j=0;j<nbSong;j++){var sng_id=((typeof params.sng_list[j]=="object")?params.sng_list[j][0]:params.sng_list[j]);$line=$("#naboo_datagrid_track_"+sng_id,oBody);$line_contributors=$("#naboo_datagrid_contributors_"+sng_id,oBody);var indexData=$(".song:visible",oBody).index($line);if(typeof options.songs.data[indexData]!='undefined'){duration+=parseInt(options.songs.data[indexData].DURATION);}
options.songs.data.splice(indexData,1);$line.remove();if($line_contributors.length>0){$line_contributors.remove();}
if(options.type==='lovedpersonal'&&userData.isFavorite('song',sng_id)){userData.deleteFavorite({type:'song',id:sng_id});}}
if(options.type=='playlist'){playlist.updateDurationAndNbSongs(-duration,-nbSong);}
options.songs.count=options.songs.count-nbSong;options.songs.total=options.songs.total-nbSong;if(creationEndIndex<options.songs.total){removedTrackBeforeLoadComplete+=nbSong;creationStartIndex-=nbSong;}
if(oBody.length==0){if(options.songs.total>0){options.$line_model.children('.check').children('input').prop('checked',false);creationStartIndex=creationEndIndex=0;oSelf.load(null,null,options.id,creationGroup);}}
$checkAll=$('tr [data-target="checkall"]',oHead);if($checkAll.prop("checked")){$checkAll.prop("checked",false);}
if(options.type!=='lovedpersonal'){Events.trigger(Events.datagrid.removedTrack);}
oSelf.visibleActionButton(false);oSelf.closeAllContributor();}
return true;}catch(e){error.log(e);}};this.selectAll=function($check){try{if(!OFFLINE&&options.songs.total>0){$(".song:visible > .check > input",oBody).prop("checked",$check.prop("checked"));oSelf.visibleActionButton($check.prop("checked"));}
return true;}catch(e){error.log(e);}};this.selectOne=function($check){try{if($check.prop("checked")){oSelf.visibleActionButton(true);}else{oSelf.visibleActionButton($("tr > .check > input:checked",oBody).length>0);}
return false;}catch(e){error.log(e);}};this.unSelectedTrack=function(){try{var selectedTrack=$("tr input:checked",oBody);selectedTrack.each(function(){$(this).prop("checked",false);});if(options.skin.displaySelectAll){$('[data-target="checkall"]',oOption).prop("checked",false);}else{$('tr [data-target="checkall"]',oHead).prop("checked",false);}
oSelf.visibleActionButton(false);}catch(e){error.log(e);}};this.visibleActionButton=function(status){try{if(status){if(!options.skin.displayOptionsToggle){oOption.show();}
$('.toolbar-actions',oOption).show();if(options.skin.displayRemove)
$("#naboo_datagrid_remove",oOption).show();if(options.skin.displayDownload)
$("#naboo_datagrid_download",oOption).show();if(options.skin.displayAdd)
$("#naboo_datagrid_add",oOption).show();}else{if(!options.skin.displayOptionsToggle){oOption.hide();}
$('.toolbar-actions',oOption).hide();}
return true;}catch(e){error.log(e);}};this.insertUploadFile=function(id,fileName){try{$progressBar=progressBar.clone();$progressBar.attr('id','PROGRESS_'+id).show();oBody.prepend($progressBar);$upload=upload_model.clone();$upload.attr('id','UPLOAD_'+id);$upload.children('[data-target="status"]').text(gettext('En cours'));$upload.children('[data-target="filename"]').text(fileName);oBody.prepend($upload);return true;}catch(e){error.log(e);}};this.updateUploadFile=function(id,fileName,pourcent){try{$("#PROGRESS_"+id,oBody).css('width',pourcent+'%');$('#UPLOAD_'+id,oBody).children('[data-target="status"]').text(gettext('En cours')+' ('+pourcent+'%)');return true;}catch(e){error.log(e);}};this.finishUploadFile=function(id,fileName,response){try{$('#PROGRESS_'+id,oWrapper).remove();if(response.error.length==0){$('#UPLOAD_'+id,oWrapper).remove();var sng_id=-Math.abs(response.results);api.call('song.getData',{sng_id:sng_id},oSelf.finishUploadFileCallback);}else{$('#UPLOAD_'+id,oWrapper).children('[data-target="status"]').text(gettext('Erreur'));}
return true;}catch(e){error.log(e);}};this.finishUploadFileCallback=function(result){try{result.FILESIZE=result.FILESIZE_MP3_MISC;options.songs.data.push(result);options.songs.count=options.songs.data.length;options.songs.total=options.songs.data.length;creationStartIndex=options.songs.count-1;oSelf.createDatagridLines();return true;}catch(e){error.log(e);}};this.download=function($btn){try{if(options.songs.data.length==0){return false;}
dzoffline.display(options.type+'/'+options.id);}catch(e){error.log(e);}};this.displayPlayingTrack=function(evt,onair){try{if(lastOnAirTrack!=false){lastOnAirTrack.removeClass('active paused');lastOnAirTrack=false;}
if(oSelf.isSameContext(dzPlayer.getContext())){$('#naboo_datagrid_track_'+oSelf.getSongId(dzPlayer.getCurrentSong()),oBody).each(function(){$(this).addClass('active');if(options.scrollAutoOnAir){Events.trigger(Events.datagrid.onAirPosition,{top:$(this).position().top,height:$(this).height()});}
lastOnAirTrack=$(this);if(!dzPlayer.isPlaying()){$(this).addClass('paused');}else{$(this).removeClass('paused');}});}
return true;}catch(e){error.log(e);}};this.displayPlayingIcon=function(evt,playing){try{if(!dzPlayer.isPaused()&&!dzPlayer.isPlaying()){playing=false;}
if(lastOnAirTrack.length==1){if(playing){lastOnAirTrack.removeClass('paused');}else{lastOnAirTrack.addClass('paused');}}
return true;}catch(e){error.log(e);}};this.isSameContext=function(onair){try{if(onair==null){return false;}
if((onair.TYPE.indexOf(options.type)>-1||onair.TYPE==oSelf.getContextName())&&onair.ID==options.id){return true;}
if(options.type==='discography_album'&&onair.TYPE.indexOf('album')>-1){return true;}
if(options.type==='album'&&onair.TYPE.indexOf('discography')>-1){return true;}
if((options.type=='loved'||options.type=='lovedpersonal')&&onair.TYPE==oSelf.getContextName()){return true;}
if(options.type=='personal_song'&&onair.TYPE==oSelf.getContextName()){return true;}
if(options.type==='history'&&onair.TYPE.indexOf('history')>-1){return true;}
return false;}catch(e){error.log(e);}};this.subscribeEventFanOnly=function(){try{if(!artistOnlyEvent){Events.subscribe(Events.user.addFavorite,oSelf.addFavoriteArtist);Events.subscribe(Events.user.deleteFavorite,oSelf.deleteFavoriteArtist);artistOnlyEvent=true;}}catch(e){error.log(e);}};this.refreshFanOnlyList=function(){try{var trackUnavailableList=$(".unavailable",oBody);trackUnavailableList.each(function(){var trackUnavailable=parseInt($(this).attr('data-unavailable'));if(trackUnavailable==right.FAN_ONLY){if(userData.isFavorite('artist',$(this).data('song').ART_ID)){oSelf.addFavoriteArtist(null,{ART_ID:$(this).data('song').ART_ID,type:'artist'});}}});}catch(e){error.log(e);}}
this.addFavoriteArtist=function(evt,params){try{if(params.type!='artist')return false;$(".unavailable",oBody).each(function(){if(typeof $(this).data('song')!='undefined'&&right.checkSongAvailable($(this).data('song'))==right.READABLE){$(this).removeClass('unavailable').unbind('mouseover mouseout');;}});}catch(e){error.log(e);}};this.deleteFavoriteArtist=function(evt,params){try{if(params.type!='artist')return false;$(".song:visible",oBody).each(function(){if(typeof $(this).data('song')!='undefined'&&right.checkSongAvailable($(this).data('song'))==right.FAN_ONLY){$(this).addClass('unavailable').attr('data-tooltip',right.getMessage(right.FAN_ONLY)).mouseover(function(){$(this).find('[data-target="track"]').tipsy({trigger:'manual',gravity:'sw',space:8,fallback:$(this).attr('data-tooltip')}).tipsy('show');}).mouseout(function(){$(this).find('[data-target="track"]').tipsy('hide');});}});}catch(e){error.log(e);}};this.displayChangeFavoriteTrack=function(evt,params){try{if(params.type!='song'){return false;}
$targetLine=$('#naboo_datagrid_track_'+params.id,oWrapper);if($targetLine.length>0){if(typeof $targetLine.data('song')!='undefined'){if(options.type==='lovedpersonal'&&evt.namespace==='USER.deleteFavorite'){if($("#naboo_datagrid_track_"+params.id,oBody).length===1){oSelf.onRemoved(true,{sng_list:[params.id]});}}else{favorite.drawButton($('.loved [data-target="lovetrack"]',$targetLine),params);}
return true;}}
if(options.type=='lovedpersonal'&&evt.namespace=='USER.addFavorite'){if(options.songs.total==options.songs.count&&countObject(params)>0){options.songs.data.push(params);options.songs.count=options.songs.data.length;options.songs.total=options.songs.data.length;creationStartIndex=options.songs.count-1;oSelf.createDatagridLines();}}
return true;}catch(e){error.log(e);}};this.getContext=function(){try{var context={TYPE:oSelf.getContextName(),ID:options.id};switch(options.type){case"playlist":context.NAME=$.trim($('#naboo_playlist_title').text());break;case"album":context.ALB_TITLE=$.trim($('#naboo_album_title').text());break;}
return context;}catch(e){error.log(e);}}
this.getContextName=function(){try{var contextName={playlist:'playlist_page',search:'search_page',personal_song:'personalsong_page',downloads:'downloads_page',album:'album_page',artist_top:'artist_top',artist_exclu:'artist_exclu',discography_album:'artist_discography',loved:'loved_page',lovedpersonal:'loved_page',history:'history_page'};if(typeof contextName[options.type]!='undefined'){return contextName[options.type];}
return options.type;}catch(e){error.log(e);}};this.activeInfiniteScroll=function(){try{if(creationStartIndex<options.songs.total&&options.scrollInfinite){Events.subscribeOnce(Events.layout.infiniteScroll,oSelf.loadNextTrack,options.event_group);infinite_scroll.active();}}catch(e){error.log(e);}};this.extendBackground=function(){try{if(options.skin.displayExtendBackground){$('.filler',oBody).remove();oTable.attr('style','');var diffSize=$(pageContent).height()-$(pageContent).children().height();if(diffSize>0){if(options.songs.count==creationGroup&&options.songs.total>creationGroup){oSelf.loadNextTrack();}else{oBody.append(fillerBar);oTable.height(oTable.height()+diffSize);}}}
return true;}catch(e){error.log(e);}};this.getSelectedTrackId=function(withType,inputChecked){try{var selectedTrack=(typeof inputChecked=='undefined')?$("tr > .check > input:checked",oBody):inputChecked;var selected=[];for(i=0;i<selectedTrack.length;i++){currentData=$(selectedTrack[i]).parents('tr').data('song');var sng_id=oSelf.getSongId(currentData);if(withType){selected.push([sng_id,sng_id>0?0:1]);}else{selected.push(sng_id);}}
return selected;}catch(e){error.log(e);}};this.getSelectedTrackData=function(inputChecked){try{var selectedTrack=(typeof inputChecked=='undefined')?$("tr > .check > input:checked",oBody):inputChecked;var song_data=[];for(var s=0;s<selectedTrack.length;s++){$line=$(selectedTrack[s]).parents('tr');if(typeof $line.data('song')!='undefined'){song_data.push($line.data('song'));}}
return song_data;}catch(e){error.log(e);}};this.getOrderTrack=function(){try{var order=[];for(i=0;i<options.songs.count;i++){order.push(oSelf.getSongId(options.songs.data[i]));}
return order;}catch(e){error.log(e);}};this.liveAddSong=function(evt,params){try{if(options.type=='playlist'&&options.id==params.playlist_id){if(creationStartIndex>=options.songs.total){api.call({method:'song.getListAllData',data:{'sng_ids':params.song},success:function(result){var duration=0;for(var t=0;t<result.data.length;t++){duration+=parseInt(result.data[t].DURATION,10);result.data[t].DATE_ADD=SERVER_TIMESTAMP;options.songs.data.push(result.data[t]);}
options.songs.count=options.songs.total=options.songs.data.length;creationStartIndex=options.songs.count-1;oSelf.createDatagridLines();playlist.updateDurationAndNbSongs(duration,result.data.length);}});}}}catch(e){error.log(e);}};this.rightClic=function($line){try{if(OFFLINE){return false;}
$line.mousedown(function(e){var evt=e;$line.mouseup(function(e){$line.unbind('mouseup');if(e.button==2){oSelf.unSelectedTrack();$target=$(e.target);if($target.is('tr')){$selectedLine=$target;}else{$selectedLine=$target.parents('tr');}
if($selectedLine.data('song')!=null){context_menu.open({target:e.target,position:{left:e.pageX+1,top:e.pageY+1},type:'song',data:{SONG:$selectedLine.data('song'),PLAYLIST_ID:(options.type==='playlist')?options.id:0,PLAYLIST_PERSONNAL:options.playlist_personnal},id:$selectedLine.data('song').SNG_ID,context:(options.type==='discography_album'||options.type==='artist_top')?'artist':options.type,listen_context:{TYPE:oSelf.getContextName(),ID:options.id}});}
e.stopPropagation();}});});}catch(e){error.log(e);}};this.tipsy=function($btn,status,gravity){try{if(status=='over'){if(typeof gravity=='undefined'){gravity='s';}
$btn.tipsy({trigger:'manual',force_top:true,gravity:gravity,title:function(){var wording=$(this).attr('data-tooltip');if($(this).is('[data-target="offline-mobile"]')){if($(this).is('.synced')){wording=gettext('Synchronisation terminée sur votre %s. Cliquez pour désynchroniser.',{sprintf:[$(this).data('device')]});}else if($(this).is('.pending')){wording=gettext('Synchronisation en cours sur votre %s. Vérifiez votre appareil.',{sprintf:[$(this).data('device')]});}}
return wording;}}).tipsy('show');}else if(status=='out'){$btn.tipsy('hide');}}catch(e){error.log(e);}}
this.getTotalDuration=function(){try{var duration=0;for(var s=0;s<options.songs.data.length;s++){duration+=parseInt(options.songs.data[s].DURATION);}
return duration;}catch(e){error.log(e);}};this.displayArtistName=function(container,data,artists){try{if(typeof data.ARTISTS!='undefined'&&data.ARTISTS.length>0){var lines=[];container.empty();var checkDouble={};for(var a=0;a<data.ARTISTS.length;a++){if(typeof artists=='undefined'||(typeof artists=='object'&&typeof artists[data.ARTISTS[a].ART_ID]=='undefined')){if(typeof checkDouble[data.ARTISTS[a].ART_ID]==='boolean'){continue;}
var line=artist_model.clone();line.attr('href','/artist/'+data.ARTISTS[a].ART_ID).text(data.ARTISTS[a].ART_NAME);lines.push(util.getOuterHTML(line));checkDouble[data.ARTISTS[a].ART_ID]=true;}}
container.append(lines.join(', '));return true;}
container.html(artist_model.clone());$('a',container).text(data.ART_NAME).attr('href',(data.ART_ID!=0&&!OFFLINE)?'/artist/'+data.ART_ID:'javascript:void(0)');return true;}catch(e){error.log(e);}};this.displaySongTitle=function(container,data){try{var sng_title=[];var str_title='';if(typeof data.SNG_CONTRIBUTORS!='undefined'&&typeof data.SNG_CONTRIBUTORS.abbreviated_composer!='undefined'&&data.SNG_CONTRIBUTORS.abbreviated_composer!=''){sng_title.push(data.SNG_CONTRIBUTORS.abbreviated_composer);}
if(options.type=='album'){sng_title.push(data.SNG_TITLE);str_title=sng_title.join(' | ');if(typeof data.VERSION!='undefined'&&data.VERSION!=''){str_title+=' '+data.VERSION;}
$(container).text(str_title);return true;}
sng_title.push(data.SNG_TITLE);str_title=sng_title.join(' | ');if(typeof data.VERSION!='undefined'&&data.VERSION!=''){str_title+=' '+data.VERSION;}
$(container).text(str_title);return true;}catch(e){error.log(e);}};this.isDeezerTrack=function(data){try{return(data.SNG_ID>0);}catch(e){error.log(e);}};this.getSongId=function(data){try{if(typeof data.SNG_ID_ORIGIN!='undefined'){return data.SNG_ID_ORIGIN;}
return data.SNG_ID;}catch(e){error.log(e);}};this.unsubscribe=function(){try{isDisplay=false;Events.unsubscribeAll(options.event_group);Events.unsubscribe(Events.player.displayCurrentSong,oSelf.displayPlayingTrack);Events.unsubscribe(Events.user.addFavorite,oSelf.displayChangeFavoriteTrack);Events.unsubscribe(Events.user.deleteFavorite,oSelf.displayChangeFavoriteTrack);Events.unsubscribe(Events.playlist.addSong,oSelf.liveAddSong);}catch(e){error.log(e);}};this.addTdInLine=function($item,selector,position){try{var colgroupTrackPosition=oColGroup.children().index(oColGroup.children(selector));var colgroupLength=oColGroup.children().length-$item.children().length;for(var i=0;i<colgroupLength;i++){var td=$('<td></td>');if(i<colgroupTrackPosition&&position.before){$item.prepend(td);}else if(position.after){$item.append(td);}}
if(position.after==null||position.before==null){$('td:eq('+colgroupTrackPosition+')',$item).attr('colspan',oColGroup.children().length-$item.children().length+1);}
return $item;}catch(e){error.log(e);}};return create();}})(jQuery);var datagrid={action:function(btn,params){try{if($(btn).is('.datagrid_master')){$datagridInstance=$(btn);}else{$datagridInstance=$(btn).parents('.datagrid_master');}
if($datagridInstance.length>0){$datagridInstance.actionDatagrid(params);}else{console.log('Impossible de trouver l instance');}}catch(e){error.log(e);}}};;
var episode_description={display:function(args){$('#naboo_episode_description').text(args.description);Events.trigger(Events.navigation.tab_displayed,{type:args.type,id:args.id});}};;
var advertising={call:function(element_type,args){try{if(typeof USER!=='undefined'&&USER.OPTIONS.ads_display===false){return false;}
if(!dzPlayer.isAdvertisingAllowed()){return false;}
var element_id=args.element_id||0;var element_data=args.element_data||'';var ord=parseInt(Math.random()*10000000000000000,10);switch(element_type){case'artist':ads.callAds('15829/115069/6955/M/'+ord+'/element_type=artist;element_id='+element_id);ads.callAds('15829/115069/27374/S/'+ord+'/element_type=artist;element_id='+element_id);break;case'artist_extend':ads.callAds('15829/115069/27374/S/'+ord+'/element_type=artist;element_id='+element_id);break;case'album':ads.callAds('15829/115066/6955/M/'+ord+'/element_type=album;element_id='+element_id);ads.callAds('15829/115066/27374/S/'+ord+'/element_type=album;element_id='+element_id);break;case'playlist':ads.callAds('15829/115067/6955/M/'+ord+'/element_type=playlist;element_id='+element_id);ads.callAds('15829/115067/27374/S/'+ord+'/element_type=playlist;element_id='+element_id);break;case'search':ads.callAds('15829/115072/6955/M/'+ord+'/element_type=result;element_id='+element_id+';element_style='+element_data);ads.callAds('15829/115072/27374/S/'+ord+'/element_type=result;element_id='+element_id+';element_style='+element_data);break;case'search_noresult':ads.callAds('15829/115072/6955/M/'+ord+'/element_type=result;element_id='+element_id+';element_style='+element_data);ads.callAds('15829/115072/27374/S/'+ord+'/element_type=result;element_id='+element_id+';element_style='+element_data);break;case'video':ads.callAds('15829/115077/6955/M/'+ord+'/element_type=video;element_id='+element_id);ads.callAds('15829/115077/27374/S/'+ord+'/element_type=video;element_id='+element_id);break;case'profile':ads.callAds('15829/115081/6955/M/'+ord+'/element_type=profile;element_id='+element_id+';element_style='+element_data);ads.callAds('15829/115081/27374/S/'+ord+'/element_type=profile;element_id='+element_id+';element_style='+element_data);break;case'tops':ads.callAds('15829/274126/6955/M/'+ord+'/element_type=tops;element_id='+element_id);ads.callAds('15829/274126/27374/S/'+ord+'/element_type=tops;element_id='+element_id);break;case'feed':ads.callAds('15829/114873/6955/S/'+ord+'/');ads.callAds('15829/114873/19632/S/'+ord+'/');ads.callAds('15829/114873/27374/S/'+ord+'/');break;case'multiple_feed':ads.callAds('15829/114873/22283/M/'+ord+'/element_type=;element_id='+element_id);break;case'loved':ads.callAds('15829/274137/6955/M/'+ord+'/element_type=loved;element_id='+element_id);ads.callAds('15829/274137/27374/S/'+ord+'/element_type=loved;element_id='+element_id);break;case'explore':ads.callAds('15829/274132/6955/M/'+ord+'/element_type=;element_id='+element_id);ads.callAds('15829/274132/27374/S/'+ord+'/element_type=;element_id='+element_id);break;case'radio':ads.callAds('15829/115070/6955/M/'+ord+'/element_type=;element_id='+element_id);ads.callAds('15829/115070/27374/S/'+ord+'/element_type=;element_id='+element_id);break;case'track':ads.callAds('15829/487686/6955/M/'+ord+'/element_type=;element_id='+element_id);ads.callAds('15829/487686/27374/S/'+ord+'/element_type=;element_id='+element_id);break;case'lyrics':$('body').removeClass('has-lyrics-ads-bottom');ads.callAds('15829/548730/27374/S/'+ord+'/element_type=;element_id='+element_id);break;case'talk':ads.callAds('15829/555138/6955/M/'+ord+'/element_type=;element_id='+element_id);ads.callAds('15829/555138/27374/S/'+ord+'/element_type=;element_id='+element_id);break;case'show':ads.callAds('15829/555137/6955/M/'+ord+'/element_type=;element_id='+element_id);ads.callAds('15829/555137/27374/S/'+ord+'/element_type=;element_id='+element_id);break;}
return true;}catch(e){error.log(e);}}};;
(function(){'use strict';var track={id:0,template:'catalog/track',display:function(args){if(typeof args.sng_id!=='string'){return false;}
track.id=args.sng_id;if(typeof args.data==='object'){return track.displayCallback(args.data);}
api.call('deezer.pageTrack',{sng_id:track.id},track.displayCallback);return true;},displayCallback:function(result){try{templating.load(track.template);$('#naboo_track_play').replaceWith(thumbnails.draw({id:track.id,alb_id:result.DATA.ALB_ID,art_id:result.DATA.ART_ID,lyrics_id:result.DATA.LYRICS_ID,type:'song',cover_type:'cover',pic_id:result.DATA.ALB_PICTURE,border:true,play:1,play_context:'track_page',width:200,height:200,width_img:250,height_img:250,play_force:true,sent_to_mobile_banner:true}));var hasLyrics=(typeof result.DATA.LYRICS_ID!=='undefined'&&result.DATA.LYRICS_ID!==0);var list_tabs={related_track:{args:{album_list:result.ISRC.data,sng_id:result.DATA.SNG_ID},selected:!hasLyrics},lyrics:{args:{lyrics_id:result.DATA.LYRICS_ID,sng_id:result.DATA.SNG_ID},disabled:!hasLyrics,selected:hasLyrics}};$('#naboo_track_title').text(result.DATA.SNG_TITLE);var mainArtistName=[];var mainArtistHash={};var $item;if(typeof result.DATA.ARTISTS!=='undefined'&&result.DATA.ARTISTS.length>0){var art_name=$('#naboo_track_song > a').clone().removeAttr('id');$('#naboo_track_song > a').remove();var art_list=$('<p></p>');for(var a in result.DATA.ARTISTS){if(!result.DATA.ARTISTS.hasOwnProperty(a)){continue;}
if(result.DATA.ARTISTS[a].ROLE_ID==0||result.DATA.ARTISTS[a].ROLE_ID==5){mainArtistName.push(result.DATA.ARTISTS[a].ART_NAME);mainArtistHash[result.DATA.ARTISTS[a].ART_ID]=true;$item=art_name.clone();$item.attr('href','/artist/'+result.DATA.ARTISTS[a].ART_ID).text(result.DATA.ARTISTS[a].ART_NAME);if(a>0){art_list.append($('<span>, </span>'));}
art_list.append($item);}}
$('#naboo_track_song').append(art_list.children());}else if(result.DATA.ART_ID!=null&&result.DATA.ART_NAME!=null){mainArtistName.push(result.DATA.ART_NAME);$('#naboo_track_song > a').attr('href','/artist/'+result.DATA.ART_ID).text(result.DATA.ART_NAME);}
if(result.DATA.DURATION!=null){$('#naboo_track_duration').text(secToMin(result.DATA.DURATION));}
$('#naboo_track_share > button').data('id',track.id);$('#naboo_track_favorite').html(button_multi_state.draw({action:'favorite',type:'song',id:track.id}));Events.subscribe(Events.layout.adsBackground,track.adjustContent,'track');$('#naboo_track_share a').attr('onClick','sharebox.load(0, '+track.id+'); return false;');tabs.init($('#naboo_track_tabs'),list_tabs);naboo.afterLoad(true);return true;}catch(e){error.log(e);}},adjustContent:function(){try{$('#related_content_top > ul').responsiveCover_update();}catch(e){error.log(e);}}};window.track=track;})();;
(function(){'use strict';var album={id:0,template:'catalog/album',display:function(args){try{if(typeof args.alb_id!=='string'){return false;}
album.id=album.alb_id=parseInt(args.alb_id,10);if(typeof args.data==='object'){return album.displayCallback(args.data);}
api.call('deezer.pageAlbum',{alb_id:album.id,lang:SETTING_LANG,tab:0},album.displayCallback);return true;}catch(e){error.log(e);}},displayCallback:function(result){try{templating.load(album.template);if(typeof result.DATA.FALLBACK==='object'){loadBox('/album/'+result.DATA.FALLBACK.ALB_ID);return false;}
album.data=result.DATA;var list_tabs={track:{selected:true,args:{type:'album',id:result.DATA.ALB_ID}},related_playlist:{args:{type:'album',id:result.DATA.ALB_ID}},fan:{args:{type:'album',id:result.DATA.ALB_ID}},related:{args:{art_id:result.DATA.ART_ID}},discography_catalog:{args:{art_id:result.DATA.ART_ID}},edito:{disabled:true,args:{id:result.DATA.ALB_ID}}};$('#naboo_album_title').text(result.DATA.ALB_TITLE);$('#naboo_album_image').replaceWith(thumbnails.draw({id:album.id,art_id:album.data.ART_ID,type:'album',cover_type:'cover',pic_id:result.DATA.ALB_PICTURE,play:1,play_context:'album_page',border:true,width:200,height:200,tracking:1,sent_to_mobile_banner:true,release_date:result.DATA.DIGITAL_RELEASE_DATE,play_force:true,context_menu_excludes:['go_to_album'],zoom_on_cover:true}));var mainArtistName=[];var mainArtistHash={};if(typeof result.DATA.ARTISTS!=='undefined'&&result.DATA.ARTISTS.length>0){var art_name=$('#naboo_album_artist_modele').clone().removeAttr('id');$('#naboo_album_artist_modele').remove();var art_list=$('<p></p>');for(var a=0;a<result.DATA.ARTISTS.length;a++){if(result.DATA.ARTISTS[a].ROLE_ID==0||result.DATA.ARTISTS[a].ROLE_ID==5){var $item=art_name.clone();$item.attr('href','/artist/'+result.DATA.ARTISTS[a].ART_ID).text(result.DATA.ARTISTS[a].ART_NAME);mainArtistName.push(result.DATA.ARTISTS[a].ART_NAME);if(result.DATA.ARTISTS[a].ROLE_ID==0){mainArtistHash[result.DATA.ARTISTS[a].ART_ID]=true;}
if(a>0){art_list.append($('<span>, </span>'));}
art_list.append($item);}}
$('#naboo_album_artist').html(art_list.children());}else{mainArtistName.push(result.DATA.ART_NAME);$('#naboo_album_artist_modele').text(result.DATA.ART_NAME).attr('href','/artist/'+result.DATA.ART_ID);}
Events.subscribeOnce(Events.navigation.tab_displayed,function(){if($('#naboo_album_heading').height()>135){$('#naboo_catalog_heading').addClass('extended');$('#naboo_album_action').addClass('album-full-infos');}});if(result.DATA.PHYSICAL_RELEASE_DATE!=null&&result.DATA.PHYSICAL_RELEASE_DATE!='0000-00-00'){$('#naboo_album_info > [data-target="date"] > strong').text(formatDate(result.DATA.PHYSICAL_RELEASE_DATE));}
if(result.DATA.NB_FAN>0){$('#naboo_album_info > [data-target="fans"] > a > strong').text(breakUpThousands(result.DATA.NB_FAN));$('#naboo_album_info > [data-target="fans"] > a').append(ngettext('Fan','Fans',{count:result.DATA.NB_FAN}));}
var $chronicle_content=$('#naboo_album_review');if(result.CHRONICLES.count>0){list_tabs.edito.disabled=false;for(var chronicle_item in result.CHRONICLES.data){if(!result.CHRONICLES.data.hasOwnProperty(chronicle_item)){continue;}
var chronicle_data=result.CHRONICLES.data[chronicle_item];var file_name=chronicle_data.LOGO_BIG.split('.');$('[data-target="logo"]',$chronicle_content).append('<a href="javascript:void(0)" class="review-logo" onclick="album.onOpenTab(\'edito\', \''+chronicle_data.SOURCE+'\');"><img src="'+SETTING_STATIC+'/img/review/big/'+file_name[0]+'-v'+STATIC_VERSION+'.'+file_name[1]+'"/></a>');}
if(result.CHRONICLES.count==1){$('[data-target="text"]',$chronicle_content).prepend(result.CHRONICLES.data[0].RESUME);}else{$('[data-target="text-link"]',$chronicle_content).remove();$('[data-target="text"]',$chronicle_content).text(gettext('Découvrez les chroniques :'));$('[data-target="logo"]',$chronicle_content).addClass('multi-review');}
$('#tab_edito_link > a').text(ngettext('Chronique','Chroniques',{count:result.CHRONICLES.count}));}else{$chronicle_content.hide();}
$('#naboo_album_favorite').html(button_multi_state.draw({action:'favorite',type:'album',id:album.id,elId:'add_to_library'}));$('#naboo_album_legal').text(result.DATA.PHYSICAL_RELEASE_DATE.substr(0,4)+' | '+result.DATA.LABEL_NAME);$('#naboo_album_share > button').data('id',result.DATA.ALB_ID);var cds=[];var disk_number=0;var all_tracks={data:[],count:0,total:0};var duration=0;if(result.SONGS!=null&&result.SONGS.count!=null&&result.SONGS.count>0){for(var track_item in result.SONGS.data){if(!result.SONGS.data.hasOwnProperty(track_item)){continue;}
var track=result.SONGS.data[track_item];disk_number=parseInt(track.DISK_NUMBER,10)-1;var track_number=parseInt(track.TRACK_NUMBER,10)-1;if(typeof cds[disk_number]==='undefined'){cds[disk_number]=[];}
if(typeof cds[disk_number][track_number]==='undefined'||right.checkSongAvailable(track)===right.READABLE){cds[disk_number][track_number]=track;duration+=parseInt(track.DURATION,10);}}
disk_number=cds.length;for(var disk in cds){if(!cds.hasOwnProperty(disk)){continue;}
for(track_number in cds[disk]){if(!cds[disk].hasOwnProperty(track_number)){continue;}
all_tracks.data.push(cds[disk][track_number]);}}
all_tracks.count=all_tracks.total=all_tracks.data.length;Events.trigger(Events.album.noReplaceNeed,{id:parseInt(result.DATA.ALB_ID,10),type:'empty'});}else{Events.trigger(Events.album.checkReplace,{id:parseInt(result.DATA.ALB_ID,10),type:'empty'});}
$('#naboo_album_tracks').createDatagrid({type:'album',id:result.DATA.ALB_ID,songs:all_tracks,disk_number:disk_number,art_id:result.DATA.ART_ID,scrollInfinite:false,main_artist_hash:mainArtistHash,offline_data:{alb_name:result.DATA.ALB_TITLE,alb_artist:result.DATA.ART_NAME,alb_rewriting:result.DATA.URL_REWRITING,alb_picture:result.DATA.ALB_PICTURE}});$('#naboo_album_info > [data-target="duration"] > strong').text(getTotalDuration(duration));tabs.init($('#naboo_album_tabs'),list_tabs);naboo.afterLoad(true);return true;}catch(e){error.log(e);}},onOpenTab:function(type,id){tabs.display(type);if(typeof id!=='undefined'){window[type].onDisplay(id);}
$('#page_content').scrollTop(0);},getLiveFeed:function(){return'1_0_ALBUMFEED_'+album.id;}};window.album=album;})();;
var artist={id:0,template:'catalog/artist',data:[],displayExtended:false,display:function(args){try{if(typeof args.art_id!=='string'){return false;}
artist.id=artist.art_id=parseInt(args.art_id,10);if(typeof args.data==='object'){return artist.displayCallback(args.data);}
api.call('deezer.pageArtist',{art_id:artist.id,lang:SETTING_LANG},artist.displayCallback);return true;}catch(e){error.log(e);}},displayCallback:function(result){try{templating.load(artist.template);artist.data=result;artist.data.NB_FAN=result.DATA.NB_FAN;var list_tabs={discography_catalog:{selected:true,args:{art_id:artist.id}},related_playlist:{args:{type:'artist',id:artist.id}},related:{args:{art_id:artist.id}},comment:{args:{type:'artist',id:artist.id}},fan:{args:{type:'artist',id:artist.id}},biography:{}};var content=$('#page_naboo_artist');$('[data-target="favorite"]',content).html(button_multi_state.draw({action:'favorite',type:'artist',id:artist.id,elId:'add_to_library'}));$('[data-target="share"]',content).attr('onClick','sharebox.load(2, '+artist.id+'); return false;');$('[data-target="fans"]',content).append(ngettext('Fan','Fans',{count:result.DATA.NB_FAN})).children('strong').text(breakUpThousands(result.DATA.NB_FAN));if(typeof artist.data.SMARTRADIO==='undefined'||artist.data.SMARTRADIO=='0'){$('[data-target="radio"]',content).remove();}else{$('[data-target="radio"]',content).html(button_multi_state.draw({action:'play',type:'artist',radio:true,id:artist.id,color:'primary',color_equalizer:'inverse',wording:'full',play_context:'artist_smartradio'}));}
if(artist.data.BIO===false||artist.data.BIO.BIO===''){list_tabs.biography.disabled=true;}else{artist.drawBiographyContent();}
$('[data-target="artist_name"]',content).text(artist.data.DATA.ART_NAME);var banner=$('[data-target="banner"]',content);var banner_style={backgroundImage:'url('+SETTING_DOMAIN_IMG+(artist.data.LAST_ALBUM.count===1?'/cover/'+artist.data.LAST_ALBUM.data[0].ALB_PICTURE:'/misc/3222e780ece735f85ee9555eaa84e623')+'/250x1200-0000-80-0-0.jpg)',backgroundPosition:'center',backgroundColor:'#000'};if(typeof artist.data.DATA.DATA!=='undefined'&&typeof artist.data.DATA.DATA.ART_BANNER!=='undefined'&&artist.data.DATA.DATA.ART_BANNER!==''){banner_style.backgroundImage='url('+SETTING_DOMAIN_IMG+'/artist/'+artist.data.DATA.DATA.ART_BANNER+'/230x1800.jpg)';banner_style.backgroundPosition=artist.data.DATA.DATA.ART_BANNER_ALIGN;banner_style.backgroundColor=artist.data.DATA.DATA.ART_BANNER_BGCOLOR;if(typeof artist.data.DATA.DATA.ART_BANNER_LINK==='string'&&artist.data.DATA.DATA.ART_BANNER_LINK!==''){banner_style.cursor='pointer';banner.attr('onClick','window.open("'+artist.data.DATA.DATA.ART_BANNER_LINK+'")');}}else{$('#naboo_artist_image').replaceWith(thumbnails.draw({id:artist.data.DATA.ART_ID,type:'artist',cover_type:'artist',pic_id:artist.data.DATA.ART_PICTURE,border:true,width:140,height:180,width_img:250,height_img:320,smartradio:artist.data.SMARTRADIO,tracking:1,context_menu_excludes:['go_to_artist']}));}
banner.css(banner_style);if(typeof artist.data.DATA.STATUS!=='undefined'&&artist.data.DATA.STATUS.status!==''){$('[data-target="status"]',content).text('"'+artist.data.DATA.STATUS.status+'"');}else{$('[data-target="status"]',content).remove();}
artist.drawSocialNetwork(content);Events.subscribeOnce(Events.gigs.display,function(){$('[data-target="ontour"]',content).show().on('click',function(){window.gigs.goToEvents(artist.id,'artist_page');});},'artist');artist.drawTops(content);tabs.init($('#naboo_artist_second'),list_tabs);naboo.afterLoad(true);return true;}catch(e){error.log(e);}},drawTops:function(content){try{$.merge(artist.data.SELECTED_PLAYLIST.data,artist.data.RELATED_PLAYLIST.data);artist.data.SELECTED_PLAYLIST.count+=artist.data.RELATED_PLAYLIST.count;if(artist.data.SELECTED_PLAYLIST.count>0){$('[data-target="playlist"] > h4',content).text(ngettext('Playlist','Playlists',{count:artist.data.SELECTED_PLAYLIST.count}));ReactComponent.require('common/elements/list',function(list){React.render(list({type:'playlist',display_fan:true,display_track:false,display_add:true,context:'artist_similar_playlist',data:artist.data.SELECTED_PLAYLIST.data.slice(0,2)}),document.getElementById('artist_selected_playlist'));});}else{$('[data-target="playlist"]',content).remove();}
if(typeof artist.data.TOP==='object'&&artist.data.TOP.count>0){var main_artist={};main_artist[artist.data.DATA.ART_ID]=true;$('[data-target="top-track"] > div',content).createDatagrid({type:'artist_top',songs:artist.data.TOP,id:artist.id,main_artist_hash:main_artist,scrollInfinite:false});}else{$('[data-target="top-track"]',content).remove();}
if(typeof artist.data.EXCLUSIVE_TRACKS==='object'&&artist.data.EXCLUSIVE_TRACKS.count>0){$('[data-target="exclu-track"] > h4',content).text(ngettext('Titre bonus','Titres bonus',{count:artist.data.EXCLUSIVE_TRACKS.count}));$('[data-target="exclu-track"] > div',content).createDatagrid({type:'artist_exclu',songs:artist.data.EXCLUSIVE_TRACKS,id:artist.id,scrollInfinite:false});}else{$('[data-target="exclu-track"]',content).remove();}}catch(e){error.log(e);}},drawBiographyContent:function(){try{$('#tab_biography_content .naboo_artist_biography_content_photo img').attr('src',SETTING_DOMAIN_IMG+'/artist/'+artist.data.DATA.ART_PICTURE+'/200x200-000000-80-0-0.jpg');if(typeof artist.data.BIO.RESUME_FULL!=='undefined'){$('#tab_biography_content .naboo_artist_biography_content_message').html('<b>'+artist.data.BIO.RESUME_FULL+'</b><br/>'+artist.data.BIO.BIO);}else{$('#tab_biography_content .naboo_artist_biography_content_message').html(artist.data.BIO.BIO);}}catch(e){error.log(e);}},drawSocialNetwork:function(content){try{if(typeof artist.data.DATA.FACEBOOK!=='undefined'&&artist.data.DATA.FACEBOOK.substr(0,4)==='http'){$('[data-target="facebook"]',content).attr('href',artist.data.DATA.FACEBOOK);}else{$('[data-target="facebook"]',content).remove();}
if(typeof artist.data.DATA.TWITTER!=='undefined'&&artist.data.DATA.TWITTER.substr(0,4)==='http'){$('[data-target="twitter"]',content).attr('href',artist.data.DATA.TWITTER);}else{$('[data-target="twitter"]',content).remove();}
if($('[data-target="social"]',content).children(':visible').length===0){$('[data-target="social"]',content).remove();}}catch(e){error.log(e);}},getLiveFeed:function(){return'1_0_ARTISTFEED_'+artist.id;},onOpenTab:function(type){tabs.display(type);},leave:function(){React.unmountComponentAtNode(document.getElementById('artist_selected_playlist'));}};;
if(typeof app=='undefined'){var app={id:0,template:'naboo/app',actual_page:null,last_page:null,base_page:null,loaded:false,iframe:null,url_id:null,alias:null,display:function(args){if(args.action=='login'){return app.displayLogin(args);}
if(typeof args.app_id!=='string'){return false;}
app.id=app.app_id=args.app_id;var deep_link='';if(typeof args.deep_link==='string'){deep_link=args.deep_link;}
if(typeof args.dzq=='string'){deep_link+='?dzq='+args.dzq;}
var page_splitted=deep_link.split('?');deep_link=page_splitted[0];if(page_splitted.length>1){var search=page_splitted[1];search=search.split('&');for(var i=0;i<search.length;i++){var param=search[i].split('=');if(param.length==2&&param[0]=='dzq'){deep_link+='?'+hex2bin(param[1]);break;}}}
if(typeof args.data==='object'){return app.launch({app_data:args.data,deep_link:deep_link});}
api.call('application.getPublicData',{app_id:app.id},function(result){app.launch({app_data:result,deep_link:deep_link});});},onPageChanged:function(args){app.loadPage(args.deep_link);naboo.afterLoad();},sendRequest:function(user_id_to,app_id,message){api.call('application.sendRequest',{user_ids_to:[user_id_to],app_id:app_id,message:message},function(result){$.facebox.close(false);});},displayLogin:function(args){try{if(typeof args.redirect_app_id==='undefined'){naboo.afterLoad(true);app.redirect_appstudio();return true;}
if(typeof args.data==='object'){app.displayLoginCallback(args.data,args);return true;}
api.call('application.getPublicData',{app_id:args.redirect_app_id},function(response){app.displayLoginCallback(response,args);});return true;}catch(e){error.log(e);}},displayLoginCallback:function(result,args){var redirect_app_id=args.redirect_app_id||'';var redirect_link=typeof args.redirect_link!=='undefined'?decodeURIComponent('/'+args.redirect_link):('/app/'+request.APP_ID);templating.load('app/login');$('#app_picture').attr('src',SETTING_DOMAIN_IMG+'/misc/'+result.APP_PICTURE+'/120x120-000000-80-0-0.jpg');$('#app_name').text(result.NAME);$('#h2_app_name').text(result.NAME);$('#app_description').text(result.DESCRIPTION);$('#btn_login').click(function(){modal.open('/lightbox/login.php?redirect_type=refresh&redirect_link='+encodeURIComponent(redirect_link)+'&app_id='+redirect_app_id);}).attr('onclick','');$('#btn_register').click(function(){modal.open('/lightbox/register.php?redirect_type=refresh&redirect_link='+encodeURIComponent(redirect_link)+'&app_id='+redirect_app_id);}).attr('onclick','');naboo.afterLoad(true);Events.ready(Events.user.loaded,function(){loadBox(redirect_link);});},redirect_appstudio:function(){window.setTimeout(function(){loadBox('/appstudio');},300);},filterDzParams:function(query_string){var filter=['dzpage','dzlang','dzcountry','dzhash'];var qs=query_string.split('&');query_string=[];for(var i=0;i<qs.length;i++){var filter_this=false;for(var j=0;j<filter.length;j++){if(qs[i].substr(0,filter[j].length+1)==filter[j]+'='){filter_this=true;break;}}
if(filter_this){continue;}
query_string.push(qs[i]);}
return query_string.join('&');},setPage:function(page){if(typeof page!=='object'||typeof page.href==='undefined'){return;}
if(typeof page.pathname==='undefined'){return;}
var dzq='';if(typeof page.search==='string'&&page.search!==''){dzq=page.search.substr(1);dzq=app.filterDzParams(dzq);if(dzq!==''){dzq='?dzq='+bin2hex(dzq);}}
var a=document.createElement('a');a.href=app.app_data.INAPP_URL_WEB;page.pathname=ltrim(page.pathname,'/');var new_page_link;if(app.loadPageMode=='ajax'){new_page_link='/'+page.pathname;}else{var origin=app.app_data.INAPP_URL_WEB.split(a.host)[0]+a.host+'/'+page.pathname;new_page_link='/'+origin.substr(app.app_data.INAPP_URL_WEB.length);}
new_page_link+=dzq;app.actual_page=new_page_link;var actual_page=trim(www.getCurrentPath(),'/ ');new_page_link=trim(new_page_link,'/');var address='app/'+app.url_id+'/'+new_page_link;if(actual_page!=address){www.setCurrentPath(address,true);}
Events.trigger(Events.navigation.page_displayed,{path:naboo.getCurrentPath()});return;},loadPageMode:'basic',loadPage:function(page){if(!app.loaded){return false;}
if(app.actual_page!=page){app.actual_page=page;var loadPage=app.actual_page;if(app.actual_page.indexOf('?')!=-1){var url=app.actual_page.split('?');var qs=url[1].split('&');var dzq=null;for(var i=0;i<qs.length;i++){if(qs[i].substr(0,4)=='dzq='){dzq=qs[i].substr(4);break;}}
if(dzq!==null){loadPage=url[0]+'?'+hex2bin(dzq);}}
if(app.loadPageMode=='ajax'){DZ.communication.callAppMethod('DZ.navigation.pageChanged',{evt:'PAGE_CHANGED',val:loadPage});}else{app.loadIframe(loadPage);}}},clear:function(){if(app.loaded){DZ.clearDeezer();}
if(app.iframe!==null){app.iframe.attr('id','dzapp_old').attr('name','dzapp_old').remove();}
dzPlayer.setApp({id:0,type:''});playercontrol.setBlindTestMode(false);app.current_height=0;app.app_id=0;app.alias=null;app.name='';app.channel_url='';app.url_id=null;app.launch_options={};app.actual_page=null;app.loadPageMode='basic';app.last_page=null;app.base_page=null;app.loaded=false;},app_id:0,userDataLoaded:function(){if(!userData.isFavorite('application',app.app_id)){if(typeof USER!='undefined'&&typeof USER.SETTING!='undefined'){app.addToFav.show();app.iframeContainer.addClass('has-favorite');}}},launch_options:{},launch:function(options){var app_data=options.app_data;app.url_id=app.id;if(app.id==app_data.INAPP_ALIAS){app.url_id=app_data.INAPP_ALIAS;}
var the_app_id=app_data.APP_ID;var newNotifs=notifications.list_unread;var to_remove=[];for(var key in newNotifs){if(!newNotifs.hasOwnProperty(key)){continue;}
var notif=newNotifs[key];if(typeof notif.ACTION!='undefined'&&notif.ACTION=='APPLICATION_NOTIFICATION'&&typeof notif.APP_ID!='undefined'){if(notif.APP_ID==the_app_id){to_remove.push(key);}}}
notifications.read(to_remove);if(USER.USER_ID===0&&app_data.NEED_LOGIN){naboo.afterLoad(true);var base_href=(app_data.INAPP_ALIAS===''?app_data.APP_ID:app_data.INAPP_ALIAS);var link=document.createElement('a');link.href='/app/'+base_href+decodeURIComponent(options.deep_link);var dzq=link.search.substr(1);dzq=app.filterDzParams(dzq);if(dzq!==''){dzq='?dzq='+bin2hex(dzq);}
link=encodeURIComponent(link.pathname.substr(1)+dzq);window.setTimeout(function(){loadBox('/app/login?app_id='+app_data.APP_ID+'&redirect_app_id='+app_data.APP_ID+'&redirect_link='+link);},300);return false;}
app.app_data=app_data;options={app_id:app_data.APP_ID,alias:app_data.INAPP_ALIAS,channel_url:app_data.INAPP_CHANNEL_URL,name:app_data.NAME,deep_link:typeof options.deep_link=='undefined'?null:options.deep_link};if(options.deep_link===null){delete options.deep_link;}
if(typeof DZ!='undefined'){DZ.inapploadedCount=0;}
if(typeof options.deep_link!='undefined'){options.deep_link=decodeURIComponent(options.deep_link);}
if(typeof options.deep_link=='undefined'||options.deep_link=='/'){options.deep_link='';}
if(options.deep_link!==''){var deep_link=options.deep_link.split('?');if(deep_link.length>1){deep_link[1]=app.filterDzParams(deep_link[1]);options.deep_link=deep_link.join('?');}}
app.launch_options=options;app.app_id=options.app_id;app.alias=options.alias;app.channel_url=options.channel_url;app.name=options.name;app.base_page='app/'+options.app_id+options.deep_link;app.actual_page=options.deep_link;getScripts(RESSOURCES.dz,function(){app.loadDom();app.loadDZ();app.loadIframe(options.deep_link);});naboo.afterLoad(true);app.loaded=true;return true;},leave:function(){app.clear();},launchError:function(from_seo){if(typeof from_seo!='boolean'){from_seo=false;}
window.setTimeout(function(){loadBox('/appstudio');},300);if(!from_seo){templating.load(app.template);}
$('#app_error').show();naboo.afterLoad(true);return true;},loadDZ:function(){if(ENV=='DEV'){DZ.SETTING_HOST_SITE=SETTING_HOST_SITE;DZ.SETTING_HOST_CONNECT=SETTING_HOST_CONNECT;DZ.SETTING_HOST_API=SETTING_HOST_API;DZ.DEBUG=true;}
if(ENV=='PREPROD'){DZ._override_pp();}
DZ.init({appId:app.app_id,channelUrl:app.channel_url,inapp:true});},loadDom:function(){var naboo=$('#naboo_content');var draggable=$('<div class="inapp-draggable-element" id="inapp_draggable_element"></div>');var appfavorite=$('<button class="btn btn-primary type="button"><span class="icon icon-add"></span><span class="label">'+gettext('Ajouter à mes applis')+'</span></button>');naboo.html('');naboo.append('<div id="dz-root"></div>');naboo.append(draggable);app.iframeContainer=$('<div id="inapp_iframe_container"></div>');app.addToFav=$('<div class="inapp-add-favorite"></div>').appendTo(naboo);$('#inapp_draggable_element').draggable({helper:function(){return'<div class="inapp-draggable-helper">music draggable !</div>';},appendTo:'body',refreshPositions:true,cursorAt:{top:0,left:0},start:function(event,ui){$('#inapp_draggable_element').attr({'data-value':JSON.stringify([[$('#inapp_draggable_element').attr('data-id'),'0']]),'element-type':'0'});}});app.addToFav.hide();appfavorite.click(function(){favorite.add({type:'application',id:app.app_id});}).appendTo(app.addToFav);Events.ready(Events.user.userReady,app.userDataLoaded);Events.addEvent('DZ',Events.user.addFavorite,function(evt,params){if(params.id==app.app_id){app.addToFav.hide();app.iframeContainer.removeClass('has-favorite');}});Events.addEvent('DZ',Events.user.deleteFavorite,function(evt,params){if(params.id==app.app_id){app.addToFav.show();app.iframeContainer.addClass('has-favorite');}});app.iframeContainer.append('<div id="inapp_iframe_overlay"></div>');naboo.append(app.iframeContainer);return true;},onResize:function(evt,args){app.setSize(0,true);},nbIframes:0,loadIframe:function(deep_link){app.nbIframes++;if(typeof deep_link=='undefined'||deep_link===null){deep_link='';}
deep_link=ltrim(deep_link,'/ ');if(deep_link===''&&typeof DZ!='undefined'){DZ.inapploadedCount=0;}
var container=$('#inapp_iframe_container');var iframe_url=SETTING_HOST_SITE+'/app/launcher.php?app_id='+app.app_id+'&inapp_page='+encodeURIComponent(deep_link);var iframe=$('#dzapp'+(app.nbIframes-1));if(iframe.length>0){iframe.remove();}
app.iframe=$('<iframe id="dzapp'+app.nbIframes+'" name="dzapp'+app.nbIframes+'" frameBorder="0" allowTransparency="true" src="'+iframe_url+'" '+' style="width:100%;height:100%;border: 0;"'+'></iframe>');container.append(app.iframe);},current_height:0,setSize:function(height,fromResize){return true;},scrollTop:function(){$(document.body).scrollTop(0);},hideInappOverlay:function(){$('#inapp_iframe_overlay').hide();window.setTimeout(function(){$(document).unbind('mouseup',app.hideInappOverlay);},0);},showInappOverlay:function(){$('#inapp_iframe_overlay').show();$(document).bind('mouseup',app.hideInappOverlay);},startDragElement:function(type,id){$('#inapp_iframe_overlay').show();$(document).bind('mouseup',app.hideInappOverlay);var evt=document.createEvent('MouseEvents');evt.initMouseEvent('mousedown',true,true,window,0,0,0,0,0,false,false,false,false,0,null);var element=document.getElementById('inapp_draggable_element');var data_type=0;switch(type){case'track':data_type=0;break;default:break;}
$(element).attr('data-type',data_type).attr('data-id',id);element.dispatchEvent(evt);}};};
var appstudio={id:0,template:'naboo/appstudio',categories:['curators','labels','tools','discovery','games','events'],init:function(){appstudio.initApps();appstudio.initCategories();},display:function(args){if(typeof args.data==='object'){return appstudio.displayCallback(args.data);}
getScripts(RESSOURCES.appstudio,function(){api.call('deezer.pageAppstudio',{},appstudio.displayCallback,{});});return true;},displayCallback:function(result){templating.load(appstudio.template);var apps_list=[result.visio,result.apps];var header=$('#page_appstudio_header');var showcase=$('.showcase');var applist=$(".applications .applist_container",showcase);var app_tpl=$(".application",applist).remove();for(var k=0;k<apps_list.length;k++){var apps=apps_list[k];var html_apps=[];for(var i=0;i<apps.length;i++){var $app=app_tpl.clone();var app=apps[i];app.LINK=(app.INAPP_ALIAS===''?app.APP_ID:app.INAPP_ALIAS);var app_img;if(k===0){app_img=appstudio.getImgLink(app.APP_PICTURE_950x320,'160x475');}else{app_img=appstudio.getImgLink(app.APP_PICTURE_220x140,'140x220');}
var cat_name=appstudio.getCatKey(app.CATEGORY);$app.addClass(cat_name).find('.meta_name').html(appstudio.getCatName(app.CATEGORY));$app.find('.app_name').html(app.NAME);$app.find('.app_description .tinyscroll_overview').html(app.DESCRIPTION);$app.find('.app_img img').attr('src',app_img);var links=[];var meta_links=[];if(app.INAPP_STATUS=='2'){links.push('<li><a href="'+SETTING_HOST_SITE+'/app/'+app.LINK+'" target="_blank" onclick="tracking.track(\'appstudio_app_click\', {app_id:'+app.APP_ID+', app_name:\''+escape(app.NAME)+'\', type:\'inapp\', source:\'btn\', category:\''+cat_name+'\'}); appstudio.goToApp(\''+app.LINK+'\', '+(app.NEED_LOGIN?'true':'false')+');return false;">'+gettext('App Deezer')+'</a></li>');meta_links.push('<a href="'+SETTING_HOST_SITE+'/app/'+app.LINK+'" target="_blank" onclick="tracking.track(\'appstudio_app_click\', {app_id:'+app.APP_ID+', app_name:\''+escape(app.NAME)+'\', type:\'inapp\', source:\'icon\', category:\''+cat_name+'\'});appstudio.goToApp(\''+app.LINK+'\', '+(app.NEED_LOGIN?'true':'false')+');return false;"><span class="icon icon-deezer-short"></span></a>');}else{if(app.SITE_URL!==''){links.push('<li><a href="'+app.SITE_URL+'" onclick="tracking.track(\'appstudio_app_click\', {app_id:'+app.APP_ID+', app_name:\''+escape(app.NAME)+'\', type:\'web\', source:\'btn\', category:\''+cat_name+'\'});" target="_blank">Web</a></li>');meta_links.push('<a href="'+app.SITE_URL+'" onclick="tracking.track(\'appstudio_app_click\', {app_id:'+app.APP_ID+', app_name:\''+escape(app.NAME)+'\', type:\'web\', source:\'icon\', category:\''+cat_name+'\'});" target="_blank"><span class="icon icon-html5"></span></a>');}
if(app.APP_STORE_URL!==''){links.push('<li><a href="'+app.APP_STORE_URL+'" onclick="tracking.track(\'appstudio_app_click\', {app_id:'+app.APP_ID+', app_name:\''+escape(app.NAME)+'\', type:\'ios\', source:\'btn\', category:\''+cat_name+'\'});" target="_blank">iOS</a></li>');meta_links.push('<a href="'+app.APP_STORE_URL+'" onclick="tracking.track(\'appstudio_app_click\', {app_id:'+app.APP_ID+', app_name:\''+escape(app.NAME)+'\', type:\'ios\', source:\'icon\', category:\''+cat_name+'\'});" target="_blank"><span class="icon icon-apple"></span></a>');}
if(app.GOOGLE_PLAY_URL!==''){links.push('<li><a href="'+app.GOOGLE_PLAY_URL+'" onclick="tracking.track(\'appstudio_app_click\', {app_id:'+app.APP_ID+', app_name:\''+escape(app.NAME)+'\', type:\'android\', source:\'btn\', category:\''+cat_name+'\'});" target="_blank">Android Market</a></li>');meta_links.push('<a href="'+app.GOOGLE_PLAY_URL+'" onclick="tracking.track(\'appstudio_app_click\', {app_id:'+app.APP_ID+', app_name:\''+escape(app.NAME)+'\', type:\'android\', source:\'icon\', category:\''+cat_name+'\'});" target="_blank"><span class="icon icon-android"></span></a>');}}
$app.find('.button-container .block_available-links ul').append(links.join(''));$app.find('.meta_links').append(meta_links.join(''));html_apps.push($app.get(0).outerHTML);}
$(applist.get(k)).html(html_apps.join(''));}
naboo.afterLoad(true);appstudio.init();},getCatKey:function(cat_id){if(typeof appstudio.categories[cat_id]=='undefined'){return"";}
return appstudio.categories[cat_id];},getCatName:function(cat_id){if(typeof appstudio.categories[cat_id]=='undefined'){return"";}
return appstudio.categories_name[appstudio.categories[cat_id]];},getImgLink:function(md5,size){return SETTING_DOMAIN_IMG+"/misc/"+md5+"/"+size+"-ffffff-90-1-1.jpg";},goToApp:function(app_id,need_login){if(USER.USER_ID===0&&need_login){www.goToConnection();return false;}
loadBox("/app/"+app_id);},resizeTinyscrollbars_timeout:null,resizeTinyscrollbars:function(){if(appstudio.resizeTinyscrollbars_timeout!==null){window.clearTimeout(appstudio.resizeTinyscrollbars_timeout);appstudio.resizeTinyscrollbars_timeout=null;}
appstudio.resizeTinyscrollbars_timeout=window.setTimeout(function(){$(".app_description").each(function(){$(this).tinyscrollbar_update('relative');});},500);},initApps:function(){$('.app_description').each(function(){$(this).tinyscrollbar({extremePreventDefault:false});});$('.applist_container').each(function(i){if(i===0){$(this).coverPane({'max_line':1,'ratio':0.35,'cover_size':475,'padding':20,'between':20,'label_size':100,'onresize':function(){appstudio.resizeTinyscrollbars();}});}else{$(this).coverPane({'ratio':0.63,'cover_size':220,'padding':20,'between':20,'label_size':140,'onresize':function(){appstudio.resizeTinyscrollbars();}});}});$(".application .app_img").hover(function(){},function(){$(this).find('.block_available-links').hide();});$('.button-container').each(function(){var available_links=$(this).find('.block_available-links li');if(available_links.length==1){var button=$(this).find('.btn');button.find('.icon-arrow-filter-down').remove();button.css({'padding-right':'13px','text-align':'center'});button.click(function(){var link=available_links.find('a');var result_click=link.get(0).onclick();if(result_click!==false){window.open(link.attr('href'));}});}else{$(this).find('.btn').click(function(){$(this).parent().find('.block_available-links').slideToggle('fast');});}});$(".icn_deezer").tipsy({gravity:'e',fallback:gettext('Disponible dans Deezer')});$(".icn_web").tipsy({gravity:'e',fallback:gettext('Disponible sur le Web')});$(".icn_ios").tipsy({gravity:'e',fallback:gettext('Disponible sur iOS')});$(".icn_android_market").tipsy({gravity:'e',fallback:gettext('Disponible sur Android')});},initCategories:function(){$(".app_cat_menu .menu_item").each(function(){$(this).click(function(){var id_cat=$(this).attr('id-cat');var app_list=$("#apps_container");if(id_cat=='all'){$(".app_cat_menu .menu_item").removeClass("app_disabled");$(".application",app_list).removeClass('app_disabled');return true;}
$(".app_cat_menu .menu_item").addClass("app_disabled");$(this).removeClass("app_disabled");$(".application",app_list).addClass('app_disabled');$(".application."+id_cat,app_list).removeClass('app_disabled');});});},openAppDetails:function(app_id){loadFacebox('/lightbox/app.php?app_id='+app_id);},actual_width:0,nb_apps:0,apps_container:null,big_apps:[],events_subscribed:false,subscribeEvents:function(){if(appstudio.events_subscribed){return false;}
appstudio.events_subscribed=true;Events.subscribe(Events.layout.resize,appstudio.redrawApps);},initCovers:function(){try{appstudio.actual_width=0;appstudio.nb_apps=0;appstudio.big_apps=[];appstudio.apps_container=$("#apps_container");appstudio.prepareListApp();appstudio.redrawApps();appstudio.subscribeEvents();}catch(e){console.log(e,e.stack);}},prepareListApp:function(){appstudio.apps_container.find('.application').each(function(i){var $this=$(this);if($this.is('.app_big')){var big_app={position_original:i,position:i,element:$this};appstudio.big_apps.push(big_app);}
appstudio.nb_apps=i+1;});},getNbAppsAfter:function(i){if(i>=appstudio.big_apps.length){return 0;}
var app=appstudio.big_apps[i];var nb_app_after=(appstudio.nb_apps-app.position-1);if(i+1<appstudio.big_apps.length){nb_app_after=appstudio.big_apps[i+1].position_original-app.position-1;}
return nb_app_after;},getNbAppsBefore:function(i){if(i>=appstudio.big_apps.length){return 0;}
var pos_before=0;if(i>0){pos_before=appstudio.big_apps[i-1].position+1;}
var pos=appstudio.big_apps[i].position;var nb_app_before=pos-pos_before;return nb_app_before;},redrawApps:function(){var container_width=appstudio.apps_container.width();var app_width=222;var app_margin=18;var app_cols=Math.floor((container_width+app_margin)/(app_width+app_margin));var new_width=app_cols*(app_width+app_margin)-app_margin;if(new_width==appstudio.actual_width){return false;}
appstudio.actual_width=new_width;for(var i=0;i<appstudio.big_apps.length;i++){appstudio.big_apps[i].position=appstudio.big_apps[i].position_original;var app=appstudio.big_apps[i];var nb_app_before=appstudio.getNbAppsBefore(i);var nb_app_after=appstudio.getNbAppsAfter(i);if(i%2==1){app.element.css({'float':'right'});}
if(i>0){nb_app_needed=((app_cols-2)*2);if(nb_app_before==nb_app_needed){continue;}else{if(nb_app_before<nb_app_needed){var decal=nb_app_needed-nb_app_before;console.log(i,'DECAL',decal,nb_app_needed,nb_app_before,nb_app_after);if(decal>=nb_app_after){app.position=app.position-nb_app_before;nb_app_after=appstudio.getNbAppsAfter(i);if(app_cols>4&&nb_app_after<(app_cols-4)*2){app.element.css({'float':'left'});}
continue;}
app.position=app.position+decal;nb_app_after=appstudio.getNbAppsAfter(i);console.log(i,'THE TESt',nb_app_after,((app_cols-2)*2));if(app_cols<=4&&nb_app_after<(app_cols-2)*2){app.element.css({'float':'left'});}
nb_app_before=0;}else{nb_app_before=nb_app_before-nb_app_needed;}}}
var lines=Math.ceil(nb_app_before/app_cols);var nb_app_needed=lines*app_cols-nb_app_before;if(nb_app_needed>(app_cols/2)){app.position=app.position-(app_cols-nb_app_needed);}else{app.position=app.position+nb_app_needed;}}
appstudio.apps_container.find('.application.app_big').remove();for(i=0;i<appstudio.big_apps.length;i++){var list_app=appstudio.apps_container.find('.application');var position=Math.min(appstudio.big_apps[i].position-1,list_app.length-1);console.log("INSERT AFTER",appstudio.big_apps[i].position,list_app.get(position));appstudio.big_apps[i].element.insertAfter($(list_app.get(position)));}
$(".applications",appstudio.apps_container).css({width:new_width+"px"});$(".applist_container",appstudio.apps_container).css({width:(new_width+app_margin)+"px"});$(".fluid_container").css({width:new_width+"px"});}};;
var menu={MenuComponent:null,PanelsComponent:null,initialized:false,init:function(){if(menu.initialized){return false;}
menu.dispatchActionEvent=new EventDispatcher();menu.subscribeActions(menu.onAction);menu.initialized=true;return true;},authorized_actions:{openCreatePlaylist:true},dispatchAction:function(action,params){if(typeof menu.authorized_actions[action]==='undefined'){return false;}
menu.dispatchActionEvent.trigger({action:action,params:params});return true;},subscribeActions:function(callback){menu.dispatchActionEvent.subscribe(callback);},onAction:function(action){switch(action.action){case'openCreatePlaylist':if(!menu.PanelsComponent.isPanelMounted('playlists')){Events.subscribe(Events.menu.panel_mounted,function(evt,panel){if(panel==='playlists'){menu.dispatchAction('openCreatePlaylist');}});}
menu.openPanel('playlists');break;default:break;}
return true;},closePanels:function(){menu.MenuComponent.onClosePanels();menu.PanelsComponent.onClosePanels();},openPanel:function(panel){menu.MenuComponent.onOpenPanel(panel);menu.PanelsComponent.onOpenPanel(panel);},togglePanel:function(panel){if(menu.MenuComponent.isPanelOpen()&&menu.MenuComponent.panels[panel].active){menu.closePanels();return false;}
menu.openPanel(panel);return true;},load:function(){menu.init();ReactComponent.require('menu/menu',function(Menu){menu.MenuComponent=React.render(Menu({controller:menu}),document.getElementById('page_sidebar'));Events.trigger(Events.menu.loaded);});ReactComponent.require('menu/panels/panels',function(Panels){menu.PanelsComponent=React.render(Panels({controller:menu}),document.getElementById('page_panels'));});},dispatchNotification:function(data,remove){},dispatchApplicationNotification:function(data,remove){},autoScroll:function(event,ui){},setCurrentApplication:function(app_data){if(ENV==='DEV'){alert('Need to fix this ! Don\'t know how yet...');}
return false;},openElement:function($line){if(ENV==='DEV'){alert('Need to fix this ! Don\'t know how yet...');}
return false;},openFolder:function($elt){if(ENV==='DEV'){alert('Need to fix this ! Don\'t know how yet...');}
return false;},adjustUserMenu:function(){},selectItem:function(type,element_id){return true;},displayCover:function(init){},updateCover:function(cover,artistName,songTitle){},getSidebarWidth:function(init){},getPositionItem:function(id){id=id||'page_sidebar';var $item=document.getElementById(id);var $sidebar=document.getElementById('page_sidebar');var pos_x=0;var pos_y=0;if($item&&$sidebar){var $item_info=$item.getBoundingClientRect();var $sidebar_info=$sidebar.getBoundingClientRect();pos_x=Math.round(parseInt($sidebar_info.width)+20);pos_y=Math.round(parseInt($item_info.top)-(parseInt($item_info.height)/2));}
return{pos_x:pos_x,pos_y:pos_y};}};;
(function(){'use strict';var _results=null;var _query='';var _cache={};function _fetchResults(next){var query=_query;api.call({method:'deezer.suggest',data:{QUERY:query,TYPES:{ARTIST:true,ALBUM:true,TRACK:true,PLAYLIST:true,SHOW:true,TAG:true},NB:3},success:function(results){_cache[query]=results;if(query===_query){next(results);}}});}
var SearchStore=new Store({getQuery:function(){return _query;},setQuery:function(query){query=query.trim();if(_query!==query){_query=query;this.emitChange('input');}
return this;},getResults:function(){return _results;},search:function(query){this.setQuery(query);if(_query===''||_query==='#'){_results=null;return this.emitChange('suggest');}
if(typeof _cache[_query]!=='undefined'){_results=_cache[_query];return this.emitChange('suggest');}
_fetchResults(function(results){_results=results;this.emitChange('suggest');}.bind(this));}});window.SearchStore=SearchStore;})();;
(function(){'use strict';if(typeof playlist=='undefined'){var playlist={id:0,template:'catalog/playlist',style:null,personal:false,display:function(args){try{if(typeof args.playlist_id!=='string'){return false;}
playlist.id=playlist.playlist_id=parseInt(args.playlist_id,10);if(typeof args.data==='object'){return playlist.displayCallback(args.data);}
var params={playlist_id:playlist.id,lang:SETTING_LANG,start:0,nb:40,tags:false};api.call('deezer.pagePlaylist',params,playlist.displayCallback);return true;}catch(e){error.log(e);}},displayCallback:function(result){try{playlist.data=result.DATA;templating.load(playlist.template);playlist.isPrivateStatus=result.DATA.STATUS=='1'||result.DATA.STATUS=='3';playlist.isPrivate=(result.DATA.PARENT_USER_ID!=USER.USER_ID&&playlist.isPrivateStatus);playlist.isCollabStatus=result.DATA.STATUS=='2';playlist.isPersonal=(result.DATA.PARENT_USER_ID==USER.USER_ID);if(result.DATA.PLAYLIST_PICTURE!=null&&!OFFLINE){Events.subscribe(Events.playlist.updatePicture,function(evt,data){if(data.type!=='base64'){playlist.data.PICTURE_TYPE=data.type;playlist.data.PLAYLIST_PICTURE=data.md5;playlist.displayPicture(data);}},'playlist');Events.subscribe(Events.playlist.uploadPicture,function(){$('#naboo_playlist_image_upload').click();},'playlist');if(playlist.isPersonal){playlist.uploadPicture();}}
playlist.displayEditableData();if(result.DATA.PARENT_USERNAME!=null){$('#naboo_playlist_information_creator').prop('href','/profile/'+result.DATA.PARENT_USER_ID).html(encodeHTMLEntities(result.DATA.PARENT_USERNAME));}
if(!playlist.isPrivate){var content=$('#naboo_playlist_header');if(typeof result.DATA.NB_SONG==='number'){$('[data-target="nb-track"]',content).append(ngettext('Titre','Titres',{count:result.DATA.NB_SONG})).children('strong').text(result.DATA.NB_SONG);}
if(!isNaN(result.DATA.DURATION)){$('[data-target="duration"] > strong',content).text(getTotalDuration(result.DATA.DURATION));}
if(typeof result.DATA.NB_FAN==='number'&&result.DATA.NB_FAN>0){$('[data-target="nb-fan"] > a',content).append(ngettext('Fan','Fans',{count:result.DATA.NB_FAN})).children('strong').text(breakUpThousands(result.DATA.NB_FAN));}else{$('[data-target="nb-fan"]',content).remove();}}
if(!playlist.isPersonal&&typeof result.DATA.PARENT_BLOCK!='undefined'&&result.DATA.PARENT_BLOCK==true){$('#naboo_comment_new').remove();$('#naboo_comment_new_not_logged').remove();}
var list_tabs={track_list:{selected:true,args:{}}};if(!playlist.isPrivate){list_tabs.comment={args:{type:'playlist',id:playlist.id,data:result.COMMENTS}};list_tabs.fan={args:{type:'playlist',id:playlist.id}};}
if(playlist.isPersonal&&gatekeeper.isAllowed('playlist_assistant')){Events.subscribeOnce(Events.datagrid.displayed,function(){Events.trigger(Events.tips.draw,{name:'playlist_assistant',check:true});},'playlist');}
if(result.SONGS.count!=null){list_tabs.track_list.args={id:playlist.id,tab:'track_list',data:{type:'playlist',id:playlist.id,playlist_personnal:playlist.isPersonal,songs:result.SONGS,playlist_private:playlist.isPrivate,playlist_collab:playlist.isCollabStatus,checksum:result.DATA.CHECKSUM,offline_data:{playlist_name:result.DATA.TITLE,playlist_creator:result.DATA.PARENT_USERNAME,playlist_checksum:result.DATA.CHECKSUM,playlist_picture:result.DATA.PLAYLIST_PICTURE,playlist_picture_type:result.DATA.PICTURE_TYPE}}};}
var action=$('#naboo_playlist_action');if(playlist.isPersonal){$('[data-target="edit"]',action).data('value',playlist.id).show();$('[data-target="delete"]',action).data('value',playlist.id).show();}else{$('[data-target="edit"]',action).remove();$('[data-target="delete"]',action).remove();Events.subscribe(Events.user.addFavorite,playlist.updateNbFan,'playlist');Events.subscribe(Events.user.deleteFavorite,playlist.updateNbFan,'playlist');}
$('[data-target="share"] > a',action).data('id',playlist.id);if(playlist.isPrivateStatus){$('[data-target="share"] > a',action).remove();}
var favoriteButtonHandler=function(){if(USER.USER_ID===0||userData.isFavorite('playlist',playlist.id)||(!playlist.isPersonal&&!playlist.isPrivateStatus)){$('[data-target="favorite"]',action).html(button_multi_state.draw({action:'favorite',id:playlist.id,type:'playlist',elId:'add_to_library'}));}else{$('[data-target="favorite"]',action).remove();if(playlist.isPrivate){$('#naboo_playlist_action').remove();$('#naboo_playlist_type').addClass('extended');}}};if(USER.USER_ID===0){favoriteButtonHandler();}else{Events.ready(Events.user.userReady,function(){favoriteButtonHandler();},'playlist');}
if(!playlist.isPersonal){$('[data-target="favorite"]',action).html(button_multi_state.draw({action:'favorite',id:playlist.id,type:'playlist',elId:'add_to_library'}));}else{$('[data-target="favorite"]',action).remove();}
tabs.init($('#naboo_playlist_tab'),list_tabs);naboo.afterLoad(true);return true;}catch(e){error.log(e);}},displayEditableData:function(){var isPublic=(playlist.data.STATUS==0||playlist.data.STATUS==2);var isCollab=(playlist.data.STATUS==2||playlist.data.STATUS==3);$('#naboo_playlist_title').text(ucfirst(playlist.data.TITLE));$('#naboo_playlist_status').text(isPublic?gettext('Publique'):gettext('Privée'));$('#naboo_playlist_collab').text(isCollab?gettext('Collaborative'):gettext('Non collaborative'));if(isPublic){$('#naboo_playlist_action [data-target="share"] > a').show();}else{$('#naboo_playlist_action [data-target="share"] > a').hide();}
if(playlist.data.DESCRIPTION!=null){$('#naboo_playlist_description').html(encodeHTMLEntities(playlist.data.DESCRIPTION).convertURLToLink());}
playlist.displayPicture();},displayPicture:function(evt,data){try{data=data||{md5:playlist.data.PLAYLIST_PICTURE,type:playlist.data.PICTURE_TYPE};$('#naboo_playlist_image').html(thumbnails.draw({id:playlist.id,type:'playlist',play_context:'playlist_page',cover_type:data.type,pic_id:(playlist.isPrivate)?'':data.md5,play:!playlist.isPrivate,border:true,width:200,height:200,tracking:1,play_force:true,sent_to_mobile_banner:true,edit:$('#naboo_playlist_header').is('.headings-playlist-edit'),parent_user_id:playlist.data.PARENT_USER_ID,context_menu_excludes:['go_to_playlist']}));}catch(e){error.log(e);}},editPlaylist:function(){try{Events.subscribeOnce(Events.playlist.updated,function(evt,data){playlist.data.TITLE=data.title;playlist.data.DESCRIPTION=data.description;playlist.data.STATUS=data.status;playlist.displayEditableData();},'playlist');modal.open('/lightbox/playlist_assistant?type=create&playlist_id='+playlist.id);return false;}catch(e){error.log(e);}},uploadPicture:function(){try{$('#naboo_playlist_image_upload').fileupload({multipart:true,add:function(e,data){var acceptFileTypes=/^image\/(gif|jpe?g|png)$/i;if(data.originalFiles[0].type==''||!acceptFileTypes.test(data.originalFiles[0].type)){return false;}
data.submit();},send:function(e,data){var fileName=data.files[0].name.substring(0,data.files[0].name.length-4);data.url=SETTING_HOST_UPLOAD+'/?sid='+SESSION_ID+'&id='+playlist.id+'&resize=1&directory=playlist&type=picture&referer='+SETTING_REFERER_UPLOAD+'&file='+fileName+'&';},done:function(e,data){if(data.result.error.length===0){Events.trigger(Events.playlist.updatePicture,{md5:data.result.results,type:'playlist'});}}});}catch(e){error.log(e);}},deletePlaylist:function(){try{userData.removePlaylist({id:playlist.id,title:playlist.data.TITLE});}catch(e){error.log(e);}},updateDurationAndNbSongs:function(duration,nb_song){try{playlist.data.DURATION=parseInt(playlist.data.DURATION,10)+parseInt(duration,10);playlist.data.NB_SONG=parseInt(playlist.data.NB_SONG,10)+parseInt(nb_song,10);var content=$('#naboo_playlist_header');if(typeof playlist.data.NB_SONG==='number'){$('[data-target="nb-track"]',content).html('<strong>'+playlist.data.NB_SONG+'</strong>'+ngettext('Titre','Titres',{count:playlist.data.NB_SONG}));}
if(!isNaN(playlist.data.DURATION)){$('[data-target="duration"] > strong',content).text(getTotalDuration(playlist.data.DURATION));}}catch(e){error.log(e);}},updateNbFan:function(evt,data){if(data.id!=playlist.data.PLAYLIST_ID){return false;}
if(evt.namespace==='USER.addFavorite'){playlist.data.NB_FAN+=1;}else{playlist.data.NB_FAN-=1;}
$('#naboo_playlist_header [data-target="nb-fan"] > a').html('<strong>'+playlist.data.NB_FAN+'</strong>'+ngettext('Fan','Fans',{count:playlist.data.NB_FAN}));},onOpenTab:function(type){tabs.display(type);$('#page_content').scrollTop(0);},leave:function(){if(gatekeeper.isAllowed('datagrid')){React.unmountComponentAtNode(document.getElementById('tab_track_list_content'));}else{$('#tab_track_list_content').destroy();}},getLiveFeed:function(){return'1_0_PLAYLISTFEED_'+playlist.id;}};}
window.playlist=playlist;}());;
var tabs={loaded:false,$container_naboo:null,$container_active:null,$container:null,$links:null,$panels:null,selected:null,list_tabs:{},destroy:function(){for(var key in tabs.list_tabs){if(!tabs.list_tabs.hasOwnProperty(key)){continue;}
if(typeof window[key]==='undefined'){delete tabs.list_tabs[key];continue;}
var component=window[key];if(typeof component.destroy=='function'){component.destroy();}
delete tabs.list_tabs[key];}
if(tabs.selected!=null){Events.unsubscribeAll(tabs.selected);}
Events.unsubscribeAll('tabs');tabs.loaded=false;tabs.selected=null;tabs.list_tabs={};tabs.$container=null;tabs.$nav_bar=null;tabs.$links=null;tabs.$panels=null;tabs.$more=null;},init:function($container,list_tabs){tabs.$container_naboo=$('#naboo_content');tabs.$container=$container;tabs.$nav_bar=$('.navbar',tabs.$container);tabs.$links=$('.navbar > ul',tabs.$container);tabs.$panels=$('.nav-tabs-panel',tabs.$container);tabs.$more=$('[data-target="more"]',tabs.$links);tabs.list_tabs={};for(var type in list_tabs){if(!list_tabs.hasOwnProperty(type)){continue;}
if(typeof window[type]!=='object'){throw new Error(type+' is not a valid component for tabs !');}
var component=list_tabs[type];component.cached=false;if(typeof component.disabled==='boolean'&&component.disabled){$('#tab_'+type+'_link',tabs.$container).remove();continue;}
$('#tab_'+type+'_link',tabs.$container).data('width',$('#tab_'+type+'_link',tabs.$container).outerWidth(true));if(typeof component.selected=='boolean'&&component.selected){tabs.selected=type;}
tabs.list_tabs[type]=component;}
Events.subscribe(Events.layout.resize,function(){clearTimeout(tabs.resize_delay);tabs.resize_delay=setTimeout(tabs.resizeMenu,500);},naboo.getCurrentClass());Events.subscribe(Events.layout.adsBackground,function(){tabs.resizeMenu();},naboo.getCurrentClass());tabs.resizeMenu();$('.dropdown',tabs.$links).on('click',tabs.toggleMoreMenu).on('mouseup',function(){return false;}).on('mousedown',function(){$('body').unbind('mouseup',tabs.toggleMoreMenu);return false;});tabs.loaded=true;if(tabs.selected!==null){tabs.display(tabs.selected);}},navClick:function($tab){if(!tabs.loaded){return false;}
var type=$tab.attr('data-tabs');if(typeof tabs.list_tabs[type]!=='undefined'&&typeof tabs.list_tabs[type].url!=='undefined'){loadBox(tabs.list_tabs[type].url);}
tabs.display(type);return true;},display:function(type,auto_scroll){if(!tabs.loaded){return false;}
if(typeof auto_scroll==='undefined'){auto_scroll=false;}
if(typeof tabs.list_tabs[type]==='undefined'){return false;}
if(tabs.selected!=null){Events.unsubscribeAll(tabs.selected);}
Events.subscribeOnce(Events.navigation.tab_displayed,function(){tabs.$container_active.height('auto');});tabs.selected_previous=tabs.selected;tabs.selected=type;var args=tabs.list_tabs[type].args||{type:type,id:naboo.id};var tab=type;$tab=$('#tab_'+tab+'_link > a');tabs.$container_active=$('#tab_'+tab+'_content',tabs.$container);tabs.$container_active.addClass('active');if(!tabs.list_tabs[tab].cached){tabs.$container_active.height(tabs.$container_naboo.height());}
var $tab_link_active=$('#tab_'+tab+'_link',tabs.$container);$tab_link_active.addClass('active');if(tabs.selected_previous!==tabs.selected){$('#tab_'+tabs.selected_previous+'_link',tabs.$container).removeClass('active');$('#tab_'+tabs.selected_previous+'_content',tabs.$container).removeClass('active');}
$('.badge',$tab_link_active).text(0).hide();infinite_scroll.disable();if(auto_scroll){var div_position=tabs.$container.position();if(div_position.top!=null){$('#page_content').scrollTop(yscroll+div_position.top);}}
if(tabs.list_tabs[tab].cached){if(typeof window[tab].onDisplay=='function'){window[tab].onDisplay();}
Events.trigger(Events.navigation.tab_displayed,args);return true;}
if(tab==='comment'||tab==='track'){$('.comment-box',tabs.$container_active).commentbox({display:true,infinite_scroll:true,type:args.type,element_id:args.id,twitter_share:true,facebook_share:true,publish_button:$('#btn-submit-comment'),template:(tab==='track')?'catalog':null,events_group:(tab==='track')?'track':'comment'});}else{window[tab].display(args);}
tabs.list_tabs[tab].cached=true;return;},resizeMenu:function(evt){try{if(typeof tabs.$links!=='undefined'){tabs.$links.children('li').last().show();}
if(tabs.$more.is(':visible')){tabs.toggleMoreMenu();}
var usedItemsSize=tabs.getTabsMenuWidth();if(tabs.$nav_bar.width()<usedItemsSize){var elt=tabs.$links.children('li[data-tab]').last().clone(true);tabs.$links.children('li[data-tab]').last().remove();tabs.$more.prepend(elt);tabs.resizeMenu();return true;}
var nbMoreItems=tabs.$more.children().children().length;var addItemSize=tabs.$more.children().first().data('width');var addItemInMainBar=(nbMoreItems>1&&tabs.$nav_bar.width()>usedItemsSize+addItemSize);var addLastItemInMainBar=(nbMoreItems===1&&tabs.$nav_bar.width()>(addItemSize+usedItemsSize-tabs.$more.parent().outerWidth()));if(addItemInMainBar||addLastItemInMainBar){var elt=tabs.$more.children().first().clone(true);tabs.$more.children().first().remove();elt.insertBefore(tabs.$links.children('li').last());if(nbMoreItems>1){tabs.resizeMenu();}else{tabs.$links.children('li').last().hide();}
return true;}
if(nbMoreItems===0){tabs.$links.children('li').last().hide();}
return false;}catch(e){error.log(e);}},getTabsMenuWidth:function(){try{var totalWidth=0;tabs.$links.children('li:visible').each(function(){totalWidth+=$(this).outerWidth(true);});return totalWidth;}catch(e){error.log(e);}},toggleMoreMenu:function(e){try{if(typeof e==='object'){e.preventDefault();}
var dropdown=tabs.$more.closest('.dropdown');if(!dropdown.hasClass('opened')){dropdown.addClass('opened');$('body').trigger('mouseup');$('body').bind('mouseup',tabs.toggleMoreMenu);}else{dropdown.removeClass('opened');$('body').unbind('mouseup',tabs.toggleMoreMenu);}}catch(e){error.log(e);}}};;
(function(){'use strict';var tops={initialized:false,id:0,template:'naboo/tops',item_width:220,item_height:220,item_artist_height:281,default_genre:0,start:0,nb:25,max:100,parent_genre:0,genre_id:0,type:'playlist',cache:{},tracklist:[],init:function(){try{if(tops.initialized){return true;}
genre.load();Events.subscribe(Events.layout.adsBackground,tops.displayAds,'tops');Events.subscribe(Events.layout.infiniteScroll,tops.loadNextItems,'tops');templating.load(tops.template);tops.$filters_genres=$('#naboo_tops_filters > form');tops.$filters_types=$('#naboo_tops_filters_type');tops.$items_container=$('#naboo_tops_container');tops.$empty_container=$('#naboo_tops_empty');tops.initialized=true;}catch(e){error.log(e);}},display:function(args){try{tops.init();tops.start=0;tops.type=args.type||tops.type;tops.genre_id=parseInt(args.genre_id||tops.genre_id,10);$('.btn',tops.$filters_types).removeClass('active');$('#filter_type_'+tops.type,tops.$filters_types).addClass('active');Events.ready(Events.genre.loaded,tops.buildMenu);Events.ready(Events.genre.loaded,tops.load);naboo.afterLoad(true);return true;}catch(e){error.log(e);}},buildMenu:function(){try{if(genre.list.length===0){return false;}
tops.$filters_genres.selectGenre({id:tops.genre_id,callback:tops.onGenreChange});return true;}catch(e){error.log(e);}},onGenreChange:function(data){try{if(data.GENRE_ID!=tops.genre_id){tops.genre_id=data.GENRE_ID;tops.start=0;tops.load();tracking.track('tops_genre_click',{id:data.GENRE_ID,genre:addslashes(data.GENRE_NAME)});}
return true;}catch(e){error.log(e);}},load:function(){try{tops.updateUrl();if(tops.start===0){tops.$items_container.html('');tops.tracklist=[];}
var cache_key=tops.type+'_'+tops.genre_id;if(typeof tops.cache[cache_key]!=='undefined'&&typeof tops.cache[cache_key][tops.start]!=='undefined'){tops.loadCallback(tops.cache[cache_key][tops.start]);return true;}
api.call('deezer.pageTops',{TYPE:tops.type,GENRE_ID:tops.genre_id,START:tops.start,NB:tops.nb},tops.loadCallback);return true;}catch(e){error.log(e);}},loadCallback:function(result){try{if(typeof genre.getData(tops.genre_id).GENRE_ID==='undefined'){tops.genre_id=tops.default_genre;tops.load();return false;}
if(result.ITEMS.total===0&&tops.start===0){tops.$empty_container.html(placeholder.draw({wording:gettext('Nous n\'avons pas trouvé de musique pour ce genre. Essayez d\'en sélectionner un autre.')}));return false;}
tops.buildMenu();tops.$empty_container.empty();var cache_key=tops.type+'_'+tops.genre_id;if(typeof tops.cache[cache_key]==='undefined'){tops.cache[cache_key]={};}
tops.cache[cache_key][tops.start]=result;tops.render(tops.cache[cache_key][tops.start].ITEMS.data);infinite_scroll.active();return true;}catch(e){error.log(e);}},render:function(data){try{for(var i=0;i<data.length;i++){var item=data[i];var index=(i+1)+tops.start;item.position=(index<10)?'0'+index:index;item.variation='egal';if(typeof item.VARIATION!=='undefined'){var variation=parseInt(item.VARIATION,10);if(variation>0){item.variation='up';}else if(variation<0){item.variation='down';}}
var unavailableType;var available;switch(tops.type){case'track':item.available=(right.checkSongAvailable(item)===right.READABLE||typeof item.FALLBACK!=='undefined')?true:false;tops.tracklist.push(item);break;case'album':available=(typeof item.AVAILABLE!=='undefined'&&item.AVAILABLE===false)?false:true;break;case'playlist':if(item.TITLE===''||/^\s+$/.test(item.TITLE)){item.TITLE=gettext('Sans nom');}
break;default:break;}}
var handlebars_data={data:data,genre_id:(tops.genre_id||'0'),start:tops.start,genre_name:addslashes(genre.getData(tops.genre_id||'0').GENRE_NAME)};tops.$items_container.append(Handlebars.templates['tops_'+tops.type](handlebars_data)).responsiveCover({cover_width:tops.item_width,cover_height:(tops.type==='artist')?tops.item_artist_height:tops.item_height,gap:15,onresize:function(options){if(options.columnsWidth===null||tops.type!=='playlist'){return;}
var firstColumn=options.columns.first().addClass('thumbnail-highlight');var pictureBlur=firstColumn.find('.picture-blur');firstColumn.css({maxWidth:'none',width:(parseFloat(options.columnsWidth)*2)+'%'});if(pictureBlur.length===0){var picture=firstColumn.find('.picture').removeClass('picture').addClass('picture-blur');var link=firstColumn.find('.picture-link');var blurred=new window.Blurred(picture.get(0));link.append(picture.clone(true).removeClass('picture-blur').addClass('picture'));blurred.setUrl(picture.attr('src'));blurred.setBlurStrength(5);blurred.setCallback(function(){$(this.getProps(['element'])).addClass('active');});blurred.render();}}});if(tops.type==='track'){$('a[data-favorite]',tops.$items_container).data('song-type',0);tops.$items_container.find('.thumbnail .evt-click[data-play="1"]').each(function(){$(this).data({playSongList:tops.tracklist,playIndex:$(this).parents('li').index(),playContext:'tops_track'});});}
Events.trigger(Events.navigation.page_updated);return true;}catch(e){error.log(e);}},loadNextItems:function(){try{tops.start+=tops.nb;if(tops.start>=tops.max){return infinite_scroll.disable();}
return tops.load();}catch(e){error.log(e);}},updateUrl:function(){try{var url='/charts/'+tops.type.toLowerCase();if(tops.genre_id>0){url+='/genre/'+tops.genre_id;}
www.setCurrentPath(url);return true;}catch(e){error.log(e);}},leave:function(){try{tops.start=0;tops.type='playlist';return true;}catch(e){error.log(e);}},displayAds:function(){try{tops.$items_container.responsiveCover_update();return true;}catch(e){error.log(e);}}};window.tops=tops;}());;
var chronicles={alb_id:0,provider:'',display:function(args){try{chronicles.alb_id=args.id;if(typeof provider!=='undefined'){chronicles.provider=args.provider;}
var params={alb_id:chronicles.alb_id,lang:SETTING_LANG};api.call('review.getList',params,chronicles.displayCallback);return true;}catch(e){error.log(e);}},displayCallback:function(result){try{if(result.count!=null&&result.count>0){for(var chronicle_item in result.data){if(!result.data.hasOwnProperty(chronicle_item)){continue;}
var chronicle_data=result.data[chronicle_item];var file_name=chronicle_data.LOGO_BIG.split('.');if(file_name.length!==2){continue;}
var logo_chronicle=SETTING_STATIC+'/img/review/big/'+file_name[0]+'-v'+STATIC_VERSION+'.'+file_name[1];var name_chronicle=chronicle_data.PARTNER_NAME;var id_chronicle=chronicle_data.SOURCE;if(chronicles.provider==''){chronicles.provider=id_chronicle;}
$('#tab_chronicles_content > table .naboo_album_chronicles_providers').append('<div id="naboo_album_chronicles_provider_'+id_chronicle+'"><a href="javascript:void(0)" onclick="chronicles.changePovider(\''+id_chronicle+'\'); return false;"><img src="'+logo_chronicle+'" alt="'+name_chronicle+'" /></a></div>');if(result.data[chronicle_item].AUTHOR_NAME==null){result.data[chronicle_item].AUTHOR_NAME='';}
if(result.data[chronicle_item].URL!=null&&result.data[chronicle_item].CHRONICLE!=null){var html_chronicles='<div id="naboo_album_chronicles_text_'+id_chronicle+'" style="display:none">'+result.data[chronicle_item].CHRONICLE+'<br/><br/>'+result.data[chronicle_item].AUTHOR_NAME;if((result.data[chronicle_item].URL!=null)&&(result.data[chronicle_item].URL!=='')){html_chronicles+='<br/>'+gettext('Retrouvez plus de chroniques sur')+' <a href="'+result.data[chronicle_item].URL+'" target="_blank">'+result.data[chronicle_item].URL+'</a>';}
html_chronicles+='</div>';$('#tab_chronicles_content > table .naboo_album_chronicles_texts').append(html_chronicles);}}}
chronicles.changePovider(chronicles.provider);Events.trigger(Events.navigation.tab_displayed,{type:'chronicles',id:chronicles.alb_id});return true;}catch(e){error.log(e);}},changePovider:function(id_provider){try{if(id_provider!=''){$('#tab_chronicles_content .naboo_album_chronicles_texts div').hide();$('#naboo_album_chronicles_text_'+id_provider).show();}
$('#tab_chronicles_content .naboo_album_chronicles_providers div a').removeClass('selected');$('#naboo_album_chronicles_provider_'+id_provider+' a').addClass('selected');return true;}catch(e){error.log(e);}},onDisplay:function(){chronicles.changePovider(chronicles.provider);return true;},open:function(id_provider){try{if(id_provider!=''&&id_provider!=chronicles.provider){chronicles.changePovider(id_provider);}
return false;}catch(e){error.log(e);}}};
var edito={alb_id:0,current_provider:'',data:{},display:function(args){try{edito.alb_id=args.id;edito.current_provider=args.provider||'';edito.content=$('#tab_edito_content');var params={alb_id:edito.alb_id,lang:SETTING_LANG};api.call('review.getList',params,edito.displayCallback);return true;}catch(e){error.log(e);}},displayCallback:function(result,params){try{edito.data=result;edito.current_provider=params.provider_name||edito.current_provider;var index_display=0;if(result.count!=null&&result.count>0){$('[data-target="logo"]',edito.content).empty();$('[data-target="author"] > img',edito.content).remove();for(var chronicle_item in result.data){if(!result.data.hasOwnProperty(chronicle_item)){continue;}
var chronicle_data=result.data[chronicle_item];var file_name=chronicle_data.LOGO_BIG.split('.');if(chronicle_data.SOURCE===edito.current_provider){index_display=chronicle_item;}
if(file_name.length!==2){continue;}
var logo_chronicle=SETTING_STATIC+'/img/review/big/'+file_name[0]+'-v'+STATIC_VERSION+'.'+file_name[1];var name_chronicle=chronicle_data.PARTNER_NAME;var id_chronicle=chronicle_data.SOURCE;if(edito.provider===''){edito.provider=id_chronicle;}
$img='<img src="'+logo_chronicle+'" alt="'+name_chronicle+'"/>';if(result.count>1){$img='<a href="javascript:void(0)" class="review-logo" onclick="edito.changePovider(\''+chronicle_data.SOURCE+'\'); return false;">'+$img+'</a>';}
$('[data-target="logo"]',edito.content).append($img);}
$('[data-target="logo"] > a',edito.content).removeClass('active');$('[data-target="logo"] > a:eq('+index_display+')',edito.content).addClass('active');$('[data-target="title"]',edito.content).text(album.data.ALB_TITLE);$('[data-target="author"]',edito.content).text(result.data[index_display].AUTHOR_NAME||'');if(result.data[index_display].PARTNER_NAME!==''&&result.data[index_display].URL!==''){$('[data-target="source"]',edito.content).html(gettext('Source :')+' <a href="'+result.data[index_display].URL+'" class="link-primary" target="_blank">'+result.data[index_display].PARTNER_NAME+'<span class="icon icon-arrow-right icon-after"></span></a>');}
if(result.data[index_display].URL!=null&&result.data[index_display].CHRONICLE!=null){$('[data-target="text"]',edito.content).html(result.data[index_display].CHRONICLE);}}
Events.trigger(Events.navigation.tab_displayed,{type:'edito',id:edito.alb_id});return true;}catch(e){error.log(e);}},onDisplay:function(provider_name){edito.current_provider=provider_name;edito.changePovider(provider_name);},changePovider:function(provider_name){try{edito.displayCallback(edito.data,{provider_name:provider_name});return true;}catch(e){error.log(e);}}};
(function(){'use strict';var explore={initialized:false,template:'naboo/explore',tab:'genres',default_genre:0,genre_id:0,parent_genre_id:0,grid:false,pagination:{start:0,nb:20,max:500},loading:false,init:function(){try{if(explore.initialized){return false;}
Events.subscribe(Events.layout.adsBackground,explore.displayAds,'explore');templating.load(explore.template);explore.genre_id=storage.isset('explore_genre')?storage.get('explore_genre'):explore.genre_id;explore.parent_genre_id=storage.isset('explore_parent_genre')?storage.get('explore_parent_genre'):explore.parent_genre_id;explore.$select_parent_genres=$('#selectbox_explore_genres_parent');explore.$select_child_genres=$('#selectbox_explore_genres_child');explore.$select_labels=$('#page_explore_select_genres');explore.pagination.start=0;explore.initialized=true;return true;}catch(e){error.log(e);}},display:function(args){try{explore.init();genre.load();explore.onPageChanged(args);return true;}catch(e){error.log(e);}},onPageChanged:function(args){var filter=args.id||explore.genre_id;explore.load(filter,null,true);},load:function(filter,pagination){try{if(explore.loading===true){return false;}
explore.loading=true;filter=filter||'0';var prev_filter=explore.genre_id;explore.genre_id=filter;if(filter!=='0'){explore.$select_child_genres.show();}
if(typeof pagination==='undefined'||!pagination){pagination=$.extend({},explore.pagination);}else{pagination=$.extend(explore.pagination,pagination);}
if(prev_filter!==filter){pagination=$.extend(explore.pagination,pagination,{start:0});}
var url='/explore';if(filter!=='0'){url+='/'+explore.tab+'/'+filter;}
www.setCurrentPath(url,true);api.call('deezer.pageExplore',{USER_ID:USER.USER_ID,COUNTRY:COUNTRY,FILTER:filter,START:pagination.start,NB:pagination.nb},explore.loadCallback);}catch(e){error.log(e);}},loadCallback:function(result){try{explore.loading=false;if(explore.pagination.start===0){explore.pagination.max=result.LAST_RELEASES.total;if(result.LAST_RELEASES.total===0&&typeof genre.getData(explore.genre_id).GENRE_ID==='undefined'){explore.load(explore.default_genre);return false;}}
storage.set('explore_genre',explore.genre_id);storage.set('explore_parent_genre',explore.parent_genre_id);Events.ready(Events.genre.loaded,explore.buildGenresMenu);explore.renderGenres(result);naboo.afterLoad(explore.pagination.start===0);return true;}catch(e){error.log(e);}},buildGenresMenu:function(){try{if(genre.list.length===0){return false;}
explore.$select_labels.selectGenre({id:explore.genre_id,callback:explore.onChangeGenre});return true;}catch(e){error.log(e);}},renderGenres:function(result){try{if(typeof result.LAST_RELEASES!=='undefined'&&typeof result.LAST_RELEASES.data!=='undefined'&&result.LAST_RELEASES.count>0){explore.renderGenresReleases(result.LAST_RELEASES);}else{infinite_scroll.disable();}
explore.rendered=true;Events.trigger(Events.navigation.page_updated);return true;}catch(e){error.log(e);}},renderGenresReleases:function(data){try{if(typeof data==='undefined'||typeof data.data==='undefined'){return false;}
if(explore.grid===false){var grid=React.createFactory(window.DzrComponents.Grid);explore.grid=React.render(grid({data:data.data,context:'explore_page',options:['type','name','artist','release_date','favorite','sticker']}),document.getElementById('explore_last_releases_grid'),explore.activeInfiniteScroll);}else{explore.grid.setProps({data:explore.grid.props.data.concat(data.data)},function(){explore.activeInfiniteScroll();});}
return true;}catch(e){error.log(e);}},activeInfiniteScroll:function(){if(explore.pagination.start+explore.pagination.nb>=explore.pagination.max){infinite_scroll.disable();return false;}
Events.subscribeOnce(Events.layout.infiniteScroll,function(){infinite_scroll.disable();explore.load(explore.genre_id,{start:explore.pagination.start+explore.pagination.nb,nb:explore.pagination.nb});},'explore');infinite_scroll.active();},onChangeGenre:function(data){try{if(Number(data.GENRE_ID)===Number(explore.genre_id)){return false;}
explore.leave();explore.load(data.GENRE_ID);tracking.track('explore_genres_select_click',{genre_id:data.GENRE_ID,genre_name:addslashes(data.GENRE_NAME)});return true;}catch(e){error.log(e);}},leave:function(){explore.grid=false;React.unmountComponentAtNode(document.getElementById('explore_last_releases_grid'));}};window.explore=explore;})();;
(function(){if(typeof(profile)!=='undefined'){return;}
function _getTabWording(tab,count){switch(tab){case'albums':return ngettext('album','albums',{count:count});case'playlists':return ngettext('playlist','playlists',{count:count});case'artists':return ngettext('artiste favori','artistes favoris',{count:count});case'radios':return ngettext('mix favori','mix favoris',{count:count});case'following':return gettext('following');case'followers':return ngettext('follower','followers',{count:count});case'shows':return ngettext('podcast','podcasts',{count:count});default:return'';}}
window.profile={initialized:false,events:false,init:false,drawGroup:40,id:0,tab:'',data:null,data_tab:{},cache:{},coverSize:{'default':{width:250,height:250},artists:{width:250,height:320}},removeItem:{},templates:{artists:'artist',albums:'album',tracks:'track',playlists:'playlist',shows:'show',followers:'user',following:'user',radios:'radio_genre'},trad:{profile_home:gettext('C\'est ici que vous retrouverez toute votre musique.'),profile_playlists_public:gettext('Conseillez-lui une de vos playlists.'),profile_albums_public:gettext('Conseillez-lui un de vos albums préférés.'),profile_artists_public:gettext('Conseillez-lui un de vos artistes favoris.'),profile_shows_public:gettext('Conseillez-lui un de vos shows préférés.'),profile_radios_public:gettext('Conseillez-lui un de vos mix préférés.'),profile_followers_public:gettext('Aucun follower.'),profile_following_public:gettext('Aucun following.'),profile_private:gettext('Ce profil est privé.'),profile_deactivate:gettext('Ce profil a été supprimé.'),profile_playlists:gettext('Découvrez vite À écouter, notre fil de recommandations musicales !'),profile_playlists_personal:gettext('Qu\'attendez-vous pour créer votre première playlist ?'),profile_albums:gettext('Aucun résultat.'),profile_artists:gettext('Aucun résultat.'),profile_radios:gettext('Aucun résultat.'),profile_shows:gettext('Aucun résultat.'),profile_loved:gettext('Vous aimez une chanson ? Ajoutez-la à vos coups de cœur en cliquant sur le cœur du player '),profile_personal_song:gettext('Vous n\'avez pas encore téléchargé vos propres MP3 ?'),profile_history:gettext('Découvrez vite À écouter, notre fil de recommandations musicales !')},emptyTrad:{top_tracks:gettext('Aucun Top Titres'),top_albums:gettext('Aucun Top Albums'),top_artists:gettext('Aucun Top Artistes')},init:function(){try{if(profile.initialized){return false;}
templating.load('naboo/profile/index');templating.load('naboo/profile/header',$('#page_profile_header'));Events.subscribe(Events.navigation.page_displayed,profile.resizeMenu,'profile');Events.subscribe(Events.user.blockFriend,profile.changeBlockStatus,'profile');Events.subscribe(Events.user.unblockFriend,profile.changeBlockStatus,'profile');Events.subscribe(Events.user.addFavorite,profile.favoriteAdded,'profile');Events.subscribe(Events.user.deleteFavorite,profile.favoriteRemoved,'profile');Events.subscribe(Events.playlist.removed,profile.favoriteRemoved,'profile');Events.subscribe(Events.layout.resize,profile.resizeMenu,'profile');Events.subscribe(Events.menu.resize,profile.resizeMenu,'profile');Events.subscribe(Events.playlist.created,profile.addPlaylist,'profile');Events.subscribe(Events.layout.adsBackground,profile.displayAds,'profile');Events.subscribe(Events.user.updatePicture,profile.updateAvatar,'profile');Events.subscribe(Events.user.uploadPicture,function(){$('#profile_avatar_upload').click();},'profile');Events.subscribe(Events.player.play,profile.displayOnlineTrack,'profile');Events.subscribe(Events.player.finish,profile.displayOnlineTrack,'profile');Events.subscribe(Events.datagrid.removedTrack,function(){profile.data.TAB[profile.tab].total--;profile.drawDatagridTabTitle();},'profile');profile.drawHeader();profile.drawMenu();profile.initialized=true;}catch(e){error.log(e);}},leave:function(){try{var datagrid=$('#profile_page_tab .datagrid_master')
if(datagrid.length>0){datagrid.destroy();}
profile.data=null;profile.id=0;}catch(e){error.log(e);}},display:function(args){try{if(typeof args.user_id!=='string'){return false;}
profile.id=args.user_id;profile.id=(profile.id==='me')?USER.USER_ID:parseInt(profile.id,10);profile.tab=args.tab||'home';$('body').unbind('mouseup',profile.toggleMoreMenu);if(typeof args.data==='object'){return profile.displayCallback(args.data);}
api.call('deezer.pageProfile',{user_id:profile.id,tab:profile.tab},profile.displayCallback);return true;}catch(e){error.log(e);}},onPageChanged:function(args){profile.tab=args.tab||'home';if(typeof profile.data.TAB[profile.tab]!=='undefined'){profile.displayCallback();return true;}
api.call('deezer.pageProfile',{user_id:profile.id,tab:profile.tab},profile.displayCallback);return true;},displayCallback:function(result){try{if(profile.data===null){profile.data=result;if(profile.tab==='home'){profile.data.TAB={home:result.TAB};}
profile.init();}else if(result){if(profile.tab==='home'){profile.data.TAB[profile.tab]=result.TAB;}else{profile.data.TAB[profile.tab]=result.TAB[profile.tab];profile.data.TAB[profile.tab+'_suggest']=result.TAB[profile.tab+'_suggest'];if(typeof result.TAB['top_'+profile.tab]==='object'){profile.data.TAB['top_'+profile.tab]=result.TAB['top_'+profile.tab];}}}
profile.drawAllCoverProgress=false;profile.tab=(!profile.data.DATA.IS_PUBLIC&&!profile.data.DATA.IS_PERSONNAL)?'private':profile.tab;profile.tab=(profile.data.DATA.USER.ACTIVATION=='2')?'deactivate':profile.tab;if(profile.tab==='deactivate'||profile.tab==='private'){var pic=(profile.tab==='deactivate')?'nocontent':profile.tab;$('#profile_page_tab').html(placeholder.draw({wording:profile.trad['profile_'+profile.tab],picture:pic}));}else{templating.load('naboo/profile/'+profile.tab,$('#profile_page_tab'));}
profile.currentTab=$('#profile_page_tab');profile.currentList=$('#profile_page_'+profile.tab);profile.currentPage=$('#page_profile');profile.updateMenu();infinite_scroll.disable();switch(profile.tab){case'loved':case'personal_song':case'history':case'downloads':profile.drawDatagridTab();break;case'albums':case'artists':case'playlists':case'shows':case'radios':case'followers':case'following':profile.drawCoverTab();break;case'home':profile.drawHomeTab();break;default:naboo.afterLoad(true);}}catch(e){error.log(e);}},displayOnlineTrack:function(evt,param){if(!profile.data.DATA.IS_PERSONNAL||profile.tab!=='home'){return false;}
profile.drawOnlineTrack(param.value);},drawOnlineTrack:function(data){try{var $page_online=$('#profile_page_online');var $page_infos=$('#profile_page_infos');if(typeof data==='undefined'||(profile.data.DATA.IS_PERSONNAL&&dzPlayer.getCurrentSong()===null)||data.SNG_ID<0){$page_online.remove();return true;}
$('span > [data-target="onair-song"]',$page_online).prop('href','/album/'+data.ALB_ID).text(data.SNG_TITLE);$('span > [data-target="onair-artist"]',$page_online).prop('href','/artist/'+data.ART_ID).text(data.ART_NAME);$page_online.show();$page_infos.fadeIn();}catch(e){error.log(e);}},drawCoverTab:function(){try{var data=profile.data.TAB;profile.inputSearch=$('#naboo_datagrid_filter_text');var searchCallback=window.debounce(function(){profile.search(profile.tab,$(this));},400);profile.inputSearch.on('keyup focus',searchCallback);profile.deleteSearch=$('#search-cross');profile.deleteSearch.on('click',function(){if(!profile.inputSearch.val().length){return false;}
profile.cleanSearch();profile.search(profile.tab,profile.inputSearch);});switch(profile.tab){case'playlists':if(gatekeeper.isAllowed('curator_feature')&&profile.id===USER.USER_ID){$('#profile_page_playlists_curator',profile.currentTab).show().on('click',function(){modal.open('/lightbox/curators/edit_playlist/'+USER.USER_ID);});}else{$('#profile_page_playlists_curator',profile.currentTab).remove();}
$('section [data-target="filter-playlist"] > button',profile.currentTab).on('click',function(){profile.filterPlaylist($(this).data('type'));});$('#profile_page_playlist_selectbox').createSelectbox({data:[{NAME:gettext('Mises à jour récemment'),ID:1},{NAME:gettext('Ajoutées récemment'),ID:7},{NAME:gettext('A - Z'),ID:0},{NAME:gettext('Les plus écoutées'),ID:5}],align:'right',callback:function(data){profile.sort('playlists',data);}});profile.data.top_playlist_hash={};for(var i=0;i<data.top_playlists.total;i++){profile.data.top_playlist_hash[data.top_playlists.data[i].PLAYLIST_ID]=i;}
data.playlists=profile.filterDisplayPlaylist(data.playlists);data.playlists.data.sort(profile.sortByDate);break;case'albums':$('#profile_page_album_selectbox').createSelectbox({data:[{NAME:gettext('Ajoutés récemment'),ID:1},{NAME:gettext('A - Z (artiste)'),ID:4},{NAME:gettext('A - Z (album)'),ID:3},{NAME:gettext('Les plus écoutés'),ID:6}],align:'right',callback:function(data){profile.sort('albums',data);}});profile.data.top_album_hash={};for(var i=0;i<data.top_albums.total;i++){profile.data.top_album_hash[data.top_albums.data[i].ALB_ID]=i;}
data.albums.data.sort(profile.sortByDate);break;case'shows':data.shows.data.sort(profile.sortByDate);break;case'artists':$('#profile_page_artist_selectbox').createSelectbox({data:[{NAME:gettext('Ajoutés récemment'),ID:1},{NAME:gettext('A - Z'),ID:2}],align:'right',callback:function(data){profile.sort('artists',data);}});data.artists.data.sort(profile.sortByDate);break;}
if(data[profile.tab].total<5&&profile.data.DATA.IS_PERSONNAL){$('[data-target="suggest-contener"]',profile.currentTab).show();$('[data-target="action"]',profile.currentTab).children().hide();profile.drawSuggest(profile.tab,$('#profile_page_'+profile.tab+'_empty'),data[profile.tab+'_suggest']);if(data[profile.tab].total===0&&profile.tab!=='playlists'){$('#profile_page_'+profile.tab).parent().hide();}
if(profile.tab==='playlists'){$('[data-target="action"] > div:last',profile.currentTab).show();}}else if(data[profile.tab].total==0&&!profile.data.DATA.IS_PERSONNAL){$('[data-target="suggest-contener"]',profile.currentTab).hide();$('[data-target="action"]',profile.currentTab).hide();$('section[data-target="empty-message-public"]',profile.currentTab).html(placeholder.draw({picture:'recommendation',wording:profile.trad['profile_'+profile.tab+'_public']}));profile.currentList.parent().hide();}
profile.drawCoverTabTitle();profile.currentTab.removeClass('full').addClass('user-empty');profile.appendCover(profile.currentList,profile.tab,data[profile.tab].data,0,profile.drawGroup);naboo.afterLoad(true);}catch(e){error.log(e);}},drawCoverTabTitle:function(type){try{type=type||'tab';if(type==='tab'){var total=profile.data.TAB[profile.tab].total
$('h2',profile.currentTab).html('<span class="color-primary">'+breakUpThousands(total)+'</span> '+_getTabWording(profile.tab,total));}else{var titleContent=$('h2[data-target="title-'+type+'"]',profile.currentTab);var total=titleContent.data('total');titleContent.html('<span class="color-primary">'+breakUpThousands(total)+'</span> '+_getTabWording(type,total));if(total>0){titleContent.wrapInner($('<a>',{'class':'link-gray-light evt-click',href:'/profile/'+profile.id+'/'+type}));}}}catch(e){error.log(e);}},appendCover:function(div,type,data,start,nb){try{var hbTemplate=Handlebars.templates['common_'+profile.templates[type]];var currentData={data:data.slice(start,start+nb),play_context:'profile_'+type,profile_id:profile.id};if(!profile.data.DATA.IS_PERSONNAL){currentData.button_favorite=true;currentData.USER_ID=USER.USER_ID.toString();}
if(profile.templates[type]==='playlist'){currentData.create_playlist=profile.data.DATA.IS_PERSONNAL&&profile.currentList.children().length===0;}
Events.ready(Events.user.userReady,function(){div.append(hbTemplate(currentData)).data('start',div.children().length);});setTimeout(function(){profile.createCoverPaneTab(div);},1);if(profile.tabIsAllDisplay()){Events.trigger(Events.profile.allCoverLoaded,{status:true});}else{Events.trigger(Events.profile.allCoverLoaded,{status:false});Events.subscribe(Events.layout.infiniteScroll,profile.scrollCover,'profile');infinite_scroll.active();}
if(type==='playlists'&&profile.currentList.data('filter')!=null&&profile.currentList.data('filter')!='all'){profile.filterPlaylist(profile.currentList.data('filter'));}
Events.trigger(Events.navigation.page_updated);}catch(e){error.log(e);}},createCoverPaneTab:function(div){try{var refresh=div.responsiveCover_update();if(refresh===false){var coverSize=profile.getCoverSize(profile.tab);div.responsiveCover({cover_width:coverSize.width,cover_height:coverSize.height,gap:15});}
return true;}catch(e){error.log(e);}},drawAllCover:function(callback){try{if(profile.tabIsAllDisplay()){profile.currentList.responsiveCover_update();return false;}
if(profile.drawAllCoverProgress){return false;}
Events.subscribeOnce(Events.profile.allCoverLoaded,function(evt,data){profile.drawAllCoverProgress=false;if(data.status===true){if(typeof callback==='function'){callback();}}else{profile.drawAllCover(callback);}});profile.drawAllCoverProgress=true;infinite_scroll.disable();var start=profile.currentList.data('start');profile.appendCover(profile.currentList,profile.tab,profile.data.TAB[profile.tab].data,start,profile.drawGroup);return true;}catch(e){error.log(e);}},scrollCover:function(){try{infinite_scroll.disable();profile.appendCover(profile.currentList,profile.tab,profile.data.TAB[profile.tab].data,profile.currentList.data('start'),profile.drawGroup);}catch(e){error.log(e);}},drawDatagridTab:function(){try{var data=profile.data.TAB;if(typeof data[profile.tab]==='undefined'){data[profile.tab]={total:0,count:0,data:[]};}
if(profile.data.DATA.IS_PERSONNAL){profile.drawPlaceholder(data[profile.tab].total);}
profile.currentTab.removeClass('user-empty').addClass('full');profile.drawDatagridTabTitle();var datagridOptions={type:profile.tab,id:profile.id,playlist_personnal:false,songs:{total:data[profile.tab].total,count:data[profile.tab].count,data:data[profile.tab].data.slice(0)}};switch(profile.tab){case'loved':if(profile.data.DATA.IS_PERSONNAL){$.extend(datagridOptions,{type:'lovedpersonal',playlist_personnal:true,offline_data:{playlist_checksum:data.loved.checksum,playlist_picture:'87fc4422c7138e9fe33205ae5707d93f',playlist_picture_type:'playlist'}});}
break;case'personal_song':if(!Modernizr.draganddrop){$('#profile_mp3_drop').hide();}
$('#profile_mp3_upload').fileupload({multipart:true,dropZone:$('#profile_mp3_drop'),sequentialUploads:true,add:function(e,data){var uploadErrors=[];var acceptFileTypes=/^audio\/(mp3|mpeg)$/i;if(data.originalFiles[0].type==''||!acceptFileTypes.test(data.originalFiles[0].type)){return false;}
data.submit();},send:function(e,data){profile.currentUploadSong={name:data.files[0].name.substring(0,data.files[0].name.length-4),size:data.files[0].size}
datagrid.action(profile.currentList,['insertUploadFile',profile.currentUploadSong.size,profile.currentUploadSong.name]);data.url=SETTING_HOST_UPLOAD+'/?sid='+SESSION_ID+'&resize=1&directory=&type=audio&referer='+SETTING_REFERER_UPLOAD+'&file='+profile.currentUploadSong.name+'&';},done:function(e,data){datagrid.action(profile.currentList,['finishUploadFile',profile.currentUploadSong.size,profile.currentUploadSong.name,data.result]);profile.data.TAB.personal_song.total++;profile.drawDatagridTabTitle();},progressall:function(e,data){var progress=parseInt(data.loaded/data.total*100,10);datagrid.action(profile.currentList,['updateUploadFile',profile.currentUploadSong.size,profile.currentUploadSong.name,progress]);}});break;}
$('section > .datagrid',profile.currentTab).createDatagrid(datagridOptions);Events.unsubscribe(Events.layout.infiniteScroll,profile.scrollCover);naboo.afterLoad(true);}catch(e){error.log(e);}},drawDatagridTabTitle:function(){try{var total=profile.data.TAB[profile.tab].total;var formattedTotal=breakUpThousands(total);var infos='<span class="color-primary">'+formattedTotal+'</span> '+ngettext('titre','titres',{count:total});$('h2',profile.currentTab).html(infos);}catch(e){error.log(e);}},drawHomeTab:function(){try{var data=profile.data.TAB.home;if(data.albums.total===0&&data.playlists.total<=1&&data.artists.total===0){var target=(profile.data.DATA.IS_PERSONNAL)?'empty-message':'empty-message-public';var wording=(profile.data.DATA.IS_PERSONNAL)?gettext('C\'est ici que vous retrouverez toute votre musique.'):gettext('La bibliothèque de %s est bien vide... Conseillez-lui de la musique !',{sprintf:[profile.data.DATA.USER.DISPLAY_NAME]});$('[data-target="'+target+'"]',profile.currentTab).show().html(placeholder.draw({picture:'recommendation',wording:wording})).next().show();}
profile.$page_message=$('#profile_page_message');if(data.message!==''||profile.data.DATA.IS_PERSONNAL){profile.$page_message_display_inner=$('#profile_page_message_display').find('> span').text(data.message);profile.$page_message_button=$('#profile_page_message_button');if(profile.data.DATA.IS_PERSONNAL===false){profile.$page_message_display_inner.html(profile.$page_message_display_inner.html().convertURLToLink());}
if(profile.data.DATA.IS_PERSONNAL){profile.$page_message_display=$('#profile_page_message_display');profile.$page_message_edit=$('#profile_page_message_edit');profile.$page_message_placeholder=$('#profile_page_message_placeholder');if(data.message==''){profile.$page_message_placeholder.show();}
profile.$page_message.addClass('user-message-cursor');profile.$page_message.on('click','#profile_page_message_display, #profile_page_message_placeholder',function(){profile.startEditMessage();});profile.$page_message_edit.on('blur',function(){profile.endEditMessage();}).on('keydown',function(evt){if(evt.keyCode==13){$(this).blur();}});profile.$page_message_button.data('tooltipFallback',gettext('Cliquez ici pour éditer')).on('click',function(){profile.startEditMessage();});}else{profile.$page_message_button.remove();if(data.message==''){profile.$page_message.remove();}}}else{profile.$page_message.remove();}
profile.drawOnlineTrack(data.online);$page_info=$('#profile_page_infos')
if($page_info.children().length===0){$page_info.remove();}
$('#profile_page_tops_nav > div > button').on('click',function(){profile.drawTops($(this).data('type'));});$('#profile_page_tops_nav > div > [data-type="tracks"]').addClass('active');profile.drawTops((profile.data.DATA.IS_PERSONNAL)?'albums':'artists');var preview=['playlists','albums','artists','followers','following'];for(var e in preview){if(!preview.hasOwnProperty(e)){continue;}
$contener=$('#profile_page_home_'+preview[e]);var totalElement=data[preview[e]].total;if(preview[e]==='playlists'){if(profile.data.DATA.IS_PERSONNAL&&totalElement<5){$('[data-target="no-empty"]',$contener).remove();$('section [data-target="create-playlist"]',profile.currentTab).show().on('click',function(){menu.dispatchAction('openCreatePlaylist');});}
data.playlists=profile.filterDisplayPlaylist(data.playlists);data.playlists.data.sort(profile.sortByDate);totalElement=data.playlists.total;}
if(totalElement<5&&profile.data.DATA.IS_PERSONNAL){if(totalElement===0&&preview[e]==='followers'){$contener.remove();continue;}
$('[data-target="no-empty"]',$contener).remove();$('[data-target="line"]',$contener).remove();profile.drawSuggest(preview[e],$('[data-target="suggest"]',$contener),data[preview[e]+'_suggest']);if(totalElement===0){$('[data-target="contener"]',$contener).parent().addClass('user-thumbnail-empty');}}else{if(totalElement==0){$('[data-target="no-empty"]',$contener).remove();}
$('[data-target="suggest-contener"]',$contener).remove();}
var hbTemplate=Handlebars.templates['common_'+profile.templates[preview[e]]];var coverSize=profile.getCoverSize(preview[e]);var hbData={data:data[preview[e]].data,play_context:'profile_'+preview[e],profile_id:profile.id};if(!profile.data.DATA.IS_PERSONNAL){hbData.button_favorite=true;hbData.USER_ID=USER.USER_ID.toString();}
if(profile.templates[preview[e]]==='playlist'){hbData.create_playlist=profile.data.DATA.IS_PERSONNAL;}
$('[data-target="contener"]',$contener).html(hbTemplate(hbData)).responsiveCover({cover_width:coverSize.width,cover_height:coverSize.height,gap:15,max_line:1});$('[data-target="no-empty"]',$contener).children('a').attr('href','/profile/'+profile.id+'/'+preview[e]);var titleElement=$('[data-target="title-'+preview[e]+'"]',$contener);titleElement.html('<span class="color-primary">'+breakUpThousands(totalElement)+'</span> '+_getTabWording(preview[e],totalElement)).data('total',totalElement);if(totalElement>0){titleElement.wrapInner($('<a>',{'class':'evt-click',href:'/profile/'+profile.id+'/'+preview[e]}));}}
naboo.afterLoad(true);}catch(e){error.log(e);}},drawTops:function(type){try{$('#profile_page_tops_nav > div > button').removeClass('active');$('#profile_page_tops_nav > div > [data-type="'+type+'"]').addClass('active');var coverSize=profile.getCoverSize(type);var tabData=profile.data.TAB.home;if(tabData.top_track.total==0&&tabData.top_album.total==0&&tabData.top_artist.total==0){$('#profile_page_tops').hide();return false;}
var topData='';if(tabData.top_track.total>0&&type==='tracks'){topData=tabData.top_track;}
if(tabData.top_album.total>0&&type==='albums'){topData=tabData.top_album;}
if(tabData.top_artist.total>0&&type==='artists'){topData=$.extend({},tabData.top_artist);}
if(topData!==''){topData.play_context='profile_top_'+type;if(!profile.data.DATA.IS_PERSONNAL){topData=$.extend({},topData,{button_favorite:(USER.USER_ID>0)});}
var hbTemplate=Handlebars.templates['common_'+profile.templates[type]];$('#profile_page_tops > [data-target="top-empty"]').hide();$('#profile_page_tops_content').html(hbTemplate(topData)).responsiveCover({cover_width:coverSize.width,cover_height:coverSize.height,gap:15,max_line:1});Events.trigger(Events.navigation.page_updated);}else{$('#profile_page_tops > [data-target="top-empty"]').text(profile.emptyTrad[type]).show();$('#profile_page_tops_content').responsiveCover_destroy();}}catch(e){error.log(e);}},drawHeader:function(){try{profile.header=$('#page_profile_header [data-target="header"]');profile.fixNav=$('.navbar',profile.header);if(profile.data.DATA.IS_PUBLIC==true){profile.drawFollowerNumber();if(profile.data.DATA.IS_PERSONNAL){$('[data-target="avatar-button"]',profile.header).show();$('[data-target="header-type"]',profile.header).addClass('header-personnal');$('#profile_avatar_upload').fileupload({multipart:true,dropZone:$('[data-target="avatar-button"]',profile.header),add:function(e,data){var uploadErrors=[];var acceptFileTypes=/^image\/(gif|jpe?g|png)$/i;if(data.originalFiles[0].type==''||!acceptFileTypes.test(data.originalFiles[0].type)){return false;}
data.submit();},send:function(e,data){var fileName=data.files[0].name.substring(0,data.files[0].name.length-4);data.url=SETTING_HOST_UPLOAD+'/?sid='+SESSION_ID+'&resize=1&directory=user&type=picture&referer='+SETTING_REFERER_UPLOAD+'&file='+fileName+'&';},done:function(e,data){if(data.result.error.length===0){profile.drawAvatar(data.result.results);Events.trigger(Events.user.updatePicture,{md5:data.result.results});}}});}
if(profile.data.DATA.CURATOR!==false&&profile.data.DATA.CURATOR.COUNTRY_NAME!==''){if(profile.data.DATA.IS_PERSONNAL){$('[data-target="header-type"]',profile.header).addClass('header-edito');}
$('[data-target="curator"]',profile.header).show().append(profile.data.DATA.CURATOR.COUNTRY_NAME).children('.flag').addClass('flag-'+profile.data.DATA.CURATOR.DEFAULT_COUNTRY.toLowerCase());}}else if(profile.data.DATA.USER.ACTIVATION=='2'){profile.fixNav.remove();$('[data-target="header-type"]',profile.header).addClass('header-deactivate');}else{profile.fixNav.remove();$('[data-target="header-type"]',profile.header).addClass('header-private');}
profile.drawAvatar(profile.data.DATA.USER.USER_PICTURE);profile.drawBanner(profile.data.DATA.USER.TOP_TRACK);$('[data-target="name"]',profile.header).text(profile.data.DATA.USER.DISPLAY_NAME).prop('href','/profile/'+profile.id).prop('title',profile.data.DATA.USER.DISPLAY_NAME);$('[data-target="blocked-wording"]',profile.header).text(gettext('BLOQUÉ'));if(profile.data.DATA.HAS_BLOCKED){$('[data-target="blocked-status"]',profile.header).addClass('user-blocked');}
if(profile.data.DATA.USER.ACTIVATION!='2'){if(!profile.data.DATA.IS_PERSONNAL){$('[data-target="follow"]',profile.header).replaceWith(button_multi_state.draw({id:profile.id,action:'favorite',type:'friend',wording:'full',color:'shadow-flow'}));}
$('[data-target="flow"]',profile.header).replaceWith(button_multi_state.draw({id:profile.id,action:'play',type:'user',wording:'full',color:'primary-flow',color_equalizer:'dark',play_context:'profile_user_radio',radio:true,tracking:1,tracking_tag:'flow_click',tracking_params:'{\'type\': \'flow\', \'instance\': \''+((profile.data.DATA.IS_PERSONNAL)?'collection':'profile')+'\'}'}));profile.drawDropdown();}}catch(e){error.log(e);}},drawDropdown:function(){try{$('[data-target="dropdown"]',profile.header).html(thumbnails.draw({id:profile.id,type:'user',cover_type:'empty',href_type:false,cover_link:false,responsive:true,blocked:profile.data.DATA.HAS_BLOCKED?'1':'0'}));}catch(e){error.log(e);}},updateAvatar:function(evt,params){try{if(!profile.data.DATA.IS_PERSONNAL){return;}
profile.data.DATA.USER.USER_PICTURE=params.md5;profile.drawAvatar(params.md5);profile.drawDropdown();}catch(e){error.log(e);}},drawBanner:function(track){try{var user_banner=SETTING_STATIC+'/images/naboo/pages/profile/private-v'+STATIC_VERSION+'.jpg';if(track.ALB_PICTURE!==''){user_banner=SETTING_DOMAIN_IMG+'/cover/'+track.ALB_PICTURE+'/250x1200-000000-80-0-0.jpg';}
$('[data-target="header-type"]',profile.header).css('background-image','url('+user_banner+')');return true;}catch(e){error.log(e);}},drawAvatar:function(md5){try{$('[data-target="avatar"]',profile.header).html(thumbnails.draw({id:profile.id,type:'user',cover_type:'user',pic_id:md5,border:false,shadow:false,size:'120x120',width:120,height:120,context_menu_hide:true}));}catch(e){error.log(e);}},drawFollowerNumber:function(){try{var following=profile.data.DATA.NB_FOLLOWING;var follower=profile.data.DATA.NB_FOLLOWER;var followingText='<strong>'+breakUpThousands(following)+'</strong> '+gettext('Following');var followerText='<strong>'+breakUpThousands(follower)+'</strong> '+ngettext('Follower','Followers',{count:follower});$('[data-target="follower"]',profile.header).html(followerText).prop('href','/profile/'+profile.id+'/followers');$('[data-target="following"]',profile.header).html(followingText).prop('href','/profile/'+profile.id+'/following');}catch(e){error.log(e);}},drawMenu:function(){try{profile.menu=$('[data-target="menu"]',profile.header);profile.more=$('[data-target="more"]',profile.header);if(!profile.data.DATA.IS_PUBLIC){profile.menu.remove();profile.more.remove();}
profile.menu.children().each(function(){if($(this).is('.dropdown')){$(this).on('click',profile.toggleMoreMenu);$(this).on('mouseup',function(){return false;});profile.more.on('mousedown',function(){$('body').unbind('mouseup',profile.toggleMoreMenu);return false;});}else{if($(this).data('public')||profile.data.DATA.IS_PERSONNAL){$(this).data({width:$(this).outerWidth(true),'user-id':profile.id}).attr('href','/profile/'+profile.id+'/'+$(this).data('tab'));}else{$(this).remove();}}});Events.ready(Events.user.dataStoreReady,function(){if(countObject(userData.dataStore)===0){$('[data-tab="downloads"]',profile.menu).remove();$('[data-tab="downloads"]',profile.more).remove();profile.resizeMenu();}});profile.resizeMenu();}catch(e){error.log(e);}},toggleMoreMenu:function(e){try{e.preventDefault();var dropdown=profile.more.closest('.dropdown');if(!dropdown.hasClass('opened')){dropdown.addClass('opened');$('body').trigger('mouseup');$('body').bind('mouseup',profile.toggleMoreMenu);}else{dropdown.removeClass('opened');$('body').unbind('mouseup',profile.toggleMoreMenu);}}catch(e){error.log(e);}},updateMenu:function(){try{profile.menu.children().removeClass('active');profile.menu.children('[data-tab="'+profile.tab+'"]').addClass('active');}catch(e){error.log(e);}},resizeMenu:function(evt){try{if(typeof profile.menu!=='undefined'){profile.menu.children('li').last().show();}
if(profile.more.is(':visible')){profile.toggleMoreMenu();}
var usedItemsSize=profile.getTabsMenuWidth();if(profile.fixNav.width()<usedItemsSize){$elt=profile.menu.children('li[data-tab]').last().clone(true);profile.menu.children('li[data-tab]').last().remove();profile.more.prepend($elt);profile.resizeMenu();return true;}
var nbMoreItems=profile.more.children().children().length;var addItemSize=profile.more.children().first().data('width');var addItemInMainBar=(nbMoreItems>1&&profile.fixNav.width()>usedItemsSize+addItemSize);var addLastItemInMainBar=(nbMoreItems===1&&profile.fixNav.width()>(addItemSize+usedItemsSize-profile.more.parent().outerWidth()));if(addItemInMainBar||addLastItemInMainBar){$elt=profile.more.children().first().clone(true);profile.more.children().first().remove();$elt.insertBefore(profile.menu.children('li').last());if(nbMoreItems>1){profile.resizeMenu();}else{profile.menu.children('li').last().hide();}
return true;}
if(nbMoreItems===0){profile.menu.children('li').last().hide();}
return false;}catch(e){error.log(e);}},getTabsMenuWidth:function(){try{var totalWidth=0;profile.menu.children('li').each(function(){totalWidth+=$(this).outerWidth(true);});return totalWidth;}catch(e){error.log(e);}},startEditMessage:function(){try{profile.$page_message.parent().addClass('active');profile.$page_message_display.hide();profile.$page_message_button.hide();profile.$page_message_edit.val(profile.data.TAB.message).show().focus();profile.$page_message_placeholder.hide();}catch(e){error.log(e);}},endEditMessage:function(){try{var msg=profile.$page_message_edit.val().trim();if(msg!=profile.data.TAB.message){api.call('user.update',{USER_DATA:{DESCRIPTION:msg}},function(){profile.data.TAB.message=msg;});}
profile.$page_message_display.show().children('span').text(msg);profile.$page_message.parent().removeClass('active');profile.$page_message_button.show();profile.$page_message_edit.hide();if(msg==''){profile.$page_message_placeholder.show();}}catch(e){error.log(e);}},search:function(type,input){var query=$.trim(input.val());var entries=$('> li',profile.currentList);var action;var searchData;if(query&&!profile.drawAllCoverProgress){query=rewriting(query.toLowerCase());profile.deleteSearch.show();entries.each(function(){searchData=$(this).data('search').toString();action=(searchData.indexOf(query)!==-1)?'show':'hide';$(this)[action]();});profile.drawPlaceholder();}else{profile.deleteSearch.hide();profile.drawAllCover();entries.show();}
profile.currentList.responsiveCover_update();},cleanSearch:function(){try{profile.inputSearch.val('');}catch(e){error.log(e);}},filterPlaylist:function(type){try{$(' > li',profile.currentList).show();if(type!=='all'){$('> [data-type!="'+type+'"]',profile.currentList).hide();}
profile.currentList.data('filter',type);var nb_visible=profile.currentList.children(':visible').length;$('h2',profile.currentTab).html('<span>'+breakUpThousands(nb_visible)+'</span> '+_getTabWording(profile.tab,nb_visible));profile.drawPlaceholder(nb_visible);$('[data-target="filter-playlist"] > button',profile.currentTab).removeClass('active');$('[data-target="filter-playlist"] [data-type="'+type+'"]',profile.currentTab).addClass('active');profile.cleanSearch();profile.drawAllCover(function(){profile.filterPlaylist(type);});}catch(e){error.log(e);}},addPlaylist:function(evt,data){try{if(profile.data.DATA.IS_PERSONNAL){api.call('playlist.getData',{PLAYLIST_ID:data.PLAYLIST_ID},function(result){result.DATE_ADD=timestampToDate(SERVER_TIMESTAMP,true,'-',true);if(profile.tab==='playlists'){profile.data.TAB[profile.tab].data.unshift(result);profile.data.TAB[profile.tab].total++;profile.appendCover(profile.currentList,'playlists',[result],0,1);$('#profile_page_'+profile.tab).parent().show();}
if(profile.tab==='home'){var titleContent=$('h2[data-target="title-playlists"]',profile.currentTab);titleContent.data('total',titleContent.data('total')+1);profile.appendCover($('#profile_page_playlists',profile.currentTab),'playlists',[result],0,1);profile.drawCoverTabTitle('playlists');$('#profile_page_playlists',profile.currentTab).parent().removeClass('user-thumbnail-empty');}});}}catch(e){error.log(e);}},drawPlaceholder:function(nb_visible){try{nb_visible=nb_visible||profile.currentList.children(':visible').length;if(nb_visible===0){var picture=((profile.tab==='personal_song')?'none':'nocontent');var wording='profile_'+profile.tab;if(profile.tab==='playlists'){if(!profile.data.DATA.IS_PERSONNAL){picture='recommendation';wording+='_public';}else if(profile.currentList.data('filter')==='playlist'){wording+='_personal';}}
$('[data-target="place-holder"]',profile.currentTab).html(placeholder.draw({wording:profile.trad[wording],picture:picture}));}else{$('[data-target="place-holder"]',profile.currentTab).empty();}}catch(e){error.log(e);}},drawSuggest:function(type,target,data){try{if(typeof data==='undefined'||data.total===0||data.count===0){target.parents('.user-section-suggestion').addClass('hide');return false;}
Events.ready(Events.user.userReady,function(){var hash={playlists:['playlist','PLAYLIST_ID'],artists:['artist','ART_ID'],albums:['album','ALB_ID'],following:['friend','USER_ID'],radios:['radio','RADIO_ID'],shows:['show','SHOW_ID']}
for(var f=0;f<data.data.length;f++){if(userData.isFavorite(hash[type][0],data.data[f][hash[type][1]])){data.data.splice(f,1);data.count--;f--;}}
if(data.count>0){target.parent().show();var coverSize=profile.getCoverSize(type);var hbTemplate=Handlebars.templates['common_'+profile.templates[type]];var hbData={data:data.data,button_favorite:true,button_close:true,play_context:'profile_'+type};target.html(hbTemplate(hbData)).show();target.responsiveCover({cover_width:coverSize.width,cover_height:coverSize.height,gap:15,max_line:1});}});}catch(e){error.log(e);}},changeBlockStatus:function(evt,data){try{if(data.id!=profile.id){return false;}
if(evt.namespace=='USER.blockFriend'){$('[data-target="blocked-status"]',profile.header).addClass('user-blocked');}else if(evt.namespace=='USER.unblockFriend'){$('[data-target="blocked-status"]',profile.header).removeClass('user-blocked');}}catch(e){error.log(e);}},favoriteAdded:function(evt,data){try{if(profile.id!=USER.USER_ID){return false;}
switch(data.type){case'friend':if(profile.tab!='home'){profile.data.TAB[profile.tab].data.unshift(data);profile.data.TAB[profile.tab].total++;profile.appendCover(profile.currentList,'following',profile.data.TAB[profile.tab].data,0,1);$('#profile_page_following').parent().show();}else{var titleContent=$('h2[data-target="title-following"]',profile.currentTab);titleContent.data('total',titleContent.data('total')+1);profile.appendCover($('#profile_page_following',profile.currentTab),'following',[data],0,1);$('#profile_page_following',profile.currentTab).parent().removeClass('user-thumbnail-empty');}
profile.drawCoverTabTitle((profile.tab==='home')?'following':null);var suggest_content=$('#profile_page_following_empty');$('#user_'+data.USER_ID,suggest_content).remove();if(suggest_content.children().length==0){suggest_content.parents('[data-target="suggest-contener"]').hide();}
break;case'album':case'artist':case'playlist':case'radio':case'show':var tab=data.type+'s';if(typeof profile.removeItem[data.id]!=='undefined'){var removedItem=$('#'+data.type+'_'+data.id);$('.picture',removedItem).css('opacity',1);if(profile.tab!='home'){profile.data.TAB[profile.tab].data.unshift(data);profile.data.TAB[profile.tab].total++;}else{var titleContent=$('h2[data-target="title-'+tab+'"]',profile.currentTab);titleContent.data('total',titleContent.data('total')+1);}
profile.drawCoverTabTitle((profile.tab==='home')?tab:null);clearTimeout(profile.removeItem[data.id]);delete profile.removeItem[profile.removeItemId];return false;}
if(profile.tab!='home'){profile.data.TAB[profile.tab].data.unshift(data);profile.data.TAB[profile.tab].total++;profile.appendCover(profile.currentList,tab,[data],0,1);$('#profile_page_'+profile.tab).parent().show();}else{var titleContent=$('h2[data-target="title-'+tab+'"]',profile.currentTab);titleContent.data('total',titleContent.data('total')+1);profile.appendCover($('#profile_page_'+tab,profile.currentTab),tab,[data],0,1);$('#profile_page_'+tab,profile.currentTab).parent().removeClass('user-thumbnail-empty');}
profile.drawCoverTabTitle((profile.tab==='home')?tab:null);var suggest_content=$('#profile_page_'+tab+'_empty');$('#'+data.type+'_'+data.id,suggest_content).remove();if(suggest_content.children().length==0){suggest_content.parents('[data-target="suggest-contener"]').hide();}
break;case'song':if(profile.tab==='loved'){profile.data.TAB.loved.total++;profile.drawDatagridTabTitle();}
break;}}catch(e){error.log(e);}},favoriteRemoved:function(evt,data){try{if(profile.id!=USER.USER_ID){return false;}
switch(data.type){case'friend':break;case'album':case'artist':case'playlist':case'radio':case'show':var tab=data.type+'s';if(profile.tab!='home'){var idByType={playlists:'PLAYLIST_ID',albums:'ALB_ID',artists:'ART_ID',radios:'RADIO_ID',shows:'SHOW_ID'};for(var d in profile.data.TAB[profile.tab].data){if(!profile.data.TAB[profile.tab].data.hasOwnProperty(d)){continue;}
if(profile.data.TAB[profile.tab].data[d][idByType[profile.tab]]==data.id){profile.data.TAB[profile.tab].data.splice(d,1);profile.data.TAB[profile.tab].total--;profile.currentList.data('start',profile.currentList.data('start')-1);break;}}}else{var titleContent=$('h2[data-target="title-'+tab+'"]',profile.currentTab);titleContent.data('total',titleContent.data('total')-1);}
profile.drawCoverTabTitle((profile.tab==='home')?tab:null);var removedItem=$('#'+data.type+'_'+data.id);if(removedItem.length===1){$('.picture',removedItem).css('opacity',0.2);profile.removeItem[data.id]=setTimeout(function(){if($('.preview',removedItem).length===1){preview.stop();}
removedItem.remove();delete profile.removeItem[data.id];if(profile.tab==='home'){$('#profile_page_'+tab,profile.currentTab).responsiveCover_update();}},5000);}
break;case'song':if(profile.tab==='loved'){profile.data.TAB.loved.total--;profile.drawDatagridTabTitle();}
break;}}catch(e){error.log(e);}},tabIsAllDisplay:function(){try{if(profile.tab==='home'){return true;}
return!(profile.currentList.data('start')<profile.data.TAB[profile.tab].total);}catch(e){error.log(e);}},sort:function(type,data){try{profile.cleanSearch();var fn=[profile.sortByPlaylistTitle,profile.sortByDate,profile.sortByArtName,profile.sortByAlbTitle,profile.sortByArtNameAlbTitle,profile.sortByPlaylistTop,profile.sortByAlbumTop,profile.sortByCreationDate]
profile.data.TAB[type].data.sort(fn[data.ID]);profile.currentList.empty();profile.appendCover(profile.currentList,profile.tab,profile.data.TAB[profile.tab].data,0,profile.drawGroup);}catch(e){error.log(e);}},displayAds:function(evt,data){try{$('ul.thumbnail-grid',profile.currentTab).each(function(){$(this).responsiveCover_update();});profile.resizeMenu();}catch(e){error.log(e);}},sortByPlaylistTitle:function(a,b){var a1=a.TITLE.toLowerCase();var b1=b.TITLE.toLowerCase();if(a1==b1){return 0;}
return(a1>b1)?1:-1;},sortByDate:function(a,b){if(typeof a.DATE_ADD==='undefined'){a.DATE_ADD='0000-00-00 00:00:00';}
if(typeof b.DATE_ADD==='undefined'){b.DATE_ADD='0000-00-00 00:00:00';}
var a1=a.DATE_ADD;var b1=b.DATE_ADD;if(a1==b1){return 0;}
return(a1<b1)?1:-1;},sortByCreationDate:function(a,b){var a1=a.DATE_FAVORITE||a.DATE_CREATE||'0000-00-00 00:00:00';var b1=b.DATE_FAVORITE||b.DATE_CREATE||'0000-00-00 00:00:00';if(a1===b1){return 0;}
return(a1<b1)?1:-1;},sortByArtName:function(a,b){var a1=a.ART_NAME.toLowerCase();var b1=b.ART_NAME.toLowerCase();if(a1==b1){return 0;}
return(a1>b1)?1:-1;},sortByArtNameAlbTitle:function(a,b){var a1=a.ART_NAME.toLowerCase()+' '+a.ALB_TITLE.toLowerCase();var b1=b.ART_NAME.toLowerCase()+' '+b.ALB_TITLE.toLowerCase();if(a1==b1){return 0;}
return(a1>b1)?1:-1;},sortByAlbTitle:function(a,b){var a1=a.ALB_TITLE.toLowerCase();var b1=b.ALB_TITLE.toLowerCase();if(a1==b1){return 0;}
return(a1>b1)?1:-1;},sortByPlaylistTop:function(a,b){var top_playlist=profile.data.top_playlist_hash;var a_value=typeof top_playlist[a.PLAYLIST_ID]!=='undefined'?1/(top_playlist[a.PLAYLIST_ID]+1):0;var b_value=typeof top_playlist[b.PLAYLIST_ID]!=='undefined'?1/(top_playlist[b.PLAYLIST_ID]+1):0;if(a_value===b_value){return profile.sortByPlaylistTitle(a,b);}
return b_value>a_value?1:-1;},sortByAlbumTop:function(a,b){var top_album=profile.data.top_album_hash;var a_value=typeof top_album[a.ALB_ID]!=='undefined'?1/(top_album[a.ALB_ID]+1):0;var b_value=typeof top_album[b.ALB_ID]!=='undefined'?1/(top_album[b.ALB_ID]+1):0;if(a_value===b_value){return profile.sortByAlbTitle(a,b);}
return b_value>a_value?1:-1;},getAdsArgs:function(){return{element_id:profile.id,element_data:profile.tab};},getCoverSize:function(type){try{if(typeof profile.coverSize[type]!=='undefined'){return profile.coverSize[type];}
return profile.coverSize.default;}catch(e){error.log(e);}},filterDisplayPlaylist:function(list){try{if(list.total===0){return list;}
var countPlaylist=0;var filtredPlaylist=[];for(var p=0;p<list.count;p++){if(list.data[p].TYPE==4||((list.data[p].STATUS==1||list.data[p].STATUS==3)&&list.data[p].PARENT_USER_ID!=USER.USER_ID)){++countPlaylist;continue;}
filtredPlaylist.push(list.data[p]);}
list.data=filtredPlaylist;list.count-=countPlaylist;list.total-=countPlaylist;return list;}catch(e){error.log(e);}}}}());;
(function(){'use strict';var container;var radio={display:function(args){container=document.getElementById('naboo_content');ReactComponent.require('radio/page',function(radioPage){React.render(radioPage(args),container);});},leave:function(){React.unmountComponentAtNode(container);}};window.radio=radio;})();;
if(typeof setting=='undefined'){var setting={removeApp:function(appId){var data='app_id='+encodeURIComponent(appId)+'&checkForm='+encodeURIComponent(checkForm);var request=sendRequest('/ajax/action.php','text','type=setting_removeApp&'+data);if(request==false){return;}
var result=eval('('+request+')');if(result.error.length>0){return;}
loadBox(www.getCurrentPath());return;},updateEmail:function(){try{var actionDone=false;var email='';if($('#info_new_mail').length==1){email=$('#info_new_mail').val();}
var password='';if($('#info_pwd').length==1){password=$('#info_pwd').val();}
var email2='';if($('#info_new_mail2').length==1){email2=$('#info_new_mail2').val();}
var old_email='';if($('#info_old_mail').length==1){old_email=$('#info_old_mail').val();}
var checkForm='';if($('#checkForm').length==1){checkForm=$('#checkForm').val();}
if(email==email2){var data='email='+encodeURIComponent(email);data+='&password='+encodeURIComponent(password);data+='&old_email='+encodeURIComponent(old_email);data+='&checkForm='+encodeURIComponent(checkForm);request=sendRequest('/ajax/action.php','text','type=user_updateEmail&'+data);if(request==false){return;}
var result=eval('('+request+')');if(result.error.REQUEST_ERROR!==undefined){actionDone=false;if(result.error.REQUEST_ERROR=='Email already exists'){error_message=gettext('Cette adresse email est indisponible.');}else if(result.error.REQUEST_ERROR=='Invalid email domain'){error_message=gettext('Le nom de domaine \'%s\' n\'est pas autorisé.',{sprintf:[result.payload.domain]});}else{error_message=gettext('Votre adresse email n\'a pas été mise à jour.');}}else{actionDone=true;}}else{error_message=gettext('Vos adresses email ne correspondent pas. Veuillez réessayer.');}
if(actionDone==false){$('#update_email_result').html(error_message).show();}else{$('#info_save_form').hide();$('#info_save_email_confirm').show();loadBox(www.getCurrentPath());}}catch(e){error.log(e);}},updatePassword:function(){try{var actionDone=false;var password='';if($('#info_new_pwd').length==1){password=$('#info_new_pwd').val();}
var password2='';if($('#info_new_pwd2').length==1){password2=$('#info_new_pwd2').val();}
var old_password='';if($('#info_old_pwd').length==1){old_password=$('#info_old_pwd').val();}
var checkForm='';if($('#checkForm').length==1){checkForm=$('#checkForm').val();}
if(password==password2&&password!=''){var data='password='+encodeURIComponent(password);data+='&old_password='+encodeURIComponent(old_password);data+='&checkForm='+encodeURIComponent(checkForm);request=sendRequest('/ajax/action.php','text','type=user_updatePassword&'+data);if(request==false){return;}
var result=eval('('+request+')');if(result.error.length>0){actionDone=false;}else{actionDone=true;}}
if(actionDone==false){$('#update_password_result').html(gettext('Votre mot de passe n\'a pas été mis à jour.')).show();}else{$('#info_save_form').hide();$('#info_save_password_confirm').show();loadBox(www.getCurrentPath());}}catch(e){error.log(e);}},saveData:function(){try{$('#check_nom').empty();$('#check_prenom').empty();$('#check_sexe').empty();$('#check_naissance').empty();$('#check_adresse').empty();$('#check_cp').empty();$('#check_ville').empty();$('#check_pays').empty();$('#check_mobile').empty();$('#blog_name').empty();$('#adresse').removeClass();$('#ville').removeClass();$('#pays').removeClass();$('#mobile').removeClass();var sexe='M';if($('#sexe_f').is(':checked')){sexe='F';}
var date_naissance_jour=0;if($('#date_naissance_jour').length==1){date_naissance_jour=$('#date_naissance_jour').val();}
var date_naissance_mois=0;if($('#date_naissance_mois').length==1){date_naissance_mois=$('#date_naissance_mois').val();}
var date_naissance_annee=0;if($('#date_naissance_annee').length==1){date_naissance_annee=$('#date_naissance_annee').val();}
var adresse='';if($('#adresse').length==1){adresse=$('#adresse').val();}
var nom='';if($('#nom').length==1){nom=$('#nom').val();}
var prenom='';if($('#prenom').length==1){prenom=$('#prenom').val();}
var cp='';if($('#cp').length==1){cp=$('#cp').val();}
var ville='';if($('#ville').length==1){ville=$('#ville').val();}
var pays='';if($('#pays').length==1){pays=$('#pays').val();}
var mobile='';if($('#mobile').length==1){mobile=$('#mobile').val();}
var blog_name='';if($('#blog_name').length==1){blog_name=$('#blog_name').val();}
var checkForm='';if($('#checkForm').length==1){checkForm=$('#checkForm').val();}
var data='sexe='+encodeURIComponent(sexe);data+='&date_naissance='+encodeURIComponent(date_naissance_annee)+'-'+encodeURIComponent(date_naissance_mois)+'-'+encodeURIComponent(date_naissance_jour);data+='&adresse='+encodeURIComponent(adresse);data+='&nom='+encodeURIComponent(nom);data+='&prenom='+encodeURIComponent(prenom);data+='&cp='+encodeURIComponent(cp);data+='&ville='+encodeURIComponent(ville);data+='&pays='+encodeURIComponent(pays);data+='&mobile='+encodeURIComponent(mobile);data+='&blog_name='+encodeURIComponent(blog_name);data+='&checkForm='+encodeURIComponent(checkForm);var request=sendRequest('/ajax/action.php','text','type=user_setData&'+data);if(request==false){return;}
var result=eval('('+request+')');if(result.error.length>0){for(var i=0;i<result.error.length;i++){if(result.error[i]=='sexe'){$('#check_sexe').html('<img src="'+SETTING_STATIC+'/img/common/form_nok.png" alt="" />');}else if(result.error[i]=='naissance'){$('#check_naissance').html('<img src="'+SETTING_STATIC+'/img/common/form_nok.png" alt="" />');}else if(result.error[i]=='blog_name'){$('#check_blog_name').html('<img src="'+SETTING_STATIC+'/img/common/form_nok.png" alt="" />');}}
www.drawFormResult('data_result','form_error','<div class="data_result_nok">'+gettext('Vos données n\'ont pas été mises à jour. Veuillez corriger les champs rouges.')+'</div>');}else{www.drawFormResult('data_result','form_success','<div class="data_result_ok">'+gettext('Vos données ont été mises à jour.')+'</div>');USER.LASTNAME=nom;USER.FIRSTNAME=prenom;USER.USER_AGE=return_age(date_naissance_annee+'-'+date_naissance_mois+'-'+date_naissance_jour);Events.trigger(Events.user.updateName,{lastname:nom,firstname:prenom});}
$('#data_result').delay(3000).fadeOut();}catch(e){error.log(e);}},initShare:function(){$('#setting_settings .icon-24.icon-mail, #setting_settings .icon-24.icon-phone, #page_account_share .social').tipsy({gravity:'s'});Events.ready(Events.googleplus.ready,function(){googleplus.renderGGPlus('hp_create_account_gp');});setting.$userSetting=$('#share_notification, #share_newsletter');if(setting.$userSetting.length===0){return;}
setting.$userSetting.on('click','input[type=checkbox]',function(){var settings={};var namespace=this.getAttribute('data-namespace');settings[namespace]={};settings[namespace][this.id]=this.checked;userSetting.set(settings,true);});},deleteAccount:function(){try{var password='';if($('#delete_account').length==1){password=$('#delete_account').val();}
var checkForm='';if($('#checkForm').length==1){checkForm=$('#checkForm').val();}
var data='&password='+encodeURIComponent(password)+'&checkForm='+encodeURIComponent(checkForm);var request=sendRequest('/ajax/action.php','text','type=user_delete&'+data);if(request==false){return;}
var result=eval('('+request+')');if(result.error.length>0){www.drawFormResult('delete_result','msg_error',gettext('Veuillez vérifier votre mot de passe.'));}else{www.drawFormResult('delete_result','msg_succes',gettext('Un email vient de vous être envoyé.'));}
$('#delete_result').delay(3000).fadeOut();return true;}catch(e){error.log(e);}},confirmUnsubscribeStep1:function(){var form=$('#form_unsubscribe');var radio_btn=$(':radio:checked',form);var err_form=$('#msg_error',form);var err_input=$('#msg_error_input',form);var err_status=false;var message=[];$(err_form,err_input).hide();radio_btn.each(function(){var input=$(this).closest('li').find(':input').not(':radio');if(input.data('force')===true&&input.val().length===0){err_input.show();err_status=true;}
message.push({type:$(this).attr('id'),detail:input.val()});});if(err_status===true){return false;}
if(radio_btn.length===0){err_form.show();return false;}
api.call('feedback.save',{type:'premium',message:message});modal.open('/lightbox/unsubscribe.php?step=2',true);return true;},confirmUnsubscribeStep2:function(){var form=$('#form_unsubscribe');var pwd=$('#user_password',form).val();var err=$('#msg_error',form);if(pwd.length==0){err.show();return false;}
var data='password='+encodeURIComponent(pwd)+'&checkForm='+encodeURIComponent(checkForm);var request=sendRequest('/ajax/action.php','text','type=order_unsubscribe&'+data);if(request==false){return;}
var result=eval('('+request+')');var nb_error=0;if(typeof result.error==='object'){for(var i in result.error){if(!result.error.hasOwnProperty(i)){continue;}
nb_error=nb_error+1;}}
if(nb_error==0){modal.open('/lightbox/unsubscribe.php?step=3',true);return true;}
if(typeof result.error.ERROR=='string'){if(result.error.ERROR=='PASSWORD'){err.show();}
if(result.error.ERROR=='PAYPAL_OLD_SUBSCRIBE_CANCEL'){loadBox('/payment/paypal_unsubscribe.php');}
if(result.error.ERROR=='PAYPAL_SUBSCRIBE_CANCEL'){www.drawFormResult('delete_premium_result','form_error',gettext('Veuillez vous rendre sur Paypal afin de couper votre paiement récurrent'));$('#delete_premium_result').delay(3000).fadeOut();}}},confirmUnsubscribeStep3:function(){user.refreshPageAfterLogin({type:'page',link:'account/subscription'});return true;},resetDeviceSerial:function(user_device_serial_id,device_serial){try{if(typeof user_device_serial_id!='undefined'&&user_device_serial_id>0){var checkForm='';if($('#checkForm').length==1){checkForm=$('#checkForm').val();}
var request=sendRequest('/ajax/action.php','text','type=user_resetDeviceSerial&device_serial_id='+encodeURIComponent(user_device_serial_id)+'&checkForm='+encodeURIComponent(checkForm));if(request==false){return;}
var result=eval('('+request+')');if(result.error.length==0){if($('#device_serial_'+user_device_serial_id).length>0){$('#device_serial_'+user_device_serial_id).hide();}
www.drawFormResult('reset_device_serial','form_success','<div style="background:#F1F1F1;width:391px;padding:10px;margin-top:5px">'+gettext('Votre ancien mobile a été désactivé.')+'</div>');$('#reset_device_serial').delay(3000).fadeOut();}}}catch(e){error.log(e);}},reactivatear:function(){var request=sendRequest('/ajax/action.php','text','type=renewal_reactivate');if(request==false){return;}
var result=eval('('+request+')');var nb_error=0;if(typeof result.error==='object'){for(var i in result.error){if(!result.error.hasOwnProperty(i)){continue;}
nb_error=nb_error+1;}}
if(nb_error==0){document.location.href='/account/subscription?lb=reactive_ar';return true;}
www.drawFormResult('delete_premium_result','form_error',gettext('Impossible de réactiver votre abonnement.'));}};};
var loading_bar={init:function(){loading_bar.content=$('#loading_bar');loading_bar.content_bar=loading_bar.content.children('div');var interval=null;var timeout_interval=null;var is_loading=false;loading_bar.content_bar.css('width','0%');Events.subscribe(Events.navigation.page_changed,function(){if(is_loading){return;}
is_loading=true;var width=20+(Math.random()*55);loading_bar.content.addClass('opened');loading_bar.content_bar.addClass('has-transition').css('width',width+'%');timeout_interval=window.setTimeout(function(){var interval_fct=function(){width+=5;loading_bar.content_bar.css('width',width+'%');if(width>=95){window.clearInterval(interval);}};interval_fct();interval=window.setInterval(interval_fct,1000);},1000);});Events.subscribe(Events.navigation.page_displayed,function(){if(!is_loading){return;}
if(timeout_interval!=null){window.clearTimeout(timeout_interval);timeout_interval=null;}
if(interval!=null){window.clearInterval(interval);interval=null;}
loading_bar.content_bar.removeClass('has-transition');loading_bar.content_bar.css('width','100%');window.setTimeout(function(){loading_bar.content.on('transitionend',function(e){loading_bar.content_bar.css('width','0%');$(this).off('transitionend');}).removeClass('opened');is_loading=false;},500);});}};
var pro={id:0,template:'naboo/pro',display:function(args){try{pro.displayCallback();return true;}catch(e){error.log(e);}},displayCallback:function(result){try{templating.load(pro.template);naboo.afterLoad(true);return true;}catch(e){error.log(e);}}};
(function(){'use strict';var talk={initialized:false,template:'naboo/talk',tab:'genres',default_genre:0,genre_id:0,parent_genre_id:0,grid:false,pagination:{start:0,nb:20,max:500},loading:false,init:function(){try{if(talk.initialized){return false;}
Events.subscribe(Events.layout.adsBackground,talk.displayAds,'talk');templating.load(talk.template);talk.genre_id=storage.isset('talk_explore_genre')?storage.get('talk_explore_genre'):talk.genre_id;talk.parent_genre_id=storage.isset('talk_explore_parent_genre')?storage.get('talk_explore_parent_genre'):talk.parent_genre_id;talk.$select_parent_genres=$('#selectbox_talk_genres_parent');talk.$select_child_genres=$('#selectbox_talk_genres_child');talk.$select_labels=$('#page_talk_select_genres');talk.pagination.start=0;talk.initialized=true;return true;}catch(e){error.log(e);}},display:function(args){try{if(!gatekeeper.isAllowed('talk')){document.location.href=document.location.protocol+'//'+SETTING_HOST+'/';}
talk.init();var filter=args.id||talk.genre_id;talk_genre.load();talk.load(filter,null,true);naboo.afterLoad(true);return true;}catch(e){error.log(e);}},load:function(filter,pagination){try{if(talk.loading===true){return false;}
talk.loading=true;filter=filter||'0';var prev_filter=talk.genre_id;var currentGenre=talk_genre.getData(filter);talk.genre_id=filter;if(talk.parent_genre_id!==0||typeof(currentGenre)!=='undefined'&&typeof(currentGenre.CHILDREN)!=='undefined'&&currentGenre.CHILDREN.length>1){talk.$select_child_genres.show();}else{talk.$select_child_genres.hide();}
if(typeof(pagination)==='undefined'||!pagination){pagination=$.extend({},talk.pagination);}else{pagination=$.extend(talk.pagination,pagination);}
if(prev_filter!==filter){pagination=$.extend(talk.pagination,pagination,{start:0});}
var url='/shows';if(filter!=='0'){url+='/'+talk.tab+'/'+filter;}
$.address.value(url);api.call('deezer.pageTalkExplore',{FILTER:filter,START:pagination.start,NB:pagination.nb},talk.loadCallback);}catch(e){error.log(e);}},loadCallback:function(result){try{talk.loading=false;if(talk.pagination.start===0){talk.pagination.max=result.EXPLORE_SHOWS.total;if(result.EXPLORE_SHOWS.total===0&&result.EXPLORE_SHOWS.total===0&&typeof(talk_genre.getData(talk.genre_id).GENRE_ID)==='undefined'&&parseInt(talk.default_genre)!==talk.default_genre){talk.load(talk.default_genre);return false;}}
storage.set('talk_explore_genre',talk.genre_id);storage.set('talk_explore_parent_genre',talk.parent_genre_id);Events.ready(Events.talk_genre.loaded,talk.buildGenresMenu);return talk.renderGenres(result);}catch(e){error.log(e);}},buildGenresMenu:function(){try{if(talk_genre.list.length===0){return false;}
talk.$select_labels.selectGenre({id:talk.genre_id,dataSource:talk_genre,callback:talk.onChangeGenre});return true;}catch(e){error.log(e);}},renderGenres:function(result){try{if(typeof(result)!=='undefined'&&typeof(result.EXPLORE_SHOWS.data)!=='undefined'&&result.EXPLORE_SHOWS.count>0){talk.renderGenresReleases(result);}else{infinite_scroll.disable();}
talk.rendered=true;Events.trigger(Events.navigation.page_updated);return true;}catch(e){error.log(e);}},renderGenresReleases:function(data){try{if(typeof(data)==='undefined'||typeof(data.EXPLORE_SHOWS)==='undefined'){return false;}
if(talk.grid===false){var grid=React.createFactory(window.DzrComponents.Grid);talk.grid=React.render(grid({data:data.EXPLORE_SHOWS.data,context:'show_page',options:['name','favorite']}),document.getElementById('talk_last_releases_grid'),talk.activeInfiniteScroll);}else{talk.grid.setProps({data:talk.grid.props.data.concat(data.EXPLORE_SHOWS.data)},function(){talk.activeInfiniteScroll();});}
return true;}catch(e){error.log(e);}},activeInfiniteScroll:function(){if(talk.pagination.start+talk.pagination.nb>=talk.pagination.max){infinite_scroll.disable();return false;}
Events.subscribe(Events.layout.infiniteScroll,function(){talk.load(talk.genre_id,{start:talk.pagination.start+talk.pagination.nb,nb:talk.pagination.nb});},'talk');infinite_scroll.active();},onChangeGenre:function(data){try{if(data.GENRE_ID===talk.genre_id){return false;}
if(typeof data.PARENT_GENRE_ID!=='undefined'){talk.parent_genre_id=data.PARENT_GENRE_ID;}else{talk.parent_genre_id=0;}
talk.leave();talk.load(data.GENRE_ID);return true;}catch(e){error.log(e);}},leave:function(){talk.grid=false;React.unmountComponentAtNode(document.getElementById('talk_last_releases_grid'));}};window.talk=talk;})();;
(function(){'use strict';var talkshow={id:0,template:'naboo/show',data:[],display:function(args){try{if(typeof args.show_id!=='string'){return false;}
talkshow.id=parseInt(args.show_id,10);api.call('deezer.pageShow',{show_id:talkshow.id,country:COUNTRY,lang:SETTING_LANG},talkshow.displayCallback);return true;}catch(e){error.log(e);}},displayCallback:function(data){try{templating.load(talkshow.template);$('#naboo_show_image').replaceWith(thumbnails.draw({id:data.DATA.SHOW_ID,type:'show',cover_type:'talk',pic_id:data.DATA.SHOW_ART_MD5,play:1,play_context:'show_page',border:true,width:200,height:200,sent_to_mobile:false,tracking:1,play_force:true,zoom_on_cover:true,context_menu_hide:true,enable_preview:false}));$('#naboo_show_name').text(data.DATA.SHOW_NAME);window.setTimeout(function(){$('#naboo_show_description').dotdotdot({height:80,after:'a',callback:function(isTruncated){if(!isTruncated){$('a',this).remove();}}}).find('> a').on('click',function(e){e.preventDefault();tabs.display('show_info');});},0);$('#naboo_show_description').html(data.DATA.SHOW_DESCRIPTION+'<a class="readmore">'+gettext('Lire la suite')+'</a>');var list_tabs={talkshow:{selected:true,args:{type:'talkshow',id:data.DATA.SHOW_ID}},show_info:{args:{type:'talkshow',data:data.DATA}}};if(data.DATA.SHOW_DESCRIPTION.length===0){$('#tab_show_info_link').hide();}
tabs.init($('#naboo_show_tabs'),list_tabs);Events.ready(Events.user.userReady,function(){data.EPISODES.data=talkshow._addHeardData(data.EPISODES.data);});ReactComponent.require('talk/show',function(theShow){React.render(theShow(data),document.getElementById('tab_talkshow_content'));naboo.afterLoad(true);});$('#naboo_show_favorite').html(button_multi_state.draw({action:'favorite',type:'show',id:data.DATA.SHOW_ID}));naboo.afterLoad(true);return true;}catch(e){error.log(e);}},onOpenTab:function(type,id){tabs.display(type);if(typeof id!=='undefined'){window[type].onDisplay(id);}
$('#page_content').scrollTop(0);},_addHeardData:function(episodes){var mark;var e;for(var i=0;i<episodes.length;i++){e=episodes[i];mark=bookmark.getEpisodeBookmark(e.EPISODE_ID,e.DURATION);e.IS_HEARD=mark.IS_HEARD;}
return episodes;}};window.talkshow=talkshow;})();;
(function(){'use strict';var show_info={display:function(args){var content=$('#tab_show_info_content');$('[data-target="title"]',content).html(args.data.SHOW_NAME);$('[data-target="text"]',content).html(args.data.SHOW_DESCRIPTION);Events.trigger(Events.navigation.tab_displayed,args);return true;}};window.show_info=show_info;})();;
(function(){'use strict';var episode={id:0,template:'catalog/episode',display:function(args){if(typeof args.episode_id!=='string'){return false;}
episode.id=args.episode_id;if(typeof args.data==='object'){return episode.displayCallback(args.data);}
api.call('episode.getData',{episode_id:episode.id},episode.displayCallback);return true;},displayCallback:function(result){templating.load(episode.template);$('#naboo_episode_play').replaceWith(thumbnails.draw({id:episode.id,show_id:result.SHOW_ID,type:'episode',cover_type:'talk',pic_id:result.SHOW_ART_MD5,border:true,play:1,play_context:'episode_page',width:200,height:200,width_img:250,height_img:250,play_force:true,sent_to_mobile_banner:true,enable_preview:false,favorite_hide:true}));tabs.init($('#naboo_episode_tabs'),{episode_description:{args:{type:'episode_description',id:episode.id,description:result.EPISODE_DESCRIPTION},selected:true}});$('#naboo_episode_title').text(result.EPISODE_TITLE);$('#naboo_show_title > a').attr('href','/show/'+result.SHOW_ID).text(result.SHOW_NAME);if(result.DURATION){$('#naboo_episode_duration').text(secToMin(result.DURATION));}
if(result.EPISODE_PUBLISHED_TIMESTAMP){var episode_date=result.EPISODE_PUBLISHED_TIMESTAMP.split(' ');$('#naboo_episode_date').text(formatDate(episode_date[0]));}
Events.ready(Events.user.userReady,function(){var _bookmark=window.bookmark.getEpisodeBookmark(episode.id).OFFSET;$('#naboo_episode_bookmark').css('width',(Number(_bookmark)*100/result.DURATION)+'%');});naboo.afterLoad(true);}};window.episode=episode;})();;