
if(typeof Events==='undefined'){var Events={evts:{},deferredObjects:[],ready:function(evt,callback){if(typeof Events.deferredObjects[evt]==='undefined'){Events.deferredObjects[evt]=$.Deferred();}
Events.deferredObjects[evt].done(callback);},resolve:function(evt){if(typeof Events.deferredObjects[evt]==='undefined'){Events.deferredObjects[evt]=$.Deferred();}
Events.deferredObjects[evt].resolve();},subscribe:function(evt,callback,group){if(typeof group==='string'){return Events.addEvent(group,evt,callback);}
$(document).unbind(evt,callback).bind(evt,callback);},addEvent:function(group,evt,callback){if(typeof group!=='string'||typeof evt!=='string'||typeof callback!=='function'){return false;}
if(typeof Events.evts[group]==='undefined'){Events.evts[group]=[];}
Events.evts[group].push({fct:callback,evt:evt});Events.subscribe(evt,callback);},unsubscribeAll:function(group){if(typeof group!=='string'||typeof Events.evts[group]==='undefined'){return false;}
for(var i=0;i<Events.evts[group].length;i++){var evt=Events.evts[group][i];Events.unsubscribe(evt.evt,evt.fct);}
Events.evts[group]=null;delete Events.evts[group];},subscribeOnce:function(evt,callback,group){if(typeof group!=='string'){group=null;}
Events.subscribe(evt,function(event,args){callback(event,args);Events.unsubscribe(evt,event.handleObj.handler);},group);},unsubscribe:function(evt,handler){$(document).unbind(evt,handler);},trigger:function(evt,args){if(typeof args=='undefined'){args=null;}
$(document).trigger(evt,[args]);},player:{playerLoaded:'EVENT.PLAYER.playerLoaded',playerReady:'DEFERRED.PLAYER.playerReady',playing:'EVENT.PLAYER.playing',fading:'EVENT.PLAYER.fading',play:'EVENT.PLAYER.play',resume:'EVENT.PLAYER.resume',paused:'EVENT.PLAYER.pause',displayNextSong:'EVENT.PLAYER.displayNextSong',displayCurrentSong:'EVENT.PLAYER.displayCurrentSong',displayEmptyPlayer:'EVENT.PLAYER.displayEmptyPlayer',duration:'EVENT.PLAYER.duration',position:'EVENT.PLAYER.position',seek:'EVENT.PLAYER.seek',prcPosition:'EVENT.PLAYER.prcPosition',pourcentLoaded:'EVENT.PLAYER.pourcentLoaded',loading:'EVENT.PLAYER.loading',log:'EVENT.PLAYER.log',log_offline:'EVENT.PLAYER.log_offline',track_end:'EVENT.PLAYER.track_end',finish:'EVENT.PLAYER.finish',finishPreview:'EVENT.PLAYER.finishPreview',finishAds:'EVENT.PLAYER.finishAds',finishJingle:'EVENT.PLAYER.finishJingle',finishTrackList:'EVENT.PLAYER.finishTrackList',setTrackList:'EVENT.PLAYER.setTrackList',fade:'EVENT.PLAYER.fade',changePlayerType:'EVENT.PLAYER.changePlayerType',hq:'EVENT.PLAYER.hq',volume:'EVENT.PLAYER.volume',volume_changed:'EVENT.PLAYER.volume_changed',refreshSoundBar:'EVENT.PLAYER.refreshSoundBar',forceCloseMix:'EVENT.PLAYER.forceCloseMix',notify:'EVENT.PLAYER.notify',repeat_changed:'EVENT.PLAYER.repeat_changed',shuffle_changed:'EVENT.PLAYER.shuffle_changed',mute_changed:'EVENT.PLAYER.mute_changed',error:'EVENT.PLAYER.error',order_changed:'EVENT.PLAYER.order_changed',user_status:'EVENT.PLAYER.user_status',updateRestrictTime:'EVENT.PLAYER.updateRestrictTime',adsVastPlaying:'EVENT.PLAYER.adsVastPlaying',preloadComplete:'EVENT.PLAYER.preloadComplete',preloadAborted:'EVENT.PLAYER.preloadAborted',tracklist_changed:'EVENT.PLAYER.tracklist_changed',blind_test_mode_changed:'EVENT.PLAYER.blind_test_mode_changed',seekCompleted:'EVENT.PLAYER.seekCompleted',setBookmark:'EVENT.PLAYER.setBookmark'},player_widget:{loaded:'EVENT.PLAYER_WIDGET.loaded',tracksLoaded:'EVENT.PLAYER_WIDGET.tracksLoaded',notify:'EVENT.PLAYER_WIDGET.notify',displayLayer:'EVENT.PLAYER_WIDGET.displayLayer',removeOverlay:'EVENT.PLAYER_WIDGET.removeOverlay'},flow:{playerDisplay:'DEFERRED.FLOW.playerDisplay'},menu:{loaded:'EVENT.MENU.loaded',contextMenu:'EVENT.MENU.contextMenu',resize:'EVENT.MENU.resize',panel_mounted:'EVENT.MENU.panel_mounted'},user:{loaded:'DEFERRED.USER.loaded',clickFavorite:'EVENT.USER.clickFavorite',addFavorite:'EVENT.USER.addFavorite',deleteFavorite:'EVENT.USER.deleteFavorite',shareClick:'EVENT.USER.shareClick',login:'EVENT.USER.login',logout:'EVENT.USER.logout',userReady:'DEFERRED.USER.userReady',dataStoreReady:'DEFERRED.USER.dataStoreReady',settingChanged:'EVENT.USER.settingChanged',blockFriend:'EVENT.USER.blockFriend',unblockFriend:'EVENT.USER.unblockFriend',updatePicture:'EVENT.USER.updatePicture',uploadPicture:'EVENT.USER.uploadPicture',updateName:'EVENT.USER.updateName',updateSearchHistory:'EVENT.USER.updateSearchHistory',userLoadData:'EVENT.USER.userLoadData',updateEpisodeBookmark:'EVENT.USER.updateEpisodeBookmark'},genre:{loaded:'DEFERRED.GENRE.loaded'},talk_genre:{loaded:'DEFERRED.TALK_GENRE.loaded'},live:{connected:'EVENT.LIVE.connected',simultaneousAccess:'EVENT.LIVE.simultaneousAccess',newMessage:'EVENT.LIVE.newMessage',newFriendInvitation:'EVENT.LIVE.newFriendInvitation',newFriendship:'EVENT.LIVE.newFriendship',newNotif:'EVENT.LIVE.newNotif',readNotif:'EVENT.LIVE.readNotif',ready:'EVENT.LIVE.ready',feed:'EVENT.LIVE.feed',limitation:'EVENT.LIVE.limitation',device_sync:'EVENT.LIVE.device_sync',pagefeed:'EVENT.LIVE.pagefeed',events:'EVENT.LIVE.events'},offline:{reminder:'EVENT.OFFLINE.reminder'},playlist:{addSong:'EVENT.PLAYLIST.addSong',removeSong:'EVENT.PLAYLIST.removeSong',created:'EVENT.PLAYLIST.created',removed:'EVENT.PLAYLIST.removed',updated:'EVENT.PLAYLIST.updated',uploadPicture:'EVENT.PLAYLIST.uploadPicture',updatePicture:'EVENT.PLAYLIST.updatePicture',assistantValidation:'EVENT.PLAYLIST.assistantValidation',assistantSuggestFinish:'EVENT.PLAYLIST.assistantSuggestFinish',assistantSuggestEmpty:'EVENT.PLAYLIST.assistantSuggestEmpty',assistantNextStep:'EVENT.PLAYLIST.assistantNextStep',assistantToggleValidation:'EVENT.PLAYLIST.assistantToggleValidation',assistantAddedTrack:'EVENT.PLAYLIST.assistantAddedTrack'},profile:{allCoverLoaded:'EVENT.PROFILE.allCoverLoaded'},layout:{width_type:'EVENT.LAYOUT.width_type',scroll:'EVENT.LAYOUT.scroll',infiniteScroll:'EVENT.LAYOUT.infiniteScroll',resize:'EVENT.LAYOUT.resize',adsBackground:'EVENT.LAYOUT.adsBackground',adsBanner:'EVENT.LAYOUT.adsBanner'},navigation:{page_changed:'EVENT.NAVIGATION.page_changed',page_loaded:'EVENT.NAVIGATION.page_loaded',page_displayed:'EVENT.NAVIGATION.page_displayed',modal_displayed:'EVENT.NAVIGATION.modal_displayed',modal_open:'EVENT.NAVIGATION.modal_open',tab_displayed:'EVENT.NAVIGATION.tab_displayed',page_updated:'EVENT.NAVIGATION.page_updated',page_initialized:'DEFERRED.NAVIGATION.page_initialized'},datagrid:{displayed:'EVENT.DATAGRID.displayed',onAirPosition:'EVENT.DATAGRID.onAirPosition',allTracksDisplayed:'EVENT.DATAGRID.allTracksDisplayed',removedTrack:'EVENT.DATAGRID.removedTrack'},album:{checkReplace:'EVENT.ALBUM.checkReplace',noReplaceNeed:'EVENT.ALBUM.noReplaceNeed'},radio:{start:'EVENT.RADIO.start'},lightbox:{close:'EVENT.LIGHTBOX.close'},search:{loaded:'EVENT.SEARCH.loaded',suggestDisplayed:'EVENT.SEARCH.suggestDisplayed',suggestClicked:'EVENT.SEARCH.suggestClicked'},tabs:{open:'EVENT.TABS.open'},modal:{close:'EVENT.MODAL.close'},googleplus:{ready:'EVENT.GOOGLEPLUS.ready'},facebook:{user_status:'EVENT.FACEBOOK.user_status'},chromecast:{status:'EVENT.CHROMECAST.status',removeFocus:'EVENT.CHROMECAST.removeFocus',closeIntro:'EVENT.CHROMECAST.closeIntro'},lyrics:{load:'EVENT.LYRICS.load',seek:'EVENT.LYRICS.seek'},gigs:{display:'EVENT.GIGS.display'},copy:{after:'EVENT.COPY.after'},tag:{select:'EVENT.TAG.select'},talk:{bookmarkSet:'EVENT.TALK.bookmarkSet'},tips:{close:'EVENT.TIPS.close',draw:'EVENT.TIPS.draw'}};};
require=function e(t,i,s){function r(n,o){if(!i[n]){if(!t[n]){var p="function"==typeof require&&require;if(!o&&p)return p(n,!0);if(a)return a(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[n]={exports:{}};t[n][0].call(c.exports,function(e){var i=t[n][1][e];return r(i?i:e)},c,c.exports,e,t,i,s)}return i[n].exports}for(var a="function"==typeof require&&require,n=0;n<s.length;n++)r(s[n]);return r}({96:[function(e,t,i){"use strict";var s=e("babel-runtime/core-js/object/keys")["default"];!function(){var e=["image/jpeg","image/png"],i=function(t){this._element=t,this._imgTag=!("IMG"!==this._element.tagName),this._url=this._element.getAttribute(this._imgTag?"src":"data-blurred"),this._mimeType=e[0],this._blurStrength=5,this._imgContainer=null,this._loadError=!1,this._callback=function(){}};i.prototype.setBlurStrength=function(e){return this._blurStrength=parseInt(e,10),this},i.prototype.setMimeType=function(t){return this._mimeType=~e.indexOf(t)?t:this._mimeType,this},i.prototype.setUrl=function(e){return this._url=e,this},i.prototype.setCallback=function(e){return this._callback="function"==typeof e?e:this._callback,this},i.prototype.render=function(){var e=document.createElement("canvas");if(!(!e.getContext||!e.getContext("2d"))==!1)return this._imgTag?this._element.src=this._url:this._element.style.backgroundImage="url("+this._url+")",this._callback();var t=new Image;t.crossOrigin="Anonymous";var i=this;t.onerror=function(){return i._imgContainer=this,i._loadError=!0,e.parentNode&&document.body.removeChild(e),i._imgTag?i._element.src=i._url:i._element.style.backgroundImage="url("+i._url+")",i._callback()},t.onload=function(){i._imgContainer=this;var s=this.width,r=this.height;e.setAttribute("width",s),e.setAttribute("height",r),e.setAttribute("style","image-rendering: optimizeSpeed;image-rendering: -moz-crisp-edges;image-rendering: -webkit-optimize-contrast;image-rendering: optimize-contrast;-ms-interpolation-mode: nearest-neighbor;"),e=document.body.appendChild(e);var a=e.getContext("2d"),n=a.canvas.width,o=a.canvas.height;a.drawImage(t,n/2-s/2,o/2-r/2),a.globalAlpha=.5;for(var p=-i._blurStrength;p<=i._blurStrength;p+=2)for(var l=-i._blurStrength;l<=i._blurStrength;l+=2)a.drawImage(e,l,p),l>=0&&p>=0&&a.drawImage(e,-(l-2.5),-(p-2.5));a.globalAlpha=1;var c;try{c=a.canvas.toDataURL(i._mimeType)}catch(u){c=i._url}return document.body.removeChild(e),i._imgTag?i._element.src=c:i._element.style.backgroundImage="url("+c+")",i._callback()},t.src=this._url},i.prototype.getProps=function(e){if(this._element){e!==Object(e)&&(e=[(e||"").toString()]);var t={};for(var i in e)this.hasOwnProperty("_"+e[i])&&(t[e[i]]=this["_"+e[i]]);return 1===s(t).length&&1===e.length?t[e[0]]:t}},i.prototype.destroy=function(){this._element&&(this._imgTag?this._element.src=this._url:this._element.style.backgroundImage=this._url)},"function"==typeof define&&define.amd?define(function(){return i}):"object"==typeof t&&t&&"object"==typeof t.exports&&t.exports?t.exports=i:window.Blurred=i}()},{"babel-runtime/core-js/object/keys":103}],104:[function(e,t,i){"use strict";var s=e("babel-runtime/core-js/object/assign")["default"];i["default"]=s||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},i.__esModule=!0},{"babel-runtime/core-js/object/assign":102}],102:[function(e,t,i){t.exports={"default":e("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":106}],106:[function(e,t,i){e("../../modules/es6.object.assign"),t.exports=e("../../modules/$").core.Object.assign},{"../../modules/$":113,"../../modules/es6.object.assign":114}],114:[function(e,t,i){var s=e("./$.def");s(s.S,"Object",{assign:e("./$.assign")})},{"./$.assign":108,"./$.def":109}],108:[function(e,t,i){var s=e("./$"),r=e("./$.enum-keys");t.exports=Object.assign||function(e,t){for(var i=Object(s.assertDefined(e)),a=arguments.length,n=1;a>n;)for(var o,p=s.ES5Object(arguments[n++]),l=r(p),c=l.length,u=0;c>u;)i[o=l[u++]]=p[o];return i}},{"./$":113,"./$.enum-keys":110}],110:[function(e,t,i){var s=e("./$");t.exports=function(e){var t=s.getKeys(e),i=s.getDesc,r=s.getSymbols;return r&&s.each.call(r(e),function(s){i(e,s).enumerable&&t.push(s)}),t}},{"./$":113}],34:[function(e,t,i){"use strict";var s=e("react/addons"),r=e("./_elements/Artist"),a=e("./_elements/Album"),n=e("./_elements/Playlist"),o=e("./_elements/Radio"),p=e("./_elements/Show"),l=e("./_elements/User"),c=e("../../../core/i18n"),u=s.createClass({displayName:"Grid",propTypes:{data:s.PropTypes.array.isRequired,type:s.PropTypes.string,context:s.PropTypes.string,tab:s.PropTypes.string,options:s.PropTypes.array},getDefaultProps:function(){return{data:[],type:"unknown",context:"",page:"",options:[]}},render:function(){return this.props.data.length?s.createElement("ul",{className:"thumbnail-grid"},this.props.data.map(function(e){var t="unknown"===this.props.type?e.__TYPE__:this.props.type;switch(t){case"artist":return s.createElement(r,{key:e.ART_ID,data:e,options:this.props.options,context:this.props.context});case"album":return s.createElement(a,{key:e.ALB_ID,data:e,options:this.props.options,context:this.props.context});case"playlist":return s.createElement(n,{key:e.PLAYLIST_ID,data:e,options:this.props.options,context:this.props.context});case"radio":return s.createElement(o,{key:e.RADIO_ID,data:e,options:this.props.options,context:this.props.context});case"show":return s.createElement(p,{key:e.SHOW_ID,data:e,options:this.props.options,context:this.props.context});case"user":return s.createElement(l,{key:e.USER_ID,data:e,options:this.props.options,context:this.props.context});default:return null}}.bind(this))):this._renderPlaceholder()},_renderPlaceholder:function(){var e="nocontent",t=c.gettext("Aucun résultat.");return"related_artists"===this.props.tab&&(e="recommendation",t=c.gettext("Aucun artiste similaire n'est disponible")),"related_playlists"===this.props.tab&&(e="recommendation",t=c.gettext("Aucune playlist n'est disponible.")),"fan_tab"===this.props.tab&&(e="recommendation",t=c.gettext("Aucun fan actuellement")),"explore_page"===this.props.context&&(t=c.gettext("Nous n'avons pas trouvé de musique pour ce genre. Essayez d'en sélectionner un autre.")),s.createElement("div",null,s.createElement("div",{className:"placeholders-img "+e}),s.createElement("div",{className:"placeholders-title"},t))}});t.exports=u},{"../../../core/i18n":98,"./_elements/Album":35,"./_elements/Artist":36,"./_elements/Playlist":37,"./_elements/Radio":38,"./_elements/Show":39,"./_elements/User":40,"react/addons":"react/addons"}],40:[function(e,t,i){"use strict";var s=e("react/addons"),r=e("../../Thumbnail"),a=e("../../StatesButton"),n=s.createClass({displayName:"User",propTypes:{data:s.PropTypes.object.isRequired,context:s.PropTypes.string.isRequired,options:s.PropTypes.array},getDefaultProps:function(){return{data:null,context:"artist_page",options:[]}},render:function(){return s.createElement("li",{key:"user_"+this.props.data.USER_ID,"data-search":this._getRewritingName(this.props.data.BLOG_NAME)+" "+this._getRewritingName(this.props.data.ALB_TITLE)},s.createElement("div",{className:"thumbnail-col"},s.createElement("div",{className:"thumbnail-wrapper"},s.createElement(r,{id:Number(this.props.data.USER_ID),type:this.props.data.__TYPE__,width:250,height:250,picture_type:"user",context:this.props.context,md5:this.props.data.USER_PICTURE})),this.props.options.length>0?this._renderCaption():null))},_renderCaption:function(){return s.createElement("article",{className:"thumbnail-caption"},this.props.options.indexOf("name")>-1?this._renderName():null,this.props.options.indexOf("follow")>-1?this._renderFollow():null)},_renderName:function(){return s.createElement("h4",{className:"heading-4 ellipsis"},s.createElement("a",{href:"/profile/"+this.props.data.USER_ID,className:"evt-click",title:this.props.data.BLOG_NAME},this.props.data.BLOG_NAME))},_renderFollow:function(){return s.createElement("p",{className:"thumbnail-button"},s.createElement(a,{id:Number(this.props.data.USER_ID),disabled:Number(this.props.data.USER_ID)===window.USER.USER_ID,type:"friend",size:"block",wording_type:"full"}))},_getRewritingName:function(e){return window.rewriting(e).toLowerCase()}});t.exports=n},{"../../StatesButton":30,"../../Thumbnail":33,"react/addons":"react/addons"}],39:[function(e,t,i){"use strict";var s=e("react/addons"),r=e("../../Thumbnail"),a=e("../../StatesButton"),n=s.createClass({displayName:"Show",propTypes:{data:s.PropTypes.object.isRequired,context:s.PropTypes.string.isRequired,options:s.PropTypes.array},getDefaultProps:function(){return{data:null,context:"show_page",options:[]}},render:function(){return s.createElement("li",{"data-search":this._getRewritingName(this.props.data.SHOW_NAME)},s.createElement("div",{className:"thumbnail-col"},s.createElement("div",{className:"thumbnail-wrapper"},s.createElement(r,{id:Number(this.props.data.SHOW_ID),type:"show",picture_type:"talk",width:250,height:250,play:!0,play_link:!0,context:this.props.context,md5:this.props.data.SHOW_ART_MD5,context_menu:this.props.data})),this._renderCaption()))},_renderCaption:function(){return this.props.options.length>0?s.createElement("article",{className:"thumbnail-caption"},this._renderTitle(),this._renderName(),this._renderFavorite()):void 0},_renderTitle:function(){return this.props.options.indexOf("title")>-1?s.createElement("h4",{className:"heading-4"},this.props.data.TITLE):void 0},_renderName:function(){return this.props.options.indexOf("name")>-1?s.createElement("h5",{className:"heading-4 ellipsis"},s.createElement("a",{href:"/show/"+this.props.data.SHOW_ID,className:"evt-click",title:this.props.data.SHOW_NAME},this.props.data.SHOW_NAME)):void 0},_renderFavorite:function(){return this.props.options.indexOf("favorite")>-1?s.createElement("p",{className:"thumbnail-button"},s.createElement(a,{id:Number(this.props.data.SHOW_ID),type:"show",size:"block"})):void 0},_getRewritingName:function(e){return window.rewriting(e).toLowerCase()}});t.exports=n},{"../../StatesButton":30,"../../Thumbnail":33,"react/addons":"react/addons"}],38:[function(e,t,i){"use strict";var s=e("react/addons"),r=e("../../Thumbnail"),a=s.createClass({displayName:"Radio",propTypes:{data:s.PropTypes.object.isRequired,context:s.PropTypes.string.isRequired,options:s.PropTypes.array},getDefautProps:function(){return{data:null,context:"",options:[]}},render:function(){return s.createElement("li",null,s.createElement("div",{className:"thumbnail-col"},s.createElement("div",{className:"thumbnail-wrapper"},s.createElement(r,{id:Number(this.props.data.RADIO_ID),md5:this.props.data.RADIO_PICTURE,type:"radio",width:250,height:250,play:!0,cover_link:!1,radio:!0,title:this.props.data.TITLE,context_menu:this.props.data,context:this.props.context}))),this._renderCaption())},_renderCaption:function(){return this.props.options.length>0?s.createElement("article",{className:"thumbnail-caption"},this._renderName()):void 0},_renderName:function(){return this.props.options.indexOf("name")>-1?s.createElement("h4",{className:"heading-4"},this.props.data.TITLE):void 0}});t.exports=a},{"../../Thumbnail":33,"react/addons":"react/addons"}],37:[function(e,t,i){"use strict";var s=e("react/addons"),r=e("../../Thumbnail"),a=e("../../StatesButton"),n=e("../../../../core/i18n"),o=s.createClass({displayName:"Playlist",propTypes:{data:s.PropTypes.object.isRequired,context:s.PropTypes.string.isRequired,options:s.PropTypes.array},getDefaultProps:function(){return{data:null,context:"playlist_page",options:[]}},render:function(){return s.createElement("li",{"data-type":this._getPlaylistType()},s.createElement("div",{className:"thumbnail-col"},s.createElement("div",{className:"thumbnail-wrapper"},s.createElement(r,{id:Number(this.props.data.PLAYLIST_ID),type:"playlist",width:250,height:250,picture_type:this.props.data.PICTURE_TYPE,play:!0,play_link:this.props.options.indexOf("play_link")>-1,context:this.props.context,md5:this.props.data.PLAYLIST_PICTURE,private_status:Number(this.props.data.STATUS),multi_cover:!0,context_menu:this.props.data})),this._renderCaption()))},_renderCaption:function(){return this.props.options.length>0?s.createElement("article",{className:"thumbnail-caption"},this._renderName(),this._renderCreator(),this._renderStatus(),this._renderFavorite()):void 0},_renderName:function(){return this.props.options.indexOf("name")>-1?s.createElement("h4",{className:"heading-4 ellipsis"},s.createElement("a",{href:"/playlist/"+this.props.data.PLAYLIST_ID,className:"evt-click",title:this.props.data.TITLE},s.createElement("span",{className:"icon icon-"+this._getPlaylistType()})," "+this.props.data.TITLE)):void 0},_renderCreator:function(){return this.props.options.indexOf("creator")>-1?s.createElement("h5",{className:"heading-4-sub ellipsis"},s.createElement("a",{href:"/profile/"+this.props.data.PARENT_USER_ID,className:"evt-click",title:this.props.data.PARENT_USERNAME},n.gettext("par")+" ",this.props.data.PARENT_USERNAME,this._renderFans())):void 0},_renderFans:function(){return this.props.options.indexOf("fans")>-1&&this.props.data.NB_FAN>0?s.createElement("span",null," - "+window.breakUpThousands(this.props.data.NB_FAN)," ",n.ngettext("fan","fans",{count:this.props.data.NB_FAN})):void 0},_renderFavorite:function(){return this.props.options.indexOf("favorite")>-1?s.createElement("p",{className:"thumbnail-button"},s.createElement(a,{id:Number(this.props.data.PLAYLIST_ID),type:"playlist",size:"block"})):void 0},_renderStatus:function(){if(this.props.options.indexOf("status")>-1){var e=[];return(0===this.props.data.STATUS||2===this.props.data.STATUS)&&e.push(n.gettext("Publique")),(1===this.props.data.STATUS||3===this.props.data.STATUS)&&e.push(n.gettext("Privée")),(2===this.props.data.STATUS||3===this.props.data.STATUS)&&e.push(n.gettext("Collaborative")),s.createElement("h5",{className:"heading-4-sub ellipsis"},e.join(" · ")||" ")}},_getPlaylistType:function(){return Number(this.props.data.PARENT_USER_ID)===window.profile.id?"playlist":2===this.props.data.STATUS?"playlist-collaborative":"playlist-favorite"}});t.exports=o},{"../../../../core/i18n":98,"../../StatesButton":30,"../../Thumbnail":33,"react/addons":"react/addons"}],36:[function(e,t,i){"use strict";var s=e("react/addons"),r=e("../../Thumbnail"),a=e("../../StatesButton"),n=e("../../../../core/i18n"),o=s.createClass({displayName:"Artist",propTypes:{data:s.PropTypes.object.isRequired,context:s.PropTypes.string.isRequired,options:s.PropTypes.array},getDefaultProps:function(){return{data:null,context:"artist_page",options:[]}},render:function(){return s.createElement("li",{key:"artist_"+this.props.data.ART_ID,"data-search":this._getRewritingName(this.props.data.ART_NAME)},s.createElement("div",{className:"thumbnail-col"},s.createElement("div",{className:"thumbnail-wrapper"},s.createElement(r,{id:Number(this.props.data.ART_ID),smartradio:this.props.data.SMARTRADIO,type:"artist",width:250,height:250,picture_type:"artist",context:this.props.context,md5:this.props.data.ART_PICTURE,context_menu:this.props.data})),this._renderCaption()))},_renderCaption:function(){return this.props.options.length>0?s.createElement("article",{className:"thumbnail-caption"},this._renderName(),this._renderFans(),this._renderFavorite()):void 0},_renderName:function(){return this.props.options.indexOf("name")>-1?s.createElement("h4",{className:"heading-4 ellipsis"},s.createElement("a",{href:"/artist/"+this.props.data.ART_ID,className:"evt-click",title:this.props.data.ART_NAME},this.props.data.ART_NAME)):void 0},_renderFans:function(){return this.props.options.indexOf("fans")>-1?s.createElement("h5",{className:"heading-4-sub ellipsis"},this.props.data.NB_FAN?window.breakUpThousands(this.props.data.NB_FAN)+" "+n.ngettext("fan","fans",{count:this.props.data.NB_FAN}):" "):void 0},_renderFavorite:function(){return this.props.options.indexOf("favorite")>-1?s.createElement("p",{className:"thumbnail-button"},s.createElement(a,{id:Number(this.props.data.ART_ID),type:"artist",size:"block"})):void 0},_getRewritingName:function(e){return window.rewriting(e).toLowerCase()}});t.exports=o},{"../../../../core/i18n":98,"../../StatesButton":30,"../../Thumbnail":33,"react/addons":"react/addons"}],35:[function(e,t,i){"use strict";var s=e("react/addons"),r=e("../../Thumbnail"),a=e("../../StatesButton"),n=e("../../../../core/i18n"),o=s.createClass({displayName:"Album",propTypes:{data:s.PropTypes.object.isRequired,context:s.PropTypes.string.isRequired,options:s.PropTypes.array},getDefaultProps:function(){return{data:null,context:"album_page",options:[]}},render:function(){return s.createElement("li",{key:"album_"+this.props.data.ALB_ID,"data-search":this._getRewritingName(this.props.data.ART_NAME)+" "+this._getRewritingName(this.props.data.ALB_TITLE)},s.createElement("div",{className:"thumbnail-col"},s.createElement("div",{className:"thumbnail-wrapper"},s.createElement(r,{id:Number(this.props.data.ALB_ID),type:"album",width:250,height:250,picture_type:"cover",play:!0,preview:!0,play_link:this.props.options.indexOf("play_link")>-1,context:this.props.context,md5:this.props.data.ALB_PICTURE,sticker:this.props.options.indexOf("sticker")>-1,release_date:this.props.data.PHYSICAL_RELEASE_DATE,context_menu:this.props.data})),this._renderCaption()))},_renderCaption:function(){return this.props.options.length>0?s.createElement("article",{className:"thumbnail-caption"},this._renderType(),this._renderName(),this._renderArtist(),this._renderReleaseDate(),this._renderFavorite()):void 0},_renderType:function(){return this.props.options.indexOf("type")>-1?s.createElement("h4",{className:"sticker sticker-gray sticker-small"},s.createElement("span",null,this.props.data.ALB_TYPE)):void 0},_renderName:function(){return this.props.options.indexOf("name")>-1?s.createElement("h4",{className:"heading-4 ellipsis"},s.createElement("a",{href:"/album/"+this.props.data.ALB_ID,className:"evt-click",title:this.props.data.ALB_TITLE},this.props.data.ALB_TITLE)):void 0},_renderArtist:function(){return this.props.options.indexOf("artist")>-1&&this.props.data.ART_NAME?s.createElement("h5",{className:"heading-4-sub ellipsis"},s.createElement("span",{key:"artistLabel"},n.gettext("par")+" "),s.createElement("a",{key:"artistLink",href:"/artist/"+this.props.data.ART_ID,className:"evt-click",title:this.props.data.ART_NAME},this.props.data.ART_NAME)):void 0},_renderFavorite:function(){return this.props.options.indexOf("favorite")>-1?s.createElement("p",{className:"thumbnail-button"},s.createElement(a,{id:Number(this.props.data.ALB_ID),type:"album",size:"block"})):void 0},_renderReleaseDate:function(){return this.props.options.indexOf("release_date")>-1?s.createElement("h5",{className:"heading-5 release"},n.gettext("Sorti le")," ",formatDate(this.props.data.PHYSICAL_RELEASE_DATE)):void 0},_getRewritingName:function(e){return window.rewriting(e).toLowerCase()}});t.exports=o},{"../../../../core/i18n":98,"../../StatesButton":30,"../../Thumbnail":33,"react/addons":"react/addons"}],33:[function(e,t,i){"use strict";var s=e("react/addons"),r=e("jquery"),a=e("classnames"),n=s.addons.PureRenderMixin,o=e("../../core/i18n"),p=e("./FileUploader"),l=s.createClass({displayName:"Thumbnail",propTypes:{id:s.PropTypes.number,play_data:s.PropTypes.array,type:s.PropTypes.oneOf(["album","track","artist","radio","user","playlist","show","talk","app"]),md5:s.PropTypes.string,height:s.PropTypes.number,width:s.PropTypes.number,height_img:s.PropTypes.oneOfType([s.PropTypes.oneOf([!1]),s.PropTypes.number]),width_img:s.PropTypes.oneOfType([s.PropTypes.oneOf([!1]),s.PropTypes.number]),play:s.PropTypes.bool,play_force:s.PropTypes.bool,play_link:s.PropTypes.bool,preview:s.PropTypes.bool,preview_only:s.PropTypes.bool,bordered:s.PropTypes.bool,rounded:s.PropTypes.bool,sticker:s.PropTypes.bool,release_date:s.PropTypes.string,radio:s.PropTypes.bool,context:s.PropTypes.string,picture_type:s.PropTypes.string,play_index:s.PropTypes.oneOfType([s.PropTypes.oneOf([null]),s.PropTypes.number]),private_status:s.PropTypes.number,multi_cover:s.PropTypes.bool,cover_play:s.PropTypes.bool,cover_link:s.PropTypes.bool,context_menu:s.PropTypes.object,display_size:s.PropTypes.bool,title:s.PropTypes.string,overlay:s.PropTypes.bool,upload_cover:s.PropTypes.bool,data_uri:s.PropTypes.oneOfType([s.PropTypes.oneOf([!1]),s.PropTypes.string]),onClick:s.PropTypes.func,lyrics_opened:s.PropTypes.bool},mixins:[n],getDefaultProps:function(){return{id:0,play_data:[],type:"album",md5:"",height:55,width:55,height_img:!1,width_img:!1,play:!1,preview:!1,preview_only:!1,play_force:!1,play_link:!1,bordered:!1,rounded:!1,sticker:!1,release_date:"",radio:!1,context:"",picture_type:"",play_index:null,private_status:0,multi_cover:!1,cover_play:!1,cover_link:!0,context_menu:null,display_size:!0,title:"",overlay:!0,upload_cover:!1,data_uri:!1}},getInitialState:function(){var e,t,i=!1;return this.props.context_menu&&(e="user"===this.props.type?this.props.context_menu.__TYPE__:this.props.type,t="user"===this.props.type?this.props.context_menu.SNG_ID:this.props.id,i=userData.isFavorite(e,t)),{context_menu_type:e,context_menu_id:t,context_type:dzPlayer.getContext("TYPE"),is_favorite:i,playing:this.getPlayingStatus(),preview_active:!1}},componentDidMount:function(){Events.ready(Events.user.userReady,this._onFavoriteToggle),Events.subscribe(Events.player.finish,this.updateOnAir),Events.subscribe(Events.player.playing,this.updateOnAir),Events.subscribe(Events.user.addFavorite,this._onFavoriteToggle),Events.subscribe(Events.user.deleteFavorite,this._onFavoriteToggle),Events.subscribe(Events.player.finishPreview,this._onNaturalPreviewEnd),this.props.preview&&setTimeout(function(){this.refs.playIcon&&r(this.refs.playIcon.getDOMNode()).tipsy({fallback:o.gettext("Cliquer longuement pour écouter un extrait"),delayIn:700,delayOut:0,gravity:"s"})}.bind(this),0)},componentDidUpdate:function(){this.updateOnAir(),this.props.preview&&this[this.state.preview_active?"_previewPlay":"_previewStop"]()},componentWillUnmount:function(){Events.unsubscribe(Events.player.finish,this.updateOnAir),Events.unsubscribe(Events.player.playing,this.updateOnAir),Events.unsubscribe(Events.user.addFavorite,this._onFavoriteToggle),Events.unsubscribe(Events.user.deleteFavorite,this._onFavoriteToggle),Events.unsubscribe(Events.player.finishPreview,this._onNaturalPreviewEnd)},getFigureStyle:function(){var e=["thumbnail"];return this.props.bordered&&e.push("thumbnail-bordered"),this.props.rounded&&e.push("thumbnail-rounded"),this.props.radio&&e.push("thumbnail-mix"),e.join(" ")},getPicturePath:function(){if(this.props.data_uri)return this.props.data_uri;var e=SETTING_DOMAIN_IMG,t=this.props.multi_cover?this.props.md5:this.props.md5.split("-")[0];if(""!==this.props.picture_type&&""!==t)e+="/"+this.props.picture_type;else if(""!==this.props.type){var i={track:"cover",album:"cover",radio:"misc",playlist:""===t?"playlist":"cover",show:"talk",app:"misc"};e+="/"+("string"==typeof i[this.props.type]?i[this.props.type]:this.props.type)}else e+="/misc";var s=(this.props.height_img===!1?this.props.height:this.props.height_img)+"x"+(this.props.width_img===!1?this.props.width:this.props.width_img);return e+"/"+t+"/"+s+"-000000-80-0-0.jpg"},getPlayingStatus:function(){if("track"===this.props.type&&this.props.id===Number(dzPlayer.getCurrentSong("MEDIA_ID"))&&null!==this.props.play_index&&Number(this.props.play_index)===dzPlayer.getIndexSong())return dzPlayer.isPlaying();var e=dzPlayer.getContext();return null!==e?dzPlayer.isPlaying()&&LOG_CONTEXT[e.TYPE]===LOG_CONTEXT[this.props.context]&&Number(e.ID)===Number(this.props.id):!1},updateOnAir:function(){this.setState({playing:this.getPlayingStatus()})},play:function(){if(this.props.preview&&this._naturalPreviewEnd)return void(this._naturalPreviewEnd=!1);if(!(this.props.preview&&this.state.preview_active||!this.props.play||this.props.preview_only)){var e=dzPlayer.getContext();return null!==e&&LOG_CONTEXT[e.TYPE]===LOG_CONTEXT[this.props.context]&&Number(e.ID)===Number(this.props.id)||null!==this.props.play_index&&Number(this.props.play_index)===dzPlayer.getTrackListIndex()?void dzPlayer.control.togglePause():(this.props.play_link&&this.link(),null!==this.props.play_index?void dzPlayer.playTrackAtIndex(this.props.play_index):void dzPlayer.play({type:this.props.type,id:this.props.id,radio:this.props.radio,context:{ID:this.props.id,TYPE:this.props.context},data:this.props.play_data}))}},link:function(){if(this.props.preview&&this._naturalPreviewEnd)return void(this._naturalPreviewEnd=!1);if(!(this.props.preview&&this.state.preview_active||!this.props.cover_link&&!this.props.cover_play)){if(this.props.cover_play)return void this.play();var e={user:"profile/"+this.props.id,radio:"radio/genre/"+this.props.id};loadBox("/"+("string"==typeof e[this.props.type]?e[this.props.type]:this.props.type+"/"+this.props.id))}},render:function(){var e=this.props.onClick?this.props.onClick:this.link;return s.createElement("figure",{className:this.getFigureStyle()},s.createElement("div",{className:"picture-link",onClick:e},s.createElement("img",{className:"picture",src:this.getPicturePath(),height:this.props.display_size?this.props.height:null,width:this.props.display_size?this.props.width:null}),this._renderOverlay()),this._renderPlayIcon(),this._renderSticker(),this._renderContextMenu(),this._renderMixTitle(),this._renderUploadIcon())},_renderUploadIcon:function(){return this.props.upload_cover&&p?s.createElement(p,{element_id:this.props.id},s.createElement("span",{className:"play play-force"},s.createElement("span",{className:"icon icon-camera"}))):null},_renderPlayIcon:function(){if(this.props.play){var e={xs:this.props.height<80&&this.props.width<80,sm:this.props.height>80&&this.props.width>80&&this.props.height<120&&this.props.width<120},t=a({"play evt-click":!0,"play-force":this.props.play_force,"play-32":e.xs,"play-52":e.sm,active:this.state.playing,preview:this.state.preview_active}),i=a({"icon-stack icon-stack-hover icon-stack-circle":!0,"icon-32":e.xs,"icon-52":e.sm,"icon-64":!e.xs&&!e.sm,active:this.props.lyrics_opened}),r=a({"equalizer equalizer-inverse":!0,"equalizer-16":e.xs||e.sm,"equalizer-24":!e.xs&&!e.sm});return s.createElement("span",{className:t,ref:"playIcon",onMouseDown:this._togglePreview.bind(this,!0),onMouseUp:this._togglePreview.bind(this,!1),onMouseLeave:this._togglePreview.bind(this,!1),onClick:this.play},s.createElement("span",{className:i},s.createElement("span",{className:"play-icon play-default"},s.createElement("span",{className:"icon icon-play"})),s.createElement("span",{className:"play-icon play-hover"},s.createElement("span",{className:"icon icon-pause"})),s.createElement("span",{className:"play-icon play-active"},s.createElement("span",{className:r},s.createElement("span",{className:"equalizer-bar equalizer-bar-1"}),s.createElement("span",{className:"equalizer-bar equalizer-bar-2"}),s.createElement("span",{className:"equalizer-bar equalizer-bar-3"})))))}},_renderSticker:function(){if(this.props.sticker){var e,t=new Date(this.props.release_date).getTime();return t/1e3+2592e3>window.SERVER_TIMESTAMP&&(e="NEW"),s.createElement("span",{className:"sticker sticker-small sticker-red"},e)}},_renderContextMenu:function(){if(!this.props.context_menu)return null;var e=a({"options-item options-favorite":!0,"action-active":this.state.is_favorite});return s.createElement("ul",{className:"options options-react","data-link":"0","data-favorite":"1"},s.createElement("li",{className:e,onClick:this._onFavoriteClick},s.createElement("span",{className:"icon icon-love","data-action":"favorite"})),s.createElement("li",{className:"options-item pull-right",onClick:this._onContextMenuClick},s.createElement("span",{className:"icon icon-options","data-action":"options"})))},_renderMixTitle:function(){return this.props.radio?s.createElement("span",{className:"mix-title"},this.props.title):void 0},_renderOverlay:function(){return this.props.overlay===!1?null:s.createElement("div",{className:"options-overlay"})},_onFavoriteToggle:function(){if(null!==this.props.context_menu){var e=userData.isFavorite(this.state.context_menu_type,this.state.context_menu_id);e!==this.state.is_favorite&&this.setState({is_favorite:e})}},_onFavoriteClick:function(){var e=this.state.is_favorite?"remove":"add";favorite[e]({type:this.state.context_menu_type,id:this.state.context_menu_id,context:this.props.context})},_onContextMenuClick:function(e){var t=this.props.context_menu;"song"===this.state.context_menu_type&&(t={SONG:t}),window.context_menu.open({is_thumbnail:!0,target:e.currentTarget,id:this.state.context_menu_id,type:this.state.context_menu_type,data:t,position:"bottom",context:this.props.context,listen_context:{ID:this.state.context_menu_id,TYPE:this.props.context}})},_onNaturalPreviewEnd:function(){this.props.preview&&this.state.preview_active&&this._updatePreviewState(!1,!0)},_previewTimer:null,_previewTimeout:500,_naturalPreviewEnd:!1,_togglePreview:function(e){return this.props.preview?(clearTimeout(this._previewTimer),e=Boolean(e),e&&this.state.preview_active||OFFLINE||"ads"===dzPlayer.getPlayerType()||"jingle"===dzPlayer.getPlayerType()?!1:void(this._previewTimer=setTimeout(function(){this._updatePreviewState(e)}.bind(this),this._previewTimeout))):!1},_previewPlay:function(){var e=this._previewTypeToMethodData();api.call({method:e.method,data:e.data,success:function(e){var t=this._extractPreviewMd5(e);return t?dzPlayer.trigger("audioPlayer_startPreview",[t]):this._updatePreviewState(!1,!0),!0}.bind(this),error:function(){return this._updatePreviewState(!1,!0),!0}.bind(this)})},_previewStop:function(){dzPlayer.trigger("audioPlayer_endPreview")},_updatePreviewState:function(e,t){this.isMounted()&&this.setState({preview_active:e},function(){this.state.preview_active&&this.refs.playIcon&&r(this.refs.playIcon.getDOMNode()).tipsy("hide"),this._naturalPreviewEnd=Boolean(t)}.bind(this))},_previewTypeToMethodData:function(){var e={album:{method:"song.getListByAlbum",data:{ALB_ID:this.props.id,NB:1}},track:{method:"song.getData",data:{SNG_ID:this.props.id}},playlist:{method:"playlist.getSongs",data:{PLAYLIST_ID:this.props.id,NB:1}},radio:{method:"radio.getSongs",data:{RADIO_ID:this.props.id,NB:1}},artist:{method:"smart.getSmartRadio",data:{ART_ID:this.props.id,LIMIT:1}},show:{method:"episode.getListByShow",data:{SHOW_ID:this.props.id,LIMIT:1}}};return e[this.props.type]},_extractPreviewMd5:function(e){return"track"===this.props.type?e===Object(e)&&e.MD5_ORIGIN&&Number(right.checkSongAvailable(e))===Number(right.READABLE)?e.MD5_ORIGIN:null:e===Object(e)&&Array.isArray(e.data)&&e.data[0].MD5_ORIGIN&&Number(right.checkSongAvailable(e.data[0]))===Number(right.READABLE)?e.data[0].MD5_ORIGIN:null}});t.exports=l},{"../../core/i18n":98,"./FileUploader":28,classnames:"classnames",jquery:"jquery","react/addons":"react/addons"}],28:[function(e,t,i){"use strict";var s=e("react/addons"),r=s.createClass({displayName:"FileUploader",propTypes:{element_id:s.PropTypes.number,children:s.PropTypes.object,accept:s.PropTypes.string,type:s.PropTypes.string,directory:s.PropTypes.string},getDefaultProps:function(){return{element_id:0,children:"",accept:"image/*",type:"picture",directory:"playlist"}},componentDidMount:function(){Events.subscribe(Events.playlist.uploadPicture,this._uploadFile)},componentWillUnmount:function(){Events.unsubscribe(Events.playlist.uploadPicture,this._uploadFile)},render:function(){return window.FileReader?s.createElement("div",{onClick:this._onSelectFileClick},s.createElement("input",{type:"file",className:"hide",multiple:!1,ref:"fileInput",accept:this.props.accept,onChange:this._onChangeFile}),this.props.children):!1},_selectedFile:null,_onSelectFileClick:function(){this.refs.fileInput.getDOMNode().click()},_onChangeFile:function(e){if(this._selectedFile=e.target.files[0],-1===this._selectedFile.type.indexOf(this.props.accept.split("/")[0]))return!1;if(this.props.element_id>0)return this._uploadFile(null,{id:this.props.element_id});var t=new FileReader;t.onload=function(e){Events.trigger(Events.playlist.updatePicture,{type:"base64",data:e.target.result})},t.readAsDataURL(this._selectedFile)},_uploadFile:function(e,t){if(null===this._selectedFile)return!1;var i="%1/?sid=%2&id=%3&resize=1&directory=%4&type=%5&referer=%6&file=%7",s=i.replace("%1",SETTING_HOST_UPLOAD).replace("%2",SESSION_ID).replace("%3",t.id).replace("%4",this.props.directory).replace("%5",this.props.type).replace("%6",SETTING_REFERER_UPLOAD).replace("%7",this._selectedFile.name),r=new FormData;r.append("file",this._selectedFile);var a=new XMLHttpRequest;return a.addEventListener("load",function(e){if(200===e.target.status){var i=JSON.parse(e.target.response);0===i.error.length&&Events.trigger(Events.playlist.updatePicture,{element_id:t.id,type:this.props.directory,md5:i.results})}}.bind(this),!1),a.addEventListener("error",function(){},!1),a.open("POST",s,!0),a.send(r)}});t.exports=r},{"react/addons":"react/addons"}],32:[function(e,t,i){"use strict";var s=e("react/addons"),r=e("../../core/i18n"),a=e("./Tag"),n=s.addons.PureRenderMixin,o=s.createClass({displayName:"TagList",propTypes:{tags:s.PropTypes.array.isRequired,max:s.PropTypes.number,min:s.PropTypes.number,showLabel:s.PropTypes.bool,query:s.PropTypes.string,type:s.PropTypes.oneOf(["button","text"]),link:s.PropTypes.bool,selected:s.PropTypes.bool,onRemove:s.PropTypes.func},mixins:[n],getDefaultProps:function(){return{max:15,min:0,showLabel:!1,query:"",link:!0,selected:!1}},getInitialState:function(){return{tags:this.props.tags,onRemove:this.props.onRemove||this._onRemove}},componentWillReceiveProps:function(e){this.setState({tags:e.tags,onRemove:e.onRemove||this._onRemove})},render:function(){var e=this.state.tags.slice(0,this.props.max);if(!e.length)return null;var t=this.props.selected?r.gettext("Résultats de recherche pour")+" ":r.gettext("Combiner avec :");return s.createElement("ul",{className:"tag-list clearfix"+(this.props.selected?" selected":""),"aria-live":"polite"},this.props.showLabel?s.createElement("li",null,s.createElement("div",{className:"tag"},s.createElement("span",{className:"btn btn-label tag-title"},t))):"",e.map(function(e,t){return s.createElement("li",{key:"panel-tag"+t},s.createElement(a,{label:e.LABEL,query:this.props.query,link:this.props.link,type:this.props.type,selected:this.props.selected,onRemove:this.state.onRemove}))}.bind(this)))},_onRemove:function(e){if(e){var t=this.state.tags;t.length>this.props.min?(t=t.filter(function(t){return t.LABEL!==e}),this.setState({tags:t},this._navigate)):this._openSearchPanel()}},_navigate:function(){if(this.props.link){var e="";this.state.tags.forEach(function(t){e+=t.LABEL.substr(1)+" "}),www.navigate("/tags/"+e.trim())}},_openSearchPanel:function(){if(this.props.link){var e=document.getElementById("menu_search");e.click(),e.focus()}}});t.exports=o},{"../../core/i18n":98,"./Tag":31,"react/addons":"react/addons"}],31:[function(e,t,i){"use strict";var s=e("react/addons"),r=e("classnames"),a=s.addons.PureRenderMixin,n=s.createClass({displayName:"Tag",propTypes:{label:s.PropTypes.renderable.isRequired,query:s.PropTypes.string,link:s.PropTypes.bool,type:s.PropTypes.oneOf(["button","text"]),selected:s.PropTypes.bool,onRemove:s.PropTypes.func},mixins:[a],getDefaultProps:function(){return{link:!0,type:"button",selected:!1,onRemove:function(){}}},render:function(){var e={"btn btn-tag":"button"===this.props.type,"txt-tag":"text"===this.props.type,selected:this.props.selected},t=r(e);return this.props.selected?s.createElement("div",{className:"tag"},s.createElement("div",{className:t},this.props.label,s.createElement("a",{href:"javascript:void(0)",className:"icon icon-cancel",role:"button",onClick:this._onRemoveClick}))):s.createElement("div",{className:"tag"},s.createElement("a",{className:t,onClick:this._onClick,role:"button"},this.props.label))},_onRemoveClick:function(e){e.stopPropagation(),this.props.onRemove(this.props.label)},_onClick:function(){if(this.props.link){var e=this.props.label.replace(/^#/,"");this.props.query&&(e=this.props.query+" "+e),www.navigate("/tags/"+e)}Events.trigger(Events.tag.select,{source:this,tag:this.props.label})}});t.exports=n},{classnames:"classnames","react/addons":"react/addons"}],30:[function(e,t,i){"use strict";var s=e("react/addons"),r=e("classnames"),a=e("../_mixins/tracking"),n=s.createClass({displayName:"StatesButton",propTypes:{id:s.PropTypes.number.isRequired,type:s.PropTypes.oneOf(["show","artist","album","playlist","radio","friend"]).isRequired,action:s.PropTypes.oneOf(["favorite","play"]).isRequired,wording_type:s.PropTypes.oneOf(["standard","full"]),play_context:s.PropTypes.string,size:s.PropTypes.oneOf(["","block"]),disabled:s.PropTypes.bool},mixins:[a],getDefaultProps:function(){return{id:0,type:"",action:"favorite",wording_type:"standard",play_context:"",size:"",disabled:!1}},getInitialState:function(){var e="default";return"favorite"===this.props.action&&userData.isFavorite(this.props.type,this.props.id)&&(e="active"),"play"===this.props.action&&this._hasSameContext()&&(e=dzPlayer.isPaused()?"resume":dzPlayer.isPlaying()?"active":"default"),{status:e,active:"active"===e}},componentDidMount:function(){this._handleEvents("subscribe")},componentWillUnmount:function(){this._handleEvents("unsubscribe")},getTrackingParams:function(){return this.props.tracking_params},render:function(){var e={"btn btn-action-default btn-default":!0,active:this.state.active,paused:!this.state.active&&"play"===this.props.action&&"resume"===this.state.status};return e["btn-"+this.props.action]=!0,e["btn-"+this.props.size]=this.props.size,e=r(e),s.createElement("button",{className:e,type:"button",onClick:this._handleClick,disabled:this.props.disabled},s.createElement("div",{className:"action action-"+this.state.status},this._renderContent()))},_renderContent:function(){var e={label:!0},t=r(e),i={icon:!0};i["icon-"+this._getIcon(this.state.status)]=!0;var a=s.createElement("span",{key:"active_icon",className:r(i)},this._getAnimatedIcon());delete i["icon-"+this._getIcon(this.state.status)];var n="resume"!==this.state.status?this.state.active?"hover":"default":this.state.status;i["icon-"+this._getIcon(n)]=!0;var o=s.createElement("span",{key:"hover_icon",className:r(i)}),p=[a,s.createElement("span",{key:"active_label",className:t},this._getWording(this.state.status))],l=[o,s.createElement("span",{key:"hover_label",className:t},this._getWording(n))];return s.createElement("div",null,s.createElement("div",{className:"active"},p),s.createElement("div",{className:"hover"},l))},_onFavoriteStatusChange:function(e,t){return"undefined"==typeof t||this.props.type!==t.type||this.props.id!==t.id?!1:void this.setState({status:this.state.active?"default":"active",active:!this.state.active})},_onPlayStatusChange:function(e,t){return this.state.active||t?this._hasSameContext()?void this.setState({status:this.state.active&&t===!1?"resume":"active",active:t}):(this.setState({status:"default",active:!1}),!0):!1},_onPlayClick:function(){return this._hasSameContext()?(dzPlayer.control.togglePause(),!0):void dzPlayer.play({type:"loved"===this.props.type?"playlist":this.props.type,id:this.props.id,context:{TYPE:this.props.play_context,ID:this.props.id}})},_onFavoriteClick:function(){favorite.action(null,{id:this.props.id,type:this.props.type})},_handleEvents:function(e){for(var t=this._type[this.props.action].events_subscription,i=t.length,s=0;i>s;s++)Events[e](t[s].event_name,this[t[s].event_callback])},_handleClick:function(){this.props.disabled||this[this._type[this.props.action].onclick]()},_type:{play:{events_subscription:[{event_name:Events.player.playing,event_callback:"_onPlayStatusChange"}],icon_mapping:{"default":"play-circle",active:" equalizer equalizer-dark equalizer-16",hover:"pause-circle",resume:"play-circle"},onclick:"_onPlayClick"},favorite:{events_subscription:[{event_name:Events.user.addFavorite,event_callback:"_onFavoriteStatusChange"},{event_name:Events.user.deleteFavorite,event_callback:"_onFavoriteStatusChange"}],icon_mapping:{"default":"love",active:"love",hover:"cancel",default_friend:"add",active_friend:"check",hover_friend:"cancel"},onclick:"_onFavoriteClick"}},_hasSameContext:function(){var e=dzPlayer.getContext();return null!==e&&LOG_CONTEXT[e.TYPE]===this.props.type&&e.ID==this.props.id},_getIcon:function(e){var t="friend"===this.props.type?"_friend":"";return this._type[this.props.action].icon_mapping[e+t]},_getAnimatedIcon:function(){return"play"!==this.props.action||"active"!==this.state.status?null:[s.createElement("span",{key:"equalizer_bar_1",className:"equalizer-bar equalizer-bar-1"}),s.createElement("span",{key:"equalizer_bar_2",className:"equalizer-bar equalizer-bar-2"}),s.createElement("span",{key:"equalizer_bar_3",className:"equalizer-bar equalizer-bar-3"})]},_getWording:function(e){return"none"===this.props.wording_type?"":button_multi_state.trad[this.props.wording_type][e+"_"+this.props.action+"_"+this.props.type]?button_multi_state.trad[this.props.wording_type][e+"_"+this.props.action+"_"+this.props.type]:button_multi_state.trad[this.props.wording_type][e+"_"+this.props.action]?button_multi_state.trad[this.props.wording_type][e+"_"+this.props.action]:button_multi_state.trad[this.props.wording_type][e]}});t.exports=n},{"../_mixins/tracking":23,classnames:"classnames","react/addons":"react/addons"}],27:[function(e,t,i){"use strict";var s=e("react/addons"),r=e("classnames"),a=e("../../core/i18n"),n=e("jquery"),o=s.createClass({displayName:"Favorite",propTypes:{id:s.PropTypes.string.isRequired,type:s.PropTypes.string,style:s.PropTypes.oneOf(["star","heart_small","heart","heart_medium","heart_large","heart_datagrid"]),context:s.PropTypes.string,display_share:s.PropTypes.bool,share_context:s.PropTypes.string,tooltip:s.PropTypes.bool,tooltip_gravity:s.PropTypes.string,onClickCallback:s.PropTypes.func,elId:s.PropTypes.string},mixins:[s.addons.PureRenderMixin],getDefaultProps:function(){return{type:"album",style:"heart_small",context:"",elId:null,display_share:!1,share_context:null,tooltip:!1,tooltip_gravity:"s",onClickCallback:function(){}}},getInitialState:function(){return{share_button_display:!1,active:userData.isFavorite(this.props.type,this.props.id)}},componentDidMount:function(){Events.subscribe(Events.modal.close,this._setShareButtonStatus),Events.subscribe(Events.user.addFavorite,this._onFavoriteToggle),Events.subscribe(Events.user.deleteFavorite,this._onFavoriteToggle)},componentWillReceiveProps:function(e){var t={active:userData.isFavorite(e.type,e.id)};this._timeout_id&&e.id!==this.props.id&&(t.share_button_display=!1,clearTimeout(this._timeout_id)),this.setState(t)},componentWillUnmount:function(){Events.unsubscribe(Events.modal.close,this._setShareButtonStatus),Events.unsubscribe(Events.user.addFavorite,this._onFavoriteToggle),Events.unsubscribe(Events.user.deleteFavorite,this._onFavoriteToggle)},render:function(){var e=r({"evt-over evt-out":this.props.tooltip,active:this.state.active,selected:"heart_datagrid"===this.props.style&&this.state.active,hover:"heart_datagrid"===this.props.style}),t=r({icon:!0,"icon-datagrid":"heart_datagrid"===this.props.style,"icon-love":!this.state.share_button_display,"icon-share":this.state.share_button_display,active:!this.state.share_button_display&&this.state.active}),i={};if(this.props.tooltip&&(i={enabled:"1",gravity:this.props.tooltip_gravity,delay:"400",offset:2,title:this.state.share_button_display?a.gettext("Partager"):this._getTooltip()}),"heart"===this.props.style||"heart_medium"===this.props.style||"heart_large"===this.props.style){e=r({"icon icon-love":"heart_small"===this.props.style,"icon icon-favorite":"star"===this.props.style,"evt-over evt-out":this.props.tooltip,action:!0});var n=r({"icon-32":"heart"===this.props.style,"icon-52":"heart_medium"===this.props.style,"icon-64":"heart_large"===this.props.style,"icon-stack icon-stack-hover icon-stack-circle":!0});return t=r({icon:!0,"icon-datagrid":"heart_datagrid"===this.props.style,"icon-love":!this.state.share_button_display,"icon-share":this.state.share_button_display,active:!this.state.share_button_display&&this.state.active}),s.createElement("a",{role:"button",className:e,"data-tooltip":i.enabled,"data-tooltip-offset":i.offset,"data-tooltip-gravity":i.gravity,"data-tooltip-delay":i.delay,title:i.title,id:this.props.elId,onClick:this.state.share_button_display?this._onShareClick:this._onClick},s.createElement("span",{className:n},s.createElement("span",{className:t})))}return s.createElement("a",{role:"button",className:e,"data-tooltip":i.enabled,"data-tooltip-gravity":i.gravity,"data-tooltip-delay":i.delay,title:i.title,id:this.props.elId,onClick:this._onClick},s.createElement("span",{className:t}))},_onClick:function(e){e.stopPropagation();try{n(e.target).tipsy("hide")}catch(t){}var i=this.state.active?"remove":"add";favorite[i]({type:this.props.type,id:this.props.id,context:this.props.context}),this.props.onClickCallback(this.props.type,this.props.id,!this.state.active)},_onShareClick:function(){this._sharebox_id=sharebox.load(0,this.props.id,this.props.share_context)},_onFavoriteToggle:function(e,t){var i=Number(this.props.id),s=Number(t.id);if(i===s){var r=userData.isFavorite(this.props.type,i),a=userData.isDisliked(i);this.setState({share_button_display:this.props.display_share&&r&&!a,active:r}),this._timeout_id=window.setTimeout(this._hideShareButton,5e3)}},_timeout_id:null,_sharebox_id:0,_hideShareButton:function(){clearTimeout(this._timeout_id),this.isMounted()&&this.setState({share_button_display:!1})},_setShareButtonStatus:function(e,t){return t!==this._sharebox_id?!1:void this._hideShareButton()},_getTooltip:function(){return"song"===this.props.type?button_multi_state.getWording({type:this.props.type,action:"favorite"},this.state.active?"hover":"add","full"):""}});t.exports=o},{"../../core/i18n":98,classnames:"classnames",jquery:"jquery","react/addons":"react/addons"}],26:[function(e,t,i){"use strict";var s=e("react/addons"),r=e("classnames"),a=e("../../core/i18n"),n=s.createClass({displayName:"Dislike",mixins:[s.addons.PureRenderMixin],getDefaultProps:function(){return{id:0,type:"disliked_song",style:"heart",tooltip:!1,tooltip_gravity:"s",elId:null,onClickCallback:function(){}}},getInitialState:function(){return{active:!1}},componentDidMount:function(){Events.subscribe(Events.user.addFavorite,this._onFavoriteToggle),Events.subscribe(Events.user.deleteFavorite,this._onFavoriteToggle)},componentWillUnmount:function(){Events.unsubscribe(Events.user.addFavorite,this._onFavoriteToggle),Events.unsubscribe(Events.user.deleteFavorite,this._onFavoriteToggle)},componentWillReceiveProps:function(){this.setState({active:!1})},render:function(){var e=r({action:"heart"===this.props.style,"evt-over evt-out":this.props.tooltip}),t=r({"icon-32":"heart"===this.props.style,"icon-52":"heart_medium"===this.props.style,"icon-64":"heart_large"===this.props.style,"icon-stack icon-stack-hover icon-stack-circle-striked":!0}),i=r({"icon icon-unlove":!0,active:this.state.active&&dzPlayer.skipRadioAllowed()}),n={};return this.props.tooltip&&(n={enabled:"1",gravity:this.props.tooltip_gravity,delay:"400",offset:2}),s.createElement("a",{className:e,id:this.props.elId,"data-tooltip":n.enabled,"data-tooltip-offset":n.offset,"data-tooltip-gravity":n.gravity,"data-tooltip-delay":n.delay,title:a.gettext("Ne plus me proposer ce titre"),onClick:this._onDislikeClick,role:"button"},s.createElement("span",{className:t},s.createElement("span",{className:i})))},_onFavoriteToggle:function(e,t){var i=Number(this.props.id),s=Number(t.id);return i!==s||"disliked_song"!==t.type?!1:void this.setState({active:userData.isDisliked(i)})},_onDislikeClick:function(e){e.stopPropagation(),favorite.add({type:this.props.type,id:this.props.id}),this.props.onClickCallback()}});t.exports=n},{"../../core/i18n":98,classnames:"classnames","react/addons":"react/addons"}],23:[function(e,t,i){"use strict";var s={tags:{player_click:["type"],context_menu_click:["type","instance"],panel_click:["panel","type","id","index","instance"],menu_click:["type"],onboarding_feed_close_click:["context"],lyrics:["ts","action","container","sng","type"]},platform:{lyrics:"deezer_log"},tracking:function(e){function t(t,i){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){if("object"!=typeof this.tags[e])return!1;for(var i={},s=this;null!==s;)"function"==typeof s.getTrackingParams&&$.extend(i,s.getTrackingParams()),s=s._owner;var r={};"object"==typeof t&&(r=dom.dataset(t));for(var a=0;a<this.tags[e].length;a++){var n=this.tags[e][a];"ts"!==n?"undefined"!=typeof r[n]&&null!=r[n]&&(i[n]=r[n]):i[n]=SERVER_TIMESTAMP}var o="";return"string"==typeof r.trackingCallback&&(o=this[r.trackingCallback]||""),"string"==typeof this.platform[e]&&"deezer_log"===this.platform[e]?(api.call({method:"log_central.log",data:{BATCH:[{channel:e,params:i}]}}),!0):void tracking.track(e,i,o)})};t.exports=s},{}],20:[function(e,t,i){"use strict";var s=e("../../core/i18n"),r={like:!0,dislike:!0},a={dislike_first:s.gettext("Flow ne vous proposera plus ce titre, promis."),dislike:s.gettext("Non merci Flow."),like_first:s.gettext("Ajouté aux Coups de cœur. Allez-y, continuez à ajouter, Flow apprend à vous connaître."),like:s.gettext("Ajouté aux Coups de cœur")},n={displayNotification:function(e){if(!r[e])return!1;var t="number"==typeof USER.SETTING.site["nb_flowplayer_"+e+"_notification"]?USER.SETTING.site["nb_flowplayer_"+e+"_notification"]:0;if(3>t){var i=a[e+(0===t?"_first":"")];window.notification.display(null,{message:i});var s={};s["nb_flowplayer_"+e+"_notification"]=t+1,userSetting.set({site:s})}}};t.exports=n},{"../../core/i18n":98}],99:[function(e,t,i){"use strict";var s=e("react/addons"),r=e("jquery"),a={$element:null,$container:null,$overlay:null,opened:!1,ready:!1,react_elem:null,transition:150,init:function(){try{a.$element=r(".modal"),a.$container=r(".modal-wrapper",a.$element),a.$overlay=r(".modal-backdrop",a.$element),a.$element.on("click",function(e){var t=r(e.target);("modal"===t.attr("id")||"modal-backdrop"===t.attr("class"))&&a.close()}),Events.subscribe(Events.navigation.modal_open,function(e,t){window.modal.setReactElement(t.div);var i=s.createFactory(window.DzrComponents.Modal[t.type]);s.render(i({data:t.data}),document.getElementById("modal_"+t.div))}),a.ready=!0}catch(e){error.log(e)}},open:function(e,t,i){try{a.ready!==!0&&a.init(),"/"!==e.charAt(0)&&"http"!==e.substr(0,4)&&(error.log({message:"path not valid",description:"modal.open: / is missing in your path "+e}),e="/"+e),"function"==typeof r.facebox&&r.facebox.close(),"undefined"==typeof t&&(t=!1);var s="GET";if("undefined"!=typeof arguments[2]&&r.isPlainObject(arguments[2])&&(i=arguments[2],s="POST"),a.opened===!0&&t===!1)return!1;var n=util.uniqid();return"undefined"!=typeof window.dataLayer&&window.dataLayer.push({event:"modal.open="+e}),LAYOUT.is_standalone||"web"!==PLATFORM?window.location=e:(a.opened=!0,a.$element.show(),"GET"===s?r.get(e,OFFLINE?{}:{modal:"1"}).done(function(t){a.doneCallback(t,e)}).fail(a.failCallback):(e+=(-1===e.indexOf("?")?"?":"&")+"modal=1",r.post(e,i).done(function(t){a.doneCallback(t,e)}).fail(a.failCallback))),a.$element.data("uniqid",n),a.bindBackButton(!0),n}catch(o){error.log(o)}},close:function(){try{return a.ready!==!0&&a.init(),a.opened===!1&&"web"===PLATFORM?!1:(a.opened=!1,a.$element.removeClass("opened"),window.setTimeout(function(){a.react_elem?s.unmountComponentAtNode(document.getElementById("modal_"+a.react_elem)):a.$container.html(""),a.react_elem=null,a.bindBackButton(!1),a.$element.hide()},a.transition),Events.trigger(Events.modal.close,a.$element.data("uniqid")),!0)}catch(e){error.log(e)}},doneCallback:function(e,t){a.$container.html(e),window.setTimeout(function(){a.$element.addClass("opened")},0),Events.trigger(Events.navigation.modal_displayed,{modal:t})},failCallback:function(){a.opened=!1},setReactElement:function(e){a.react_elem=String(e||"")},bindBackButton:function(e){e=Boolean(e),r(document).on("keydown",function(t){e&&8===t.which&&!r(t.target).is("input, textarea")&&t.preventDefault()})}};t.exports=a},{jquery:"jquery","react/addons":"react/addons"}],103:[function(e,t,i){t.exports={"default":e("core-js/library/fn/object/keys"),__esModule:!0}},{"core-js/library/fn/object/keys":107}],107:[function(e,t,i){e("../../modules/es6.object.statics-accept-primitives"),t.exports=e("../../modules/$").core.Object.keys},{"../../modules/$":113,"../../modules/es6.object.statics-accept-primitives":115}],115:[function(e,t,i){var s=e("./$"),r=e("./$.def"),a=s.isObject,n=s.toObject;s.each.call("freeze,seal,preventExtensions,isFrozen,isSealed,isExtensible,getOwnPropertyDescriptor,getPrototypeOf,keys,getOwnPropertyNames".split(","),function(t,i){var o=(s.core.Object||{})[t]||Object[t],p=0,l={};l[t]=0==i?function(e){return a(e)?o(e):e}:1==i?function(e){return a(e)?o(e):e}:2==i?function(e){return a(e)?o(e):e}:3==i?function(e){return a(e)?o(e):!0}:4==i?function(e){return a(e)?o(e):!0}:5==i?function(e){return a(e)?o(e):!1}:6==i?function(e,t){return o(n(e),t)}:7==i?function(e){return o(Object(s.assertDefined(e)))}:8==i?function(e){return o(n(e))}:e("./$.get-names").get;try{o("z")}catch(c){p=1}r(r.S+r.F*p,"Object",l)})},{"./$":113,"./$.def":109,"./$.get-names":112}],112:[function(e,t,i){function s(e){try{return n(e)}catch(t){return o.slice()}}var r=e("./$"),a={}.toString,n=r.getNames,o="object"==typeof window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.get=function(e){return o&&"[object Window]"==a.call(e)?s(e):n(r.toObject(e))}},{"./$":113}],109:[function(e,t,i){function s(e,t){return function(){return e.apply(t,arguments)}}function r(e,t,i){var a,l,c,u,d=e&r.G,h=e&r.P,m=d?n:e&r.S?n[t]:(n[t]||{}).prototype,_=d?o:o[t]||(o[t]={});d&&(i=t);for(a in i)l=!(e&r.F)&&m&&a in m,l&&a in _||(c=l?m[a]:i[a],d&&!p(m[a])?u=i[a]:e&r.B&&l?u=s(c,n):e&r.W&&m[a]==c?!function(e){u=function(t){return this instanceof e?new e(t):e(t)},u.prototype=e.prototype}(c):u=h&&p(c)?s(Function.call,c):c,_[a]=u,h&&((_.prototype||(_.prototype={}))[a]=c))}var a=e("./$"),n=a.g,o=a.core,p=a.isFunction;r.F=1,r.G=2,r.S=4,r.P=8,r.B=16,r.W=32,t.exports=r},{"./$":113}],113:[function(e,t,i){"use strict";function s(e){return isNaN(e=+e)?0:(e>0?_:m)(e)}function r(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}function a(e,t,i){return e[t]=i,e}function n(e){return f?function(t,i,s){return b.setDesc(t,i,r(e,s))}:a}function o(e){return null!==e&&("object"==typeof e||"function"==typeof e)}function p(e){return"function"==typeof e}function l(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}var c="undefined"!=typeof self?self:Function("return this")(),u={},d=Object.defineProperty,h={}.hasOwnProperty,m=Math.ceil,_=Math.floor,y=Math.max,v=Math.min,f=!!function(){try{return 2==d({},"a",{get:function(){return 2}}).a}catch(e){}}(),g=n(1),b=t.exports=e("./$.fw")({g:c,core:u,html:c.document&&document.documentElement,isObject:o,isFunction:p,that:function(){return this},toInteger:s,toLength:function(e){return e>0?v(s(e),9007199254740991):0},toIndex:function(e,t){return e=s(e),0>e?y(e+t,0):v(e,t)},has:function(e,t){return h.call(e,t)},create:Object.create,getProto:Object.getPrototypeOf,DESC:f,desc:r,getDesc:Object.getOwnPropertyDescriptor,setDesc:d,setDescs:Object.defineProperties,getKeys:Object.keys,getNames:Object.getOwnPropertyNames,getSymbols:Object.getOwnPropertySymbols,assertDefined:l,ES5Object:Object,toObject:function(e){return b.ES5Object(l(e))},hide:g,def:n(0),set:c.Symbol?a:g,each:[].forEach});"undefined"!=typeof __e&&(__e=u),"undefined"!=typeof __g&&(__g=c)},{"./$.fw":111}],111:[function(e,t,i){t.exports=function(e){return e.FW=!1,e.path=e.core,e}},{}],98:[function(e,t,i){"use strict";var s=e("i18next-client"),r={init:function(){var e,t=window.SETTING_LANG.toLowerCase();switch(t){case"us":e="en";break;case"mx":e="es";break;case"br":e="pt";break;case"no":e="nb";break;case"rs":e="sr";break;case"me":e="sr";break;case"se":e="sv";break;case"cn":e="zh";break;default:e=t}s.init({debug:!1,resStore:window.translation,lng:e,fallbackLng:!1,useCookie:!1,lowerCaseLng:!0,keyseparator:"::",nsseparator:":::",postProcess:"sprintf"})},gettext:function(e,t){if(!arguments.length||!arguments[0])throw new Error("_() called with empty key");return t=t||{},s.t(e,t)},ngettext:function(e,t,i){if(!arguments.length||arguments.length<3)throw new Error("ngettext() called with incorrect number of arguments",arguments);if("undefined"==typeof i.count)throw new Error('ngettext() called with no "count" attribute',arguments);var r=parseInt(i.count,10);return i.sprintf?s.t(e,{count:r,postProcess:"sprintf",sprintf:i.sprintf}):s.t(e,{count:r})}};t.exports=r},{"i18next-client":"i18next-client"}]},{},[]);;
require=function e(t,s,a){function i(r,l){if(!s[r]){if(!t[r]){var o="function"==typeof require&&require;if(!l&&o)return o(r,!0);if(n)return n(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var d=s[r]={exports:{}};t[r][0].call(d.exports,function(e){var s=t[r][1][e];return i(s?s:e)},d,d.exports,e,t,s,a)}return s[r].exports}for(var n="function"==typeof require&&require,r=0;r<a.length;r++)i(a[r]);return i}({2:[function(e,t,s){"use strict";var a=e("../core/i18n");a.init(),window.gettext=a.gettext,window.ngettext=a.ngettext;var i=e("../core/modal"),n=e("../core/Blurred");window.modal=i,window.Blurred=n;var r=e("../components/_mixins/notification"),l=e("../components/_mixins/tracking"),o=e("../components/common/Thumbnail"),c=e("../components/common/Tag"),d=e("../components/common/TagList"),p=e("../components/common/Favorite"),u=e("../components/common/Dislike"),m=e("../components/player/Player"),h=e("../components/modal/sharebox/Render"),g=e("../components/common/grid/Grid"),_=e("../components/common/StatesButton"),y=e("../components/common/Selectbox"),f=e("../components/modal/curator/playlist/Edit"),b=e("../components/modal/playlist_assistant/Render"),E=e("../components/modal/curator/tagging/Render");window.DzrComponents={Thumbnail:o,Tag:c,TagList:d,Favorite:p,Dislike:u,Grid:g,StatesButton:_,Selectbox:y,Player:m,Modal:{ShareBox:h,CuratorPlaylist:f,CuratorTagging:E,PlaylistAssistant:b},_mixins:{notification:r,tracking:l}}},{"../components/_mixins/notification":20,"../components/_mixins/tracking":23,"../components/common/Dislike":26,"../components/common/Favorite":27,"../components/common/Selectbox":29,"../components/common/StatesButton":30,"../components/common/Tag":31,"../components/common/TagList":32,"../components/common/Thumbnail":33,"../components/common/grid/Grid":34,"../components/modal/curator/playlist/Edit":61,"../components/modal/curator/tagging/Render":62,"../components/modal/playlist_assistant/Render":63,"../components/modal/sharebox/Render":67,"../components/player/Player":74,"../core/Blurred":96,"../core/i18n":98,"../core/modal":99}],74:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("./_elements/Cover"),n=e("./_elements/ControlBar"),r=e("../_mixins/control"),l=a.createClass({displayName:"Player",mixins:[r],render:function(){return a.createElement("div",{className:"player",id:"player"},a.createElement(i,{lyrics_opened:this.state.lyrics_opened}),a.createElement(n,{queuelist_opened:this.state.queuelist_opened}))}});t.exports=l},{"../_mixins/control":17,"./_elements/ControlBar":79,"./_elements/Cover":80,"react/addons":"react/addons"}],80:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("classnames"),n=e("../../_mixins/currentSong"),r=e("../../_mixins/currentType"),l=e("../../_mixins/control"),o=e("./Title"),c=e("./Action"),d=e("./TimeBar"),p=a.createClass({displayName:"Cover",propTypes:{lyrics_opened:a.PropTypes.bool.isRequired},mixins:[n,r,l],componentWillUpdate:function(e,t){this.state.track.SNG_ID!==t.track.SNG_ID&&this.refs.action.closeContextMenu()},render:function(){var e=SETTING_STATIC+"/images/common/ads/player.jpg",t=i({"player-options":!0,hide:"ads"===this.state.type||this.state.track_type===dzPlayer.MEDIA_TYPE_TALK});return"ads"!==this.state.type&&(e=SETTING_DOMAIN_IMG+"/cover/",this.state.track_type===dzPlayer.MEDIA_TYPE_TALK?e=SETTING_DOMAIN_IMG+"/talk/"+this.state.track.SHOW_ART_MD5:playercontrol.blindTestMode||"string"!=typeof this.state.track.ALB_PICTURE||(e+=this.state.track.ALB_PICTURE),e+="/250x250.jpg"),a.createElement("div",{className:"player-cover",id:"player-cover"},a.createElement("img",{src:e,height:"220",width:"220",alt:""}),a.createElement(o,null),a.createElement(c,{ref:"action",lyrics_opened:this.props.lyrics_opened}),a.createElement(d,null),a.createElement("a",{className:t,"data-action":"add",role:"button",onClick:this.action},a.createElement("span",{className:"icon icon-options"})),a.createElement("div",{className:"player-overlay","data-action":"seek",role:"button",onClick:this.action}))}});t.exports=p},{"../../_mixins/control":17,"../../_mixins/currentSong":18,"../../_mixins/currentType":19,"./Action":75,"./TimeBar":83,"./Title":84,classnames:"classnames","react/addons":"react/addons"}],84:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("../../_mixins/control"),n=e("./SongTitle"),r=e("./ArtistName"),l=a.createClass({displayName:"Title",mixins:[i],render:function(){return a.createElement("div",{className:"player-track","data-action":"seek",onClick:this.action},a.createElement(n,null),a.createElement(r,null))}});t.exports=l},{"../../_mixins/control":17,"./ArtistName":76,"./SongTitle":82,"react/addons":"react/addons"}],82:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("../../_mixins/currentSong"),n=e("../../_mixins/currentType"),r=e("../../_mixins/control"),l=a.createClass({displayName:"SongTitle",mixins:[i,n,r],render:function(){if(playercontrol.blindTestMode)return a.createElement("h2",{className:"player-track-title heading-2"},"???");if("ads"===this.state.type){var e={title:null===dzPlayer.getAudioAds()?"":dzPlayer.getAudioAds().textlink.text,link:null===dzPlayer.getAudioAds()?"":dzPlayer.getAudioAds().tracking.clickCommand};return a.createElement("h2",{className:"player-track-title heading-2 ads"},a.createElement("a",{className:"player-track-link","data-action":"link","data-href":e.link,onClick:this.action},e.title))}var t=this.state.track_type===dzPlayer.MEDIA_TYPE_TALK?this.state.track.EPISODE_TITLE:this.state.track.SNG_TITLE;"string"==typeof this.state.track.VERSION&&this.state.track.VERSION.length>0&&(t+=" "+this.state.track.VERSION),window.document.title=t;var s="";return this.state.track_type===dzPlayer.MEDIA_TYPE_TALK?s="/show/"+this.state.track.SHOW_ID:Number(this.state.track.ALB_ID)>0&&(s="/album/"+this.state.track.ALB_ID),a.createElement("h2",{className:"player-track-title heading-2"},a.createElement("span",{className:"player-track-link","data-action":"link","data-href":s,onClick:this.action},t))}});t.exports=l},{"../../_mixins/control":17,"../../_mixins/currentSong":18,"../../_mixins/currentType":19,"react/addons":"react/addons"}],76:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("../../../core/i18n"),n=e("../../_mixins/currentSong"),r=e("../../_mixins/currentType"),l=e("../../_mixins/control"),o=a.createClass({displayName:"ArtistName",mixins:[n,r,l],render:function(){var e=this.state.track.ARTISTS||[];if("ads"===this.state.type)return a.createElement("div",null);if(this.state.track_type===dzPlayer.MEDIA_TYPE_TALK)return a.createElement("h3",{className:"player-track-artist heading-2-sub ellipsis"},a.createElement("span",{className:"player-track-link","data-action":"link","data-href":"/show/"+this.state.track.SHOW_ID,onClick:this.action},this.state.track.SHOW_NAME));0===e.length&&e.push({ART_NAME:this.state.track.ART_NAME,ART_ID:this.state.track.ART_ID});var t={};return a.createElement("h3",{className:"player-track-artist heading-2-sub ellipsis"},i.gettext("par")," ",e.map(function(s,i){return"boolean"==typeof t[s.ART_ID]?[]:(t[s.ART_ID]=!0,playercontrol.blindTestMode?"???":(window.document.title+=" - "+s.ART_NAME,[a.createElement("span",{className:"player-track-link","data-action":"link",key:"artist_"+s.ART_ID,"data-href":0!==s.ART_ID?"/artist/"+s.ART_ID:"",onClick:this.action},s.ART_NAME),i===e.length-1?"":", "]))}.bind(this)))}});t.exports=o},{"../../../core/i18n":98,"../../_mixins/control":17,"../../_mixins/currentSong":18,"../../_mixins/currentType":19,"react/addons":"react/addons"}],83:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("jquery"),n=e("../../_mixins/playing"),r=e("../../_mixins/control"),l=a.createClass({displayName:"TimeBar",propTypes:{dragging:a.PropTypes.bool},mixins:[n,r],getDefaultProps:function(){return{dragging:!1}},componentDidMount:function(){var e=this;i(this.refs.seek.getDOMNode()).draggable({axis:"x",containment:"parent",start:function(){e.props.dragging=!0},stop:function(t,s){e.props.dragging=!1,dzPlayer.isPlaying()?dzPlayer.control.seek(s.position.left/t.target.parentNode.offsetWidth):i(this).css("left",e.cursorPosition())}}),Events.subscribe(Events.player.changePlayerType,function(){i(this.refs.seek.getDOMNode()).draggable(this.seekAllowed()?"enable":"disable")}.bind(this),"player")},cursorPosition:function(){var e=Math.min(this.state.position,this.state.duration);return e>0?Math.floor(100*e/this.state.duration)+"%":"0%"},seek:function(e){this.seekAllowed()&&dzPlayer.control.seek(e.pageX/e.currentTarget.parentNode.offsetWidth)},render:function(){var e=this.cursorPosition(),t={};return this.props.dragging||(t.left=e),a.createElement("div",{className:"player-progress",ref:"timebar",role:"progressbar"},a.createElement("div",{className:"progress progress-background"}),a.createElement("div",{className:"progress progress-buffer",style:{width:this.state.buffer+"%"},onClick:this.action,"data-action":"seek"}),a.createElement("div",{className:"progress progress-seek",style:{width:e},onClick:this.action,"data-action":"seek"},a.createElement("div",{className:"progress-seek-overlay"})),a.createElement("div",{className:"progress-handler",style:t,ref:"seek"}),a.createElement("div",{className:"progress-time"},secToMin(this.state.position)),a.createElement("div",{className:"progress-length"},secToMin(this.state.duration)))}});t.exports=l},{"../../_mixins/control":17,"../../_mixins/playing":21,jquery:"jquery","react/addons":"react/addons"}],75:[function(e,t,s){"use strict";var a=e("babel-runtime/helpers/extends")["default"],i=e("react/addons"),n=e("classnames"),r=e("../../../core/i18n"),l=e("../../_mixins/currentSong"),o=e("../../_mixins/currentType"),c=e("../../_mixins/notification"),d=e("../../_mixins/control"),p=e("../../common/Dislike"),u=e("../../common/Favorite"),m=i.createClass({displayName:"Action",propTypes:{lyrics_opened:i.PropTypes.bool},mixins:[l,d,o,c],render:function(){var e=this.state.type,t=dzPlayer.isRadio(),s=dzPlayer.helper.isPlayingFlow()?"flow":null,l="undefined"!=typeof this.state.track.LYRICS_ID&&0!==this.state.track.LYRICS_ID,o=n({"evt-out evt-over action action-hide":!0,disabled:this.state.track.SNG_ID<0}),c=n({"icon icon-lyrics":!0,disabled:this.state.track.SNG_ID<0,active:this.props.lyrics_opened}),d={"data-tooltip":1,"data-tooltip-delay":700,"data-tooltip-offset":2,"data-tooltip-gravity":"sw"},m=i.createElement(u,{type:"song",style:"heart",context:"player",tooltip:!0,tooltip_gravity:"sw",id:String(this.state.track.SNG_ID),key:this.state.track.SNG_ID,onClickCallback:this._onFavoriteClick,share_context:s}),h=i.createElement(p,{tooltip:!0,tooltip_gravity:"sw",id:this.state.track.SNG_ID,key:"dislike_"+this.state.track.SNG_ID,onClickCallback:this._onDislikeClick}),g=i.createElement("a",a({className:o,onClick:this.action,key:"add_playlist_"+this.state.track.SNG_ID,role:"button","data-action":"playlist","data-tooltip-fallback":r.gettext("Ajouter à une playlist")},d),i.createElement("span",{className:"icon-32 icon-stack icon-stack-hover icon-stack-circle"},i.createElement("span",{className:"icon icon-playlist-add"}))),_=r.gettext(this.props.lyrics_opened?"Masquer les paroles":"Afficher les paroles"),y=i.createElement("a",a({className:"evt-out evt-over action",onClick:this.action,key:"lyrics_"+this.state.track.SNG_ID,role:"button","data-action":"lyrics","data-tooltip-fallback":_},d),i.createElement("span",{className:"icon-32 icon-stack icon-stack-hover icon-stack-circle",id:"player-lyrics"},i.createElement("span",{className:c}))),f=[];return"ads"!==e&&this.state.track_type===dzPlayer.MEDIA_TYPE_SONG&&(f=[m],t&&f.unshift(h),l&&f.push(y),t||f.push(g)),i.createElement("div",{className:"player-actions clearfix","data-action":"seek",onClick:this.action},f.map(function(e,t){return[e,t===f.length-1]}))},_onDislikeClick:function(){return dzPlayer.skipRadioAllowed()?(this.displayNotification("dislike"),void setTimeout(dzPlayer.control.nextSong,300)):this.notify_already_displayed?!1:(this.notify_already_displayed=!0,notificationBar.display("flow_skip_push",{}),!1)},_onFavoriteClick:function(e,t,s){s&&this.displayNotification("like")}});t.exports=m},{"../../../core/i18n":98,"../../_mixins/control":17,"../../_mixins/currentSong":18,"../../_mixins/currentType":19,"../../_mixins/notification":20,"../../common/Dislike":26,"../../common/Favorite":27,"babel-runtime/helpers/extends":104,classnames:"classnames","react/addons":"react/addons"}],79:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("../../../core/i18n"),n=e("../../_mixins/control"),r=e("../../_mixins/playing"),l=e("../../_mixins/statusButton"),o=e("../../_mixins/currentSong"),c=e("./BottomControl"),d=e("./PlayControl"),p=e("./ChromecastControl"),u=a.createClass({displayName:"ControlBar",propTypes:{queuelist_opened:a.PropTypes.bool.isRequired},mixins:[n,r,l,o],render:function(){var e=i.gettext("Précédent"),t=i.gettext("Suivant");return a.createElement("div",{className:"player-controls"},a.createElement("ul",{className:"controls controls-main clearfix"},a.createElement("li",null,a.createElement("button",{className:"control control-prev",type:"button",onClick:this.action,"data-action":"prevSong",disabled:this.status("prev"),title:e},a.createElement("span",{className:"icon icon-prev"}))),this.state.track_type===dzPlayer.MEDIA_TYPE_TALK?a.createElement("li",null,a.createElement("button",{className:"control control-prev-30",type:"button",onClick:this.action,"data-action":"backward"},a.createElement("span",{className:"icon icon-prev-30"}))):!1,a.createElement("li",null,a.createElement(d,null)),this.state.track_type===dzPlayer.MEDIA_TYPE_TALK?a.createElement("li",null,a.createElement("button",{className:"control control-next-30",type:"button",onClick:this.action,"data-action":"forward"},a.createElement("span",{className:"icon icon-next-30"}))):!1,a.createElement("li",null,a.createElement("button",{className:"control control-next",type:"button",onClick:this.action,"data-action":"nextSong",disabled:this.status("next"),title:t},a.createElement("span",{className:"icon icon-next"})))),a.createElement(c,{queuelist_opened:this.props.queuelist_opened}),this.state.track_type===dzPlayer.MEDIA_TYPE_SONG?a.createElement(p,null):!1)}});t.exports=u},{"../../../core/i18n":98,"../../_mixins/control":17,"../../_mixins/currentSong":18,"../../_mixins/playing":21,"../../_mixins/statusButton":22,"./BottomControl":77,"./ChromecastControl":78,"./PlayControl":81,"react/addons":"react/addons"}],81:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("../../../core/i18n"),n=e("../../_mixins/control"),r=e("../../_mixins/playing"),l=e("../../_mixins/statusButton"),o=a.createClass({displayName:"PlayControl",mixins:[n,r,l],getInitialState:function(){return{playing:!1,paused:!1}},componentDidMount:function(){Events.subscribe(Events.player.playing,function(e,t){this.setState({playing:t})}.bind(this),"player"),Events.subscribe(Events.player.paused,function(e,t){this.setState({paused:t})}.bind(this),"player"),Events.subscribe(Events.player.finishTrackList,function(){this.setState({playing:!1,paused:!1})}.bind(this),"player")},render:function(){var e=i.gettext("Play"),t=i.gettext("Pause");return this.state.paused&&!this.state.playing||!this.state.paused&&!this.state.playing?a.createElement("button",{className:"control control-play",type:"button",onClick:this.action,"data-action":"play",disabled:this.status("play"),title:e},a.createElement("span",{className:"icon icon-play"})):a.createElement("button",{className:"control control-pause",type:"button",onClick:this.action,"data-action":"pause",disabled:this.status("pause"),title:t},a.createElement("span",{className:"icon icon-pause"}))}});t.exports=o},{"../../../core/i18n":98,"../../_mixins/control":17,"../../_mixins/playing":21,"../../_mixins/statusButton":22,"react/addons":"react/addons"}],77:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("jquery"),n=e("../../../core/i18n"),r=e("../../_mixins/playing"),l=e("../../_mixins/control"),o=e("../../_mixins/statusButton"),c=e("../../_mixins/currentSong"),d=e("../../_mixins/currentType"),p=e("../../_mixins/tracking"),u=e("./ChromecastControl"),m=a.createClass({displayName:"BottomControl",mixins:[r,l,o,d,p,c],componentDidMount:function(){var e=this;i(this.refs.volume.getDOMNode()).draggable({axis:"x",containment:"parent",drag:function(t,s){i(this).is(":visible")&&dzPlayer.control.setVolume(e.getCursorVolume(t,s),!0)},stop:function(t,s){i(this).is(":visible")?dzPlayer.control.setVolume(e.getCursorVolume(t,s),!0):i(this).css("left",e.status("volume"))}}),Events.subscribe(Events.player.changePlayerType,function(e,t){i(this.refs.volume.getDOMNode()).draggable("ads"!==t?"enable":"disable")}.bind(this),"player")},getCursorVolume:function(e,t){var s=t.position.left/(e.target.parentNode.offsetWidth-4);return s=Math.min(s,1),s=Math.max(s,0)},render:function(){var e=[],t=n.gettext("Répéter"),s=n.gettext("Aléatoire"),i=n.gettext("File d'attente");if(("mod"===this.state.type||"chromecast"===this.state.type&&!chromecast.isRadio())&&(e=this.state.track_type===dzPlayer.MEDIA_TYPE_SONG?[a.createElement("li",{key:"repeat"},a.createElement("button",{className:"control control-repeat"+this.status("repeat"),type:"button",onClick:this.action,"data-type":"repeat","data-action":"setRepeat",title:t},a.createElement("span",{className:"icon icon-repeat"}),a.createElement("span",{className:"icon icon-repeat-one"}))),a.createElement("li",{key:"shuffle"},a.createElement("button",{className:"control control-shuffle"+this.status("shuffle"),type:"button",onClick:this.action,"data-type":"shuffle","data-action":"setShuffle",title:s},a.createElement("span",{className:"icon icon-shuffle"})))]:[a.createElement("li",{className:"chromecast",key:"chromecast"},a.createElement(u,null))]),"radio"===this.state.type||"chromecast"===this.state.type&&chromecast.isRadio()){var r="user"===dzPlayer.radioType;e=[a.createElement("li",{key:"radio",className:"tag"},a.createElement("span",{className:"sticker sticker-small sticker-flow"},n.gettext(r?"FLOW":"MIX")))]}return"ads"===this.state.type&&(e=[a.createElement("li",{key:"ads",className:"tag"},a.createElement("span",{className:"sticker sticker-small sticker-flow"},n.gettext("PUBLICITÉ")))]),a.createElement("ul",{className:"controls controls-options clearfix"},a.createElement("li",{className:"volume"},a.createElement("button",{className:"control control-volume"+this.status("mute"),type:"button",onClick:this.action,"data-action":"mute"},a.createElement("span",{className:"icon icon-volume"}),a.createElement("span",{className:"icon icon-volume-min"}),a.createElement("span",{className:"icon icon-volume-off"})),a.createElement("span",{className:"volume-progress",onClick:this.action,"data-action":"setVolume",ref:"volume_bar"},a.createElement("span",{className:"volume-progress-bar"},a.createElement("span",{className:"volume-bar",style:{width:this.status("volume")},onClick:this.action,"data-action":"setVolume"}),a.createElement("span",{className:"volume-handler",style:{left:this.status("volume")},ref:"volume"}))),a.createElement("button",{className:"control control-volume-max",type:"button"},a.createElement("span",{className:"icon icon-volume-max"}))),e,a.createElement("li",null,a.createElement("button",{className:"control "+("chromecast"===this.state.type?"disabled":"")+" control-qlist"+this.status("queue"),type:"button",title:i,onClick:this.action,"data-type":"queuelist","data-action":"queuelist"},a.createElement("span",{className:"icon icon-qlist"}))))}});t.exports=m},{"../../../core/i18n":98,"../../_mixins/control":17,"../../_mixins/currentSong":18,"../../_mixins/currentType":19,"../../_mixins/playing":21,"../../_mixins/statusButton":22,"../../_mixins/tracking":23,"./ChromecastControl":78,jquery:"jquery","react/addons":"react/addons"}],78:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("../../_mixins/chromecast"),n=a.createClass({displayName:"ChromecastControl",mixins:[i],render:function(){var e=this.state.chromecast;chromecast.canCast()||(e="hide");var t,s,i="chromecast-icon",n={hide:"hidden",loading:"loading",connected:"active",show:"",disconnected:""},r=!1;return"show"===e&&(storage.get("CCIntro_"+USER.USER_ID)||(r=!0)),t=i+" "+n[e],s=a.createElement("a",{className:t,title:"Chromecast","data-action":"chromecast",onClick:this._onClick}),r&&(s=a.createElement("div",{className:"chromecast-tooltip"},s)),s},_onClick:function(){"connected"!==chromecast.getStatus()&&Events.trigger(Events.chromecast.status,"show"),storage.set("CCIntro_"+USER.USER_ID,!0),chromecast.launch()}});t.exports=n},{"../../_mixins/chromecast":16,"react/addons":"react/addons"}],16:[function(e,t,s){"use strict";var a={getInitialState:function(){return{chromecast:chromecast.getStatus()}},componentDidMount:function(){Events.subscribe(Events.chromecast.status,this._onStatusChange)},componentWillUnmount:function(){Events.unsubscribe(Events.chromecast.status,this._onStatusChange)},_onStatusChange:function(e,t){this.setState({chromecast:t})}};t.exports=a},{}],19:[function(e,t,s){"use strict";var a={getInitialState:function(){return{type:dzPlayer.getPlayerType()}},componentDidMount:function(){Events.subscribe(Events.player.changePlayerType,function(e,t){this.setState({type:t})}.bind(this),"player")}};t.exports=a},{}],22:[function(e,t,s){"use strict";var a={status:function(e){switch(e){case"prev":return("chromecast"===dzPlayer.getPlayerType()&&!chromecast.isRadio()||"mod"===dzPlayer.getPlayerType())&&(dzPlayer.getIndexSong()>0||this.state.repeat>0)?"":"disabled";case"next":return"chromecast"!==dzPlayer.getPlayerType()&&"mod"!==dzPlayer.getPlayerType()&&!dzPlayer.isRadio()||dzPlayer.isLastSong()&&!(this.state.repeat>0)?"disabled":"";case"play":case"pause":return"ads"===dzPlayer.getPlayerType()?"disabled":"";case"volume":return this.state.volume+"%";case"mute":return this.state.mute||0===this.state.volume?"-mute":"";case"repeat":return this.state.repeat>0?2===this.state.repeat?"-one active":" active":"";case"shuffle":return this.state.shuffle?" active":"";case"queue":return this.props.queuelist_opened?" active":""}}};t.exports=a},{}],21:[function(e,t,s){"use strict";var a={getInitialState:function(){return{position:0,buffer:0,duration:0,loading:0}},componentDidMount:function(){Events.subscribe(Events.player.position,function(e,t){this.setState({position:t})}.bind(this),"player"),Events.subscribe(Events.player.pourcentLoaded,function(e,t){this.setState({buffer:t})}.bind(this),"player"),Events.subscribe(Events.player.duration,function(e,t){this.setState({duration:t})}.bind(this),"player"),Events.subscribe(Events.player.loading,function(e,t){this.setState({loading:t})}.bind(this),"player")}};t.exports=a},{}],18:[function(e,t,s){"use strict";function a(){var e=dzPlayer.getCurrentSong();return{track:e||{},track_type:dzPlayer.getMediaType(e)}}var i={getInitialState:function(){return a()},componentDidMount:function(){Events.subscribe(Events.player.displayCurrentSong,this._onSongChange,"currentSongMixin"),Events.subscribe(Events.player.blind_test_mode_changed,this._onSongChange,"currentSongMixin")},componentWillUnmount:function(){Events.unsubscribeAll("currentSongMixin")},_onSongChange:function(){this.setState(a())}};t.exports=i},{}],17:[function(e,t,s){"use strict";var a=e("jquery"),i={getInitialState:function(){return{volume:100*dzPlayer.getVolume(),shuffle:dzPlayer.isShuffle(),repeat:dzPlayer.getRepeat(),mute:dzPlayer.isMuted(),queuelist_opened:!1,lyrics_opened:!1}},componentWillUnmount:function(){Events.unsubscribe(Events.player.changePlayerType,this._onChangePlayerType),Events.unsubscribe(Events.player.repeat_changed,this._onChangeRepeat),Events.unsubscribe(Events.player.shuffle_changed,this._onChangeShuffle),Events.unsubscribe(Events.player.volume_changed,this._onChangeVolume),Events.unsubscribe(Events.player.mute_changed,this._onChangeMute)},componentDidMount:function(){Events.subscribe(Events.player.changePlayerType,this._onChangePlayerType,"player"),Events.subscribe(Events.player.repeat_changed,this._onChangeRepeat,"player"),Events.subscribe(Events.player.shuffle_changed,this._onChangeShuffle,"player"),Events.subscribe(Events.player.volume_changed,this._onChangeVolume,"player"),Events.subscribe(Events.player.mute_changed,this._onChangeMute,"player")},action:function(e){e.preventDefault(),e.stopPropagation();var t=dom.dataset(e.currentTarget),s=e.currentTarget.className,i=dzPlayer.helper.isPlayingFlow()?"flow":"";if("string"==typeof t.action&&-1===s.indexOf("disabled")){var n,r=[],l=t.action;switch(t.action){case"link":""!==t.href&&("http"===t.href.substr(0,4)?window.open(t.href):loadBox(t.href));break;case"setShuffle":r=[!dzPlayer.isShuffle(),!0];break;case"setRepeat":r=[2===dzPlayer.getRepeat()?0:dzPlayer.getRepeat()+1];break;case"share":sharebox.load(0,dzPlayer.getCurrentSong("SNG_ID"));break;case"add":case"playlist":context_menu.open({target:e.target,position:"right",type:"song",view:"playlist"===t.action?"playlist":"home",data:{SONG:dzPlayer.getCurrentSong(),PLAYLIST_ID:dzPlayer.getContext("ID")},id:dzPlayer.getCurrentSong("SNG_ID"),context:"player",share_context:i});break;case"mute":r=[!dzPlayer.isMuted()];break;case"setVolume":var o=(e.pageX-a(e.currentTarget).offset().left)/this.refs.volume_bar.getDOMNode().offsetWidth;o=Math.min(o,1),r=[Math.max(o,0),!0];break;case"queuelist":menu.togglePanel("queuelist");break;case"lyrics":menu.togglePanel("lyrics");break;case"play":if(OFFLINE)return void dzoffline.display();break;case"seek":if(!this.seekAllowed())return;r=[e.pageX/e.currentTarget.parentNode.offsetWidth];break;case"chromecast":"connected"!==chromecast.getStatus()&&Events.trigger(Events.chromecast.status,"show"),storage.set("CCIntro_"+USER.USER_ID,!0),chromecast.launch();break;case"nextSong":dzPlayer.skipRadioAllowed()||notificationBar.display("flow_skip_push",{});break;case"forward":l="seek",n=(dzPlayer.position+30)/dzPlayer.duration,n>=1&&(l="nextSong"),r=[n];break;case"backward":l="seek",n=(dzPlayer.position-30)/dzPlayer.duration,r=[Math.max(n,0)]}this.doTracking(t.action,e),"function"==typeof dzPlayer.control[l]&&dzPlayer.control[l].apply(dzPlayer,r)}},closeContextMenu:function(){window.context_menu.close("player")},doTracking:function(e,t){if("function"!=typeof this.tracking)return!1;var s={queuelist:!0,setRepeat:!0,setShuffle:!0};return"boolean"!=typeof s[e]?!1:void this.tracking("player_click",t.currentTarget)},seekAllowed:function(){return!(dzPlayer.isRadio()&&!USER.OPTIONS.web_hq||"chromecast"===dzPlayer.getPlayerType()&&!dzPlayer.isRadio()||"ads"===dzPlayer.getPlayerType()||"jingle"===dzPlayer.getPlayerType())},_onChangePlayerType:function(e,t){this.setState({type:t})},_onChangeRepeat:function(e,t){this.setState({repeat:t})},_onChangeShuffle:function(e,t){this.setState({shuffle:t})},_onChangeVolume:function(e,t){this.setState({volume:t})},_onChangeMute:function(e,t){this.setState({mute:t,volume:t?0:100*dzPlayer.getVolume()})}};t.exports=i},{jquery:"jquery"}],67:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("classnames"),n=e("../../../core/i18n"),r=e("./_elements/NavTab"),l=e("./_elements/FriendsView"),o=e("./_elements/SocialButton"),c=e("./_elements/ShareButton"),d=e("../../common/Thumbnail"),p=a.createClass({displayName:"ShareBox",getDefaultProps:function(){return{id:null,type:null,data:[],options:{}}},getInitialState:function(){return{tabs:!1,context:"all",message:"",selected:[],friends:[],display:this._getFriendsMaxDisplay()}},componentWillMount:function(){this._setCurrentRefKey(),this._setClipboardUrl()},componentDidMount:function(){this._setTabsDisplay(),this._renderGGPlus(),this._resizeView()},render:function(){if(!this._getCurrentRefKey())return null;var e=this._getTitle(),t=null,s=null,o={type:this._getCurrentRefKey(),md5:this._getPictureMd5(),picture_type:this._getPictureType()};"sradio"===o.type&&(o.type="artist");var p=i({"share-message":!0,"form-control":!0,"form-control-block":!0,open:Boolean(this.state.message)});return this.props.data.SUBTITLE&&(t=a.createElement("div",{className:"heading-2-sub ellipsis",id:"share-subtitle"},n.gettext("par")+" "+this.props.data.SUBTITLE)),this._checkOption("standalone")||(s=a.createElement("div",{className:"share-action"},a.createElement("button",{ref:"copyToClipboard",className:"btn btn-default",type:"button",onMouseEnter:this._instantiateZC},a.createElement("span",{className:"label"},n.gettext("Copier l'URL Deezer"))),a.createElement("button",{className:"btn btn-default",type:"button",onClick:this._onEmbedClick},a.createElement("span",{className:"icon icon-embed"})))),a.createElement("div",null,a.createElement("div",{className:"modal-header"},e),a.createElement("div",{className:"modal-body"},a.createElement("div",{className:" share-content share-infos"},a.createElement("div",{className:"cell cell-thumbnail"},a.createElement(d,{id:Number(this.props.id),type:o.type,md5:o.md5,overlay:!1,picture_type:o.picture_type,height:120,width:120})),a.createElement("div",{className:"cell cell-infos"},a.createElement("div",{className:"heading-2 ellipsis",id:"share-title",dangerouslySetInnerHTML:{__html:this.props.data.TITLE}}),t,s)),a.createElement("div",{className:"share-nav clearfix"},this.state.tabs?this._getTabs().map(function(e,t){return a.createElement(r,{key:e.type+"_"+t,type:e.type,text:e.text,context:this.state.context,switchCurrentTab:this._switchCurrentTab})}.bind(this)):null),a.createElement("div",{className:"share-content share-followers"},this.state.tabs?a.createElement(l,{friends:this.state.friends,display:this.state.display,visible:"friends"===this.state.context,selected:this.state.selected,max:this._getSelectedMaxDisplay(),standalone:this._checkOption("standalone"),removeLastFriend:this._removeLastFriend,displayMoreFriends:this._displayMoreFriends,updateFriendsList:this._updateFriendsList,toggleFriend:this._toggleFriend}):null,a.createElement("textarea",{ref:"shareMessage",maxLength:this._getShareMessageMaxLength(),placeholder:n.gettext("Ajouter un message..."),className:p,onKeyPress:this._checkMessageInput,onChange:this._updateMessage}))),a.createElement("div",{className:"modal-footer"},a.createElement("div",{className:"action"},this._renderSocialButton()),a.createElement(c,{enabled:this._isShareEnabled(),shareElement:this._shareElement})))},_currentRefKey:null,_shareMessageMaxLength:180,_updateMessageTimeoutFn:null,_updateMessageDelayMs:300,_friendsMaxDisplay:24,_selectedMaxDisplay:8,_resizeViewTimeoutFn:null,_resizeViewDelayMs:500,_clipboardUrl:SETTING_HOST_SITE,_getCurrentRefKey:function(){return this._currentRefKey},_getTitle:function(){return this._getRefKeys()[this._getCurrentRefKey()].title},_getConfirmationMessage:function(){return this._getRefKeys()[this._getCurrentRefKey()].confirmation},_getPictureMd5:function(){return this.props.data.PICTURE},_getPictureType:function(){return this.props.data.PICTURE_TYPE},_getFriendsMaxDisplay:function(){return this._friendsMaxDisplay},_getSelectedMaxDisplay:function(){return this._selectedMaxDisplay},_getShareMessageMaxLength:function(){return this._shareMessageMaxLength},_getClipboardUrl:function(){return this._clipboardUrl},_getPlatforms:function(){return[{name:"facebook",key:"facebook",fn:"login"},{name:"twitter",key:"twitter",fn:"link"},{name:"googleplus",key:"google",fn:null}]},_getTabs:function(){return[{type:"all",text:n.gettext("Tous mes followers")},{type:"friends",text:n.gettext("Choisir des followers")}]},_getRefKeys:function(){return{track:{title:n.gettext("Partager ce titre"),confirmation:n.gettext("Titre partagé !"),type:0},album:{title:n.gettext("Partager cet album"),confirmation:n.gettext("Album partagé !"),type:1},artist:{title:n.gettext("Partager cette page artiste"),confirmation:n.gettext("Page artiste partagée !"),type:2},playlist:{title:n.gettext("Partager cette playlist"),confirmation:n.gettext("Playlist partagée !"),type:3},radio:{title:n.gettext("Partager ce mix"),confirmation:n.gettext("Mix partagé !"),type:4},sradio:{title:n.gettext("Partager ce mix"),confirmation:n.gettext("Mix partagé !"),type:6}}},_getPlatformsStatus:function(){var e={};return this._getPlatforms().map(function(t){e[t.name]=Boolean(this._isPlatformAllowed(t.name)&&this._isPlatformEnabled(t.key)&&this._isPlatformRegistered(t.name))}.bind(this)),e},_switchCurrentTab:function(e){this.setState({context:e},function(){this._resizeView()}.bind(this))},_checkMessageInput:function(e){if(13===e.which)return void e.preventDefault();var t=this.refs.shareMessage.getDOMNode().value.trim();return t.length>=this._getShareMessageMaxLength()?void e.preventDefault():void 0},_updateMessage:function(){clearTimeout(this._updateMessageTimeoutFn);var e=this.refs.shareMessage.getDOMNode().value.trim();this.state.message.length&&e.length||this.setState({message:e}),this._updateMessageTimeoutFn=setTimeout(function(){this.setState({message:e})}.bind(this),this._updateMessageDelayMs)},_isShareEnabled:function(){return"all"===this.state.context?this.state.tabs||!this.state.tabs&&this._hasCheckedPlatforms():this.state.selected.length||!this.state.selected.length&&this._hasCheckedPlatforms()},_isPlatformAllowed:function(e){return this._checkOption("standalone")&&("googleplus"===e||"facebook"===e&&!facebook.isScopeAllowed("publish_actions"))?!1:"googleplus"!==e||this._isPlatformRegistered(e)?!0:!1},_isPlatformEnabled:function(e){var t=Boolean(USER.SETTING[e]&&USER.SETTING[e].share_share);return t&&"facebook"===e&&!facebook.isScopeAllowed("publish_actions")?!1:t},_isPlatformRegistered:function(e){var t=Boolean(countObject(USER[e.toUpperCase()]));return"facebook"===e?Boolean(facebook.isScopeAllowed("publish_actions")&&t):t},_hasCheckedPlatforms:function(){var e=this._getPlatformsStatus();for(var t in e)if(e.hasOwnProperty(t)&&e[t]===!0)return!0;return!1},_hasAllowedPlatforms:function(){var e=this._getPlatforms();return this._isPlatformAllowed(e[0].name)},_togglePlatformBtn:function(e){if(!this._isPlatformRegistered(e.name)||"facebook"===e.name&&!facebook.isScopeAllowed("publish_actions")){if("googleplus"===e.name)return;var t={type:"modal",link:"/lightbox/sharebox?type="+this.props.type+"&id="+this.props.id};return"twitter"===e.name?t=this._checkOption("standalone")?t.link+"&standalone=true":www.getCurrentPath()+"?lb="+t.link:"facebook"===e.name&&(t={redirect:t}),window[e.name.toString()][e.fn.toString()](t)}var s={};s[e.key]={share_share:!USER.SETTING[e.key].share_share},userSetting.set(s,!this._checkOption("standalone")),this.forceUpdate()},_removeLastFriend:function(){var e=this.state.selected;e.length&&(e.pop(),this.setState({selected:e}))},_toggleFriend:function(e){var t=this.state.selected.indexOf(e),s=this.state.selected;return-1===t?s.push(e):s.splice(t,1),this.setState({selected:s}),!0},_displayMoreFriends:function(){if(this.state.display!==this.state.friends.length){var e=this.state.display+this._getFriendsMaxDisplay();e>this.state.friends.length&&(e=this.state.friends.length),this.setState({display:e})}},_updateFriendsList:function(e){e.sort(function(e,t){var s=(e.FIRSTNAME||"").toLowerCase(),a=(t.FIRSTNAME||"").toLowerCase();return a>s?-1:s>a?1:0}),this.setState({friends:e})},_shareElement:function(){var e=this._getPlatformsStatus(),t="all"===this.state.context?"*":this.state.selected,s=JSON.parse(JSON.stringify(this.props.options));for(var a in e)e.hasOwnProperty(a)&&(s[a]=e[a]);var i={type:this.props.type,id:this.props.id,message:this.state.message,friend_list:t,options:s};try{api.call("share.add",i,function(){if(this._checkOption("standalone"))return sharebox.close(!0);if(Events.trigger(Events.user.shareClick,{message:this._getConfirmationMessage()}),e.googleplus===!0){var t=document.getElementById("share-btn-publish-google");null!==t&&t.click()}sharebox.close()}.bind(this))}catch(n){error.log(n)}},_setCurrentRefKey:function(){var e=this._getRefKeys();for(var t in e)e.hasOwnProperty(t)&&e[t].type===this.props.type&&(this._currentRefKey=t);return Boolean(this._currentRefKey)},_checkOption:function(e){return Boolean(this.props.options[e])},_setTabsDisplay:function(){api.call("friend.getFollower",{nb:1,user_id:USER.USER_ID},function(){this.setState({tabs:!0})}.bind(this))},_renderSocialButton:function(){if(!this._hasAllowedPlatforms())return null;var e=[];return this._checkOption("standalone")||e.push(a.createElement("span",{className:"btn btn-label",key:"social-buttons-label"},n.gettext("Partager aussi sur :"))),e.push(this._getPlatforms().map(function(e,t){return a.createElement(o,{key:e.name+"_"+t,platform:e.name,allowed:this._isPlatformAllowed(e.name),enabled:this._isPlatformEnabled(e.key),registered:this._isPlatformRegistered(e.name),togglePlatformBtn:this._togglePlatformBtn.bind(this,e)})}.bind(this))),e},_renderGGPlus:function(){this._checkOption("standalone")||"undefined"==typeof gapi||gapi.interactivepost.render("share-btn-publish-google",{contenturl:this.props.data.URL,clientid:googleplus.getAppData().client_id,cookiepolicy:googleplus.getAppData().cookie_policy,calltoactionlabel:"LISTEN",calltoactionurl:this.props.data.URL+"?autoplay",requestvisibleactions:googleplus.getAppData().request_visible_actions})},_setClipboardUrl:function(){this._checkOption("standalone")||clipboard.getUrl(this.props.type,this.props.id,function(e){this._clipboardUrl=e}.bind(this))},_instantiateZC:function(){copyToClipboard(this.refs.copyToClipboard.getDOMNode(),this._getClipboardUrl(),n.gettext("L'URL a bien été copiée."))},_onEmbedClick:function(){var e=sharebox.idToType(this.props.type);"song"===e&&(e="tracks"),window.open(SETTING_HOST_DEVELOPERS+"/musicplugins/player?type="+encodeURIComponent(e)+"&id="+encodeURIComponent(this.props.id))},_resizeView:function(){this._checkOption("standalone")&&(clearTimeout(this._resizeViewTimeoutFn),this._resizeViewTimeoutFn=setTimeout(function(){window.resizeTo(450,document.getElementById("modal_sharebox").offsetHeight)},this._resizeViewDelayMs))}});t.exports=p},{"../../../core/i18n":98,"../../common/Thumbnail":33,"./_elements/FriendsView":69,"./_elements/NavTab":70,"./_elements/ShareButton":72,"./_elements/SocialButton":73,classnames:"classnames","react/addons":"react/addons"}],73:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("classnames"),n=a.createClass({displayName:"SocialButton",getInitialState:function(){return{enabled:this.props.enabled}},render:function(){if(!this.props.allowed)return null;var e={btn:!0,"btn-share":!0,active:this.state.enabled&&this.props.registered};e[this.props.platform]=!0;var t=i(e);return a.createElement("button",{className:t,type:"button",onClick:this._togglePlatformBtn})},_togglePlatformBtn:function(){return this.props.registered?void this.setState({enabled:!this.state.enabled},this.props.togglePlatformBtn):this.props.togglePlatformBtn()}});t.exports=n},{classnames:"classnames","react/addons":"react/addons"}],72:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("classnames"),n=e("../../../../core/i18n"),r=a.createClass({displayName:"ShareButton",getInitialState:function(){return{shared:!1}},render:function(){var e=i({btn:!0,"btn-large":!0,"btn-primary":!0});return a.createElement("div",{className:"notice"},a.createElement("button",{className:e,disabled:!this.props.enabled||this.state.shared,onClick:this._shareElement},a.createElement("span",{className:"label"},n.gettext("Partager"))),a.createElement("button",{id:"share-btn-publish-google",className:"none"}))},_shareElement:function(){this.props.enabled&&this.setState({shared:!0},function(){this.props.shareElement()}.bind(this))}});t.exports=r},{"../../../../core/i18n":98,classnames:"classnames","react/addons":"react/addons"}],70:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("classnames"),n=a.createClass({displayName:"NavTab",render:function(){var e=i({"share-nav-tabs":!0,selected:this.props.context===this.props.type});return a.createElement("a",{className:e,onClick:this._switchCurrentTab},this.props.text)},_switchCurrentTab:function(e){e.preventDefault(),this.props.context!==this.props.type&&this.props.switchCurrentTab(this.props.type)}});t.exports=n},{classnames:"classnames","react/addons":"react/addons"}],69:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("classnames"),n=e("../../../../core/i18n"),r=e("./FriendCell"),l=e("./SelectedCell"),o=a.createClass({displayName:"FriendsView",getInitialState:function(){return{current:0,filter:"",filtered:[],loader:!0}},componentDidUpdate:function(e){this.props.visible&&this.props.visible!==e.visible&&(this.refs.inputFilterFriends.getDOMNode().focus(),this.state.filtered.length||this.props.friends.length||!this._isGetFriendsListAllowed()||this._getFriendsList()),this.props.visible!==e.visible||this._isGetFriendsListAllowed()||this.state.filtered.length||!this.props.friends.length||this.state.filter.length||this.setState({filtered:this.props.friends})},render:function(){var e=i({"share-friends-container":!0,visible:this.props.visible}),t=parseInt(this.props.selected.length,10),s=null,o=this.props.max;if(this.props.standalone&&(o/=2),t>=parseInt(o+1,10)){var c=i({"friend-hover friends-more":!0,"cell-limit":Boolean(t-o>=10)});s=a.createElement("div",{className:"friend-thumbnail friend-removable",onClick:this._displaySelectedFriends},a.createElement("span",{className:c},"+"+(t-o>=100?99:t-o)))}return a.createElement("div",{className:e},a.createElement("form",{className:"share-friends-form",autoComplete:"off",onSubmit:this._handleSubmit},a.createElement("div",{className:"share-friends-filter form-control",id:"friends_filter"},a.createElement("div",{className:"share-friends-selected"+(t?" visible":"")},s,this._sliceSelectedFriends(this.props.selected,o).map(function(e,t){var s=this._getSelectedFriendData(e);return s?a.createElement(l,{key:"s_"+e+"_"+t,data:s,standalone:this.props.standalone,toggleFriend:this._toggleFriend}):null}.bind(this))),a.createElement("input",{id:"friends_input",type:"text",ref:"inputFilterFriends",value:this.state.filter,className:"share-friends-input form-control form-control-transparent",placeholder:n.gettext("Rechercher")+"...",onKeyUp:this._handleSearchNavigation,onChange:this._handleSearchChanged,autoComplete:"off"})),a.createElement("div",{ref:"friendsList",className:"share-friends-list",onScroll:this._displayMoreFriends},a.createElement("div",{className:"friends-loader",style:{display:this.state.loader?"block":"none"}}),this.state.filtered.slice(0,this.props.display).map(function(e,t){return a.createElement(r,{key:"f_"+e.USER_ID+"_"+t,data:e,selected:this._isFriendSelected(t),checked:this._isFriendChecked(e.USER_ID),toggleFriend:this._toggleFriend})}.bind(this)))))},_allowGetFriendsList:!0,_handleSubmit:function(e){e.preventDefault()},_handleSearchChanged:function(e){var t=e.target.value;return this.setState({current:0,filter:t,filtered:this._filterFriends(this.props.friends,t)},function(){this.refs.friendsList.getDOMNode().scrollTop=0}.bind(this)),!0},_handleSearchNavigation:function(e){e.preventDefault();var t=e.keyCode,s=this._getNavKeys()[t],a=0,i=this.refs.friendsList.getDOMNode(),n=this.refs.friendsContainer.getDOMNode();if("undefined"==typeof s)return!1;switch(s){case"enter":return this.state.filtered.length?(this._toggleFriend(this.state.filtered[this.state.current].USER_ID),!0):!1;case"arrowRight":if(a=this.state.current+1,a>this.state.filtered.length-1)return!1;break;case"arrowLeft":if(a=this.state.current-1,0>a)return!1;break;case"arrowTop":a=Math.max(0,this.state.current-6);break;case"arrowBottom":a=Math.min(this.state.filtered.length-1,this.state.current+6)}return this.setState({current:a},function(){var e=n.querySelector("span.selected");e&&(i.scrollTop=e.getBoundingClientRect().top-n.getBoundingClientRect().top-10)}),!0},_sliceSelectedFriends:function(e,t){if(e.length<=t)return e;var s=e.length-t,a=e.length-1;return(1===s||a>t&&a<e.length)&&(a=e.length),e.slice(s,a)},_removeLastFriend:function(){this.props.removeLastFriend()},_filterFriends:function(e,t){if(!t)return e;t=t.toLowerCase().trim();for(var s=[],a=-5,i=0,n=e.length;n>i;++i){var r=(e[i].BLOG_NAME||"").toLowerCase().trim(),l=(e[i].FIRSTNAME||"").toLowerCase().trim(),o=(e[i].LASTNAME||"").toLowerCase().trim(),c=r.indexOf(t)+l.indexOf(t)+o.indexOf(t)+(l+" "+o).indexOf(t)+(o+" "+l).indexOf(t);c>a&&s.push(e[i])}return s},_isFriendSelected:function(e){return Boolean(e===this.state.current)},_isFriendChecked:function(e){return Boolean(-1!==this.props.selected.indexOf(e))},_getSelectedFriendData:function(e){for(var t=this.props.friends,s=0,a=t.length;a>s;++s)if(t[s].USER_ID===e)return t[s];return null},_setGetFriendsListAllowStatus:function(e){this._allowGetFriendsList=Boolean(e)},_setFriendsDisplayShareName:function(e){if(!e.length)return e;for(var t=0,s=e.length;s>t;++t)e[t].DISPLAY_SHARE_NAME=(e[t].FIRSTNAME||"").length+(e[t].LASTNAME||"").length!==0?((e[t].FIRSTNAME||"")+" "+(e[t].LASTNAME||"")).trim():e[t].BLOG_NAME;return e},_isGetFriendsListAllowed:function(){return this._allowGetFriendsList},_getFriendsList:function(){this._setGetFriendsListAllowStatus(!1),api.call("friend.getList",{start:0,nb:2e3,user_id:USER.USER_ID},function(e){this.setState({loader:!1},function(){e.count&&this.props.updateFriendsList(this._setFriendsDisplayShareName(e.data))})}.bind(this))},_getNavKeys:function(){return{13:"enter",37:"arrowLeft",38:"arrowTop",39:"arrowRight",40:"arrowBottom"}},_displayMoreFriends:function(){var e=this.refs.friendsList.getDOMNode();e.scrollHeight===e.scrollTop+e.clientHeight&&this.props.displayMoreFriends()},_displaySelectedFriends:function(e){e.preventDefault()},_toggleFriend:function(e){this.props.toggleFriend(e);var t=this.refs.inputFilterFriends.getDOMNode().value,s={filter:"",filtered:this.props.friends};t.length&&(s.current=0),this.setState(s,function(){0===s.current&&(this.refs.friendsList.getDOMNode().scrollTop=0)}.bind(this))}});t.exports=o},{"../../../../core/i18n":98,"./FriendCell":68,"./SelectedCell":71,classnames:"classnames","react/addons":"react/addons"}],71:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("jquery"),n=e("../../../common/Thumbnail"),r=a.createClass({displayName:"SelectedCell",componentDidMount:function(){this.props.standalone||i(this.refs["tipsyFriend_"+this.props.data.USER_ID].getDOMNode()).tipsy({gravity:"s",delayIn:10,delayOut:10,z_index:1e4})},render:function(){return a.createElement("a",{role:"button",className:"friend-thumbnail friend-removable",title:this.props.data.DISPLAY_SHARE_NAME,ref:"tipsyFriend_"+this.props.data.USER_ID,onClick:this._toggleFriend},a.createElement(n,{id:Number(this.props.data.USER_ID),md5:this.props.data.USER_PICTURE,overlay:!1,rounded:!0,type:"user",height:22,width:22}),a.createElement("div",{className:"friend-hover"},a.createElement("span",{className:"icon icon-cancel"})))},_toggleFriend:function(e){e.preventDefault(),this.props.standalone||i(this.refs["tipsyFriend_"+this.props.data.USER_ID].getDOMNode()).tipsy("hide"),this.props.toggleFriend(this.props.data.USER_ID)}});t.exports=r},{"../../../common/Thumbnail":33,jquery:"jquery","react/addons":"react/addons"}],68:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("classnames"),n=e("../../../common/Thumbnail"),r=a.createClass({displayName:"FriendsCell",render:function(){var e=i({"friend-item":!0,selected:this.props.selected}),t=i({"friend-hover":!0,check:this.props.checked});return a.createElement("a",{className:e,onClick:this._toggleFriend},a.createElement("span",{className:"friend-thumbnail"},a.createElement(n,{id:Number(this.props.data.USER_ID),md5:this.props.data.USER_PICTURE,overlay:!1,rounded:!0,type:"user",height:44,width:44}),a.createElement("span",{className:t},a.createElement("span",{className:"icon icon-add"}),a.createElement("span",{className:"icon icon-check"}),a.createElement("span",{className:"icon icon-cancel"}))),a.createElement("p",{className:"friend-infos ellipsis"},this.props.data.DISPLAY_SHARE_NAME))},_toggleFriend:function(e){e.preventDefault(),this.props.toggleFriend(this.props.data.USER_ID)}});t.exports=r},{"../../../common/Thumbnail":33,classnames:"classnames","react/addons":"react/addons"}],63:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("classnames"),n=e("../../../core/i18n"),r=e("./_elements/Create"),l=e("./_elements/Suggest"),o=e("./_elements/Tags"),c=a.createClass({displayName:"PlaylistAssistant",propTypes:{type:a.PropTypes.string.isRequired,playlist_id:a.PropTypes.number,sng_id:a.PropTypes.array,playlist_data:a.PropTypes.object,song_data:a.PropTypes.object},getDefaultProps:function(){return{playlist_id:null,sng_id:[],type:null,playlist_data:{},song_data:{}}},getInitialState:function(){return{creation:"create"===this.props.type,suggest:"suggest"===this.props.type,suggest_empty:!1,tag:gatekeeper.isAllowed("playlist_assistant")&&"create"===this.props.type&&0===this.props.sng_id.length&&0===this.props.playlist_id,playlist_id:this.props.playlist_id,submit_disabled:!1,close_action:!1,tag_list:[],addedTrack:0}},componentDidMount:function(){Events.trigger(Events.tips.close,"playlist_assistant"),window.context_menu.close(),Events.subscribe(Events.playlist.assistantNextStep,this._nextStep),Events.subscribe(Events.playlist.assistantToggleValidation,this._toggleButtonStatus),Events.subscribe(Events.playlist.assistantSuggestEmpty,this._emptySuggest),Events.subscribe(Events.playlist.assistantAddedTrack,this._setAddedTrack)},componentWillUnmount:function(){Events.trigger(Events.tips.close,"playlist_assistant_suggest"),Events.unsubscribe(Events.playlist.assistantNextStep,this._nextStep),Events.unsubscribe(Events.playlist.assistantToggleValidation,this._toggleButtonStatus),Events.unsubscribe(Events.playlist.assistantSuggestEmpty,this._emptySuggest),Events.unsubscribe(Events.playlist.assistantAddedTrack,this._setAddedTrack)},render:function(){return a.createElement("div",{className:"modal-playlist-assistant",role:"dialog","aria-labelledby":"playlist-assistant-header"},a.createElement("div",{className:"modal-header",id:"playlist-assistant-header"},this._getTitle()),this._renderBody(),a.createElement("div",{className:"modal-footer"},this._renderCancelButton(),this._renderAddedTracks(),this._renderSubmitButton()))},_onSubmit:function(e){return this.state.submit_disabled?void e.preventDefault():void Events.trigger(Events.playlist.assistantValidation,{})},_onClose:function(){modal.close()},_getTitle:function(){return n.gettext(this.state.creation?0===this.props.playlist_id?"Créer une playlist":"Éditer la playlist":"Suggestions de titres")},_renderCancelButton:function(){return this.state.creation?a.createElement("button",{className:"btn btn-default pull-left",type:"button",onClick:this._onClose},a.createElement("span",{className:"label"},n.gettext("Annuler"))):!1},_renderAddedTracks:function(){return this.state.creation||this.state.suggest_empty?null:a.createElement("h5",{className:"heading-5 notice"},this.state.addedTrack+" ",n.ngettext("titre sélectionné","titres sélectionnés",{count:this.state.addedTrack}))},_setAddedTrack:function(e,t){this.setState({addedTrack:t.nb})},_renderSubmitButton:function(){var e=i({"btn btn-primary pull-right":!0,disabled:this.state.submit_disabled}),t=n.gettext("Terminé !");if(this.state.creation&&(t=n.gettext("Créer"),this.props.playlist_id>0?t=n.gettext("Enregistrer"):this.state.tag&&(t=n.gettext("Passer"))),this.state.suggest_empty){if(!this.state.close_action)return!1;t=n.gettext("Fermer")}return a.createElement("button",{id:"modal_playlist_assistant_submit",type:"button",className:e,onClick:this._onSubmit},a.createElement("span",{className:"label"},t))},_renderBody:function(){return this.state.creation?this.state.tag?a.createElement(o,null):a.createElement(r,{playlist_data:this.props.playlist_data,song_data:this.props.song_data,playlist_id:this.props.playlist_id,sng_id:this.props.sng_id,tags:this.state.tag_list}):a.createElement(l,{playlist_id:this.state.playlist_id})},_toggleButtonStatus:function(){this.setState({submit_disabled:!this.state.submit_disabled})},_nextStep:function(e,t){this.setState({tag:!1,tag_list:t.tags})},_emptySuggest:function(e,t){this.setState({suggest_empty:!0,close_action:t.close})}});t.exports=c},{"../../../core/i18n":98,"./_elements/Create":64,"./_elements/Suggest":65,"./_elements/Tags":66,classnames:"classnames","react/addons":"react/addons"}],66:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("jquery"),n=e("../../../../core/i18n"),r=e("../../../common/TagList"),l=a.createClass({displayName:"Tags",componentDidMount:function(){Events.subscribe(Events.playlist.assistantValidation,this._onSubmit),Events.subscribe(Events.tag.select,this._onSubmit),window.setTimeout(function(){i(this.refs.scroll.getDOMNode()).nanoScroller()}.bind(this),0)},componentWillUnmount:function(){Events.unsubscribe(Events.playlist.assistantValidation,this._onSubmit),Events.unsubscribe(Events.tag.select,this._onSubmit)},render:function(){return a.createElement("div",{className:"modal-body playlist-assistant-tags"},a.createElement("div",{className:"playlist-content"},a.createElement("h2",{className:"heading-4"},n.gettext("Choisissez un tag ou passez à l'étape suivante :")),a.createElement("div",{className:"tag-list-container nano",ref:"scroll"},a.createElement("div",{className:"nano-content"},a.createElement(r,{link:!1,tags:userData.data.USER_TAGS.data,max:userData.data.USER_TAGS.total})))))},_onSubmit:function(e,t){Events.trigger(Events.playlist.assistantNextStep,{tags:null==t.tag?[]:[t.tag.substr(1)]})}});t.exports=l},{"../../../../core/i18n":98,"../../../common/TagList":32,jquery:"jquery","react/addons":"react/addons"}],65:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("../../../../core/i18n"),n=e("../../../common/Thumbnail"),r=a.createClass({displayName:"Suggest",propTypes:{playlist_id:a.PropTypes.number.isRequired},getDefaultProps:function(){return{playlist_id:0}},getInitialState:function(){return{track_list:null,track_index:0}},componentDidMount:function(){Events.subscribe(Events.playlist.assistantValidation,this._onSubmit),Events.subscribe(Events.player.tracklist_changed,this._onPlaySuggest),this._displaySong()},componentWillUnmount:function(){(this._dislikedSong.length>0||this._likedSong.length>0)&&api.call({method:"deezer.playlist_assistant",data:{playlist_id:this.props.playlist_id,liked_tracks:this._likedSong,banned_tracks:this._dislikedSong,nb:0}}),this._playedSuggest&&dzPlayer.restoreTrackList(),Events.unsubscribe(Events.playlist.assistantValidation,this._onSubmit),Events.unsubscribe(Events.player.tracklist_changed,this._onPlaySuggest)},render:function(){if(null===this.state.track_list)return a.createElement("div",{className:"modal-body playlist-assistant-suggest"});if(0===this.state.track_list.length)return a.createElement("div",{className:"modal-body playlist-assistant-suggest"},a.createElement("div",{className:"playlist-content"},a.createElement("div",{className:"placeholders-img nocontent"}),a.createElement("div",{className:"placeholders-title"},i.gettext("Désolé..."),a.createElement("div",{className:"placeholders-title"},i.gettext(0===this._trackListGroup?"Nous n'avons pas encore de suggestions pour vous. Écoutez de la musique et revenez plus tard !":"Nous n'avons plus de suggestions en stock, revenez plus tard !")),this._trackListGroup>0&&this._nbAddedTrack>0?a.createElement("button",{className:"btn btn-primary",type:"button",onClick:this._onPlayPlaylist},a.createElement("span",{className:"label"},i.gettext("Écouter la playlist"))):!1)));var e=this.state.track_list[this.state.track_index];return a.createElement("div",{className:"modal-body playlist-assistant-suggest"},a.createElement("div",{className:"suggest-headings"},a.createElement("h2",{className:"heading-4"},i.gettext("Voici des suggestions basées sur vos écoutes et notre sélection éditoriale :")),a.createElement("h5",{className:"heading-5-sub"},gettext("Vous pouvez toujours rechercher et ajouter des titres manuellement."))),a.createElement("div",{className:"playlist-content clearfix"},a.createElement("div",{className:"thumbnail-bg"},a.createElement(n,{type:"track",height:250,width:250,id:Number(e.SNG_ID),play_data:[e],md5:e.ALB_PICTURE,play:!0,play_force:!0,cover_link:!1,context:"track_assistant"})),a.createElement("div",{className:"playlist-info"},a.createElement("h2",{className:"heading-2 ellipsis",title:e.SNG_TITLE},e.SNG_TITLE),a.createElement("h3",{className:"heading-2-sub ellipsis"},i.gettext("par")+" "+e.ART_NAME),a.createElement("a",{className:"suggest-action",onClick:this._dislike,role:"button"},a.createElement("span",{className:"icon-64 icon-stack icon-stack-circle icon-stack-cancel"},a.createElement("span",{className:"icon icon-light icon-cancel"}))),a.createElement("a",{className:"suggest-action",onClick:this._like,role:"button"},a.createElement("span",{className:"icon-64 icon-stack icon-stack-circle icon-stack-check"},a.createElement("span",{className:"icon icon-light icon-check"}))))))},_onSubmit:function(){this._nbAddedTrack>0&&Events.trigger(Events.playlist.assistantSuggestFinish,{count:this._nbAddedTrack}),modal.close()},_onPlayPlaylist:function(){dzPlayer.play({type:"playlist",id:this.props.playlist_id})},_onPlaySuggest:function(){"track_assistant"===dzPlayer.getContext("TYPE")&&(this._playedSuggest=!0)},_likedSong:[],_dislikedSong:[],_nbAddedTrack:0,_trackListGroup:0,_playedSuggest:!1,_like:function(){this._likedSong.push(this.state.track_list[this.state.track_index].SNG_ID),userData.addPlaylistSong(this.props.playlist_id,[[this.state.track_list[this.state.track_index].SNG_ID,0]],{notify:!1}),this._nbAddedTrack++,Events.trigger(Events.playlist.assistantAddedTrack,{nb:this._nbAddedTrack}),this._displaySong()},_dislike:function(){this._dislikedSong.push(this.state.track_list[this.state.track_index].SNG_ID),this._displaySong()},_displaySong:function(){null===this.state.track_list||this.state.track_list.length-1===this.state.track_index?api.call({method:"deezer.playlist_assistant",data:{playlist_id:this.props.playlist_id,liked_tracks:this._likedSong,banned_tracks:this._dislikedSong},success:function(e){this._likedSong=[],this._dislikedSong=[],this._trackListGroup++,0===e.data.length&&Events.trigger(Events.playlist.assistantSuggestEmpty,{close:0===this._trackListGroup}),this.setState({track_index:0,track_list:e.data},this._displaySongCallback)}.bind(this)}):this.setState({track_index:this.state.track_index+1},this._displaySongCallback)},_displaySongCallback:function(){4===this.state.track_index&&Events.trigger(Events.tips.draw,{name:"playlist_assistant_suggest",check:!0});var e=this.state.track_list[this.state.track_index];this._playedSuggest&&dzPlayer.play({type:"track",autoplay:dzPlayer.playing,id:e.SNG_ID,saveCurrentTrackList:!1,context:{ID:e.SNG_ID,TYPE:"track_assistant"},data:[e]})}});t.exports=r},{"../../../../core/i18n":98,"../../../common/Thumbnail":33,"react/addons":"react/addons"}],64:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("classnames"),n=e("../../../../core/i18n"),r=e("../../../common/Thumbnail"),l=a.createClass({displayName:"Create",propTypes:{playlist_id:a.PropTypes.number.isRequired,sng_id:a.PropTypes.array,tags:a.PropTypes.array,playlist_data:a.PropTypes.object,song_data:a.PropTypes.object},getDefaultProps:function(){return{playlist_id:0,sng_id:[],tags:[],playlist_data:{},song_data:{}}},getInitialState:function(){return{is_private:1===Number(this.props.playlist_data.STATUS)||3===Number(this.props.playlist_data.STATUS),is_collab:2===Number(this.props.playlist_data.STATUS)||3===Number(this.props.playlist_data.STATUS),title:this.props.playlist_data.TITLE||this._getDefaultTitle(),description:this.props.playlist_data.DESCRIPTION||"",playlist_picture:this.props.playlist_data.PLAYLIST_PICTURE,playlist_picture_type:this.props.playlist_data.PICTURE_TYPE,playlist_picture_data:!1,title_error:!1}},componentDidMount:function(){Events.subscribe(Events.playlist.assistantValidation,this._onSubmit),Events.subscribe(Events.playlist.updatePicture,this._onUpdatePicture)},componentWillUnmount:function(){Events.unsubscribe(Events.playlist.assistantValidation,this._onSubmit),Events.unsubscribe(Events.playlist.updatePicture,this._onUpdatePicture)},render:function(){var e=i({"form-control form-control-block playlist-description":!0,open:""===this.state.description?!1:this.state.description.length>0}),t=i({"playlist-info":!0,"has-error":this.state.title_error});return a.createElement("div",{className:"modal-body playlist-assistant-create"},a.createElement("div",{className:"playlist-content clearfix"},a.createElement(r,{id:this.props.playlist_id,type:"playlist",md5:this.state.playlist_picture,picture_type:this.state.playlist_picture_type,height:200,width:200,height_img:200,width_img:200,bordered:!0,upload_cover:!0,multi_cover:!0,data_uri:this.state.playlist_picture_data}),a.createElement("input",{className:"hide",accept:"image/*",id:"naboo_playlist_image_upload",name:"file",type:"file"}),a.createElement("div",{className:t},a.createElement("h2",{className:"heading-4"},n.gettext(0===this.props.playlist_id?"Pour lui donner un nom, c'est par ici :":"Pour changer son nom, c'est par ici :")),a.createElement("input",{className:"form-control form-control-block",type:"text",maxLength:"50",placeholder:n.gettext("Nom de la playlist"),onChange:this._onChangeTitle,value:this.state.title}),this.state.title_error?a.createElement("div",{className:"alert alert-danger"},n.gettext("Votre playlist mérite d'avoir un nom !")):!1,a.createElement("div",{className:"form-inline"},a.createElement("div",{className:"form-group"},a.createElement("span",{className:"form-checkbox playlist-option"},a.createElement("label",{htmlFor:"private"},a.createElement("input",{id:"private",type:"checkbox",checked:this.state.is_private,onChange:this._onChangePrivate}),n.gettext("Privée"))),a.createElement("span",{className:"form-checkbox playlist-option"},a.createElement("label",{htmlFor:"collab"},a.createElement("input",{id:"collab",type:"checkbox",checked:this.state.is_collab,onChange:this._onChangeCollab}),n.gettext("Collaborative")),this.state.is_collab&&0!==this.props.playlist_id?a.createElement("input",{className:"form-control form-collab",type:"text",readOnly:"readonly",onClick:this._onSelectInput,value:SETTING_HOST_SITE+"/sharedplaylist-"+this.props.playlist_id+"-"+this.props.playlist_data.COLLAB_KEY}):!1))))),a.createElement("div",{className:"playlist-content"},a.createElement("h2",{className:"heading-4"},n.gettext("Parlez-nous un peu de cette playlist...")),a.createElement("textarea",{name:"playlist-description",maxLength:"200",className:e,placeholder:n.gettext("Saisir une description (optionnel)"),onChange:this._onChangeDescription,value:this.state.description})))},_onUpdatePicture:function(e,t){return"base64"===t.type?(this.setState({playlist_picture_data:t.data}),!0):0===this.props.playlist_id?(www.navigate("/playlist/"+t.element_id),modal.close(),!0):void this.setState({playlist_picture:t.md5,playlist_picture_type:t.type})},_onChangePrivate:function(e){this.setState({is_private:e.target.checked})},_onChangeCollab:function(e){this.setState({is_collab:e.target.checked})},_onChangeTitle:function(e){this.setState({title:e.target.value})},_onChangeDescription:function(e){this.setState({description:e.target.value})},_onSelectInput:function(e){e.target.select()},_onSubmit:function(){if(this.setState({title_error:""===window.trim(this.state.title)}),""===window.trim(this.state.title))return!1;Events.trigger(Events.playlist.assistantToggleValidation);var e=0;this.state.is_collab&&(e+=2),this.state.is_private&&(e+=1);var t="";this.state.description&&(t+=this.state.description);var s={title:window.trim(this.state.title),description:t,status:e};if(0===this.props.playlist_id){if(s.tags=this.props.tags,this.props.sng_id.length>0){s.songs=[];for(var a=0;a<this.props.sng_id.length;a++)s.songs[a]=[this.props.sng_id[a],this.props.sng_id[a]>0?0:1]}userData.createPlaylist(s,this._validateCallback)}else s.playlist_id=this.props.playlist_id,userData.updatePlaylist(s,this._validateCallback)},_getDefaultTitle:function(){var e="";if(1===this.props.tags.length){for(var t=this.props.tags[0],s=t.split("_"),a=0;a<s.length;a++)s[a]=window.ucfirst(s[a]);e=s.join(" ")}return this.props.sng_id.length>0&&(e=this.props.song_data.ART_NAME),e},_validateCallback:function(e){if("string"==typeof e){if(this.state.playlist_picture_data!==!1)return Events.trigger(Events.playlist.uploadPicture,{id:e}),!1;www.navigate("/playlist/"+e)}return modal.close(),!1}});t.exports=l},{"../../../../core/i18n":98,"../../../common/Thumbnail":33,classnames:"classnames","react/addons":"react/addons"}],62:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("../../../common/Thumbnail"),n=e("../../../common/TagList"),r=a.createClass({displayName:"CuratorTagging",propTypes:{item:a.PropTypes.object.isRequired,type:a.PropTypes.oneOf(["song","artist","album"]).isRequired,itemTags:a.PropTypes.array.isRequired,allTags:a.PropTypes.arrayOf(a.PropTypes.shape({TAG_ID:a.PropTypes.string.isRequired,TAG_NAME:a.PropTypes.string.isRequired,TAG_TYPE:a.PropTypes.string.isRequired})).isRequired,hiddenCategories:a.PropTypes.array},getDefaultProps:function(){return{hiddenCategories:["audio_content"]}},getInitialState:function(){return{itemTags:this.props.itemTags,filter:"",category:""}},componentDidMount:function(){Events.subscribe(Events.tag.select,this._onSelect)},componentWillUnmount:function(){Events.unsubscribe(Events.tag.select,this._onSelect)},render:function(){return a.createElement("section",{id:"modal_edit_tag"},this._renderHeader(),a.createElement("div",{className:"modal-body"},a.createElement("div",{className:"wrapper"},this._renderItemInfos(),this._renderSelected(),this._renderForm())),this._renderFooter())},_renderHeader:function(){return a.createElement("header",null,a.createElement("h1",{className:"modal-header"},"Edit tags"))},_renderFooter:function(){return a.createElement("footer",{className:"modal-footer"},a.createElement("div",{className:"action"},a.createElement("button",{className:"btn btn-default",type:"button",role:"button",onClick:this._onCancelClick},a.createElement("span",{className:"label"},"Cancel")),a.createElement("button",{className:"btn btn-primary",type:"button",role:"button",onClick:this._onSaveClick},a.createElement("span",{className:"label"},"Save"))))},_renderItemInfos:function(){var e=this._getPictureInfo();return a.createElement("div",{className:"wrapper-table track-infos"},a.createElement("div",{className:"cell cell-thumbnail"},a.createElement(i,{id:e.id,type:e.type,md5:e.md5,height:120,width:120})),a.createElement("div",{className:"cell cell-infos"},a.createElement("div",{className:"heading-2"},a.createElement("div",{className:"ellipsis"},this._getTitle())),a.createElement("div",{className:"heading-2-sub ellipsis",id:"share-subtitle"},this._getSubTitle()),a.createElement(n,{tags:this._getTrackInfosTags(),link:!1,max:1/0,type:"text"})))},_renderSelected:function(){return 0===this.state.itemTags.length?null:[a.createElement("div",{key:"header",className:"heading-3"},"Selected tags"),a.createElement("div",{key:"header-sub",className:"heading-3-sub"},"(may not yet be visible on the site)"),a.createElement("div",{key:"list",className:"wrapper"},a.createElement("div",{className:"selected-tag-list"},this._renderSelectedList()))]},_renderForm:function(){return a.createElement("form",{className:"form-horizontal",role:"form"},a.createElement("div",{className:"heading-3"},"Add tags"),a.createElement("div",{className:"form-group"},a.createElement("label",{className:"control-label",htmlFor:"modal_edit_tag_filter"},"Filter"),a.createElement("input",{id:"modal_edit_tag_filter",type:"search",className:"form-control",onChange:this._onFilterChange,value:this.state.filter})),a.createElement("div",{className:"form-group"},a.createElement("label",{className:"control-label",htmlFor:"modal_edit_tag_categories"},"Category"),a.createElement("div",{className:"form-controls"},this._renderCategoryList())),a.createElement("div",{className:"wrapper"},a.createElement("div",{className:"full-tag-list"},this._renderTagList())))},_renderCategoryList:function(){var e=this.props.allTags.map(function(e){return e.TAG_TYPE});return e=e.reduce(function(e,t){return-1===e.indexOf(t)?e.concat([t]):e},[]),e=e.filter(function(e){return-1===this.props.hiddenCategories.indexOf(e)}.bind(this)),e=e.map(function(e){return a.createElement("option",{key:e,value:e},e)}),e.unshift(a.createElement("option",{key:"all",value:""},"All categories")),a.createElement("select",{id:"modal_edit_tag_categories",className:"form-control",value:this.state.category,onChange:this._onCategoryChange},e)},_renderSelectedList:function(){for(var e,t=[],s=0,i=this.state.itemTags.length;i>s;s++)e=this._getTagFromLabel(this.state.itemTags[s]),"undefined"!=typeof e&&t.push({LABEL:e.TAG_NAME});return a.createElement(n,{tags:t,max:1/0,link:!1,selected:!0,onRemove:this._onRemove})},_renderTagList:function(){for(var e=this._filterTags(this.props.allTags),t=[],s=0,i=e.length;i>s;s++)t.push({LABEL:e[s].TAG_NAME});return a.createElement(n,{tags:t,max:1/0,link:!1})},_onCategoryChange:function(e){this.setState({category:e.target.value})},_onFilterChange:function(e){this.setState({filter:e.target.value})},_onSelect:function(e,t){"text"!==t.source.props.type&&this._selectTag(t.tag)},_onRemove:function(e){this._unselectTag(e)},_onCancelClick:function(e){e.preventDefault(),modal.close()},_onSaveClick:function(e){e.preventDefault();for(var t,s={},a=0,i=this.state.itemTags.length;i>a;a++)this.state.itemTags.hasOwnProperty(a)&&(t=this.state.itemTags[a],s[t]=this._getTagFromLabel(t).TAG_ID);api.call({method:"tag_edito.updateAll",data:{ELEM_ID:this._getId(),TAG_LIST:s,TYPE:this.props.type+"s"}}),modal.close()},_selectTag:function(e){var t=this.state.itemTags.slice();t.push(e.replace(/ |-/g,"_")),this.setState({itemTags:t})},_unselectTag:function(e){var t=this.state.itemTags.filter(function(t){return t!==e.replace(/ |-/g,"_")});this.setState({itemTags:t})},_filterTags:function(e){var t=window.rewriting(this.state.filter.toLowerCase()),s=this.state.itemTags.map(function(e){return e}),a=e.filter(function(e){return-1!==s.indexOf(e.TAG_NAME.replace(/ |-/g,"_"))||""!==this.state.category&&this.state.category!==e.TAG_TYPE||-1!==this.props.hiddenCategories.indexOf(e.TAG_TYPE)||""!==this.state.filter&&-1===window.rewriting(e.TAG_NAME.toLowerCase()).indexOf(t)?!1:!0}.bind(this));return a},_getTagFromLabel:function(e){for(var t=0,s=this.props.allTags.length;s>t;t++)if(this.props.allTags[t].TAG_NAME.replace(/ |-/g,"_")===e)return this.props.allTags[t]},_getTrackInfosTags:function(){var e=this.props.item.TAGS.filter(function(e){return-1!==this.props.item.BANNED_TAGS.indexOf(e)?!1:!0}.bind(this));return e=e.map(function(e){return{LABEL:this._getTagFromLabel(e).TAG_NAME}}.bind(this)),e=e.concat(this.props.item.BANNED_TAGS.map(function(e){return{LABEL:a.createElement("del",null,this._getTagFromLabel(e).TAG_NAME)}}.bind(this)))},_getTitle:function(){return"song"===this.props.type?this.props.item.SNG_TITLE:"artist"===this.props.type?this.props.item.ART_NAME:"album"===this.props.type?this.props.item.ALB_TITLE:""},_getSubTitle:function(){return"song"===this.props.type||"album"===this.props.type?"by "+this.props.item.ART_NAME:""},_getPictureInfo:function(){return"song"===this.props.type?{id:this._getId(),type:"cover",md5:this.props.item.ALB_PICTURE}:"artist"===this.props.type?{id:this._getId(),type:"artist",md5:this.props.item.ART_PICTURE}:"album"===this.props.type?{id:this._getId(),type:"cover",md5:this.props.item.ALB_PICTURE}:{}},_getId:function(){return"song"===this.props.type?Number(this.props.item.SNG_ID):"artist"===this.props.type?Number(this.props.item.ART_ID):"album"===this.props.type?Number(this.props.item.ALB_ID):0}});t.exports=r},{"../../../common/TagList":32,"../../../common/Thumbnail":33,"react/addons":"react/addons"}],61:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("../../../common/Selectbox"),n=e("../../../../core/i18n"),r=a.createClass({displayName:"CuratorPlaylistEdit",propTypes:{data:a.PropTypes.array},getDefaultProps:function(){return{data:{}}},getInitialState:function(){var e=window.storage.isset("playlist_edit_curator")?window.storage.get("playlist_edit_curator").genre:0,t=this._splitPlaylistData(e);return{available_playlist:t.available,selected_playlist:t.selected,available_filter:"",selected_filter:"",genre:e,sort:"sortTitle"}},componentDidMount:function(){this._idList={},window.setTimeout(function(){this._refreshScrollbar("available"),this._refreshScrollbar("selected")}.bind(this),0)},componentDidUpdate:function(e,t){this.state.available_playlist.length!==t.available_playlist.length&&this._refreshScrollbar("available"),this.state.selected_playlist.length!==t.selected_playlist.length&&this._refreshScrollbar("selected")},componentWillUnmount:function(){this._idList={}},render:function(){return a.createElement("div",null,a.createElement("div",{className:"modal-header"},n.gettext("Taguer par genre")),a.createElement("div",{className:"modal-body"},a.createElement("div",{className:"wrapper"},a.createElement("div",{className:"wrapper-table"},a.createElement("div",{className:"cell"},n.gettext("Choisis un genre :")),a.createElement("div",{className:"cell"},a.createElement("select",{onChange:this._onChangeGenre,value:this.state.genre},this.props.data.map(function(e,t){return a.createElement("option",{key:"genre_"+t,value:Number(e.GENRE_ID)},e.GENRE_NAME)}),a.createElement("option",{key:"private",value:"private"},n.gettext("Playlist privée"))),a.createElement(i,{ref:"selectbox",type:"playlist_curator",position:"",saveOrder:!1,onChange:this._onChangeSort}))),a.createElement("div",{className:"columns"},a.createElement("div",{className:"column column-left"},a.createElement("div",{className:"curator-title"},n.gettext("Playlists disponibles")+" ("+this.state.available_playlist.length+")"),a.createElement("div",{className:"curator-table-search"},a.createElement("form",{className:"form-inline",role:"form"},a.createElement("div",{className:"form-group"},a.createElement("input",{className:"form-control",type:"text",placeholder:n.gettext("Filtrer"),onKeyUp:this._onFilter.bind(this,"available")})),a.createElement("div",{className:"form-group"},a.createElement("span",{className:"icon icon-search"})))),a.createElement("div",{className:"curator-table nano",ref:"available_scroll"},a.createElement("div",{className:"nano-content"},this.state.available_playlist.map(function(e,t){return e.TITLE.toLowerCase().indexOf(this.state.available_filter)>-1?a.createElement("div",{key:"playlist_available_"+t,className:"line line-blue ellipsis",onClick:this._onMove.bind(this,e.PLAYLIST_ID,"left",t)},a.createElement("span",{className:"icon icon-add pull-right"}),a.createElement("span",null,e.TITLE)):!1}.bind(this))))),a.createElement("div",{className:"column column-right"},a.createElement("div",{className:"curator-title"},n.gettext("Playlists par genre")+" ("+this.state.selected_playlist.length+")"),a.createElement("div",{className:"curator-table-search"},a.createElement("form",{className:"form-inline",role:"form"},a.createElement("div",{className:"form-group"},a.createElement("input",{className:"form-control",type:"text",placeholder:n.gettext("Filtrer"),onKeyUp:this._onFilter.bind(this,"selected")})),a.createElement("div",{className:"form-group"},a.createElement("span",{className:"icon icon-search"})))),a.createElement("div",{className:"curator-table nano",ref:"selected_scroll"},a.createElement("div",{className:"nano-content"},this.state.selected_playlist.map(function(e,t){return e.TITLE.toLowerCase().indexOf(this.state.selected_filter)>-1?a.createElement("div",{key:"playlist_selected_"+t,className:"line line-gray ellipsis",onClick:this._onMove.bind(this,e.PLAYLIST_ID,"right",t)},a.createElement("span",{className:"icon icon-add pull-right icon-cancel"}),a.createElement("span",null,e.TITLE)):!1}.bind(this)))))))),a.createElement("div",{className:"modal-footer"},a.createElement("div",{className:"action"},a.createElement("button",{className:"btn btn-default pull-left",type:"button",onClick:this._onClose},a.createElement("span",{className:"label"},n.gettext("Annuler"))),a.createElement("button",{className:"btn btn-primary",type:"button",onClick:this._onSave},a.createElement("span",{className:"label"},n.gettext("Valider"))))))},_onMove:function(e,t,s){var a="left"===t?"available_playlist":"selected_playlist",i="right"===t?"available_playlist":"selected_playlist",n=this.state[a].slice(0),r=this.state[i].slice(0),l=n.splice(s,1);r.push(l[0]),this.setState({selected_playlist:"available_playlist"===a?r:n,available_playlist:"selected_playlist"===i?n:r.sort(this["_"+this.state.sort])}),this._idList[e]="available_playlist"===a},_onFilter:function(e,t){var s={};s[e+"_filter"]=t.target.value.toLowerCase(),this.setState(s,function(){this._refreshScrollbar(e)}.bind(this))},_onChangeGenre:function(e){window.countObject(this._idList)>0&&this._onSave();var t=this._splitPlaylistData(e.target.value);this.setState({genre:e.target.value,available_playlist:t.available,selected_playlist:t.selected,selected_filter:"",available_filter:""}),window.storage.set("playlist_edit_curator",{genre:e.target.value})},_onChangeSort:function(e){this.setState({sort:e,selected_playlist:this.state.selected_playlist.sort(this["_"+e]),available_playlist:this.state.available_playlist.sort(this["_"+e])})},_onSave:function(e){if(0===window.countObject(this._idList))return void(e&&this._onClose());var t=this.state.genre;api.call({method:"deezer.setPlaylistGenre",data:{id_list:this._idList,genre:t},success:function(s){if(s)for(var a in this._idList)if(this._idList.hasOwnProperty(a)){var i={};if("private"===t){if(i.STATUS=Number(this._hashPlaylist[a].STATUS),(1===i.STATUS||3===i.STATUS)&&this._idList[a])continue;if((0===i.STATUS||2===i.STATUS)&&!this._idList[a])continue;i.STATUS+=this._idList[a]?1:-1}else{if(!Array.isArray(this._hashPlaylist[a].GENRE))continue;var n=this._hashPlaylist[a].GENRE.indexOf(t);if(n>-1&&!this._idList[a])this._hashPlaylist[a].GENRE.splice(n,1);else{if(-1!==n||!this._idList[a])continue;this._hashPlaylist[a].GENRE.push(t)}i.GENRE=this._hashPlaylist[a].GENRE}userData.refreshPlaylistData(a,i)}this._idList={},e&&this._onClose()}.bind(this)})},_onClose:function(){window.modal.close()},_idList:{},_hashPlaylist:{},_splitPlaylistData:function(e){for(var t=[],s=[],a=0;a<userData.data.PLAYLISTS.total;a++){var i=userData.data.PLAYLISTS.data[a];this._hashPlaylist[userData.data.PLAYLISTS.data[a].PLAYLIST_ID]=i;var n="private"===e&&(1===Number(i.STATUS)||4===Number(i.STATUS)),r="private"!==e&&Array.isArray(i.GENRE)&&i.GENRE.indexOf(e)>-1;n||r?s.push(i):t.push(i)}return{available:t,selected:s}},_refreshScrollbar:function(e){$(this.refs[e+"_scroll"].getDOMNode()).nanoScroller()},_sortTitle:function(e,t){var s=e.TITLE.toLowerCase().trim(),a=t.TITLE.toLowerCase().trim();return s===a?0:s>a?1:-1},_sortDate:function(e,t){var s=e.DATE_ADD||"0000-00-00 00:00:00",a=t.DATE_ADD||"0000-00-00 00:00:00";return s===a?0:a>s?1:-1}});t.exports=r},{"../../../../core/i18n":98,"../../../common/Selectbox":29,"react/addons":"react/addons"}],29:[function(e,t,s){"use strict";var a=e("react/addons"),i=e("classnames"),n=e("../../core/i18n"),r=a.createClass({displayName:"Selectbox",propTypes:{type:a.PropTypes.oneOf(["album","playlist","playlist_curator"]),position:a.PropTypes.oneOf(["right","left",""]),saveOrder:a.PropTypes.bool,onChange:a.PropTypes.func},getDefaultProps:function(){return{type:"album",position:"right",saveOrder:!0,onChange:function(){}}},getInitialState:function(){return{open:!1}},render:function(){var e=i({selectbox:!0,dropdown:!0,opened:this.state.open,"pull-right":"right"===this.props.position,"pull-left":"left"===this.props.position});return a.createElement("span",{className:e,id:"panel_album_selectbox",ref:"selectbox"},a.createElement("button",{className:"btn btn-default btn-mini dropdown-toggle",type:"button",onClick:this._toggle},a.createElement("span",{className:"icon icon-list"}),a.createElement("span",{className:"icon icon-sort-desc color-primary"})),a.createElement("ul",{className:"dropdown-menu"},this._getElement().map(function(e,t){return a.createElement("li",{key:"selectbox_"+e.type+t},a.createElement("a",{href:"#",onClick:this._onChange.bind(this,e.type)},e.label))}.bind(this))))},_onChange:function(e,t){if(t.preventDefault(),this._sortType=e,this.props.onChange(this._sortType),this.props.saveOrder){var s={};s["sort_panel_"+this.props.type]=this._sortType,userSetting.set({site:s})}},_onClose:function(){document.removeEventListener("click",this._onClose),this.setState({open:!1})},_sortType:"",_getElement:function(){var e={album:[{type:"ART_NAME",label:n.gettext("A - Z (artiste)")},{type:"ALB_TITLE",label:n.gettext("A - Z (album)")},{type:"DATE_CREATE",label:n.gettext("Ajoutés récemment")},{type:"TOP_ALBUM",label:n.gettext("Les plus écoutés")}],playlist:[{type:"PLAYLIST_TITLE",label:n.gettext("A - Z")},{type:"DATE_UPDATE",label:n.gettext("Mises à jour récemment")},{type:"DATE_CREATE",label:n.gettext("Ajoutées récemment")},{type:"PLAYLIST_TYPE",label:n.gettext("Type")},{type:"TOP_PLAYLIST",label:n.gettext("Les plus écoutées")}],playlist_curator:[{type:"sortTitle",label:n.gettext("A - Z")},{type:"sortDate",label:n.gettext("Mises à jour récemment")}]};return e[this.props.type]?e[this.props.type]:[]},_toggle:function(){this.setState({open:!this.state.open},function(){this.state.open&&document.addEventListener("click",this._onClose)}.bind(this))}});t.exports=r},{"../../core/i18n":98,classnames:"classnames","react/addons":"react/addons"}]},{},[2]);;
if(typeof platform=='undefined'){var platform={init:function(){if(typeof PLATFORM_OBJ!=='object'){PLATFORM_OBJ={name:'web'};}
if(PLATFORM_OBJ.name===false){PLATFORM_OBJ.name='web';}
platform.data=PLATFORM_OBJ;},get:function(){return platform.data;}}};
var error={i:0,not_loged_error:{VALID_TOKEN_REQUIRED:true,NEED_USER_AUTH_REQUIRED:true},display:function(e){console.log('ERROR API:',e);console.log(e.name);},log:function(e){if(typeof e!=='object'){return false;}
if(typeof error.not_loged_error[e.name]!=='undefined'){return false;}
error.i+=1;var err={name:'',message:'',description:'',payload:'',stack:''};if(typeof e.name!=='undefined'){err.name=e.name;}
if(typeof e.message!=='undefined'){err.message=e.message;}
if(typeof e.description!=='undefined'){err.description=e.description;}
if(typeof e.payload!=='undefined'&&e.payload!==null){err.payload=e.payload;}
if(typeof e.stack!=='undefined'){err.stack=e.stack;}
live.log.send('app_error',{error:err,nb:error.i});console.log('Error #'+error.i);console.log(err.name);console.log(err.message);console.log(err.description);console.log(err.payload);console.log(err.stack);console.log('');return true;},handle:function(e){error.log(e);error.display(e);return true;}};function dzError(obj){this.name=obj.name||'dzError';this.message=obj.message||'';this.description=obj.description||'';this.payload=obj.payload||null;var e=new Error();this.stack=e.stack;};
(function(){'use strict';if(typeof window.Handlebars==='undefined'){return;}
var isWebview=window.feed&&window.feed.is_webview;Handlebars.registerHelper('thumbnail',function(options){return thumbnails.draw(options);});Handlebars.registerHelper('placeholder',function(options){return placeholder.draw(options);});Handlebars.registerHelper('thumbnail_unavailable_link',function(a){if(typeof a!=='undefined'&&a==='radio'||isWebview){return'javascript:void(0)';}
if(SETTING_LANG==='fr'){return'http://support.deezer.com/hc/fr/articles/201193812-Pourquoi-est-il-impossible-de-trouver-certains-artistes-sur-Deezer-';}
return'http://support.deezer.com/hc/en-gb/articles/201193812-Why-is-impossible-to-find-certain-artists-on-Deezer-';});Handlebars.registerHelper('buttonAction',function(options){return button_multi_state.draw(options);});Handlebars.registerHelper('ifEqual',function(a,b,options){return(a===b)?options.fn():options.inverse();});Handlebars.registerHelper('ifOrEqual',function(a,b,c,options){return(a===b||a===c)?options.fn():options.inverse();});Handlebars.registerHelper('ifNotEqual',function(a,b,options){return(a!==b)?options.fn():options.inverse();});Handlebars.registerHelper('ifOr',function(resp,width,height,options){return(resp||width||height)?options.fn():options.inverse();});Handlebars.registerHelper('isFavorite',function(type,id){var options=arguments[(arguments.length-1)];if(type==='song'){var regex_key=/^(\d+)_(\d{1})$/;if(!regex_key.test(id)){id+='_0';}}
return(userData.isFavorite(type,id))?options.fn():options.inverse();});Handlebars.registerHelper('isCuratorUser',function(options){return gatekeeper.isAllowed('curator_feature')?options.fn(this):options.inverse(this);});Handlebars.registerHelper('drawStackCovers',function(pic_id,type,options){var display_options={playlist:{width:250,height:250,nb:3,cover:'cover'},artist:{width:120,height:250,nb:2,cover:'artist'}};if(typeof pic_id==='undefined'||typeof pic_id!=='string'||typeof type!=='string'||typeof display_options[type]==='undefined'){return false;}
var picture=pic_id.split('-');var data={};data.height=options.hash.height||display_options[type].height;data.width=options.hash.width||display_options[type].width;data.cover=display_options[type].cover;if(picture.length<=1){data.size='250x360';data.width=360;data.height=250;data.pic_id=picture[0];data.img_url=SETTING_DOMAIN_IMG+'/'+data.cover+'/'+data.pic_id+'/'+data.size+'-000000-80-0-0.jpg';return options.inverse(data);}
var ret='';for(var i=display_options[type].nb;i>=0;i--){data.last_cover=(i<=0&&type==='playlist')?'last':'';data.pic_id=picture[i];data.img_url=SETTING_DOMAIN_IMG+'/'+data.cover+'/'+data.pic_id+'/'+data.height+'x'+data.width+'-000000-80-0-0.jpg';ret+=options.fn(data);}
return ret;});Handlebars.registerHelper('setTracking',function(options){var opt=options.hash;var tracking_attr='';if(typeof opt.tracking!=='undefined'&&(typeof opt.tag!=='string')){return tracking_attr;}
tracking_attr+='data-tracking="'+opt.tracking+'"';tracking_attr+=(opt.tag)?'data-tracking-tag="'+opt.tag+'"':'';tracking_attr+=(opt.tracking_id)?'data-tracking-id="'+opt.tracking_id+'"':'';tracking_attr+=(opt.params)?'data-tracking-params="'+opt.params+'"':'';return new Handlebars.SafeString(tracking_attr);});Handlebars.registerHelper('setRadioTypeShare',function(a,b,options){return(typeof a!=='undefined'&&b==='artist')?options.fn():options.inverse();});Handlebars.registerHelper('convertURLToLink',function(str){return(typeof str==='string')?new Handlebars.SafeString(str.convertURLToLink()):'';});Handlebars.registerHelper('toLowerCase',function(str){return(typeof str==='string')?str.toLowerCase():'';});Handlebars.registerHelper('encodeURIComponent',function(str){return(typeof str==='string')?encodeURIComponent(str):'';});Handlebars.registerHelper('toUpperCase',function(str){return(typeof str==='string')?str.toUpperCase():'';});Handlebars.registerHelper('formatDate',function(str){return(typeof str==='string')?formatDate(str):'';});Handlebars.registerHelper('getYear',function(str){return(typeof str==='string')?str.substr(0,4):'';});Handlebars.registerHelper('formatMessage',function(str){str=Handlebars.Utils.escapeExpression(str);var pos;var nb_line=0;var reg=/(\r\n|\n|\r)/;while((pos=str.search(reg))!==-1){nb_line++;str=str.replace(reg,'<br/>');if(nb_line>=8){return new Handlebars.SafeString(str.substr(0,pos));}}
return new Handlebars.SafeString(str);});Handlebars.registerHelper('getRewritingName',function(name){return rewriting(name).toLowerCase();});Handlebars.registerHelper('breakUpThousands',function(str){return breakUpThousands(str);});Handlebars.registerHelper('ifGreater',function(a,b,options){return(a>b)?options.fn():options.inverse();});Handlebars.registerHelper('gettext',function(key,args){if(args.hash){if(args.hash.context){args.hash.context+='';}
return new Handlebars.SafeString(gettext(key,args.hash));}
return new Handlebars.SafeString(gettext(key));});Handlebars.registerHelper('ngettext',function(singular,plural,args){if(!args.hash||arguments.length<3){throw new Error('ngettext helper called with incorrect number of arguments',args.hash);}
if(typeof args.hash.count==='undefined'){throw new Error('ngettext helper called with no "count" attribute',args.hash);}
if(args.hash.context){args.hash.context+='';}
return new Handlebars.SafeString(gettext(singular,args.hash));});function sprintf(){if(arguments.length===0){return'';}
var regex=/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g;var a=arguments;var i=0;var format=a[i++];var pad=function(str,len,chr,leftJustify){chr=chr||' ';str=String(str);var padding=str.length>=len?'':new Array(len-str.length+1).join(chr);return leftJustify?str+padding:padding+str;};var justify=function(value,prefix,leftJustify,minWidth,zeroPad,customPadChar){var diff=minWidth-value.length;if(diff>0){if(leftJustify||!zeroPad){value=pad(value,minWidth,customPadChar,leftJustify);}else{value=value.slice(0,prefix.length)+pad('',diff,'0',true)+value.slice(prefix.length);}}
return value;};var formatBaseX=function(value,base,prefix,leftJustify,minWidth,precision,zeroPad){var number=value>>>0;prefix=prefix&&number&&{2:'0b',8:'0',16:'0x'}[base]||'';value=prefix+pad(number.toString(base),precision||0,'0',false);return justify(value,prefix,leftJustify,minWidth,zeroPad);};var formatString=function(value,leftJustify,minWidth,precision,zeroPad,customPadChar){if(precision!==null){value=value.slice(0,precision);}
return justify(value,'',leftJustify,minWidth,zeroPad,customPadChar);};var doFormat=function(substring,valueIndex,flags,minWidth,_,precision,type){var number;var prefix;var method;var textTransform;var value;if(substring==='%%'){return'%';}
var leftJustify=false;var positivePrefix='';var zeroPad=false;var prefixBaseX=false;var customPadChar=' ';var flagsl=flags.length;for(var j=0;flags&&j<flagsl;j++){switch(flags.charAt(j)){case' ':positivePrefix=' ';break;case'+':positivePrefix='+';break;case'-':leftJustify=true;break;case'\'':customPadChar=flags.charAt(j+1);break;case'0':zeroPad=true;break;case'#':prefixBaseX=true;break;default:break;}}
if(!minWidth){minWidth=0;}else if(minWidth==='*'){minWidth=Number(a[i++]);}else if(minWidth.charAt(0)==='*'){minWidth=Number(a[minWidth.slice(1,-1)]);}else{minWidth=Number(minWidth);}
if(minWidth<0){minWidth=-minWidth;leftJustify=true;}
if(!isFinite(minWidth)){throw new Error('sprintf: (minimum-)width must be finite');}
if(!precision){if('fFeE'.indexOf(type)>-1){precision=6;}else if(type==='d'){precision=0;}}else if(precision==='*'){precision=Number(a[i++]);}else if(precision.charAt(0)==='*'){precision=Number(a[precision.slice(1,-1)]);}else{precision=Number(precision);}
value=valueIndex?a[valueIndex.slice(0,-1)]:a[i++];switch(type){case's':return formatString(String(value),leftJustify,minWidth,precision,zeroPad,customPadChar);case'c':return formatString(String.fromCharCode(Number(value)),leftJustify,minWidth,precision,zeroPad);case'b':return formatBaseX(value,2,prefixBaseX,leftJustify,minWidth,precision,zeroPad);case'o':return formatBaseX(value,8,prefixBaseX,leftJustify,minWidth,precision,zeroPad);case'x':return formatBaseX(value,16,prefixBaseX,leftJustify,minWidth,precision,zeroPad);case'X':return formatBaseX(value,16,prefixBaseX,leftJustify,minWidth,precision,zeroPad).toUpperCase();case'u':return formatBaseX(value,10,prefixBaseX,leftJustify,minWidth,precision,zeroPad);case'i':case'd':number=Number(value)||0;number=Math.round(number-number%1);prefix=number<0?'-':positivePrefix;value=prefix+pad(String(Math.abs(number)),precision,'0',false);return justify(value,prefix,leftJustify,minWidth,zeroPad);case'e':case'E':case'f':case'F':case'g':case'G':number=Number(value);prefix=number<0?'-':positivePrefix;method=['toExponential','toFixed','toPrecision']['efg'.indexOf(type.toLowerCase())];textTransform=['toString','toUpperCase']['eEfFgG'.indexOf(type)%2];value=prefix+Math.abs(number)[method](precision);return justify(value,prefix,leftJustify,minWidth,zeroPad)[textTransform]();default:return substring;}};return format.replace(regex,doFormat);}
Handlebars.registerHelper('sprintf',function(){return sprintf.apply(this,Array.prototype.slice.call(arguments));});Handlebars.registerHelper('getPlaylistType',function(user_id,parent_user_id,status,options){if(Number(parent_user_id)!==user_id){if(Number(status)===2){return'playlist-collaborative';}
return'playlist-favorite';}
return'playlist';});Handlebars.registerHelper('isPersonalPlaylist',function(parent_user_id,options){return(parent_user_id==USER.USER_ID)?options.fn():options.inverse();});Handlebars.registerHelper('addition',function(n1,n2){return Number(n1)+Number(n2);});})();;
(function(){var api_error_handler={'playlist.addSongs':function(e){if(e.name==='ERROR_DATA_EXISTS'){notification.display(null,{message:gettext('Ce titre a déjà été ajouté à la playlist')});return true;}
if(e.name==='QUOTA_ERROR'){modal.open('/lightbox/api_error?type=PLAYLIST_ADDSONGS_QUOTA_ERROR',true);return true;}
return false;},'playlist.create':function(e){if(e.name==='ERROR_QUOTA'){modal.open('/lightbox/api_error?type=PLAYLISTS_ERROR_QUOTA',true);return true;}
return false;}};window.api={uniqId:0,callParameters:{method:'',data:{},success:function(){},error:null,callback_parameters:{},retry:0},getUniqId:function(){if(api.uniqId===0){api.uniqId=util.uniqid();}
return api.uniqId;},call:function(options){if(arguments.length>1){options={method:arguments[0]||'',data:arguments[1]||{},success:arguments[2]||function(){},callback_parameters:arguments[3]||{},retry:arguments[5]||0}}
if(!Array.isArray(options)){options=[options];}
var post_values=[];for(var i=0;i<options.length;i++){options[i]=$.extend({},api.callParameters,options[i]);if(options[i].method===''){throw'Missing method_name in api.call';}
if(options[i].retry>=4){return false;}
post_values.push({method:options[i].method,params:options[i].data});}
var url='/ajax/gw-light.php?api_version=1.0&api_token='+encodeURIComponent(checkForm)+'&input=3&cid='+api.getUniqId();sendRequest(url,'text',JSON.stringify(post_values),true,function(xhr){api.callback(xhr.responseText,options);},null);return true;},callback:function(request,options){try{var methods=[];for(var i=0;i<options.length;i++){methods.push(options[i].method);}
if(request==''){throw new dzError({name:'REQUEST_EMPTY',message:'Api error',description:'REQUEST_EMPTY',payload:{methods:methods.join('|')}});}
request=JSON.parse(request);if(!Array.isArray(request)){throw new dzError({name:'BAD_REQUEST',message:'Api error',description:'BAD_REQUEST',payload:{methods:methods.join('|')}});}
var errors=[];var exception_payload;for(var i=0;i<request.length;i++){exception_payload={method:options[i].method,methods:methods.join('|')};try{var result=api.getResult(request[i],exception_payload);options[i].success(result,options[i].callback_parameters);}catch(e){if(e.name==='VALID_TOKEN_REQUIRED'||e.name==='NEED_USER_AUTH_REQUIRED'){api.ping(options.slice(i));return false;}
if(typeof options[i].error==='function'&&options[i].error(e,options[i].callback_parameters)){continue;}
if(typeof api_error_handler[options[i].method]==='function'&&api_error_handler[options[i].method](e)){continue;}
errors.push(e);}}
for(var i=0;i<errors.length;i++){error.log(errors[i]);if(i===0){error.display(errors[i]);}}
if(errors.length>0){return false;}
return true;}catch(e){error.handle(e);}},getResult:function(request,exception_payload){exception_payload=exception_payload||null;if(typeof request!='object'){throw new dzError({name:'REQUEST_EMPTY',message:'Api error',description:'REQUEST_EMPTY',payload:exception_payload});}
if(typeof request.results==='undefined'||typeof request.error==='undefined'){throw new dzError({name:'REQUEST_EMPTY',message:'Api error',description:'REQUEST_EMPTY',payload:exception_payload});}
for(var i in request.error){if(!request.error.hasOwnProperty(i)){continue;}
throw new dzError({name:i,message:'Api error',description:request.error[i],payload:request.payload||null});}
if(countObject(request.results)===0){throw new dzError({name:'REQUEST_EMPTY',message:'Api error',description:'REQUEST_EMPTY',payload:exception_payload});}
return request.results;},ping:function(options){api.call('deezer.ping',{},function(result){if(typeof result.CHECKFORM!=='undefined'){if(USER.USER_ID>0&&result.USER_ID===0){SESSION_ID=result.SESSION;checkForm=result.CHECKFORM;modal.open('/lightbox/no_session.php');return false;}
USER.USER_ID=result.USER_ID;SESSION_ID=result.SESSION;checkForm=result.CHECKFORM;options.retry+=1;api.call(options);}
return true;},{},'ping',options.retry+1);return true;}};}());;
var auth={login_config:{facebook:true,facebook_flow:'js',ggplus:true,operators:true},init_register:function(options,register_form){if(typeof options.login_config=='object'){auth.login_config=$.extend({},auth.login_config,options.login_config);}
var register_options={};if(typeof options.register_options!='undefined'){register_options=options.register_options;}
auth.register.init(register_options,register_form);},register:{options:{tracking:null},$fbconnect:null,$form:null,init:function(options,register_form){auth.register.$fbconnect=$('#register_fbconnect');auth.register.$form=register_form||$('#form_register');auth.register.options=options;if(!auth.login_config.facebook&&!auth.login_config.ggplus){auth.register.$fbconnect.hide();auth.register.$form.show();}},create_account_fb_click:function(param){if(!auth.login_config.facebook){return false;}
if(typeof auth.register.options.tracking.platform!=='undefined'&&typeof auth.register.options.tracking.context!=='undefined'){tracking.track('register_choice_click',{'registration_type':'facebook','platform':auth.register.options.tracking.platform,'context':auth.register.options.tracking.context});}
if(auth.login_config.facebook_flow==='js'){param=param||{};facebook.login({redirect:{type:String(param.type||''),link:String(param.link||'')}});modal.close();}else{window.location.href=param;}
return false;},create_account_click:function(){if(auth.register.options.tracking!==null){tracking.track('register_choice_click',auth.register.options.tracking);}
auth.register.$fbconnect.slideUp();auth.register.$form.slideDown();if(auth.register.options.tracking!==null){tracking.track('register_form',auth.register.options.tracking);}}}};;
if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=='function'){throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');}
var aArgs=Array.prototype.slice.call(arguments,1);var fToBind=this;var FuncNOOP=function(){};var fBound=function(){return fToBind.apply(this instanceof FuncNOOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)));};FuncNOOP.prototype=this.prototype;fBound.prototype=new FuncNOOP();return fBound;};}
if(typeof console==='undefined'){console=function(){};console.log=function(msg){};}
$(document).ready(function(){if(ENV!=='DEV'&&typeof gatekeeper!=='undefined'&&!gatekeeper.isAllowed('console_log')){console.log=function(){};}
if(ENV==='DEV'){var oldConsole=console;console.warn=function(msg){if(msg.indexOf('JSX')===-1){oldConsole.log(msg);}}}});if(typeof window.onerror==='undefined'){window.onerror=function(){};}
document.write=function(){return false;}
document.open=function(){return false;}
document.close=function(){return false;}
function loadFacebox(page){try{dclk_hide();$('.tipsy').remove();$('#hovercard').hide();$('#sharebox').remove();$('#facebox_overlay').fadeOut();param=page.split('?');var query_param='';if(typeof param[1]!='undefined'){var query_param=param[1];}
var url='/'+param[0]+'?checkForm='+encodeURIComponent(checkForm)+'&'+query_param;if(PLATFORM!='web'){$.get(url,function(data){$('body').html(data);});return true;}
var id=util.uniqid();jQuery.facebox({ajax:url});$('#facebox').data('uniqid',id);return id;}catch(e){error.log(e);}}
function loadBox(page,options){return www.navigate(page,options);}
function displayInterstitial(data){try{var content='';var self_close=false;switch(data.type){case'autopromo_img':if(!www.allowAutoPromo(data)){return false;}
if(data.target=='internal'){data.target='_self';data.click='javascript:'+data.click+'; removeInterstitial(); return false';}else{data.target='_'+data.target;}
content='<img src="'+data.url+'"/>';storage.set('autopromo_intersticiel',true,true,SERVER_TIMESTAMP+86400);break;case'autopromo_video':if(!www.allowAutoPromo(data)){return false;}
content=data.embed;if(data.self_close==='0'){self_close=true;}
storage.set('autopromo_intersticiel',true,true,SERVER_TIMESTAMP+86400);break;case'ads_billboard':if(!USER.OPTIONS.ads_display){return false;}
content='<img src="'+data.url+'"/>';break;case'ads_interstitial':if(!USER.OPTIONS.ads_display){return false;}
var formatSize=data.formatSize.split('x');if(data.format=='image'){content='<img src="'+data.url+'"/>';}else if(data.format=='swf'){ads.setSwf('interstitial_ads','interstitial_ads_swf',data.url,formatSize[0],formatSize[1],data.clickTagMethod,data.click,'#FFFFFF','opaque');data.click='javascript:void(0)';data.target='_self';}else if(data.format=='redirect'){ads.setRedirect('interstitial_ads',data.redirect.js,data.redirect.clickCommand,formatSize[0],formatSize[1]);data.click='javascript:void(0)';data.target='_self';}else if(data.format=='video'){ads.setVideo('interstitial_ads','interstitial_ads_swf',data.url,formatSize[0],formatSize[1],'','',0,data.click);data.click='javascript:void(0)';data.target='_self';}
if(data.pixelAgence){ads.setPixelAgence(data.pixelAgence,'ads_pixel');}
if(data.pixelAgenceScript){$('head').append(unescape(data.pixelAgenceScript));}
break;default:return false;}
if(typeof data.duration==='undefined'){data.duration=3;}
if(content!=''){$('#interstitial_ads').append($(content));}
$('#interstitial_ads').attr({href:data.click,target:data.target});$('#interstitial').show();if(!self_close){setTimeout(function(){removeInterstitial();},parseInt(data.duration)*1000);}}catch(e){error.log(e);}}
function removeInterstitial(){try{$('#interstitial').hide();$('#interstitial_ads').removeAttr('href').empty();}catch(e){error.log(e);}}
function show(id){$('#'+id).css('display','block');}
function hide(id){$('#'+id).css('display','none');}
function inline(id){$('#'+id).css('display','inline');}
var last_asynch_request;var async_groups={};function sendRequest(url,response,post,asynchronous,callback,callback_parameters){try{var post_status='GET';if(post!=''&&typeof post!=='undefined'){post_status='POST';}
if(typeof asynchronous!='boolean'){asynchronous=false;}
if(typeof callback_parameters=='undefined'||callback_parameters==null){callback_parameters=false;}
var ajax=$.ajax({url:url,type:post_status,data:post,async:asynchronous,success:function(data,textStatus,xhr){if(typeof callback==='function'){try{callback(xhr,callback_parameters);}catch(e){error.log(e)}}else{return data;}}});if(response=='xml'){result=ajax.responseXML;}else{result=ajax.responseText;}
return result;}catch(e){error.log(e);}}
function setCookie(name,value,expiredays){var exdate=new Date();exdate.setDate(exdate.getDate()+expiredays);var cookie_domain=typeof SETTING_DOMAIN_COOKIE==='undefined'?'':(';domain='+SETTING_DOMAIN_COOKIE);document.cookie=name+'='+escape(value)+cookie_domain+'; path=/'+((expiredays==null)?'':';expires='+exdate.toGMTString());}
function getCookie(name){if(document.cookie.length>0){c_start=document.cookie.indexOf(name+'=');if(c_start!=-1){c_start=c_start+name.length+1;c_end=document.cookie.indexOf(';',c_start);if(c_end==-1){c_end=document.cookie.length;}
return unescape(document.cookie.substring(c_start,c_end));}}
return'';}
function addslashes(string){return string.toString().replace(/([\\"'])/g,'\\$1').replace(/\0/g,'\\0');}
function stripslashes(string){return string.toString().replace(/\\(.?)/g,function(s,n1){switch(n1){case'\\':return'\\';case'0':return'\u0000';case'':return'';default:return n1;}});}
function ucfirst(str){try{var f=str.charAt(0).toUpperCase();return f+str.substr(1);}catch(e){error.log(e);}}
function base64_decode(data){try{var b64='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';var o1;var o2;var o3;var h1;var h2;var h3;var h4;var bits;var i=0;var ac=0;var dec='';var tmp_arr=[];if(!data){return data;}
data+='';do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&0xff;o2=bits>>8&0xff;o3=bits&0xff;if(h3==64){tmp_arr[ac++]=String.fromCharCode(o1);}else if(h4==64){tmp_arr[ac++]=String.fromCharCode(o1,o2);}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3);}}while(i<data.length);dec=tmp_arr.join('');return dec;}catch(e){error.log(e);}}
function bin2hex(str){var len=str.length;var rv='';var i=0;var c;while(len-->0){c=str.charCodeAt(i++);rv+=_bin2hex[(c&0xf0)>>4];rv+=_bin2hex[(c&0x0f)];}
return rv;}
function hex2bin(str){var len=str.length;var rv='';var i=0;var c1;var c2;while(len>1){h1=str.charAt(i++);c1=h1.charCodeAt(0);h2=str.charAt(i++);c2=h2.charCodeAt(0);rv+=String.fromCharCode((_hex2bin[c1]<<4)+_hex2bin[c2]);len-=2;}
return rv;}
var _bin2hex=['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f'];var _hex2bin=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0,0,10,11,12,13,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,11,12,13,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function analyticsTrackingEvent(category,action,optional_label){try{date=new Date();timestamp=date.getTime();timestamp=Math.round(timestamp/1000)+315622800;if(typeof _gaq!='undefined'){_gaq.push(['_trackEvent',category,action,optional_label]);}}catch(e){error.log(e);}}
function insertAfter(element,node){try{element.parentNode.insertBefore(node,element.nextSibling);}catch(e){error.log(e);}}
function crontab(){if(typeof crontab_timeout==='undefined'){crontab_timeout=window.setInterval(crontab,999);}
update_server_timestamp();try{if((SESSION_DURATION%10)===0){ads.incrementRefreshCounter();friends.updateOnline();}
if((SESSION_DURATION%30)===0){calculeTime();}}catch(e){}
return true;}
function update_server_timestamp(){SERVER_TIMESTAMP+=1;SESSION_DURATION+=1;return true;}
function rewriting(str){if(typeof str=='undefined'){return'';}
var spec=['À','Á','Â','Ã','Ä','Å','Æ','à','á','â','ã','ä','å','æ','È','É','Ê','Ë','è','é','ê','ë','Ì','Í','Î','Ï','ì','í','î','ï','Ò','Ó','Ô','Õ','Ö','Ø','ò','ó','ô','õ','ö','ø','Ù','Ú','Û','Ü','ù','ú','û','ü','ß','Ç','ç','Ð','ð','Ñ','ñ','Þ','þ','Ý','ş',' ','"','\'','(',')',',','.',';','?','!',':','‘','&','$','+','[',']','{','}'];var norm=['A','A','A','A','A','A','A','a','a','a','a','a','a','a','E','E','E','E','e','e','e','e','I','I','I','I','i','i','i','i','O','O','O','O','O','O','o','o','o','o','o','o','U','U','U','U','u','u','u','u','B','C','c','D','d','N','n','P','p','Y','s','-','-','-','-','-','-','-','-','-','-','-','-','-','-','-','-','-'];for(var i=0;i<spec.length;i++){str=str_replace(str,spec[i],norm[i]);}
return str;}
String.prototype.trim=function(trimChar){return trim(this,typeof trimChar!='undefined'?trimChar:null);};function trim(myString,trimChar){if(typeof trimChar=='string'&&trimChar!=''){var regexpLeft=new RegExp('^['+trimChar+']['+trimChar+']*');var regexpRight=new RegExp('['+trimChar+']['+trimChar+']*$');}else{var regexpLeft=new RegExp('^\\s\\s*');var regexpRight=new RegExp('\\s\\s*$');}
return myString.replace(regexpLeft,'').replace(regexpRight,'');}
String.prototype.ltrim=function(trimChar){return ltrim(this,typeof trimChar!='undefined'?trimChar:null)};function ltrim(myString,trimChar){if(typeof trimChar=='string'&&trimChar!=''){var regexpLeft=new RegExp('^['+trimChar+']['+trimChar+']*');}else{var regexpLeft=new RegExp('^\\s\\s*');}
return myString.replace(regexpLeft,'');}
function str_replace(haystack,needle,replacement){var temp=haystack.split(needle);return temp.join(replacement);}
function truncateTxt(txt,max_length){if(txt.length>max_length){txt=txt.substr(0,max_length-4)+' ...';}
return txt;}
function shuffle(a){var j=0;var valI;var valJ;var l=a.length-1;if(l===-1){return a;}
while(l>-1){j=Math.floor(Math.random()*l);valI=a[l];valJ=a[j];a[l]=valJ;a[j]=valI;l=l-1;}
return a;}
function calculeTime(){$('.timestamp').each(function(index){if(typeof $(this).data('timestamp')==='undefined'||isNaN($(this).data('timestamp'))){return;}
var data_timestamp=parseInt($(this).data('timestamp'),10);var timestamp=SERVER_TIMESTAMP-data_timestamp;$(this).text((data_timestamp===0)?'-':getAgoTime(timestamp));if($(this).is('[data-display-title="true"]')&&data_timestamp>0){$(this).prop('title',getAgoTime(timestamp))}});return true;}
function localTimeStamp(){return Math.floor(new Date().getTime()/1000);}
function getAgoTime(timer){try{if(isNaN(timer)||timer<0){timer=0;}
if(timer<60){return gettext('Il y a quelques instants');}else if(timer<3600){timer=Math.round(timer/60);return ngettext('Il y a %s minute','Il y a %s minutes',{sprintf:[timer],count:timer});}else if(timer<86400){timer=Math.round(timer/3600);return ngettext('Il y a %s heure','Il y a %s heures',{sprintf:[timer],count:timer});}else if(timer>86400&&timer<172800){return gettext('Hier');}else if(timer<518400){timer=Math.round(timer/86400);return ngettext('Il y a %s jour','Il y a %s jours',{sprintf:[timer],count:timer});}else if(timer<2592000){timer=Math.round(timer/604800);return ngettext('Il y a %s semaine','Il y a %s semaines',{sprintf:[timer],count:timer});}else{timer=Math.round(timer/2592000);if(timer>12){return gettext('Il y a plus d\'un an');}
return ngettext('Il y a %s mois','Il y a %s mois',{sprintf:[timer],count:timer});}}catch(e){error.log(e)}}
function pad(number,length){var str=number.toString();while(str.length<length){str='0'+str;}
return str;}
function secToMin(seconds){try{if(isNaN(seconds)){return false;}
seconds=Math.floor(seconds);return pad(Math.floor(seconds/60),2)+':'+pad(seconds%60,2);}catch(e){error.log(e);}}
function getTotalDuration(seconds){seconds=seconds||0;var minutes=Math.floor(seconds/60);var hours;var result;if(minutes>59){hours=Math.floor(minutes/60);minutes=minutes-(hours*60);result=ngettext('%s h','%s h',{sprintf:[hours],count:hours});if(minutes>0){result+=' '+ngettext('%s min','%s min',{sprintf:[pad(minutes,2)],count:minutes});}}else{result=' '+ngettext('%s min','%s min',{sprintf:[pad(minutes,2)],count:minutes});}
return result;}
function timestampToDate(timestamp,hours,date_separator,reverse_date){var hours=hours||false;var date_separator=date_separator||'/';var reverse_date=reverse_date||false;var date=new Date();date.setTime(timestamp*1000);var month=parseInt(date.getMonth())+1;var dateString=pad(date.getDate(),2)+date_separator+pad(month,2)+date_separator+date.getFullYear();if(reverse_date){dateString=date.getFullYear()+date_separator+pad(month,2)+date_separator+pad(date.getDate(),2);}
if(hours){dateString+=' '+pad(date.getHours(),2)+':'+pad(date.getMinutes(),2)+':'+pad(date.getSeconds(),2);}
return dateString;}
function serialize(txt){switch(typeof txt){case'string':return's:'+txt.length+':"'+txt+'";';case'number':if(txt>=0&&String(txt).indexOf('.')==-1&&txt<65536){return'i:'+txt+';';}
return'd:'+txt+';';case'boolean':return'b:'+((txt)?'1':'0')+';';case'object':var i=0;var ret='';for(var k in txt){if(!txt.hasOwnProperty(k)){continue;}
if(!isNaN(k)){k=Number(k);}
ret+=serialize(k)+serialize(txt[k]);i++;}
return'a:'+i+':{'+ret+'}';default:return'N;';}}
function unserialize(txt){var level=0;var arrlen=[];var del=0;var result=[];var key=[];var save=txt;while(1){switch(txt.substr(0,1)){case'N':del=2;ret=null;break;case'b':del=txt.indexOf(';')+1;ret=(txt.substring(2,del-1)=='1')?true:false;break;case'i':del=txt.indexOf(';')+1;ret=Number(txt.substring(2,del-1));break;case'd':del=txt.indexOf(';')+1;ret=Number(txt.substring(2,del-1));break;case's':del=txt.substr(2,txt.substr(2).indexOf(':'));ret=txt.substr(1+txt.indexOf('"'),del);del=txt.indexOf('"')+1+ret.length+2;break;case'a':del=txt.indexOf(':{')+2;ret=new Array();arrlen[level+1]=Number(txt.substring(txt.indexOf(':')+1,del-2))*2;break;case'O':txt=txt.substr(2);var tmp=txt.indexOf(':"')+2;var nlen=Number(txt.substring(0,txt.indexOf(':')));name=txt.substring(tmp,tmp+nlen);txt=txt.substring(tmp+nlen+2);del=txt.indexOf(':{')+2;ret=new Object();arrlen[level+1]=Number(txt.substring(0,del-2))*2;break;case'}':txt=txt.substr(1);if(arrlen[level]!=0){alert('var missed : '+save);return undefined;};level--;continue;default:if(level==0){return result;}
return undefined;}
if(arrlen[level]%2==0){if(typeof ret=='object'){alert('array index object no accepted : '+save);return undefined;}
if(ret==undefined){alert('syntax invalid(2) : '+save);return undefined;}
key[level]=ret;}else{var ev='';for(var i=1;i<=level;i++){if(typeof key[i]=='number'){ev+='['+key[i]+']';}else{ev+='["'+key[i]+'"]';}}
eval('result'+ev+'= ret;');}
arrlen[level]--;if(typeof ret=='object'){level++;}
txt=txt.substr(del);continue;}}
function countObject(obj){if(typeof obj!=='object'){return false;}
if(typeof Object.keys=='function'){return Object.keys(obj).length;}
var count=0;for(var prop in obj){if(obj.hasOwnProperty(prop)){++count;}}
return count;}
function return_age(date){now=CURRENT_DATE;exp_date=date.split('-');exp_now=now.split('-');date_year=exp_date[0];date_month=exp_date[1];date_day=exp_date[2];now_year=exp_now[0];now_month=exp_now[1];now_day=exp_now[2];years=now_year-date_year;if(now_month<=date_month){if(date_month==now_month){if(date_day>now_day){years-=1;}}else{years-=1;}}
age=years;return age;}
function dateToTimestamp(string_date){if(typeof string_date==='undefined'||typeof string_date!=='string'){return false;}
var rdate=/^\d{4}-\d{1,2}-\d{1,2}$/;var rdatehours=/^\d{4}-\d{1,2}-\d{1,2} \d{2}:\d{2}:\d{2}$/;var total_date=[];if(rdate.exec(string_date)){date=string_date.split('-');time=['0','0','0']}else if(rdatehours.exec(string_date)){full_date=string_date.split(' ');time=full_date[1].split(':');date=full_date[0].split('-');}else{return SERVER_TIMESTAMP;}
return new Date(date[0],date[1]-1,date[2],time[0],time[1],time[2]).getTime()/1000;}
function getShortMonthName(month){var months_name=[gettext('JAN'),gettext('FEV'),gettext('MAR'),gettext('AVR'),gettext('MAI'),gettext('JUIN'),gettext('JUIL'),gettext('AOU'),gettext('SEP'),gettext('OCT'),gettext('NOV'),gettext('DEC')];return months_name[(month.charAt(0)=='0')?(parseInt(month.charAt(1))-1):(parseInt(month)-1)];}
function getScripts(scripts,finalCallback){_getScript(scripts,0,scripts.length,finalCallback);}
function _getScript(scripts,pos,max,finalCallback){if(pos<0||pos>=max){finalCallback();return;}
if(RESSOURCES.cached[scripts[pos][0]]==true){_getScript(scripts,pos+1,max,finalCallback);}else{if(scripts[pos][1]=='js'){$.ajax({cache:true,url:scripts[pos][0],dataType:'script',success:function(){RESSOURCES.cached[scripts[pos][0]]=true;_getScript(scripts,pos+1,max,finalCallback);}});}
if(scripts[pos][1]=='css'){$('head').append($('<link rel="stylesheet" type="text/css" href="'+scripts[pos][0]+'" />'));RESSOURCES.cached[scripts[pos][0]]=true;_getScript(scripts,pos+1,max,finalCallback);}}}
function getClientHeight(){if(typeof window.innerHeight==='number'){return window.innerHeight;}else if(typeof document.documentElement.clientHeight!=='undefined'){return document.documentElement.clientHeight;}else if(typeof document.body.clientHeight!=='undefined'){return document.body.clientHeight;}else{return 0;}}
function getClientWidth(){if(typeof document.documentElement.clientWidth!=='undefined'){return document.documentElement.clientWidth;}else if(typeof document.body.clientWidth!=='undefined'){return document.body.clientWidth;}else if(typeof window.innerWidth==='number'){return window.innerWidth;}else{return 0;}}
function timestampToIso8601(ts){if(typeof ts==='undefined'){var ts=Math.floor(new Date().getTime()/1000);}
var aDate=new Date();aDate.setTime(ts*1000);return(aDate.getFullYear()+'-'+pad((aDate.getMonth()+1),2)+'-'+pad(aDate.getDate(),2)+'T'+pad(aDate.getHours(),2)+':'+pad(aDate.getMinutes(),2));}
String.prototype.format=function(){var s=this;var i=arguments.length;while(i--){s=s.replace(new RegExp('\\{'+i+'\\}','gm'),arguments[i]);}
return s;};function storeSongsDownload(sng_ids){try{api.call('store.getDownloadUrl',{songs:sng_ids},storeSongsDownloadCallBack,{songs:sng_ids});return true;}catch(e){error.log(e);}};function storeSongsDownloadCallBack(result,callBackParams){try{if($('#store_downloads_file').length==0){$('body').append('<iframe id="store_downloads_file" style="display:none;height:1px;width:1px"/></iframe>');}
$('#store_downloads_file').attr('src',result+((ENV=='DEV'&&callBackParams.songs.length>1)?'&ZIP=1':''));}catch(e){error.log(e);}};function formatDate(date,delimiter){if(typeof delimiter==='undefined'){delimiter='-';}
var buffer=[];var format=DATE_FORMAT.split('-');if(date.indexOf('-')==-1&&date.length==8){date=date.substring(0,4)+'-'+date.substring(4,6)+'-'+date.substring(6,8);}
var parts=date.split('-');for(var i=0;i<3;i++){switch(format[i]){case'd':buffer.push(parts[2]);break;case'm':buffer.push(parts[1]);break;case'Y':buffer.push(parts[0]);break;}}
return buffer.join(delimiter);}
function formatedTimeToSecond(time){var format=time.split(':');var seconds=0;if(format.length==3){seconds+=parseInt(format[2]);seconds+=parseInt(format[1])*60;seconds+=parseInt(format[0])*(60*60);}
return seconds;}
function formatDuration(duration,display_hours){display_hours=display_hours||false;duration=parseInt(duration,10)||0;if(duration<=0){return'00:00';}
var hour=Math.floor(duration/(60*60));var min=Math.floor(display_hours?(duration%(60*60)/60):(duration/60));var sec=Math.floor(duration%(60*60)%60);if(hour<10){hour='0'+hour;}
return(display_hours?hour+':':'')+((min<10)?'0'+min:min)+':'+((sec<10)?'0'+sec:sec);}
function breakUpThousands(nStr){nStr+='';var x=nStr.split('.');var x1=x[0];var x2=x.length>1?'.'+x[1]:'';var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,'$1'+' '+'$2');}
return x1+x2;}
function loadPayment($this){try{var data=$this.data();data.origin=data.origin||0;var url=SETTING_HOST_SITE+'/payment/go.php?';url+=typeof data.offer_id!=='undefined'?'id='+data.offer_id+'&':'';url+=typeof data.change_mop!=='undefined'?'change_mop='+data.change_mop+'&':'';url+=typeof data.gift!=='undefined'?'gift='+data.gift+'&':'';url+='origin='+data.origin+'&';if(typeof data.gift!=='undefined'){url+='gift='+data.gift+'&';}
loadPaymentProgress=true;tracking.track('offers_subscribe_click',{origin:data.origin},function(){window.location=url;});return true;}catch(e){}}
function stripTags(str){var el=document.createElement('div');el.innerHTML=str;return el.textContent?el.textContent:el.innerText;}
function htmle(str){return encodeHTMLEntities(str);}
function encodeHTMLEntities(str){var el=document.createElement('div');el[typeof el.textContent!=='undefined'?'textContent':'innerText']=str;return el.innerHTML;}
function copyToClipboard(target,data,message){if(!window.ZeroClipboard||!target||!data){return false;}
new ZeroClipboard(target).on('ready',function(){this.on('copy',function(zc){zc.clipboardData.setData('text/plain',data);}).on('aftercopy',function(){if(message){Events.trigger(Events.copy.after,{message:message});}});});}
function isPlainObject(obj){return obj&&obj===Object(obj)&&!Array.isArray(obj);}
function getObjDeepKey(obj,keys){if(!isPlainObject(obj)){return null;}
for(var i=0,keys=keys.split('.'),l=keys.length;i<l;++i){if(typeof obj[keys[i]]==='undefined'||(i!==(keys.length-1)&&!isPlainObject(obj[keys[i]]))){return null;}
obj=obj[keys[i]];};return obj;}
String.prototype.convertURLToLink=function(){var RexExpURL=/(https?:\/\/|www\.)([a-z0-9-\.]+\.)?([a-z0-9-]+)\.([a-z0-9-]{2,63})((\?|\/)([^\s\r\n@<>!]*))?/gi;return this.toString().replace(RexExpURL,function(matched){if(matched.indexOf('@')===-1){var urlwithHTTP=matched.indexOf('http')===-1?'http://'+matched:matched;var domain=urlwithHTTP.split('/')[2].split('.').reverse().slice(0,2).reverse().join('.');if(domain==document.domain){return'<a href="/'+arguments[7]+'" class="evt-click">'+matched+'</a>';}
return'<a href="http://'+SETTING_HOST+'/l.php?url='+encodeURIComponent(urlwithHTTP)+'" target="_blank">'+matched+'</a>';}
return matched;});};function intersectObject(o1,o2){var r={};for(var p in o1){if(!o1.hasOwnProperty(p)){continue;}
if(typeof o2[p]!=='undefined'){r[p]=o1[p];}}
return r;}
function compareObject(w,x){var p_in_w={};for(var p in w){if(!w.hasOwnProperty(p)){continue;}
if(typeof w[p]!==typeof x[p]){return false;}
if((w[p]===null)!==(x[p]===null)){return false;}
switch(typeof w[p]){case'undefined':if(typeof x[p]!=='undefined'){return false;}
break;case'object':if(w[p]!==null&&x[p]!==null&&(w[p].constructor.toString()!==x[p].constructor.toString()||!compareObject(w[p],x[p]))){return false;}
break;case'function':if(p!='equals'&&w[p].toString()!=x[p].toString()){return false;}
break;default:if(w[p]!==x[p]){return false;}}
p_in_w[p]=true;}
for(var q in x){if(!x.hasOwnProperty(q)){continue;}
if(!p_in_w.hasOwnProperty(q)){return false;}}
return true;};
try{var JSON={stringify:function stringify(arg){var c,i,l,s='',v;switch(typeof arg){case'object':if(arg){if(arg.constructor==Array){for(i=0;i<arg.length;++i){v=stringify(arg[i]);if(s){s+=',';}
s+=v;}
return'['+s+']';}else if(typeof arg.toString!='undefined'){for(i in arg){if(!arg.hasOwnProperty(i)){continue;}
v=stringify(arg[i]);if(typeof v!='function'){if(s){s+=',';}
s+=stringify(i)+':'+v;}}
return'{'+s+'}';}}
return'null';case'number':return isFinite(arg)?String(arg):'null';case'string':l=arg.length;s='"';for(i=0;i<l;i+=1){c=arg.charAt(i);if(c>=' '){if(c=='\\'||c=='"'){s+='\\';}
s+=c;}else{switch(c){case'\b':s+='\\b';break;case'\f':s+='\\f';break;case'\n':s+='\\n';break;case'\r':s+='\\r';break;case'\t':s+='\\t';break;default:c=c.charCodeAt();s+='\\u00'+Math.floor(c/16).toString(16)+
(c%16).toString(16);}}}
return s+'"';case'boolean':return String(arg);default:return'null';}},parse:function(text){var at=0;var ch=' ';function error(m){var err_text=typeof text==='string'?text:'not_a_valid_string';throw new dzError({name:'JSONError',message:'JSONError',description:m+': at '+(at-1)+' in '+err_text,at:at-1,text:text});}
function next(){ch=text.charAt(at);at+=1;return ch;}
function white(){while(ch){if(ch<=' '){next();}else if(ch=='/'){switch(next()){case'/':while(next()&&ch!='\n'&&ch!='\r'){}
break;case'*':next();for(;;){if(ch){if(ch=='*'){if(next()=='/'){next();break;}}else{next();}}else{error("Unterminated comment");}}
break;default:error("Syntax error");}}else{break;}}}
function string(){var i,s='',t,u;if(ch=='"'){outer:while(next()){if(ch=='"'){next();return s;}else if(ch=='\\'){switch(next()){case'b':s+='\b';break;case'f':s+='\f';break;case'n':s+='\n';break;case'r':s+='\r';break;case't':s+='\t';break;case'u':u=0;for(i=0;i<4;i+=1){t=parseInt(next(),16);if(!isFinite(t)){break outer;}
u=u*16+t;}
s+=String.fromCharCode(u);break;default:s+=ch;}}else{s+=ch;}}}
error("Bad string");}
function array(){var a=[];if(ch=='['){next();white();if(ch==']'){next();return a;}
while(ch){a.push(value());white();if(ch==']'){next();return a;}else if(ch!=','){break;}
next();white();}}
error("Bad array");}
function object(){var k,o={};if(ch=='{'){next();white();if(ch=='}'){next();return o;}
while(ch){k=string();white();if(ch!=':'){break;}
next();o[k]=value();white();if(ch=='}'){next();return o;}else if(ch!=','){break;}
next();white();}}
error("Bad object");}
function number(){var n='',v;if(ch=='-'){n='-';next();}
while(ch>='0'&&ch<='9'){n+=ch;next();}
if(ch=='.'){n+='.';while(next()&&ch>='0'&&ch<='9'){n+=ch;}}
v=+n;if(!isFinite(v)){error("Bad number");}else{return v;}}
function word(){switch(ch){case't':if(next()=='r'&&next()=='u'&&next()=='e'){next();return true;}
break;case'f':if(next()=='a'&&next()=='l'&&next()=='s'&&next()=='e'){next();return false;}
break;case'n':if(next()=='u'&&next()=='l'&&next()=='l'){next();return null;}
break;}
error("Syntax error");}
function value(){white();switch(ch){case'{':return object();case'[':return array();case'"':return string();case'-':return number();default:return ch>='0'&&ch<='9'?number():word();}}
return value();}};}catch(e){};
if(typeof storage=='undefined'){var storage={init:function(){if(document.cookie.indexOf('USER_CHECKSUMS_'+USER.USER_ID)>-1){var c=document.cookie.split('; ');for(var i in c){setCookie(c[i],'',-1);}
window.location='';}},formatKey:function(key){return key+'_'+USER.USER_ID;},get:function(key,default_value){var value;if(!storage.isset(key)){return(typeof default_value!=='undefined'?default_value:false);}
key=storage.formatKey(key);if(Modernizr.localstorage){value=window.localStorage.getItem(key);}else if(getCookie(key)!==''){value=getCookie(key);}else{return false;}
return JSON.parse(value);},set:function(key,value,fallback,expiredays){key=storage.formatKey(key);value=JSON.stringify(value);if(typeof fallback!=='boolean'){fallback=true;}
if(Modernizr.localstorage){try{window.localStorage.setItem(key,value);}catch(e){window.error.log(e);}}else if(fallback){if(typeof expiredays==='undefined'){expiredays=365;}
setCookie(key,value,expiredays);}
return true;},isset:function(key){key=storage.formatKey(key);if(Modernizr.localstorage){if(typeof window.localStorage[key]==='undefined'||window.localStorage[key]===null){return false;}
return true;}
if(getCookie(key)===''){return false;}
return true;}};};
var templating={loaded:{},load:function(name,div){try{div=div||$('#naboo_content');if(typeof templating.loaded[name]!=='undefined'){return templating.display(templating.loaded[name],div);}
var content=false;if(div.children('[data-template="'+name+'"]').length==1){div.children('[data-seo="'+name+'"]').remove();div.children('[data-template="'+name+'"]').show();content=div.html();}else{content=sendRequest('/ajax/template.php?template='+encodeURIComponent(name)+'&v='+STATIC_VERSION+'&l='+SETTING_LANG,'text','');if(OFFLINE&&typeof content==='undefined'){window.location=SETTING_HOST_SITE+'/offline';}
if(content==='error'){return false;}}
if(content===false){return false;}
templating.loaded[name]=content;return templating.display(content,div);}catch(e){error.log(e);}},display:function(content,div){div.html(content);Events.trigger(Events.navigation.page_loaded);return true;}};
if(typeof Events==='undefined'){var Events={evts:{},deferredObjects:[],ready:function(evt,callback){if(typeof Events.deferredObjects[evt]==='undefined'){Events.deferredObjects[evt]=$.Deferred();}
Events.deferredObjects[evt].done(callback);},resolve:function(evt){if(typeof Events.deferredObjects[evt]==='undefined'){Events.deferredObjects[evt]=$.Deferred();}
Events.deferredObjects[evt].resolve();},subscribe:function(evt,callback,group){if(typeof group==='string'){return Events.addEvent(group,evt,callback);}
$(document).unbind(evt,callback).bind(evt,callback);},addEvent:function(group,evt,callback){if(typeof group!=='string'||typeof evt!=='string'||typeof callback!=='function'){return false;}
if(typeof Events.evts[group]==='undefined'){Events.evts[group]=[];}
Events.evts[group].push({fct:callback,evt:evt});Events.subscribe(evt,callback);},unsubscribeAll:function(group){if(typeof group!=='string'||typeof Events.evts[group]==='undefined'){return false;}
for(var i=0;i<Events.evts[group].length;i++){var evt=Events.evts[group][i];Events.unsubscribe(evt.evt,evt.fct);}
Events.evts[group]=null;delete Events.evts[group];},subscribeOnce:function(evt,callback,group){if(typeof group!=='string'){group=null;}
Events.subscribe(evt,function(event,args){callback(event,args);Events.unsubscribe(evt,event.handleObj.handler);},group);},unsubscribe:function(evt,handler){$(document).unbind(evt,handler);},trigger:function(evt,args){if(typeof args=='undefined'){args=null;}
$(document).trigger(evt,[args]);},player:{playerLoaded:'EVENT.PLAYER.playerLoaded',playerReady:'DEFERRED.PLAYER.playerReady',playing:'EVENT.PLAYER.playing',fading:'EVENT.PLAYER.fading',play:'EVENT.PLAYER.play',resume:'EVENT.PLAYER.resume',paused:'EVENT.PLAYER.pause',displayNextSong:'EVENT.PLAYER.displayNextSong',displayCurrentSong:'EVENT.PLAYER.displayCurrentSong',displayEmptyPlayer:'EVENT.PLAYER.displayEmptyPlayer',duration:'EVENT.PLAYER.duration',position:'EVENT.PLAYER.position',seek:'EVENT.PLAYER.seek',prcPosition:'EVENT.PLAYER.prcPosition',pourcentLoaded:'EVENT.PLAYER.pourcentLoaded',loading:'EVENT.PLAYER.loading',log:'EVENT.PLAYER.log',log_offline:'EVENT.PLAYER.log_offline',track_end:'EVENT.PLAYER.track_end',finish:'EVENT.PLAYER.finish',finishPreview:'EVENT.PLAYER.finishPreview',finishAds:'EVENT.PLAYER.finishAds',finishJingle:'EVENT.PLAYER.finishJingle',finishTrackList:'EVENT.PLAYER.finishTrackList',setTrackList:'EVENT.PLAYER.setTrackList',fade:'EVENT.PLAYER.fade',changePlayerType:'EVENT.PLAYER.changePlayerType',hq:'EVENT.PLAYER.hq',volume:'EVENT.PLAYER.volume',volume_changed:'EVENT.PLAYER.volume_changed',refreshSoundBar:'EVENT.PLAYER.refreshSoundBar',forceCloseMix:'EVENT.PLAYER.forceCloseMix',notify:'EVENT.PLAYER.notify',repeat_changed:'EVENT.PLAYER.repeat_changed',shuffle_changed:'EVENT.PLAYER.shuffle_changed',mute_changed:'EVENT.PLAYER.mute_changed',error:'EVENT.PLAYER.error',order_changed:'EVENT.PLAYER.order_changed',user_status:'EVENT.PLAYER.user_status',updateRestrictTime:'EVENT.PLAYER.updateRestrictTime',adsVastPlaying:'EVENT.PLAYER.adsVastPlaying',preloadComplete:'EVENT.PLAYER.preloadComplete',preloadAborted:'EVENT.PLAYER.preloadAborted',tracklist_changed:'EVENT.PLAYER.tracklist_changed',blind_test_mode_changed:'EVENT.PLAYER.blind_test_mode_changed',seekCompleted:'EVENT.PLAYER.seekCompleted',setBookmark:'EVENT.PLAYER.setBookmark'},player_widget:{loaded:'EVENT.PLAYER_WIDGET.loaded',tracksLoaded:'EVENT.PLAYER_WIDGET.tracksLoaded',notify:'EVENT.PLAYER_WIDGET.notify',displayLayer:'EVENT.PLAYER_WIDGET.displayLayer',removeOverlay:'EVENT.PLAYER_WIDGET.removeOverlay'},flow:{playerDisplay:'DEFERRED.FLOW.playerDisplay'},menu:{loaded:'EVENT.MENU.loaded',contextMenu:'EVENT.MENU.contextMenu',resize:'EVENT.MENU.resize',panel_mounted:'EVENT.MENU.panel_mounted'},user:{loaded:'DEFERRED.USER.loaded',clickFavorite:'EVENT.USER.clickFavorite',addFavorite:'EVENT.USER.addFavorite',deleteFavorite:'EVENT.USER.deleteFavorite',shareClick:'EVENT.USER.shareClick',login:'EVENT.USER.login',logout:'EVENT.USER.logout',userReady:'DEFERRED.USER.userReady',dataStoreReady:'DEFERRED.USER.dataStoreReady',settingChanged:'EVENT.USER.settingChanged',blockFriend:'EVENT.USER.blockFriend',unblockFriend:'EVENT.USER.unblockFriend',updatePicture:'EVENT.USER.updatePicture',uploadPicture:'EVENT.USER.uploadPicture',updateName:'EVENT.USER.updateName',updateSearchHistory:'EVENT.USER.updateSearchHistory',userLoadData:'EVENT.USER.userLoadData',updateEpisodeBookmark:'EVENT.USER.updateEpisodeBookmark'},genre:{loaded:'DEFERRED.GENRE.loaded'},talk_genre:{loaded:'DEFERRED.TALK_GENRE.loaded'},live:{connected:'EVENT.LIVE.connected',simultaneousAccess:'EVENT.LIVE.simultaneousAccess',newMessage:'EVENT.LIVE.newMessage',newFriendInvitation:'EVENT.LIVE.newFriendInvitation',newFriendship:'EVENT.LIVE.newFriendship',newNotif:'EVENT.LIVE.newNotif',readNotif:'EVENT.LIVE.readNotif',ready:'EVENT.LIVE.ready',feed:'EVENT.LIVE.feed',limitation:'EVENT.LIVE.limitation',device_sync:'EVENT.LIVE.device_sync',pagefeed:'EVENT.LIVE.pagefeed',events:'EVENT.LIVE.events'},offline:{reminder:'EVENT.OFFLINE.reminder'},playlist:{addSong:'EVENT.PLAYLIST.addSong',removeSong:'EVENT.PLAYLIST.removeSong',created:'EVENT.PLAYLIST.created',removed:'EVENT.PLAYLIST.removed',updated:'EVENT.PLAYLIST.updated',uploadPicture:'EVENT.PLAYLIST.uploadPicture',updatePicture:'EVENT.PLAYLIST.updatePicture',assistantValidation:'EVENT.PLAYLIST.assistantValidation',assistantSuggestFinish:'EVENT.PLAYLIST.assistantSuggestFinish',assistantSuggestEmpty:'EVENT.PLAYLIST.assistantSuggestEmpty',assistantNextStep:'EVENT.PLAYLIST.assistantNextStep',assistantToggleValidation:'EVENT.PLAYLIST.assistantToggleValidation',assistantAddedTrack:'EVENT.PLAYLIST.assistantAddedTrack'},profile:{allCoverLoaded:'EVENT.PROFILE.allCoverLoaded'},layout:{width_type:'EVENT.LAYOUT.width_type',scroll:'EVENT.LAYOUT.scroll',infiniteScroll:'EVENT.LAYOUT.infiniteScroll',resize:'EVENT.LAYOUT.resize',adsBackground:'EVENT.LAYOUT.adsBackground',adsBanner:'EVENT.LAYOUT.adsBanner'},navigation:{page_changed:'EVENT.NAVIGATION.page_changed',page_loaded:'EVENT.NAVIGATION.page_loaded',page_displayed:'EVENT.NAVIGATION.page_displayed',modal_displayed:'EVENT.NAVIGATION.modal_displayed',modal_open:'EVENT.NAVIGATION.modal_open',tab_displayed:'EVENT.NAVIGATION.tab_displayed',page_updated:'EVENT.NAVIGATION.page_updated',page_initialized:'DEFERRED.NAVIGATION.page_initialized'},datagrid:{displayed:'EVENT.DATAGRID.displayed',onAirPosition:'EVENT.DATAGRID.onAirPosition',allTracksDisplayed:'EVENT.DATAGRID.allTracksDisplayed',removedTrack:'EVENT.DATAGRID.removedTrack'},album:{checkReplace:'EVENT.ALBUM.checkReplace',noReplaceNeed:'EVENT.ALBUM.noReplaceNeed'},radio:{start:'EVENT.RADIO.start'},lightbox:{close:'EVENT.LIGHTBOX.close'},search:{loaded:'EVENT.SEARCH.loaded',suggestDisplayed:'EVENT.SEARCH.suggestDisplayed',suggestClicked:'EVENT.SEARCH.suggestClicked'},tabs:{open:'EVENT.TABS.open'},modal:{close:'EVENT.MODAL.close'},googleplus:{ready:'EVENT.GOOGLEPLUS.ready'},facebook:{user_status:'EVENT.FACEBOOK.user_status'},chromecast:{status:'EVENT.CHROMECAST.status',removeFocus:'EVENT.CHROMECAST.removeFocus',closeIntro:'EVENT.CHROMECAST.closeIntro'},lyrics:{load:'EVENT.LYRICS.load',seek:'EVENT.LYRICS.seek'},gigs:{display:'EVENT.GIGS.display'},copy:{after:'EVENT.COPY.after'},tag:{select:'EVENT.TAG.select'},talk:{bookmarkSet:'EVENT.TALK.bookmarkSet'},tips:{close:'EVENT.TIPS.close',draw:'EVENT.TIPS.draw'}};};
var EventDispatcher=function(){this.uniq_id=util.uniqid();this.callbacks={};this.subscribe=function(callback){callback.uniq_id=util.uniqid();this.callbacks[callback.uniq_id]=callback;}.bind(this);this.unSubscribe=function(callback){if(!callback.hasOwnProperty('uniq_id')){return false;}
var uniq_id=callback.uniq_id;if(typeof this.callbacks[uniq_id]==='undefined'){return false;}
delete this.callbacks[uniq_id];}.bind(this);this.trigger=function(arg){for(var uniq_id in this.callbacks){if(!this.callbacks.hasOwnProperty(uniq_id)){continue;}
this.callbacks[uniq_id](arg);}}.bind(this);};;
var Store=function(proto){this.uniq_id=util.uniqid();this.parent={};this.callbacks={};this.eventDispatcher=new EventDispatcher();this.emitChange=function(type){this.eventDispatcher.trigger(type);}.bind(this);this.onChange=function(callback){this.eventDispatcher.subscribe(callback);}.bind(this);this.offChange=function(callback){this.eventDispatcher.unSubscribe(callback);}.bind(this);for(var key in proto){if(!proto.hasOwnProperty(key)){continue;}
if(this.hasOwnProperty(key)){this.parent[key]=this[key];}
this[key]=proto[key];}};;
if(typeof tracking==='undefined'){var tracking={initialized:false,random_id:0,events_options:{mobile_session:{sampling:5},mobile_install:{sampling:5},unlogged_home_display:{sampling:5},navigation:{sampling:0,websocket:true},search_trigger:{sampling:5},search_results:{sampling:5},add_to_favorite:{sampling:5},headermenu_click:{sampling:5},menu_click:{sampling:5,websocket:true},usermenu_click:{sampling:5},player_click:{sampling:5},context_menu_click:{sampling:5},panel_click:{sampling:5},flow_click:{sampling:5},chromecast_open_menu_click:{sampling:5},chromecast_menu_choice_click:{sampling:5},add_to_playlist:{sampling:5},playlist_create:{sampling:5},upgrade_ui_box_display:{sampling:5},upgrade_ui_box_click:{sampling:5},backstage_landing_elite:{sampling:5},display_page:{sampling:5},landing_display:{sampling:5},unlogged_home_click:{sampling:5},soon_display:{sampling:5},soon_click:{sampling:5},top_playlists_click:{sampling:5}},double_tag:{menu_click:{properties:{type:'offers_subscribe'},tracking:{event_name:'offers_subscribe_click',properties:{origin:'menu_push_subscription'}}}},init:function(){Events.ready(Events.user.loaded,tracking.register);Events.subscribe(Events.user.logout,tracking.unregister);Events.subscribe(Events.user.addFavorite,function(evt,params){if(params.type==='disliked_song'){return false;}
var props={type:params.type,id:params.id};tracking.addFavoriteContext(props,params.context);tracking.track('add_to_favorite',props);mixpanel.people.increment('add_favorite');});Events.subscribe(Events.playlist.created,function(evt,params){tracking.track('playlist_create',{id:params.id});mixpanel.people.increment('playlist_create');});Events.subscribe(Events.playlist.addSong,function(evt,params){var props={id:params.playlist_id,position:params.position||-1};tracking.addFavoriteContext(props,params.context);tracking.track('add_to_playlist',props);});Events.subscribe(Events.navigation.page_changed,function(evt,params){tracking.track('navigation',{event:'onDisplay',properties:{page:params.path}});});Events.subscribe(Events.navigation.modal_displayed,function(evt,params){tracking.track('navigation',{event:'onDisplay',properties:{modal:params.modal}});});Events.subscribe(Events.navigation.tab_displayed,function(evt,params){tracking.track('navigation',{event:'onDisplay',properties:{tab:params.type}});});tracking.random_id=Math.floor(Math.random()*10000);tracking.registerABTest();tracking.initialized=true;return true;},check_mixpanel:function(event_name){if(typeof tracking.events_options[event_name]==='undefined'){return true;}
var sampling_value=tracking.events_options[event_name].sampling;var id=USER.USER_ID===0?tracking.random_id:USER.USER_ID;if(id%100<sampling_value){return true;}
return false;},check_websocket:function(event_name){if(typeof tracking.events_options[event_name]==='undefined'){return false;}
if(typeof tracking.events_options[event_name].websocket!=='undefined'&&tracking.events_options[event_name].websocket){return true;}
return false;},track:function(event_name,properties,callback){if(typeof mixpanel==='undefined'){return false;}
if(typeof callback!=='function'){callback=function(){};}
if(typeof properties==='undefined'){properties={};}
if(tracking.check_websocket(event_name)){live.log.send(event_name,properties);}
if(typeof SESSION_DURATION==='number'){properties.session_duration=SESSION_DURATION;}
if(typeof tracking.double_tag[event_name]==='object'){var intersect_properties=intersectObject(properties,tracking.double_tag[event_name].properties);if(compareObject(intersect_properties,tracking.double_tag[event_name].properties)){var re_track=tracking.double_tag[event_name].tracking;tracking.track(re_track.event_name,re_track.properties);}}
if(tracking.check_mixpanel(event_name)){if(typeof tracking.events_options[event_name]==='object'){if(USER.USER_ID===0){properties.sampled_unique_id=tracking.events_options[event_name].sampling;}else{properties.sampled=tracking.events_options[event_name].sampling;}}
mixpanel.track(event_name,properties,callback);}else{callback();}
return true;},register:function(){try{if(typeof mixpanel==='undefined'){return false;}
var data={USER_ID:USER.USER_ID,USER_AGE:USER.USER_AGE,USER_GENDER:USER.USER_GENDER,FB_USER_ID:USER.FACEBOOK.UID,DZ_COUNTRY:COUNTRY,TWITTER:(typeof USER.TWITTER.TOKEN==='string'),OFFER_ID:OFFER_ID,TRY_AND_BUY:USER.TRY_AND_BUY.ACTIVE};mixpanel.register(data);mixpanel.people.identify(USER.USER_ID.toString());mixpanel.people.set({$last_login:timestampToDate(SERVER_TIMESTAMP,true),$created:USER.INSCRIPTION_DATE,$country_code:COUNTRY,offer_id:[OFFER_ID],age:USER.USER_AGE,gender:USER.USER_GENDER});return true;}catch(e){error.log(e);}},unregister:function(){var data=['USER_ID','USER_AGE','USER_GENDER','FB_USER_ID','TWITTER'];for(var i=0;i<data.length;i++){mixpanel.unregister(data[i]);}
return true;},trackCampaign:function(){try{if(location.search.length===0){return false;}
var query_string=location.search.substr(1);var allowed_tags=['ref','utm_source','utm_medium','utm_term','utm_content','utm_campaign'];var nb_tags=allowed_tags.length;var query_params={};var query_buffer=query_string.split('&');while(typeof query_buffer[0]!=='undefined'){var param=query_buffer.shift().split('=');query_params[param[0]]=param[1];}
for(var i=0;i<nb_tags;i++){var tag=allowed_tags[i];if(typeof query_params[tag]!=='undefined'&&query_params[tag]!==''){var tracking_info={url:location.protocol+'//'+location.hostname+location.pathname,query_string:query_string};var mixpanel_data={};for(var j=0;j<nb_tags;j++){var _tag=allowed_tags[j];if(typeof query_params[_tag]!=='undefined'&&query_params[_tag]!==''){mixpanel_data[_tag]=query_params[_tag];}}
if(countObject(mixpanel_data)>0){mixpanel.register(mixpanel_data);tracking.track('display_page',$.extend(tracking_info,mixpanel_data));}
break;}}
return true;}catch(e){error.log(e);}},registerABTest:function(){try{if(typeof mixpanel==='undefined'){return false;}
var data={};for(var i in USER.ABTEST){if(!USER.ABTEST.hasOwnProperty(i)){continue;}
data[USER.ABTEST[i].id]=USER.ABTEST[i].option;}
mixpanel.register(data);}catch(e){error.log(e);}},addFavoriteContext:function(data,context){try{context=context||naboo.getCurrentClass();if(context==='profile'){context=(profile.tab==='loved')?profile.tab:context;context=(profile.id==USER.USER_ID?'my_':'other_')+context;}
if(context==='playlist'){context=(playlist.isPersonal?'my_':'other_')+context;}
if(context==='artist'&&data.type==='artist'){data.main_artist=(data.id==artist.id);}
data.context=context;}catch(e){error.log(e);}},trackFormEvent:function($element,event,error){var properties=tracking.createFormFieldProperties($element);properties.event='on'+ucfirst(event);if(error){properties.error=error;}
tracking.track('navigation',properties);},createFormFieldProperties:function($field){var properties={};properties.id=$field.attr('id')||'';properties.type=$field.prop('tagName');properties.attributes={};$.each($field.get(0).attributes,function(){properties.attributes[this.name]=this.value;});return properties;}};};
(function(){'use strict';if(typeof window.EventsDelegation!=='undefined'){return;}
var tooltipDelayId;var EventsDelegation={mousedDownFired:false,excludeTracking:{play:true},initMouseClickEvents:function(){try{$(document).on('click','.evt-click',function(e){e.stopPropagation();e.preventDefault();var $this=$(this);var data=$this.data();var event_name='evt-click-'+util.uniqid();if(OFFLINE){if(typeof data.play!=='undefined'){dzoffline.display();}
return false;}
var action_list=['play','playNext','share','favorite','curator','link','close','tabs','deletePicture','changePicture','loginFacebook','registerFacebook','modal','redirect','userBlock','connect','login','register'];if(typeof $this.attr('href')!=='undefined'){data.link=$this.attr('data-link')||1;}
Events.ready(event_name,function(){for(var a in action_list){if(!action_list.hasOwnProperty(a)){continue;}
var action=action_list[a];if(typeof data[action]!=='undefined'&&parseInt(data[action],10)!==0){EventsDelegation[action]($this,data);}}
delete Events.deferredObjects[event_name];});EventsDelegation.tracking($this,data,event_name);});return true;}catch(e){error.log(e);}},initMouseOverEvents:function(){try{$(document).on('mouseenter','.evt-over',function(e){e.stopPropagation();e.preventDefault();var data=$(this).data();if(typeof data.tooltip!=='undefined'&&data.tooltip===1&&!$(this).is('.active')){var tooltip_data={fallback:data.tooltipFallback||$.fn.tipsy.defaults.fallback,gravity:data.tooltipGravity||$.fn.tipsy.defaults.gravity,trigger:data.tooltipTrigger||'manual',offset:(typeof data.tooltipOffset!=='undefined')?parseInt(data.tooltipOffset,10):$.fn.tipsy.defaults.offset,force_top:(typeof data.tooltipForceTop!=='undefined')?Boolean(parseInt(data.tooltipForceTop,10)):$.fn.tipsy.defaults.force_top};$(this).tipsy(tooltip_data);if(typeof data.tooltipDelay!=='undefined'){var element=$(this);tooltipDelayId=setTimeout(function(){element.tipsy('show');},data.tooltipDelay);}else{$(this).tipsy('show');}}
if(typeof data.hovercard!=='undefined'){hovercard.init($(this));}
return true;});return true;}catch(e){error.log(e);}},initMouseOutEvents:function(){try{$(document).on('mouseleave','.evt-out',function(e){e.stopPropagation();e.preventDefault();var data=$(this).data();if(typeof tooltipDelayId!=='undefined'&&tooltipDelayId>0){clearTimeout(tooltipDelayId);tooltipDelayId=0;}
if(typeof data.tooltip!=='undefined'&&data.tooltip===1&&typeof $(this).data('tipsy')!=='undefined'){$(this).tipsy('hide');}
if(typeof data.hovercard!=='undefined'){hovercard.remove();}
if(typeof data.cancelHover!=='undefined'){$(this).removeClass('evt-out evt-over cancel-hover');}
if(typeof data.play!=='undefined'&&data.play===1){clearTimeout(preview.timer);if(preview.active){preview.stop();}}
return true;});return true;}catch(e){error.log(e);}},initMouseDownEvents:function(){try{$(document).on('mousedown','.evt-click',function(e){if(e.button===2){return false;}
var $this=$(this);var data=$this.data();var event_name='evt-click-'+util.uniqid();if(typeof data.play!=='undefined'&&data.play===1&&data.enablePreview){preview.timer=window.setTimeout(function(){if(typeof data.tracking!=='undefined'){data.trackingTag='preview';EventsDelegation.tracking($this,data,event_name);EventsDelegation.mousedDownFired=true;}else{Events.resolve(event_name);}
preview.init($this);if(!$this.is('.active')){$this.tipsy('hide');}},500);}
return false;});return true;}catch(e){error.log(e);}},play:function($this,data){try{if(typeof data.type==='undefined'){return false;}
clearTimeout(preview.timer);if(preview.active){preview.stop();return true;}
if(preview.naturalFinish){preview.naturalFinish=false;return true;}
var params={type:data.type,context:{TYPE:'unknow',ID:0}};if(typeof data.id!=='undefined'){params.id=data.id;}
if(typeof data.playAuto==='boolean'){params.autoplay=data.playAuto;}
if(typeof data.radio==='boolean'){params.radio=data.radio;}
if(typeof data.playIndex==='number'){params.index=data.playIndex;}
if(typeof data.playSongList==='object'){params.data=data.playSongList;}
if(typeof data.playContext==='string'){params.context={TYPE:data.playContext,ID:data.id};}
if(typeof data.playContextId!=='undefined'){params.context.CONTEXT_ID=data.playContextId;}
var currentContext=dzPlayer.getContext();if((currentContext!==null&&LOG_CONTEXT[currentContext.TYPE]===LOG_CONTEXT[params.context.TYPE]&&currentContext.ID==params.context.ID&&typeof params.index==='undefined')||(Number(dzPlayer.getCurrentSong('MEDIA_ID'))===params.id)){EventsDelegation.toggleTrackingStatus(data);dzPlayer.control.togglePause();return true;}
if(params.type==='song'){params.type='track';}
if(typeof window.feed==='object'&&window.feed.is_webview===true){var type=((params.radio===true)?'radio/':'')+data.type;window.location='dzr://'+type+'/'+data.id+'?action=play';return true;}
dzPlayer.play(params);EventsDelegation.setSentToMobile($this,data);return true;}catch(e){error.log(e);}},setSentToMobile:function($this,data){if(data.isSentToMobile){if(thumbnails.push_mobile%3===0){$this.parent().find('[data-sent-to-mobile="1"]').addClass('active');}
thumbnails.push_mobile+=1;}
return true;},toggleTrackingStatus:function(data){if(typeof data.tracking==='undefined'){return false;}
data.tracking=(typeof data.tracking==='string')?'':!data.tracking;},playNext:function($this,data){try{if(typeof data.id==='undefined'){return false;}
api.call('song.getData',{SNG_ID:data.id,COUNTRY:COUNTRY},function(result){dzPlayer.addNextTracks([result]);return true;});return true;}catch(e){error.log(e);}},share:function($this,data){return sharebox.load(data.type,data.id);},favorite:function($this,data){try{if(typeof data.type==='undefined'||typeof data.id==='undefined'){return false;}
Events.trigger(Events.user.clickFavorite,$.extend({},data));if(typeof data.favoriteDelegate!=='undefined'){window[data.favoriteDelegate].favoriteAction($this,$.extend({},data));}else{favorite.action($this,$.extend({},data));}
return true;}catch(e){error.log(e);}},changePicture:function($this,data){try{Events.trigger(Events[data.type].uploadPicture);return true;}catch(e){error.log(e);}},userBlock:function($this,data){try{user[(data.blocked===0)?'block':'unblock']($this,data.id,null);return true;}catch(e){error.log(e);}},deletePicture:function($this,data){try{var post={};if(typeof data.id!=='undefined'){post[data.type+'_id']=data.id;}
api.call({method:data.type+'.deletePicture',data:post,success:function(){Events.trigger(Events[data.type].updatePicture,{md5:'',type:''});}});}catch(e){error.log(e);}},curator:function($this,data){try{if(typeof data.curatorAction==='undefined'||typeof data.type==='undefined'||typeof data.id==='undefined'){return false;}
switch(data.curatorAction){case'push_album':if(data.type==='album'){modal.open('/lightbox/curators/push_album/'+data.id);}
break;case'genre_album':if(data.type==='album'){modal.open('/lightbox/curators/update_genre/'+data.id);}
break;default:break;}
return true;}catch(e){error.log(e);}},modal:function($this,data){try{if(data.modal==='/close'){modal.close();return true;}
var force=data.modalForce||false;modal.open(data.modal,force);return true;}catch(e){error.log(e);}},connect:function(){www.goToConnection();},login:function(){www.goToLogin();},register:function(){www.goToRegister();},loginFacebook:function($this,data){try{if(typeof data.loginRedirect==='string'&&data.loginRedirect.length>=4&&data.loginRedirect.substr(0,4)==='http'){window.location.href=data.loginRedirect;return true;}
var redirect=data.loginRedirect||'';var login_only=true;if(typeof data.loginOnly!=='undefined'){login_only=Boolean(data.loginOnly);}
tracking.trackFormEvent($this,'click');facebook.login({login_only:login_only,redirect:redirect});if(PLATFORM==='web'){modal.close();}
return true;}catch(e){error.log(e);}},registerFacebook:function($this,data){try{if(typeof data.loginRedirect==='string'&&data.loginRedirect.length>=4&&data.loginRedirect.substr(0,4)==='http'){window.location.href=data.loginRedirect;return true;}
var redirect=((data.loginRedirect)?data.loginRedirect:'')||'';if(PLATFORM!=='web'&&redirect!==''){window.location.href=redirect;return true;}
if(redirect!==Object(redirect)){redirect='';}
tracking.trackFormEvent($this,'click');window.auth.register.create_account_fb_click(redirect);return true;}catch(e){error.log(e);}},redirect:function($this,data){try{var redirect=data.redirect.toString();if(redirect.substr(0,1)==='/'||redirect.substr(0,4)==='http'){window.location.href=redirect;return true;}
var href=$this.attr('href');if(typeof href!=='string'||href.indexOf('javascript:')>-1||href===''){return false;}
window.location.href=href;return true;}catch(e){error.log(e);}},link:function($this,data){try{var href=$this.attr('href');var target=$this.attr('target');var is_webview=(typeof window.feed==='object'&&window.feed.is_webview===true);if(OFFLINE){return false;}
if(href.indexOf('javascript:')>-1||href===''){return false;}
if((href.substr(0,4)==='http')||target==='_blank'){if(target!=='_blank'&&(is_webview||href.indexOf(SETTING_HOST)>-1)){href=href.replace(RegExp('https?://'+SETTING_HOST+'/'),'');if(is_webview){href='dzr://'+href;}
window.location=href;return true;}
window.open(href);return true;}
if(href.charAt(0)==='/'&&!data.redirect){if(is_webview){window.location='dzr:/'+href;return true;}
loadBox(href);return true;}
return false;}catch(e){error.log(e);}},tabs:function($this){try{return tabs.navClick($this);}catch(e){error.log(e);}},close:function($this){try{$this.parents('[data-target="close"]').remove();return true;}catch(e){error.log(e);}},tracking:function($this,data,event_name){try{if(EventsDelegation.mousedDownFired===true||data.tracking===0||typeof data.trackingTag==='undefined'){EventsDelegation.mousedDownFired=false;Events.resolve(event_name);return false;}
if(typeof data.tracking==='string'&&typeof window[data.tracking]!=='undefined'&&typeof window[data.tracking].tracking==='function'&&typeof data.trackingId!=='undefined'){return window[data.tracking].tracking(data.trackingTag,data.trackingId,function(){Events.resolve(event_name);});}
var tracking_params={};if(typeof data.trackingParams!=='undefined'&&typeof data.trackingParams==='string'){tracking_params=$.extend(tracking_params,JSON.parse(data.trackingParams.replace(/'/g,'"')));}
Events.resolve(event_name);if(typeof EventsDelegation.excludeTracking[data.trackingTag]!=='undefined'){return false;}
tracking.track(data.trackingTag,tracking_params,function(){if(typeof data.trackingCallback==='string'){eval(data.trackingCallback);}});}catch(e){error.log(e);}}};EventsDelegation.initMouseOverEvents();EventsDelegation.initMouseOutEvents();EventsDelegation.initMouseDownEvents();EventsDelegation.initMouseClickEvents();window.EventsDelegation=EventsDelegation;})();;
var ads={smart_site:'deezer',inactivity_count:0,ads_url_prefix:'http://ww400.smartadserver.com/call/pubj/',feed_ads_position:0,allow_audio:true,inactivity_duration:240,refresh_duration:240,init:function(){try{if(!USER.OPTIONS.ads_display&&!USER.OPTIONS.ads_audio){return false;}
if(USER.USER_ID>0&&dateToTimestamp(USER.INSCRIPTION_DATE)+172800>SERVER_TIMESTAMP){USER.OPTIONS.ads_display=false;USER.OPTIONS.ads_audio=false;$('body').removeClass('dz_ads');return true;}
if(SETTING_HOST==='orange.deezer.com'||SETTING_HOST.indexOf('orange.deezerdev.com',0)!==-1){ads.smart_site='orange';}
Events.subscribe(Events.navigation.page_changed,function(evt,params){if(naboo.getCurrentPath()===params.path){return false;}
ads.resetRefreshCounter();disableAds();});Events.subscribe(Events.player.play,function(evt,param){startAudioAdsTimer();});return true;}catch(e){error.log(e);}},setMassMotion:function(data){try{if(typeof data.redirect.js!='undefined'&&data.redirect.js.length>0){var headElement=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.async=true;script.src=data.redirect.js;headElement.appendChild(script);}
return true;}catch(e){error.log(e);}},setSwf:function(div,id,content,w,h,clickMethod,clickCommand,bgColor,wmode){try{if($('#'+div).length===0){return false;}
var oldId;if($('[id='+div+']').length>1){oldId=div;var newId=div+'_'+SERVER_TIMESTAMP;$('#'+oldId).attr('id',newId);div=newId;}
var so=new SWFObject(content,id,w,h,'8',bgColor);so.addParam('wmode',wmode);so.addParam('allowScriptAccess','always');so.addVariable(clickMethod,clickCommand);so.write(div);$('#'+div).show();if(typeof oldId!='undefined'){$('#'+div).attr('id',oldId);}
return true;}catch(e){error.log(e);}},setImage:function(div,content,clickCommand,clickCommandTarget){try{if($('#'+div).length===0){return false;}
$('#'+div).html('<a href="'+clickCommand+'" target="'+clickCommandTarget+'"><img src="'+content+'" /></a>').show();}catch(e){error.log(e);}},setText:function(div,str,max_length){try{if($('#'+div).length===0||typeof str==='undefined'||typeof max_length==='undefined'){return false;}
$('#'+div).text(str.substr(0,max_length));}catch(e){error.log(e.message,e.stack);}},setUrl:function(div,url){try{if($('#'+div).length===0||typeof url==='undefined'){return false;}
$('#'+div).prop('href',url);}catch(e){error.log(e.message,e.stack);}},setVideo:function(div,id,content,w,h,startImage,endImage,autoPlayDelay,clickCommand){try{if($('#'+div).length===0){return false;}
var so=new SWFObject(SETTING_STATIC+'/swf/videoAdsPlayer-v'+STATIC_VERSION+'.swf',id,w,h,'9');so.addParam('wmode','opaque');so.addParam('allowScriptAccess','always');so.addVariable('urlContent',content);so.addVariable('urlStartImage',startImage);so.addVariable('urlEndImage',endImage);so.addVariable('autoPlayDelay',autoPlayDelay);so.addVariable('clickTag',clickCommand);so.write(div);return true;}catch(e){error.log(e);}},setRedirect:function(div,js,clickCommand,w,h){try{if($('#'+div).length===0){return false;}
$('#'+div).html('<iframe src="'+SETTING_STATIC+'/ads/iframe-v'+STATIC_VERSION+'.html?tag='+bin2hex(js)+'&clickcommand='+encodeURIComponent(clickCommand)+'" scrolling="no" resizable="no" width="'+w+'" height="'+h+'" frameborder="0"></iframe>').show();return true;}catch(e){error.log(e);}},setPixelAgence:function(url,id){try{if(url===''){return false;}
if($('#'+id).length==0){$('body').append($('<div id="'+id+'"></div>'));}
$('#'+id).html('<img src="'+url+'" onLoad="try {ads.unsetPixelAgence('+'\''+id+'\''+')} catch (e) {}; return true" onError="try {ads.unsetPixelAgence('+'\''+id+'\''+')} catch (e) {}; return true" />');return true;}catch(e){error.log(e);}},unsetPixelAgence:function(id){try{$('#'+id).text('');return true;}catch(e){error.log(e);}},setAlenty:function(data){try{if(typeof data.tracking.alenty!='undefined'&&data.tracking.alenty.length>0){var headElement=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.async=true;script.src=data.tracking.alenty;headElement.appendChild(script);}
return true;}catch(e){error.log(e);}},callAds:function(tags,isAudio){try{if(typeof isAudio=='undefined'){isAudio=false;}
if(typeof USER!='undefined'&&USER.OPTIONS.ads_display===false&&!isAudio){return false;}
if(typeof USER!='undefined'&&USER.OPTIONS.ads_audio===false&&isAudio){return false;}
var urlParams=tags+ads.adsUrlParams();var headElement=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.async=true;script.src=ads.ads_url_prefix+urlParams;headElement.appendChild(script);var tagList=tags.split('/');if(typeof tagList[2]=='undefined'){return false;}
var formatId=tagList[2];if(typeof adsCurrentDisplay[formatId]=='undefined'){if(formatId!='7073'&&formatId!='17992'&&formatId!='19632'){adsCurrentDisplay[formatId]={url:tags,refreshDuration:ads.refresh_duration,refreshCount:0};}}}catch(e){error.log(e);}},adsUrlParams:function(){try{var params=';user_age='+USER.USER_AGE;params+=';user_sexe='+USER.USER_GENDER;params+=';env='+ENV;params+=';pr='+((typeof DZPS==='boolean'&&DZPS===true)?'1':'0');params+=';user_id='+USER.USER_ID;params+=';username='+(typeof USER.BLOG_NAME==='string'?encodeURIComponent(USER.BLOG_NAME):'');params+=';firstname='+(typeof USER.FIRSTNAME==='string'?encodeURIComponent(USER.FIRSTNAME):'');params+=';lastname='+(typeof USER.LASTNAME==='string'?encodeURIComponent(USER.LASTNAME):'');params+=';partners='+encodeURIComponent(USER.PARTNERS);params+=';offer_id='+OFFER_ID;params+=';focus='+ads_focus_value;params+=';site='+ads.smart_site;params+=';user_fc='+(USER.FACEBOOK.UID?'1':'0');params+=';favorite_tag='+USER.FAVORITE_TAG;params+=';lang='+SETTING_LANG;params+=';player_play='+((dzPlayer.playing)?'1':'O');return params+'?';}catch(e){error.log(e);}},incrementRefreshCounter:function(){try{for(var a in adsCurrentDisplay){if(!adsCurrentDisplay.hasOwnProperty(a)){continue;}
adsCurrentDisplay[a].refreshCount+=10;}
if(!ads_focus_value){ads.inactivity_count+=10;}
ads.checkAutoRefresh(false);}catch(e){error.log(e);}},checkAutoRefresh:function(resetInactivity){try{for(var a in adsCurrentDisplay){if(!adsCurrentDisplay.hasOwnProperty(a)){continue;}
if(adsCurrentDisplay[a].refreshCount>=adsCurrentDisplay[a].refreshDuration&&ads_focus_value){var reCallUrl=';automatic_refresh=true';if(ads.inactivity_count>=ads.inactivity_duration){reCallUrl+=';billboard=true';}
if(dzPlayer.getPlayerType()!='ads'){ads.callAds(adsCurrentDisplay[a].url+reCallUrl);}
adsCurrentDisplay[a].refreshCount=0;ads.inactivity_count=0;}}
if(resetInactivity){ads.inactivity_count=0;}
return true;}catch(e){error.log(e);}},resetRefreshCounter:function(){try{ads.inactivity_count=0;adsCurrentDisplay={};}catch(e){error.log(e);}},displayAutopromo:function(data){try{var clickCommandTarget='_'+data.LINKTYPE;var clickCommandUrl=data.LINK;if(clickCommandTarget=='_internal'){clickCommandTarget='_self';clickCommandUrl='javascript:'+clickCommandUrl;}
var adsHeader={format:{formatType:'image',formatSize:'770x120'},content:{urlContent:SETTING_DOMAIN_IMG+'/misc/'+data.BACKGROUND+'/0x0-000000-80-0-0.jpg'},background:{backgroundUrl:SETTING_DOMAIN_IMG+'/misc/'+data.RIGHT_COLUMN+'/0x0-000000-80-0-0.jpg',backgroundColor:'#'+data.COLOR},tracking:{clickCommand:clickCommandUrl,clickCommandTarget:clickCommandTarget,clickTagMethod:'',pixelAgence:'',alenty:'',timestamp:''},options:{repeat:'no-repeat',displayBackground:true}};displayAdsPlayer(adsHeader);return true;}catch(e){error.log(e);}}};var adsCurrentDisplay={};var homepage_end_background='';var timeout_ads_video=null;function dclk_show(){if(typeof expand_data!='undefined'){var ads_expand=$('#ads_expand');if(ads_expand.length==1){ads.setSwf('ads_expand','ads_expand_swf',expand_data.expand.urlContentExpand,expand_data.expand.widthExpand,expand_data.expand.heightExpand,expand_data.tracking.clickTagMethod,expand_data.tracking.clickCommand,'#FFFFFF','transparent');ads_expand.parent().css('position','');var position={left:expand_data.expand.posXExpand,top:expand_data.expand.posYExpand};if(expand_data.format.formatSize=='300x250'){if(position.left=='0'&&position.top=='0'){position.top=$('#ads_300x250').offset().top;position.left=$('#ads_300x250').offset().left+300-expand_data.expand.widthExpand;}else{position.top=$('#ads_300x250').offset().top;position.left=$('#ads_300x250').offset().left-expand_data.expand.widthExpand-20;}}else if(expand_data.format.formatSize=='750x120'||expand_data.format.formatSize=='728x90'){var padding=0;var $source=$('#'+expand_data.div);if(position.left=='0'&&position.top=='0'){position.top=$source.offset().top+((expand_data.div==='ads_banner_bottom')?-100:padding);position.left=$source.children().offset().left;}else{position.top=$source.offset().top+((expand_data.div==='ads_banner_bottom')?-400:(120+(padding*2)));position.left=$source.children().offset().left;Events.subscribeOnce(Events.layout.adsBackground,function(evt,data){if(data.display==='show'){ads_expand.css('left',($source.offset().left+15)+'px');}},'expand_resize');}}
ads_expand.css({top:position.top+'px',left:position.left+'px',display:'block'});}}}
dclk_hide=dclk_hide_overlay=function(){$('#ads_expand').hide().text('');};function open_window(page){window.open(page);}
function encodeClickCommand(str){try{var split_command=str.split('%7Esscs%3D%3f',2);if(typeof split_command[0]!='undefined'&&typeof split_command[1]!='undefined'){split_command2=split_command[1].split('http%3A%2F',2);if(typeof split_command2[0]!='undefined'&&typeof split_command2[1]!='undefined'){str=split_command[0]+'%7Esscs%3D%3f'+split_command2[0]+'http%3A%2F'+split_command2[1];}else{str=split_command[0]+'%7Esscs%3D%3f'+escape(split_command[1]);}}
return str;}catch(e){error.log(e);}}
function displayAdsHabillage(data){try{if(typeof data.header.url!='undefined'){data.header.url=encodeClickCommand(data.header.url);}
var banner_div;if(data.background.backgroundType=='image'){$('body').addClass('has-ads');$('#ads_banner_left').css('background-color',data.background.color);$('#ads_banner_left > img').attr('src',data.background.backgroundUrl);$('body').addClass('has-ads-full');}else if(typeof data.background.backgroundType!='undefined'&&data.background.backgroundType=='video'&&typeof data.background.url!='undefined'&&typeof data.background.color!='undefined'&&typeof data.header.url!='undefined'&&$('#ads_video').length==1){$('#ads_video').show();var so=new SWFObject(SETTING_STATIC+'/swf/deezerplayer-v'+STATIC_VERSION+'.swf?feed='+data.background.url+'&stretch=fill&smooth=on&volume=0&clickTAG='+data.header.url,'ads_video_swf','100%','100%','9',data.background.color);so.addParam('wmode','opaque');so.addParam('allowScriptAccess','always');so.write('ads_video');if(typeof data.background.urlEndImage!='undefined'){homepage_end_background=data.background.urlEndImage+' no-repeat center 104px';}
if(typeof data.background.videoDuration!='undefined'&&data.background.videoDuration>0){timeout_ads_video=setTimeout(function(){disableAdsVideo();},(data.background.videoDuration*1000));}}else if(data.background.backgroundType=='massmotion'){ads.setMassMotion(data);}else if(data.background.backgroundType=='redirect'&&typeof data.redirect.js!='undefined'&&data.redirect.js.length>0){banner_div='naboo_banner_habillage';ads.setRedirect(banner_div,data.redirect.js,data.header.url,data.header.width,data.header.height);}
if(data.background.backgroundType!='massmotion'&&data.background.backgroundType!='redirect'){var bgColor='#FFFFFF';var wmode='transparent';if(typeof data.header.swfBackgroundColor!='undefined'&&data.header.swfBackgroundColor.length>0){bgColor=data.header.swfBackgroundColor;wmode='opaque';}
banner_div='naboo_banner_habillage';ads.setSwf(banner_div,banner_div+'_swf',data.header.location,data.header.width,data.header.height,data.header.method,data.header.url,bgColor,wmode);$('#'+banner_div).css('height',data.header.height).show();if(data.background.backgroundType=='video'){$('#'+banner_div).css('visibility','hidden');}}
if(typeof data.background.centerColor!='undefined'&&data.background.centerColor!==''){$('#homepage').css('background',data.background.centerColor);}
if(typeof data.header.url!='undefined'&&typeof data.background.url!='undefined'&&data.background.url!==''){$('#naboo > .page-content > .page-ads').attr('onclick','window.open = \''+data.header.url+'\'');}
if(typeof data.tracking.pixelAgence!='undefined'){ads.setPixelAgence(data.tracking.pixelAgence,'ads_pixel');}
ads.setAlenty(data);Events.trigger(Events.layout.adsBanner,{display:'show',type:'right'});return true;}catch(e){error.log(e);}}
function disableAdsHabillage(){try{$('body').removeClass('has-ads-full');$('#ads_banner_left > img').removeAttr('src');ads.allow_audio=true;return true;}catch(e){console.log(e.message,e.stack);}}
function hideAdsHabillage(page){try{$('body').removeClass('has-ads-full has-ads');ads.allow_audio=true;Events.trigger(Events.layout.adsBackground,{display:'hide'});return true;}catch(e){error.log(e);}}
function disableAdsVideo(){try{if(timeout_ads_video!==null){clearTimeout(timeout_ads_video);}
$('#ads_video').hide().text('');$('#banner_habillage').css('visibility','visible');if(homepage_end_background!==null&&homepage_end_background!==''){www.displayBackground(homepage_end_background);}
return true;}catch(e){error.log(e);}}
function displayAdsBillboard(data){error.log('displayAdsBillboard:deprecated');}
function displayAdsInterstitial(data){try{var billboard_data={url:data.content.urlContent,click:data.tracking.clickCommand,pixelAgence:data.tracking.pixelAgence,pixelAgenceScript:data.tracking.pixelAgenceScript,clickTagMethod:data.tracking.clickTagMethod,pixelAgence:data.tracking.pixelAgence,target:'_blank',duration:data.options.duration,type:'ads_interstitial',format:data.format.formatType,formatSize:data.format.formatSize,redirect:data.redirect};displayInterstitial(billboard_data);ads.setAlenty(data);}catch(e){error.log(e);}}
var adsTimeoutId=0;var currentAudioAds='';var firstAudioAdsFinish=false;var firstAudioAdsTimer=(ENV==='PROD')?60000:30000;var audioAdsTimer=(ENV==='PROD')?540000:45000;function startAudioAdsTimer(){try{if(typeof USER!=='undefined'&&USER.OPTIONS.ads_audio===false){return false;}
if(adsTimeoutId>0){return false;}
if(dzPlayer.getAudioAds()!==null){return false;}
adsTimeoutId=window.setTimeout(getAudioAds,firstAudioAdsFinish?audioAdsTimer:firstAudioAdsTimer);firstAudioAdsFinish=true;return true;}catch(e){error.log(e);}}
function stopAudioAdsTimer(){try{currentAudioAds='';if(adsTimeoutId>0){window.clearTimeout(adsTimeoutId);}
adsTimeoutId=0;return true;}catch(e){error.log(e);}}
function startDisplayAudioAds(){try{if(currentAudioAds!==''){if(typeof currentAudioAds.tracking.vastImpression!='undefined'){for(var j=0;j<currentAudioAds.tracking.vastImpression.length;j++){var urlImpression=currentAudioAds.tracking.vastImpression[j];if(urlImpression.indexOf('sz=1x1')>-1){ads.setPixelAgence(urlImpression,'ads_pixel');}else{sendRequest(urlImpression,'text','');}}}
if((currentAudioAds.content.urlContent!==''||currentAudioAds.content.htmlContent!==''||(currentAudioAds.format.formatType=='massmotion'&&currentAudioAds.redirect.js!==''))){if(naboo.getCurrentClass()!==null||www.getCurrentPageType()=='radio'){Events.subscribe(Events.player.adsVastPlaying,adsVastPlayingControl);displayAdsPlayer(currentAudioAds,false);}else{countAdsPlayer(currentAudioAds.tracking.pixelAgence);}}}
return true;}catch(e){error.log(e);}}
function adsVastPlayingControl(evt,data){try{if(dzPlayer.getAudioAds()===null){return false;}
if(typeof dzPlayer.getAudioAds().audio=='undefined'){return false;}
var quartile=Math.round(dzPlayer.getAudioAds().audio.duration/4);if(Math.floor(data.position)==1&&typeof dzPlayer.getAudioAds().tracking.trackingStart!='undefined'){sendRequest(dzPlayer.getAudioAds().tracking.trackingStart,'text','');delete dzPlayer.getAudioAds().tracking.trackingStart;}else if(Math.floor(data.position)==quartile&&typeof dzPlayer.getAudioAds().tracking.trackingFirstQuartile!='undefined'){sendRequest(dzPlayer.getAudioAds().tracking.trackingFirstQuartile,'text','');delete dzPlayer.getAudioAds().tracking.trackingFirstQuartile;}else if(Math.floor(data.position)==quartile*2&&typeof dzPlayer.getAudioAds().tracking.trackingMidpoint!='undefined'){sendRequest(dzPlayer.getAudioAds().tracking.trackingMidpoint,'text','');delete dzPlayer.getAudioAds().tracking.trackingMidpoint;}else if(Math.floor(data.position)==quartile*3&&typeof dzPlayer.getAudioAds().tracking.trackingThirdQuartile!='undefined'){sendRequest(dzPlayer.getAudioAds().tracking.trackingThirdQuartile,'text','');delete dzPlayer.getAudioAds().tracking.trackingThirdQuartile;}else if(Math.floor(data.position)==dzPlayer.getAudioAds().audio.duration&&typeof dzPlayer.getAudioAds().tracking.trackingComplete!='undefined'){sendRequest(dzPlayer.getAudioAds().tracking.trackingComplete,'text','');delete dzPlayer.getAudioAds().tracking.trackingComplete;}}catch(e){error.log(e);}}
function displayAdsVast(url,defaultSize){try{sendRequest(url,'text','',true,function(xml){var xmlDoc=$.parseXML(xml.responseText);$xml=$(xmlDoc);$ad=$xml.find('Ad');if($ad.length===0){return false;}
$linear=$xml.find('Linear');$companion=$xml.find('CompanionAds');$impressions=[];for(var i=0;i<$xml.find('Impression').length;i++){$impressions.push(str_replace($xml.find('Impression')[i].textContent,'[timestamp]',SERVER_TIMESTAMP));}
for(var i=0;i<$xml.find('CompanionAds [event="creativeView"]').length;i++){$impressions.push(str_replace($xml.find('CompanionAds [event="creativeView"]')[i].textContent,'[timestamp]',SERVER_TIMESTAMP));}
var format='';if($companion.find('StaticResource').text()!==''){format=$companion.find('StaticResource').attr('creativeType');if(format.indexOf('image')>-1){format='image';}else if(format.indexOf('massmotion')>-1){format='massmotion';}else if(format.indexOf('swf')>-1){format='swf';}}else if($companion.find('HTMLResource').text()!==''){format='html';}
var size=(typeof defaultSize!='undefined')?defaultSize:'728x90';if($companion.find('Companion').attr('width')!='0'&&$companion.find('Companion').attr('height')!='0'){size=$companion.find('Companion').attr('width')+'x'+$companion.find('Companion').attr('height');}
currentAudioAds={format:{formatType:format,formatSize:size},content:{urlContent:$companion.find('StaticResource').text(),htmlContent:str_replace($companion.find('HTMLResource').text(),'[timestamp]',SERVER_TIMESTAMP)},audio:{url:$linear.find('MediaFile').text(),duration:formatedTimeToSecond($linear.find('Duration').text())},textlink:{text:$xml.find('AdTitle').text()},tracking:{clickCommand:$companion.find('CompanionClickThrough').text(),vastImpression:$impressions,trackingStart:$linear.find('Tracking[event="start"]').text(),trackingFirstQuartile:$linear.find('Tracking[event="firstQuartile"]').text(),trackingMidpoint:$linear.find('Tracking[event="midpoint"]').text(),trackingThirdQuartile:$linear.find('Tracking[event="thirdQuartile"]').text(),trackingComplete:$linear.find('Tracking[event="complete"]').text()}};dzPlayer.setAudioAds(currentAudioAds);});}catch(e){error.log(e);}}
function displayAudioAds(data){try{if(typeof data.format!='undefined'&&typeof data.format.formatType!='undefined'&&data.format.formatType=='redirect'){displayAdsVast(data.redirect.js,data.format.formatSize);return true;}
dzPlayer.setAudioAds(data);if(typeof data.expand!='undefined'&&typeof data.expand.urlContentExpand!='undefined'&&data.expand.urlContentExpand.length>0){expand_data=data;}
currentAudioAds=data;}catch(e){error.log(e);}}
function disableAudioAds(){try{$('#ads_banner_audio').hide().empty();if($('#ads_banner_top').children().length===0){$('body').removeClass('has-ads-top');}
if($('#ads_banner_bottom').children().length===0){$('body').removeClass('has-ads-bottom');}
$('#ads_banner_top').show();$('#ads_banner_bottom').show();if(typeof $('#naboo > .page-content > .page-ads > img').attr('src')==='string'||typeof $('#ads_banner_left > img').attr('src')==='string'){$('body').addClass('has-ads has-ads-full');Events.trigger(Events.layout.adsBackground,{display:'show'});}}catch(e){error.log(e);}}
function getAudioAds(){try{var sas_id=0;var ads_page_id={explore:274132,tops:274126,search:115072,result:115072,playlist:115067,album:115066,artist:115069,radio:115070,feed:114873,home:114873,profile:115081,track:487686,talk:555138,show:555137};if(typeof ads_page_id[naboo.getCurrentClass()]==='number'&&ads.allow_audio){sas_id=ads_page_id[naboo.getCurrentClass()];}
if(sas_id>0){var elementType=www.getCurrentPageType();var elementId=www.getCurrentPageId();var elementStyle=0;var ord=parseInt(Math.random()*10000000000000000);ads.callAds('15829/'+sas_id+'/7073/S/'+ord+'/element_type='+elementType+';element_id='+elementId+';element_style='+elementStyle,true);}
stopAudioAdsTimer();}catch(e){error.log(e);}}
histoUrl={adsPlayer:[]};function displayAdsFooter(data){try{if(typeof data=='undefined'){return false;}
if(naboo.getCurrentClass()===null){return false;}
if(menu.MenuComponent&&menu.MenuComponent.isPanelOpen('lyrics')){$('body').addClass('has-lyrics-ads-bottom');displayAdsBanner(data,'lyrics_ads_banner_bottom');}else{$('body').addClass('has-ads-bottom');$('#ads_banner_bottom').parent().removeClass('ads-120');displayAdsBanner(data,'ads_banner_bottom');}}catch(e){error.log(e);}}
function displayAdsPlayer(data,removeHabillage){try{if(typeof data=='undefined'){return false;}
if(naboo.getCurrentClass()===null){return false;}
if(typeof removeHabillage==='undefined'){removeHabillage=true;}
$('body').addClass('has-ads-top');var div_ads;var div_ads_audio='ads_banner_audio';if(typeof data.audio!='undefined'&&typeof data.audio.url!='undefined'){$('body').addClass('has-ads-bottom');div_ads=div_ads_audio;$('#'+div_ads_audio).show();$('#ads_banner_top').hide();$('#ads_banner_bottom').hide();}else{div_ads='ads_banner_top';$('#'+div_ads_audio).hide();}
if(removeHabillage){disableAdsHabillage();}else{hideAdsHabillage();}
if(typeof data.background!='undefined'&&typeof data.background.backgroundUrl!='undefined'&&data.background.backgroundUrl.length>0){$('body').addClass('has-ads has-ads-full');$('#ads_banner_left > img').attr('src',data.background.backgroundUrl);ads.allow_audio=true;if(typeof data.options.allow_audio!=='undefined'){ads.allow_audio=data.options.allow_audio;}
Events.trigger(Events.layout.adsBackground,{display:'show'});}
if(typeof data.background!='undefined'&&typeof data.background.backgroundColor!='undefined'&&data.background.backgroundColor.length>0){$('body').addClass('has-ads has-ads-full');$('#ads_banner_left').css('background-color',data.background.backgroundColor);}
displayAdsBanner(data,div_ads);return true;}catch(e){error.log(e);}}
function displayAdsBanner(data,div_ads){try{if(typeof data.options!='undefined'&&typeof data.options.refresh!='undefined'&&typeof data.format.formatId!='undefined'){if(data.options.refresh===false){delete adsCurrentDisplay[data.format.formatId];}else if(typeof data.options.refreshDuration!=='undefined'&&data.options.refreshDuration!=0){adsCurrentDisplay[data.format.formatId].refreshDuration=data.options.refreshDuration;}}
if(typeof data.format!='undefined'&&typeof data.format.formatSize!='undefined'){formatType=data.format.formatType;formatSize=data.format.formatSize;formatSizes=formatSize.split('x');if((div_ads==='ads_banner_bottom'||div_ads==='ads_banner_audio')&&formatSizes[1]==120){$('#'+div_ads).parent().addClass('ads-120');}else if(div_ads==='ads_banner_top'){$('#'+div_ads).height(formatSizes[1]);}}else{return false;}
if(typeof data.tracking.clickCommand!='undefined'&&formatType=='swf'){data.tracking.clickCommand=encodeClickCommand(data.tracking.clickCommand);}
if(typeof data.billboard!='undefined'&&typeof data.billboard.billboardUrl!='undefined'&&data.billboard.billboardUrl.length>0){var billboard_data={url:data.billboard.billboardUrl,click:data.tracking.clickCommand,target:'_blank',duration:3,type:'ads_billboard'};displayInterstitial(billboard_data);}
if(formatType=='massmotion'){ads.setMassMotion(data);}else if(formatType=='swf'){var bgColor='#FFFFFF';if(typeof data.content.swfBackgroundColor!='undefined'&&data.content.swfBackgroundColor.length>0){bgColor=data.content.swfBackgroundColor;}
ads.setSwf(div_ads,div_ads+'_swf',data.content.urlContent,formatSizes[0],formatSizes[1],data.tracking.clickTagMethod,data.tracking.clickCommand,bgColor,'transparent');}else if(formatType=='image'){if(typeof data.tracking.clickCommandTarget=='undefined'){data.tracking.clickCommandTarget='_blank';}
ads.setImage(div_ads,data.content.urlContent,data.tracking.clickCommand,data.tracking.clickCommandTarget);}else if(formatType=='redirect'&&typeof data.redirect.clickCommand!='undefined'){ads.setRedirect(div_ads,data.redirect.js,data.redirect.clickCommand,formatSizes[0],formatSizes[1]);}else if(formatType=='html'&&data.content.htmlContent!=''&&currentAudioAds.format.formatSize!=null){ads.setRedirect(div_ads,escape(data.content.htmlContent),'',formatSizes[0],formatSizes[1]);}
if(typeof data.tracking.pixelAgence!='undefined'&&typeof data.tracking.timestamp!='undefined'){if(typeof histoUrl.adsPlayer[data.tracking.pixelAgence+'|'+data.tracking.timestamp]=='undefined'){ads.setPixelAgence(data.tracking.pixelAgence,'ads_pixel');histoUrl.adsPlayer[data.tracking.pixelAgence+'|'+data.tracking.timestamp]=true;}}
if(data.tracking.pixelAgenceScript){$('head').append(unescape(data.tracking.pixelAgenceScript));}
if(typeof data.background!='undefined'&&typeof data.tracking.clickCommand!='undefined'&&typeof data.background.backgroundUrl!='undefined'&&data.background.backgroundUrl.length>0){if(typeof data.tracking.clickCommandTarget=='undefined'){data.tracking.clickCommandTarget='_blank';}
$('#ads_banner_left').attr({onclick:'window.'+((data.tracking.clickCommandTarget=='_blank')?'open':'location')+'(\''+data.tracking.clickCommand+'\'); return false;'});}
if(typeof data.expand!='undefined'&&typeof data.expand.urlContentExpand!='undefined'&&data.expand.urlContentExpand.length>0){expand_data=data;expand_data.div=div_ads;if(expand_data.expand.autoExpand=='Yes'){dclk_show();expand_data=null;}}
ads.setAlenty(data);Events.trigger(Events.layout.adsBanner,{display:'show',type:(div_ads==='ads_banner_top'?'top':'bottom')});return true;}catch(e){error.log(e);}}
function countAdsPlayer(pixelAgence){try{$('#ads_pixel').html('<img src="'+pixelAgence+'"/>');return true;}catch(e){error.log(e);}}
function disableAdsPlayer(){try{$('#ads_banner_top').hide().text('');return true;}catch(e){error.log(e);}}
function disableAds(){try{$('body').removeClass('has-ads-bottom has-ads-top');$('#ads_banner_top').empty();$('#ads_banner_bottom').empty();Events.unsubscribeAll('expand_resize');disableAdsHabillage();Events.trigger(Events.layout.adsBanner,{display:'hide'});return true;}catch(e){error.log(e);}}
var expand_data=null;function displayAdsClassic(data){try{formatSize=data.format.formatSize;formatSizes=formatSize.split('x');formatType=data.format.formatType;if(typeof data.options!='undefined'&&typeof data.options.refresh!='undefined'&&typeof data.format.formatId!='undefined'){if(data.options.refresh===false){delete adsCurrentDisplay[data.format.formatId];}
if(typeof data.options.refreshDuration!='undefined'&&data.options.refreshDuration!=0){adsCurrentDisplay[data.format.formatId].refreshDuration=data.options.refreshDuration;}}
var div_ads;if(formatSize=='300x250'||formatSize=='300x600'||formatSize=='120x600'){div_ads='ads_'+formatSize;}else if(formatSize=='728x90'){div_ads='ads_banner_bottom';}
if(typeof data.tracking.clickCommand!='undefined'&&(formatType=='swf'||formatType=='video')){data.tracking.clickCommand=encodeClickCommand(data.tracking.clickCommand);}
if(formatType=='massmotion'){ads.setMassMotion(data);}else if(formatType=='swf'){ads.setSwf(div_ads,div_ads+'_swf',data.content.urlContent,formatSizes[0],formatSizes[1],data.tracking.clickTagMethod,data.tracking.clickCommand,'#FFFFFF','opaque');}else if(formatType=='image'){if(typeof data.tracking.clickCommandTarget=='undefined'){data.tracking.clickCommandTarget='_blank';}
ads.setImage(div_ads,data.content.urlContent,data.tracking.clickCommand,data.tracking.clickCommandTarget);}else if(formatType=='video'){ads.setVideo(div_ads,div_ads+'_swf',data.content.urlContent,formatSizes[0],formatSizes[1],data.content.urlStartImage,data.content.urlEndImage,data.options.autoPlayDelay,data.tracking.clickCommand);}else if(formatType=='redirect'&&typeof data.redirect.clickCommand!='undefined'){ads.setRedirect(div_ads,data.redirect.js,data.redirect.clickCommand,formatSizes[0],formatSizes[1]);}
if(typeof data.tracking.pixelAgence!='undefined'){ads.setPixelAgence(data.tracking.pixelAgence,div_ads+'_pixel');}
ads.setAlenty(data);if(typeof data.expand!='undefined'&&typeof data.expand.urlContentExpand!='undefined'&&data.expand.urlContentExpand.length>0){expand_data=data;if(data.expand.autoExpand=='Yes'){dclk_show();}}}catch(e){error.log(e);}}
function displayAdsFeed(data){try{var formatSize=data.format.formatSize;var formatSizes=formatSize.split('x');var formatType=data.banFormat.banFormatType;var banUrlContent=data.banFormat.banUrlContent;var banClickCommand=data.banFormat.banClickCommand;var clickCommandTarget=data.tracking.clickCommandTarget||'_blank';var type=data.format.formatType;var div_ads='ads_'+ads.feed_ads_position;if(typeof data.tracking.clickCommand!='undefined'&&(formatType=='swf'||formatType=='video')){data.tracking.clickCommand=encodeClickCommand(data.tracking.clickCommand);}
if(typeof type!=='undefined'&&type==='Card'){var smallFormatType=data.cardFormat.smallAdFormatType;formatSize=data.cardFormat.smallAdFormatSize;formatSizes=formatSize.split('x');if(smallFormatType=='image'){ads.setImage(div_ads+'_small',data.cardFormat.smallAdUrlContent,banClickCommand,clickCommandTarget);}else if(smallFormatType=='swf'){ads.setSwf(div_ads+'_small',div_ads+'_swf',data.cardFormat.smallAdUrlContent,formatSizes[0],formatSizes[1],data.tracking.clickTagMethod,data.tracking.clickCommand,'#FFFFFF','transparent');}
ads.setText(div_ads+'_text',data.cardFormat.bigAdText,150);ads.setText(div_ads+'_small_url',data.cardFormat.smallAdText,50);ads.setUrl(div_ads+'_url',banClickCommand);ads.setUrl(div_ads+'_small_url',banClickCommand);formatType=data.cardFormat.bigAdFormatType;formatSize=data.cardFormat.bigAdFormatSize;formatSizes=formatSize.split('x');div_ads+='_big';}
if(formatType=='image'){if(typeof clickCommandTarget=='undefined'){clickCommandTarget='_blank';}
ads.setImage(div_ads,banUrlContent,banClickCommand,clickCommandTarget);}else if(formatType=='video'){ads.setVideo(div_ads,div_ads+'_swf',banUrlContent,formatSizes[0],formatSizes[1],'','','',data.tracking.clickCommand);}else if(formatType=='swf'){ads.setSwf(div_ads,div_ads+'_swf',banUrlContent,formatSizes[0],formatSizes[1],data.tracking.clickTagMethod,banClickCommand,'#FFFFFF','transparent');}else if(formatType=='redirect'&&typeof data.redirect.clickCommand!='undefined'){ads.setRedirect(div_ads,data.redirect.js,data.redirect.clickCommand,formatSizes[0],formatSizes[1]);}
if(typeof data.tracking.pixelAgence!='undefined'){ads.setPixelAgence(data.tracking.pixelAgence,div_ads+'_pixel');}
ads.setAlenty(data);$('#'+((type==='Card')?'sponsored_':'ads_')+ads.feed_ads_position+'_container').show();ads.feed_ads_position++;}catch(e){error.log(e);}}
function immersive_end(){try{Events.trigger(Events.player.finishAds);disableAudioAds();}catch(e){error.log(e);}};
var dzoffline={init:function(){try{if(!Modernizr.indexeddb||!dzoffline.browserCompatibility()){return false;}
if(USER.USER_ID===0){Events.ready(Events.user.loaded,dzoffline.init);return false;}
dzoffline.downloadAppNotify();if(window.navigator.onLine){dzoffline.createFrame();$('#frame_manifest').attr('src','/appcache/index.php');}else{$('body').addClass('is-offline');}
window.addEventListener('online',dzoffline.changeDisplay);window.addEventListener('offline',dzoffline.changeDisplay);return true;}catch(e){error.log(e);}},createFrame:function(){try{if($('#frame_manifest').length===0){$('body').append('<iframe id="frame_manifest" style="display:none;height:1px;width:1px"></iframe>');}}catch(e){error.log(e);}},downloadAppNotify:function(){try{if(storage.get('offline_reminder')===true&&!OFFLINE){Events.trigger(Events.offline.reminder);}
return true;}catch(e){error.log(e);}},changeDisplay:function(event){try{OFFLINE=(event.type=='offline');if(!OFFLINE){if(www.getCurrentPageType()==='offline'){setTimeout(function(){window.location.href='/';},5000);}else{dzoffline.downloadAppNotify();}}
return true;}catch(e){error.log(e);}},browserCompatibility:function(){try{switch(BrowserDetect.browser){case'Chrome':if(BrowserDetect.version>=15){return true;}
break;}
return false;}catch(e){error.log(e);}},display:function(uri){var params=[];if(!OFFLINE){params.push('offline=0');if(typeof uri==='string'){params.push('uri='+uri);}}
modal.open('/lightbox/offline'+(params.length>0?'?'+params.join('&'):''),true);}};
(function(){'use strict';var FBApi=function(){this.app_ready=false;this.app_id=0;this.app_namespace='';this.app_scope='';this.api_version='';this.channel='';this.fb_uid='';this.access_token='';this.user_scopes=null;};FBApi.prototype.setFBUid=function(fb_uid){this.fb_uid=String(fb_uid||'');return this;};FBApi.prototype.setAccessToken=function(access_token){this.access_token=String(access_token||'');return this;};FBApi.prototype.getFBUid=function(){return this.fb_uid;};FBApi.prototype.getAccessToken=function(){return this.access_token;};FBApi.prototype.setAppData=function(data){if(this.app_ready){error.log(new Error('FBApi :: setAppData - App is already configured'));return this;}
if(data!==Object(data)||Array.isArray(data)){error.log(new Error('FBApi :: setAppData - data is not a valid object'));return;}
this.app_id=data.id||this.app_id;this.app_namespace=String(data.namespace||this.app_namespace);this.app_scope=String(data.scope||this.app_scope);this.api_version='v'+String(data.version||this.api_version);this.channel=String(data.channel||this.channel);this.app_ready=true;return this;};FBApi.prototype.unsetUserData=function(){this.fb_uid='';this.access_token='';};FBApi.prototype.getAppData=function(){return{id:this.app_id,namespace:this.app_namespace,scope:this.app_scope,version:this.api_version,channel:this.channel};};FBApi.prototype.getUserScopes=function(callback,force){if(typeof FB==='undefined'){error.log(new Error('FBApi :: getUserScopes - FB is undefined'));return;}
if(typeof callback!=='function'){error.log(new Error('FBApi :: getUserScopes - callback is not a valid function'));return;}
if(!this.fb_uid){error.log(new Error('FBApi :: getUserScopes - fb_uid is missing'));return;}
if(!this.access_token){error.log(new Error('FBApi :: getUserScopes - access_token is missing'));return;}
if(this.user_scopes!==null&&!force){setTimeout(callback.bind(this,this.user_scopes),0);return;}
FB.api('/'+this.fb_uid+'/permissions?access_token='+this.access_token,function(res){res=res.data||null;if(res===null){return callback();}
var parsed={};for(var i=0,l=res.length;i<l;++i){parsed[res[i].permission]=res[i].status==='granted';}
this.user_scopes=parsed;callback(this.user_scopes);}.bind(this));};FBApi.prototype.checkUserScopes=function(requested,callback,force){if(typeof callback!=='function'){error.log(new Error('FBApi :: checkUserScopes - callback is not a valid function'));return;}
requested=String(requested||'');force=Boolean(force);if(!requested.length||requested==='*'){requested=this.getAppData().scope;}
requested=requested.split(',');this.getUserScopes(function(scope){if(!scope||scope!==Object(scope)){return callback();}
var res={};for(var i=0,l=requested.length;i<l;++i){var current=requested[i].toLowerCase();res[current]=Boolean(scope[current]);}
callback(res);},force);};FBApi.prototype.isScopeAllowed=function(scope){scope=String(scope||'');if(this.user_scopes===null){return false;}
return Boolean(this.user_scopes[scope]);};FBApi.prototype.allowExternalScope=function(scope){var user_scopes=this.user_scopes===Object(this.user_scopes)?this.user_scopes:{};user_scopes[String(scope||'')]=true;this.user_scopes=user_scopes;};window.FBApi=FBApi;})();;
(function(){'use strict';var FBAuth=function(api){this.api=api;this.login_only=false;this.skip_onboarding=false;this.auto_login=true;this.redirect=null;this.facebook_logged=false;};FBAuth.prototype.setUserStatus=function(status,trigger){this.facebook_logged=Boolean(status);trigger=Boolean(trigger);if(trigger){Events.trigger(Events.facebook.user_status,{status:this.facebook_logged});}
return this;};FBAuth.prototype.setAutoLogin=function(bool){this.auto_login=Boolean(bool);return this;};FBAuth.prototype.isLoginOnly=function(){return this.login_only;};FBAuth.prototype.isAutoLoginAllowed=function(){return this.auto_login;};FBAuth.prototype.login=function(parameters){if(typeof FB==='undefined'){error.log(new Error('FBAuth :: login - FB is undefined'));return;}
parameters=parameters||{};if(parameters!==Object(parameters)||Array.isArray(parameters)){error.log(new Error('FBAuth :: login - parameters is not a valid object'));return;}
var scopes=String(parameters.scopes||'*');var scopes_mandatory=Boolean(parameters.scopes_mandatory);if(scopes==='*'){scopes=this.api.getAppData().scope;}
this.redirect=null;this.login_only=Boolean(parameters.login_only);this.skip_onboarding=Boolean(parameters.skip_onboarding);if(parameters.redirect===Object(parameters.redirect)){this.setRedirect(parameters.redirect.type,parameters.redirect.link);}
FB.login(function(auth){if(!auth.authResponse||auth.status!=='connected'){return;}
if(scopes_mandatory){if(!this.api.getFBUid()){this.api.setFBUid(auth.authResponse.userID);}
if(!this.api.getAccessToken()){this.api.setAccessToken(auth.authResponse.accessToken);}
this.api.checkUserScopes(scopes,function(res){if(!res){return;}
scopes=scopes.split(',');for(var i=0,l=scopes.length;i<l;++i){if(!res[scopes[i]]&&scopes[i]!=='email'){return;}}
this.connect(auth.authResponse.userID,auth.authResponse.accessToken);}.bind(this),true);}else{this.connect(auth.authResponse.userID,auth.authResponse.accessToken);}}.bind(this),{scope:scopes});};FBAuth.prototype.connect=function(fb_uid,access_token){fb_uid=String(fb_uid||'');access_token=String(access_token||'');if(!fb_uid||!access_token){error.log(new Error('FBAuth :: connect - Missing mandatory parameters'));return;}
api.call({method:'facebook.auth',data:{fb_user_id:fb_uid,access_token:access_token,login_only:this.login_only,skip_onboarding:this.skip_onboarding},success:function(res){var status=(!res||!res.status)?null:res.status;switch(status){case'success':user.refreshPageAfterLogin(this.redirect);break;case'link':if(this.redirect===null){this.setRedirect('modal','/lightbox/facebook/link');}
user.refreshPageAfterLogin(this.redirect);break;case'register':user.refreshPageAfterLogin(this.redirect);break;default:modal.open('/lightbox/facebook/error',true);break;}
return true;}.bind(this),error:function(err){var payload=!(err||!err.payload)?{}:err.payload;var status=!payload.status?'error':payload.status;var email=window.getObjDeepKey(payload,'user_data.EMAIL');switch(status){case'missing_email':modal.open('/lightbox/register?reason=fb_missing_email',true);break;default:modal.open('/lightbox/facebook/error?reason='+status+(email?'&email='+encodeURIComponent(email):''));break;}
return true;}});};FBAuth.prototype.setRedirect=function(type,link){type=String(type||'page');link=String(link||'/');if(link.charAt(0)!=='/'){link='/'+link;}
this.redirect={type:type,link:link};return this;};window.FBAuth=FBAuth;})();;
(function(){'use strict';var FBMethod=function(api,auth){this.api=api;this.auth=auth;this.fb_ready=false;this.events_ready=false;this.init_get_status=true;};FBMethod.prototype.initFB=function(){if(typeof FB==='undefined'){error.log(new Error('FBMethod :: initFB - FB is undefined'));return;}
try{if(this.fb_ready){error.log(new Error('FBMethod :: initFB - FB was already initialized'));return;}
FB.init({appId:this.api.getAppData().id,channelUrl:this.api.getAppData().channel,version:this.api.getAppData().version,status:true,cookie:true,oauth:true,music:true,xfbml:false});this.fb_ready=true;if(!this.init_get_status){return;}
FB.getLoginStatus(function(res){this.auth.setUserStatus(res.status==='connected'||res.status==='not_authorized',true);if(res.status==='connected'){if(!user.current()){if(this.auth.isAutoLoginAllowed()){this.auth.connect(res.authResponse.userID,res.authResponse.accessToken);}}else{if(this.api.getFBUid()!==String(res.authResponse.userID)){this.api.unsetUserData();}else{this.api.getUserScopes(function(){user.setLogType('facebook');this.initEvents();}.bind(this),true);}}}}.bind(this));}catch(e){error.log(e);}};FBMethod.prototype.shouldGetStatus=function(bool){this.init_get_status=Boolean(bool);return this;},FBMethod.prototype.initEvents=function(){try{if(this.events_ready){error.log(new Error('FBMethod :: initEvents - Events were already initialized'));return;}
Events.subscribe(Events.player.play,function(evt,parameters){this.bridgeAction('play',parameters);}.bind(this));Events.subscribe(Events.player.resume,function(evt,parameters){this.bridgeAction('resume',parameters);}.bind(this));Events.subscribe(Events.player.paused,function(evt,parameters){this.bridgeAction('pause',dzPlayer.getCurrentSong());}.bind(this));Events.subscribe(Events.player.error,function(evt,parameters){this.bridgeAction('error',parameters);}.bind(this));if(typeof FB==='undefined'){error.log(new Error('FBMethod :: initEvents - FB is undefined'));return;}
FB.Event.subscribe('fb.music.PLAY',function(parameters){this.playerCallback('play',parameters);}.bind(this));FB.Event.subscribe('fb.music.RESUME',function(parameters){this.playerCallback('resume',parameters);}.bind(this));FB.Event.subscribe('fb.music.PAUSE',function(parameters){this.playerCallback('pause',parameters);}.bind(this));FB.Event.subscribe('fb.music.STATUS',function(parameters){this.sendStatus();}.bind(this));FB.Event.subscribe('fb.music.USER_MISMATCH',function(parameters){this.bridgeAction('close');}.bind(this));this.events_ready=true;}catch(e){error.log(e);}};FBMethod.prototype.unlinkAccount=function(){if(!confirm(gettext('Êtes-vous sûr de vouloir dissocier vos comptes Deezer et %1$s ?','Facebook'))){return;}
api.call({method:'facebook.unlinkAccount',success:function(status){if(status){this.closeBridge(window.location.reload.bind(window.location));}}.bind(this)});};FBMethod.prototype.isActionEnabled=function(action){action=String(action||'');if(typeof USER.SETTING.facebook==='undefined'){error.log(new Error('FBMethod :: isActionEnabled - Missing facebook key in user\'s settings'));return false;}
return Boolean(USER.SETTING.facebook['share_'+action]);};FBMethod.prototype.closeBridge=function(callback){callback=typeof callback==='function'?callback:function(){return;};this.bridgeAction('close',callback);};FBMethod.prototype.bridgeAction=function(action,parameters,callback){if(typeof FB==='undefined'){error.log(new Error('FBMethod :: bridgeAction - FB is undefined'));return;}
action=String(action||'');if(typeof parameters==='function'){callback=parameters;parameters={};}
if(parameters!==Object(parameters)||Array.isArray(parameters)){parameters={};}
if(typeof callback!=='function'){callback=function(){};}
var status={};var context=null;switch(action){case'close':status={offline:true};break;case'play':if(!parameters.SNG_ID||parameters.TYPE===1){return;}
status={playing:true,song:SETTING_HOST_SITE+'/track/'+parameters.SNG_ID,created_time:timestampToIso8601(Math.floor(Date.now()/1000)),expires_in:parameters.DURATION};break;case'pause':if(!parameters.SNG_ID||parameters.TYPE===1){return;}
status={playing:false,song:SETTING_HOST_SITE+'/track/'+parameters.SNG_ID};context=this.getSongContext();if(Object.keys(context).length){status[context.type]=context.url;}
break;case'resume':if(!parameters.SNG_ID||parameters.TYPE===1){return;}
context=this.getSongContext();status={playing:true,song:SETTING_HOST_SITE+'/track/'+parameters.SNG_ID,created_time:timestampToIso8601(),expires_in:parseInt(parameters.DURATION,10)-parseInt(dzPlayer.getPosition(),10)};if(Object.keys(context).length){status[context.type]=context.url;}
break;case'error':status={playing:false,song:SETTING_HOST_SITE+'/track/'+parameters.songId};switch(parameters.dzErrorCode){case right.NOT_ENCODED:status.error_code=4;break;case right.PREMIUM_ONLY:case NOT_RELEASE_FREE:status.error_code=102;break;case right.MP3_FRIEND:case right.LOCALITY:status.error_code=103;break;default:status.error_code=0;}
break;default:error.log(new Error('FBMethod :: bridgeAction - Unknown "'+action+'" action'));return;}
status.user_id=this.api.getFBUid();FB.Music.send('STATUS',status);return callback();};FBMethod.prototype.playerCallback=function(command,parameters){command=String(command||'');parameters=parameters||{};if(parameters!==Object(parameters)){error.log(new Error('FBMethod :: playerCallback - parameters is not a valid object'));return;}
switch(command){case'resume':dzPlayer.control.play();break;case'pause':dzPlayer.control.pause();break;case'play':var context_keys=['album','radio_station','playlist','musician','song'];var context=null;for(var i=0,l=context_keys.length;i<l;++i){if(typeof parameters[context_keys[i]]!=='undefined'){context=context_keys[i];}}
if(context===null){return;}
var path=parameters[context].split('/').reverse();var ctx_id=parseInt(path[0],10);var ctx_type=String(path[1]);var radio_type=context==='radio_station'?(String(path[2])==='artist'?'artist':'radio'):null;dzPlayer.loadTracks({id:ctx_id,type:radio_type?radio_type:ctx_type,radio:Boolean(radio_type)});if(parameters[context]!==document.location.href){loadBox('/'+(radio_type?String(path[2])+'/':'')+ctx_type+'/'+ctx_id);}
break;default:error.log(new Error('FBMethod :: playerCallback - Unknown "'+command+'" command'));return;}};FBMethod.prototype.sendStatus=function(){if(typeof FB==='undefined'){error.log(new Error('FBMethod :: sendStatus - FB is undefined'));return;}
var status={playing:dzPlayer.isPlaying(),user_id:this.api.getFBUid()};if(!status.user_id){return;}
if(dzPlayer.getCurrentSong()!==null){status.song=SETTING_HOST_SITE+'/track/'+dzPlayer.getCurrentSong('SNG_ID');}
var context=this.getSongContext();if(Object.keys(context).length){status[context.type]=context.url;}
FB.Music.send('STATUS',status);};FBMethod.prototype.getSongContext=function(){var context_keys={album:['album_page','explore_picks_album','explore_region_album','tops_album','feed_album','profile_top_albums','artist_discography','profile_albums','ticker_album','menu_panel_album','suggest_album'],radio_station:['smartradio_page','feed_smartradio','artist_smartradio','profile_radios','radio_page','feed_radio'],playlist:['playlist_page','feed_playlist','tops_playlist','profile_playlists','player_default_playlist','loved_page','ticker_playlist','menu_panel_playlist','suggest_playlist'],musician:['artist_top','search_page']};var context=dzPlayer.getContext();var url=SETTING_HOST_SITE+'/';var type=null;if(context===null||!context.TYPE){return{};}
for(var ctx in context_keys){if(type!==null){break;}
if(!context_keys.hasOwnProperty(ctx)){continue;}
for(var i=0,l=context_keys[ctx].length;i<l;++i){if(context_keys[ctx][i]===context.TYPE){type=ctx;break;}}}
if(type===null){return{};}
url+=type==='radio_station'?'radio/'+dzPlayer.getRadioType():type;url+='/'+parseInt(context.ID,10);return{type:type,url:url};};window.FBMethod=FBMethod;})();;
(function(){'use strict'
var FBWrapper=function(){this.api=new FBApi();this.auth=new FBAuth(this.api);this.method=new FBMethod(this.api,this.auth);};FBWrapper.prototype.setFBUid=function(fb_uid){return this.api.setFBUid(fb_uid);},FBWrapper.prototype.setAccessToken=function(access_token){return this.api.setAccessToken(access_token);},FBWrapper.prototype.isScopeAllowed=function(scope){return this.api.isScopeAllowed(scope);},FBWrapper.prototype.setAppData=function(data){return this.api.setAppData(data);},FBWrapper.prototype.getAppData=function(){return this.api.getAppData();},FBWrapper.prototype.checkUserScopes=function(requested,callback,force){return this.api.checkUserScopes(requested,callback,force);},FBWrapper.prototype.allowExternalScope=function(scope){return this.api.allowExternalScope(scope);},FBWrapper.prototype.setAutoLogin=function(auto_login){return this.auth.setAutoLogin(auto_login);},FBWrapper.prototype.isLoginOnly=function(){return this.auth.isLoginOnly();},FBWrapper.prototype.login=function(parameters){return this.auth.login(parameters);},FBWrapper.prototype.initFB=function(){return this.method.initFB();},FBWrapper.prototype.shouldGetStatus=function(bool){return this.method.shouldGetStatus(bool);},FBWrapper.prototype.unlinkAccount=function(){return this.method.unlinkAccount();},FBWrapper.prototype.isActionEnabled=function(action){return this.method.isActionEnabled(action);},FBWrapper.prototype.closeBridge=function(callback){return this.method.closeBridge(callback);}
window.facebook=new FBWrapper();})();;
(function(){'use strict';var GGPlusApi=function(){this.app_ready=false;this.client_id='';this.client_key='';this.app_name='';this.app_scope='';this.app_redirect_uri='';this.app_access_type='';this.app_cookie_policy='';this.app_request_visible_actions='';this.api_version='';this.gg_uid='';this.access_token={};};GGPlusApi.prototype.setGGUid=function(gg_uid){this.gg_uid=String(gg_uid||'');return this;};GGPlusApi.prototype.setAccessToken=function(access_token){this.access_token=window.isPlainObject(access_token)?access_token:{};return this;};GGPlusApi.prototype.getGGUid=function(){return this.gg_uid;};GGPlusApi.prototype.getAccessToken=function(){return this.access_token;};GGPlusApi.prototype.setAppData=function(data){if(this.app_ready){error.log(new Error('GGPlusApi :: setAppData - App is already configured'));return this;}
if(!window.isPlainObject(data)){error.log(new Error('GGPlusApi :: setAppData - data is not a valid object'));return;}
this.client_id=String(data.client_id||this.client_id);this.client_key=String(data.client_key||this.client_key);this.app_name=String(data.name||this.app_name);this.app_scope=String(data.scope||this.app_scope);this.app_redirect_uri=String(data.redirect_uri||this.app_redirect_uri);this.app_access_type=String(data.access_type||this.app_access_type);this.app_cookie_policy=String(data.cookie_policy||this.app_cookie_policy)
this.app_request_visible_actions=String(data.request_visible_actions||this.app_request_visible_actions)
this.api_version=String(data.version||this.api_version);this.app_ready=true;return this;};GGPlusApi.prototype.unsetUserData=function(){this.gg_uid='';this.access_token={};};GGPlusApi.prototype.getAppData=function(format){format=Boolean(format);var app_data={client_id:this.client_id,client_key:this.client_key,name:this.app_name,scope:this.app_scope,redirect_uri:this.app_redirect_uri,access_type:this.app_access_type,cookie_policy:this.app_cookie_policy,request_visible_actions:this.app_request_visible_actions,version:this.api_version};if(!format){return app_data;}
delete app_data.client_key;var formated={};for(var key in app_data){if(app_data.hasOwnProperty(key)){formated[key.replace(new RegExp('_','g'),'')]=app_data[key];}}
return formated;};window.GGPlusApi=GGPlusApi;})();;
(function(){'use strict';var GGPlusAuth=function(api){this.api=api;this.redirect=null;};GGPlusAuth.prototype.login=function(code,parameters){if(typeof code!=='string'){error.log(new Error('GGPlusAuth :: login - Missing code'));return;}
this.redirect=null;if(window.isPlainObject(parameters.redirect)){this.setRedirect(parameters.redirect.type,parameters.redirect.link);}
gapi.client.load('oauth2',this.api.getAppData().version,function(){var request=gapi.client.oauth2.userinfo.get();request.execute(function(result){this.connect(result.id,code);}.bind(this));}.bind(this));};GGPlusAuth.prototype.connect=function(gg_uid,auth_key){gg_uid=String(gg_uid||'');auth_key=String(auth_key||'');if(!gg_uid||!auth_key){error.log(new Error('GGPlusAuth :: connect - Missing mandatory parameters'));return;}
api.call({method:'googleplus.auth',data:{gg_user_id:gg_uid,auth_key:auth_key},success:function(res){var status=!(res||!res.status)?null:res.status;switch(status){case'success':user.refreshPageAfterLogin(this.redirect);break;case'link':if(this.redirect===null){this.setRedirect('modal','/lightbox/googleplus/link');}
user.refreshPageAfterLogin(this.redirect);break;case'register':user.refreshPageAfterLogin(this.redirect);break;default:modal.open('/lightbox/googleplus/error');break;}
return true;}.bind(this),error:function(err){var payload=!(err||!err.payload)?{}:err.payload;var status=!payload.status?'error':payload.status;var email=window.getObjDeepKey(payload,'user_data.EMAIL');switch(status){case'missing_email':modal.open('/lightbox/register?reason=gg_missing_email',true);break;default:modal.open('/lightbox/googleplus/error?reason='+status+(email?'&email='+encodeURIComponent(email):''));break;}
return true;}});};GGPlusAuth.prototype.setRedirect=function(type,link){type=String(type||'page');link=String(link||'/');if(link.charAt(0)!=='/'){link='/'+link;}
this.redirect={type:type,link:link};return this;};window.GGPlusAuth=GGPlusAuth;})();;
(function(){'use strict';var GGPlusMethod=function(api,auth){this.api=api;this.auth=auth;};GGPlusMethod.prototype.renderGGPlus=function(elementId,parameters){if(typeof gapi==='undefined'){error.log(new Error('GGPlusMethod :: renderGGPlus - gapi is undefined'));return;}
var gg_btn=document.getElementById(elementId||'home_account_gp');if(gg_btn===null||gg_btn.getAttribute('data-gapiattached')){return;}
parameters=parameters||{};if(!window.isPlainObject(parameters)){error.log(new Error('GGPlusMethod :: renderGGPlus - parameters is not a valid object'));return;}
var redirect=String(gg_btn.getAttribute('data-redirect')||'');if(redirect.length){parameters.redirect=JSON.parse(redirect);}
var render=this.api.getAppData(true);render.callback=function(result){if(result&&result.code){if(window.getObjDeepKey(result,'status.method')==='PROMPT'){this.auth.login(result.code,parameters);tracking.trackFormEvent($(gg_btn),'click');}}}.bind(this);gapi.signin.render(elementId,render);};GGPlusMethod.prototype.unlinkAccount=function(){if(!confirm(gettext('Êtes-vous sûr de vouloir dissocier vos comptes Deezer et %1$s ?','Google+'))){return;}
api.call({method:'googleplus.unlinkAccount',success:function(status){if(status){window.location.reload();}}});};window.GGPlusMethod=GGPlusMethod;})();;
(function(){'use strict'
var GGPlusWrapper=function(){this.api=new GGPlusApi();this.auth=new GGPlusAuth(this.api);this.method=new GGPlusMethod(this.api,this.auth);};GGPlusWrapper.prototype.setGGUid=function(gg_uid){return this.api.setGGUid(gg_uid);},GGPlusWrapper.prototype.setAccessToken=function(access_token){return this.api.setAccessToken(access_token);},GGPlusWrapper.prototype.setAppData=function(data){return this.api.setAppData(data);},GGPlusWrapper.prototype.getAppData=function(){return this.api.getAppData();},GGPlusWrapper.prototype.login=function(parameters){return this.auth.login(parameters);},GGPlusWrapper.prototype.renderGGPlus=function(elementId,parameters){return this.method.renderGGPlus(elementId,parameters);},GGPlusWrapper.prototype.unlinkAccount=function(){return this.method.unlinkAccount();},window.googleplus=new GGPlusWrapper();})();;
var context_menu={ContextMenuComponent:null,init:function(){Events.ready(Events.user.userReady,function(){ReactComponent.require('common/context_menu',function(ContextMenu){context_menu.ContextMenuComponent=React.render(ContextMenu({controller:context_menu}),document.getElementById('page_context_menu'));});});},close:function(context){if(context_menu.ContextMenuComponent===null||USER.USER_ID===0){return false;}
context_menu.ContextMenuComponent.onClose(context);},open:function(evt){var data=evt;if(USER.USER_ID===0){www.goToConnection();return false;}
if(typeof evt.currentTarget==='object'){data=$.extend({},evt.currentTarget.dataset);data.target=evt.currentTarget;}
context_menu.ContextMenuComponent.onOpen(data);}};;
var playercontrol={blindTestMode:false,initContent:{},smartRadioCounter:3600000,smartRadioIntervalId:0,smartRadioSkipCount:0,heightPlayer:105,fadingProgress:false,init:function(data){try{if(typeof PLAYER_INIT==='object'){data=PLAYER_INIT;}
restrict.init();playercontrol.initContent={type:data.type,data:data.data,index:data.index,id:data.element_id,autoplay:data.auto_play};Events.subscribeOnce(Events.player.playerLoaded,function(){dzPlayer.initRestriction();dzPlayer.restoreSetting(USER.SETTING);playercontrol.setFirstContent();});Events.subscribe(Events.player.changePlayerType,function(evt,param){if(param==='ads'){startDisplayAudioAds();}});Events.subscribe(Events.live.simultaneousAccess,function(){if(dzPlayer.isPlaying()===false||dzPlayer.getPlayerType()!=='mod'){return false;}
dzPlayer.control.pause();modal.open('/lightbox/limitation.php');});Events.subscribe(Events.player.finish,playercontrol.finish);Events.subscribe(Events.player.finishAds,playercontrol.finishAds);Events.subscribe(Events.player.finishJingle,playercontrol.finishJingle);Events.subscribe(Events.player.fading,playercontrol.fading);Events.subscribe(Events.radio.start,playercontrol.smartRadioStopCounter);dzPlayer.initSoPlayer('core_player');if(BrowserDetect.browser==='Explorer'&&BrowserDetect.version<=8){notificationBar.display(BrowserDetect.version===8?'ie8_support':'ie_warning');}
if(data.show_lyrics){Events.subscribeOnce(Events.menu.loaded,function(){Events.ready(Events.player.playerReady,function(){menu.openPanel('lyrics');});});}}catch(e){error.log(e);}},setFirstContent:function(){try{if(playercontrol.initContent.type===''||playercontrol.initContent.data===''){return false;}
if(OFFLINE){return false;}
var params={type:'playlist',id:PLAYLIST_WELCOME_ID};if(playercontrol.initContent.data.count>0){params=$.extend({},playercontrol.initContent);params.data=playercontrol.initContent.data.data;params.type=LOG_CONTEXT[playercontrol.initContent.type];params.radio=(playercontrol.initContent.type==='smartradio_page'||playercontrol.initContent.type==='radio_page');params.context={TYPE:playercontrol.initContent.type,ID:playercontrol.initContent.id};params.callbackTrack=function(data){if(data.length===0){dzPlayer.play({type:'playlist',id:PLAYLIST_WELCOME_ID,autoplay:false});}};}
dzPlayer.play(params);Events.resolve(Events.player.playerReady);return true;}catch(e){error.log(e);}},setBlindTestMode:function(active){if(typeof active!=='boolean'){active=true;}
playercontrol.blindTestMode=active;Events.trigger(Events.player.blind_test_mode_changed,dzPlayer.getCurrentSong());return true;},finish:function(){try{if(!playercontrol.fadingProgress){dzPlayer.control.nextSong(true);}
playercontrol.fadingProgress=false;return true;}catch(e){error.log(e);}},fading:function(){if(USER.OPTIONS.ads_audio&&dzPlayer.getAudioAds()!=null){return false;}
playercontrol.fadingProgress=true;dzPlayer.control.nextSong(true);},finishAds:function(){try{Events.trigger(Events.player.adsVastPlaying,{position:dzPlayer.getAudioAds().audio.duration});if(dzPlayer.getPlayerType()==='ads'){dzPlayer.setAudioAds(null);}
dzPlayer.setPlayerType(dzPlayer.previousPlayerType);dzPlayer.control.nextSong(true);setTimeout(disableAudioAds,10000);return true;}catch(e){error.log(e);}},finishJingle:function(){try{dzPlayer.setPlayerType(dzPlayer.previousPlayerType);dzPlayer.control.nextSong(true);return true;}catch(e){error.log(e);}}};;
(function($){function maybeCall(thing,ctx){return(typeof thing=='function')?(thing.call(ctx)):thing;};function isElementInDOM(ele){while(ele=ele.parentNode){if(ele==document)return true;}
return false;};function Tipsy(element,options){this.$element=$(element);this.options=options;this.enabled=true;this.fixTitle();};Tipsy.prototype={show:function(){var title=this.getTitle();if(title&&this.enabled){var $tip=this.tip();$tip.find('.tipsy-inner')[this.options.html?'html':'text'](title);$tip[0].className='tipsy';$tip.remove().css({top:0,left:0,visibility:'hidden',display:'block'}).prependTo(document.body);var pos=$.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight,gravity=maybeCall(this.options.gravity,this.$element[0]);var tp;switch(gravity.charAt(0)){case'n':tp={top:pos.top+pos.height+this.options.offset,left:pos.left+pos.width/2-actualWidth/2};break;case's':tp={top:pos.top-actualHeight-this.options.offset,left:pos.left+pos.width/2-actualWidth/2};break;case'e':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth-this.options.offset};break;case'w':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width+this.options.offset};break;}
if(gravity.length==2){if(gravity.charAt(1)=='w'){tp.left=pos.left+pos.width/2-15;}else{tp.left=pos.left+pos.width/2-actualWidth+15;}}
$tip.css(tp).addClass('tipsy-'+gravity);if(this.options.hasOwnProperty('z_index')){tp.zIndex=parseInt(this.options.z_index,10);$tip.css(tp);}
$tip.find('.tipsy-arrow')[0].className='tipsy-arrow tipsy-arrow-'+gravity.charAt(0);if(this.options.className){$tip.addClass(maybeCall(this.options.className,this.$element[0]));}
if(this.options.fade){$tip.stop().css({opacity:0,display:'block',visibility:'visible'}).animate({opacity:this.options.opacity});}else{$tip.css({visibility:'visible',opacity:this.options.opacity});}}},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(function(){$(this).remove();});}else{this.tip().remove();}},fixTitle:function(){var $e=this.$element;if($e.attr('title')||typeof $e.attr('original-title')!='string'){$e.attr('original-title',$e.attr('title')||'').removeAttr('title');}},getTitle:function(){var title,$e=this.$element,o=this.options;this.fixTitle();var title,o=this.options;if(typeof o.title=='string'){title=$e.attr(o.title=='title'?'original-title':o.title);}else if(typeof o.title=='function'){title=o.title.call($e[0]);}
title=(''+title).replace(/(^\s*|\s*$)/,"");return title||o.fallback;},tip:function(){if(!this.$tip){this.$tip=$('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>');this.$tip.data('tipsy-pointee',this.$element[0]);}
return this.$tip;},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null;}},enable:function(){this.enabled=true;},disable:function(){this.enabled=false;},toggleEnabled:function(){this.enabled=!this.enabled;}};$.fn.tipsy=function(options){if(options===true){return this.data('tipsy');}else if(typeof options=='string'){var tipsy=this.data('tipsy');if(tipsy)tipsy[options]();return this;}
options=$.extend({},$.fn.tipsy.defaults,options);function get(ele){var tipsy=$.data(ele,'tipsy');if(!tipsy){tipsy=new Tipsy(ele,$.fn.tipsy.elementOptions(ele,options));$.data(ele,'tipsy',tipsy);}
return tipsy;}
function enter(){var tipsy=get(this);tipsy.hoverState='in';if(options.delayIn==0){tipsy.show();}else{tipsy.fixTitle();setTimeout(function(){if(tipsy.hoverState=='in')tipsy.show();},options.delayIn);}};function leave(){var tipsy=get(this);tipsy.hoverState='out';if(options.delayOut==0){tipsy.hide();}else{setTimeout(function(){if(tipsy.hoverState=='out')tipsy.hide();},options.delayOut);}};if(!options.live)this.each(function(){get(this);});if(options.trigger!='manual'){var binder=options.live?'live':'bind',eventIn=options.trigger=='hover'?'mouseenter':'focus',eventOut=options.trigger=='hover'?'mouseleave':'blur';this[binder](eventIn,enter)[binder](eventOut,leave);}
return this;};$.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:false,fallback:'',gravity:'n',html:false,live:false,offset:0,opacity:1,title:'title',trigger:'hover'};$.fn.tipsy.revalidate=function(){$('.tipsy').each(function(){var pointee=$.data(this,'tipsy-pointee');if(!pointee||!isElementInDOM(pointee)){$(this).remove();}});};$.fn.tipsy.elementOptions=function(ele,options){return $.metadata?$.extend({},options,$(ele).metadata()):options;};$.fn.tipsy.autoNS=function(){return $(this).offset().top>($(document).scrollTop()+$(window).height()/2)?'s':'n';};$.fn.tipsy.autoWE=function(){return $(this).offset().left>($(document).scrollLeft()+$(window).width()/2)?'e':'w';};$.fn.tipsy.autoBounds=function(margin,prefer){return function(){var dir={ns:prefer[0],ew:(prefer.length>1?prefer[1]:false)},boundTop=$(document).scrollTop()+margin,boundLeft=$(document).scrollLeft()+margin,$this=$(this);if($this.offset().top<boundTop)dir.ns='n';if($this.offset().left<boundLeft)dir.ew='w';if($(window).width()+$(document).scrollLeft()-$this.offset().left<margin)dir.ew='e';if($(window).height()+$(document).scrollTop()-$this.offset().top<margin)dir.ns='s';return dir.ns+(dir.ew?dir.ew:'');}};})(jQuery);;
(function(){var _dzPlayer={trackList:[],trackListOriginal:[],trackListIndex:0,trackListDuration:0,lyrics:{}};var _dzPlayerEvents={queue:[],delayed:null,trigger:function(evt_name,arg){if(_dzPlayerEvents.delayed!==null){window.clearTimeout(_dzPlayerEvents.delayed);}
_dzPlayerEvents.queue.push({evt_name:evt_name,arg:arg});_dzPlayerEvents.delayed=window.setTimeout(_dzPlayerEvents.triggerAll,0);},triggerAll:function(){for(var i=0;i<_dzPlayerEvents.queue.length;i++){Events.trigger(_dzPlayerEvents.queue[i].evt_name,_dzPlayerEvents.queue[i].arg);}
_dzPlayerEvents.queue=[];window.clearTimeout(_dzPlayerEvents.delayed);_dzPlayerEvents.delayed=null;}};var _trackList={setIndex:function(index){if(index<0||index>_dzPlayer.trackList.length-1){index=0;}
_dzPlayer.trackListIndex=index;},calculeDuration:function(){try{_dzPlayer.trackListDuration=0;for(var t=0;t<_dzPlayer.trackList.length;t++){_dzPlayer.trackListDuration+=parseInt(_dzPlayer.trackList[t].data.DURATION,10);}
return _dzPlayer.trackListDuration;}catch(e){error.log(e);}},reIndexWithSngId:function(sng_id){var i;for(i=0;i<_dzPlayer.trackList.length;i++){if(_dzPlayer.trackList[i].data.SNG_ID===sng_id){_dzPlayer.trackListIndex=i;break;}}
return i<_dzPlayer.trackList.length;},getOriginalIndexWithSngId:function(sng_id){var index=0;for(var i=0;i<_dzPlayer.trackListOriginal.length;i++){if(_dzPlayer.trackListOriginal[i].data.SNG_ID===sng_id){index=i;break;}}
return index;},order:function(order){if(_dzPlayer.trackList.length!==order.length){return false;}
var current_song_id=dzPlayer.getCurrentSong('SNG_ID');var newTrackList=[];for(var o=0;o<order.length;o++){var sng_id=order[o];for(var i=0;i<_dzPlayer.trackList.length;i++){if(_dzPlayer.trackList[i].data.SNG_ID==sng_id){newTrackList.push(_dzPlayer.trackList[i]);}}}
if(newTrackList.length!==_dzPlayer.trackList.length){return false;}
_dzPlayer.trackList=newTrackList.slice();_trackList.reIndexWithSngId(current_song_id);_trackList.emitChange({type:'order'});return true;},remove:function(index){if(index<0||index>_dzPlayer.trackList.length-1){return false;}
if(index<_dzPlayer.trackListIndex){_dzPlayer.trackListIndex--;}
var removed_track=_dzPlayer.trackList.splice(index,1);if(removed_track.length!==0){var removed_track_id=removed_track[0].data.SNG_ID;var original_index=_trackList.getOriginalIndexWithSngId(removed_track_id);_dzPlayer.trackListOriginal.splice(original_index,1);}
_trackList.calculeDuration();_trackList.emitChange({type:'remove',song:removed_track});return true;},shuffle:function(index_first_track){index_first_track=typeof index_first_track==='number'?index_first_track:_dzPlayer.trackListIndex;_dzPlayer.trackListOriginal=_dzPlayer.trackList.slice();var current_song_id=dzPlayer.getCurrentSong('SNG_ID');var first_track=null;if(index_first_track!==-1){first_track=_dzPlayer.trackList.splice(index_first_track,1);first_track=first_track.length===0?null:first_track[0];}
shuffle(_dzPlayer.trackList);if(first_track!==null){_dzPlayer.trackList.unshift(first_track);}
_trackList.reIndexWithSngId(current_song_id);_trackList.emitChange({type:'shuffle'});return true;},unShuffle:function(){var current_song_id=dzPlayer.getCurrentSong('SNG_ID');_dzPlayer.trackList=_dzPlayer.trackListOriginal.slice();_trackList.reIndexWithSngId(current_song_id);_trackList.emitChange({type:'unShuffle'});return true;},addNext:function(new_tracklist){if(new_tracklist.length===0){return false;}
if(dzPlayer.isRadio()){return false;}
Array.prototype.splice.apply(_dzPlayer.trackList,[_dzPlayer.trackListIndex+1,0].concat(new_tracklist));var current_song_id=dzPlayer.getCurrentSong('SNG_ID');if(current_song_id===0){_dzPlayer.trackListOriginal=_dzPlayer.trackList.slice();}else{var tracklistoriginal_index=_trackList.getOriginalIndexWithSngId(current_song_id);Array.prototype.splice.apply(_dzPlayer.trackListOriginal,[tracklistoriginal_index+1,0].concat(new_tracklist));}
_trackList.calculeDuration();_trackList.emitChange({type:'addNext',song:new_tracklist});return true;},addToQueue:function(new_tracklist){if(new_tracklist.length===0){return false;}
_dzPlayer.trackList=_dzPlayer.trackList.concat(new_tracklist);_dzPlayer.trackListOriginal=_dzPlayer.trackListOriginal.concat(new_tracklist);_trackList.calculeDuration();var change_evt={type:'addToQueue',song:new_tracklist};if(dzPlayer.isRadio()){change_evt.type='lazyLoad';}
_trackList.emitChange(change_evt);return true;},set:function(new_tracklist,options){options=typeof options==='undefined'?{}:options;if(typeof options.addNext==='boolean'&&options.addNext){return _trackList.addNext(new_tracklist);}
if(typeof options.addQueue==='boolean'&&options.addQueue){return _trackList.addToQueue(new_tracklist);}
_dzPlayer.trackList=new_tracklist;_dzPlayer.trackListOriginal=_dzPlayer.trackList.slice();_trackList.calculeDuration();_trackList.emitChange({type:'set'});return true;},save:function(options){if(options.addQueue||options.addNext){return false;}
if(options.id==dzPlayer.getContext('ID')&&options.type===LOG_CONTEXT[dzPlayer.getContext('TYPE')]){return false;}
_trackList.backup={trackList:dzPlayer.getTrackList(false),trackListIndex:_dzPlayer.trackListIndex,trackOffset:dzPlayer.position,radio:dzPlayer.getPlayerType()==='radio',context:dzPlayer.getContext()};},restore:function(){if(countObject(_trackList.backup)===0){return false;}
dzPlayer.play({data:_trackList.backup.trackList,index:_trackList.backup.trackListIndex,offset:_trackList.backup.trackOffset,context:_trackList.backup.context,autoplay:_trackList.backup.trackOffset>0,radio:_trackList.backup.radio,saveCurrentTrackList:false});_trackList.backup={};},first_list_already_set:false,emitChange:function(data){if(data.type==='set'&&!_trackList.first_list_already_set){_trackList.first_list_already_set=true;data.first=true;}
_dzPlayerEvents.trigger(Events.player.tracklist_changed,data);}};var dzPlayer={MEDIA_TYPE_TALK:'talk',MEDIA_TYPE_SONG:'song',minimumFlashVersion:10.1,volume:0.5,cover:'',songId:0,muted:false,paused:false,playing:false,loading:false,lastPosition:0,position:0,duration:0,fade:0,repeat:0,shuffle:false,pourcentLoaded:0,nextSongInfo:[],playerType:'mod',previousPlayerType:'mod',fadeOutProgress:false,fadeInProgress:false,hq:false,numSong:-1,nbSongs:-1,playerLoaded:false,audioAds:null,previousSkipAction:'',appId:0,appType:'',radioType:'',radioSkipInterval:3600000,radioSkipIntervalId:0,radioSkipCounter:0,cached:{},context:{},logTrackTemplate:{media:{id:0,type:0},type:0,stat:{seek:0,pause:0},lt:0,ctxt:{},dev:{v:STATIC_VERSION,t:0},ls:[]},logTrack:{},user_status:{},_play:function(autoPlay,naturalEnd){try{if(dzPlayer.getCurrentSong()===null){return false;}
if(dzPlayer.getAudioAds()!=null&&dzPlayer.getPlayerType()!='ads'&&dzPlayer.isAdvertisingAllowed()&&USER.OPTIONS.ads_audio){_dzPlayer.trackListIndex--;dzPlayer._playAudioAds();return false;}
if(dzPlayer.getCurrentSong('TYPE')=='JINGLE'){dzPlayer._playAudioJingle();return false;}
if(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){_dzPlayer.trackList[_dzPlayer.trackListIndex].data.OFFSET=bookmark.getEpisodeBookmark(_dzPlayer.trackList[_dzPlayer.trackListIndex].data.EPISODE_ID).OFFSET;}
if(dzPlayer.getNbSongs()===0){return false;}
if(typeof autoPlay!=='boolean'){autoPlay=true;}
if(typeof naturalEnd!=='boolean'){naturalEnd=false;}
if(dzPlayer.getPlayerType()==='ads'||dzPlayer.getPlayerType()==='jingle'||dzPlayer.getPlayerType()==='chromecast'){return false;}
if(autoPlay){dzPlayer.logManager();dzPlayer.trigger('audioPlayer_'+((naturalEnd&&dzPlayer.fade>0)?'appendTracks':'playTracks'),[[dzPlayer.getCurrentSong()],0,autoPlay]);Events.trigger(Events.player.notify,'start');Events.trigger(Events.player.play,{value:dzPlayer.getCurrentSong()});dzPlayer.duration=(dzPlayer.isLimited())?30:dzPlayer.getCurrentSong('DURATION');Events.trigger(Events.player.duration,dzPlayer.duration);}else{dzPlayer.trigger('audioPlayer_stop',[]);}
delete _dzPlayer.trackList[_dzPlayer.trackListIndex].data.OFFSET;_dzPlayerEvents.trigger(Events.player.displayCurrentSong,dzPlayer.getCurrentSong());if(dzPlayer.isRadio()&&_dzPlayer.trackList.length-_dzPlayer.trackListIndex==4&&_dzPlayer.trackListIndex>0){dzPlayer.loadTracks({id:dzPlayer.getContext('ID'),type:dzPlayer.getRadioType(),radio:true,addQueue:true,context:dzPlayer.getContext()});}}catch(e){error.log(e);}},_playAudioJingle:function(){try{dzPlayer.previousPlayerType=dzPlayer.getPlayerType();dzPlayer.trigger('setAudioJingle',[{audio:{url:SETTING_STATIC+'/'+dzPlayer.getCurrentSong('URL'),duration:dzPlayer.getCurrentSong('DURATION')},format:{formatType:'',formatType:''},content:{urlContent:''},tracking:{clickCommand:'',clickTagMethod:'',pixelAgence:''},textlink:{text:''}}]);_dzPlayerEvents.trigger(Events.player.displayCurrentSong,dzPlayer.getCurrentSong());dzPlayer.setPlayerType('jingle');}catch(e){error.log(e);}},_playAudioAds:function(){try{dzPlayer.previousPlayerType=dzPlayer.getPlayerType();dzPlayer.trigger('setAudioAds',[dzPlayer.getAudioAds()]);dzPlayer.setPlayerType('ads');}catch(e){error.log(e);}},initSoPlayer:function(div_id){try{var path='swf/coreplayer3-v'+STATIC_VERSION+'.swf';if(typeof RESSOURCES==='object'){path=RESSOURCES.coreplayer3;}
var so;so=new SWFObject(SETTING_STATIC+'/'+path,'audioPlayerSWF','1','1',dzPlayer.minimumFlashVersion.toString(),'#3a3a3a');so.addVariable('host_stream_cdn',HOST_STREAM_CDN);so.addVariable('host_stream',HOST_STREAM);so.addVariable('host_preview',HOST_PREVIEW);so.addVariable('cdn_ratio',CDN_RATIO);so.addVariable('range_qs','x-bits-range');so.addVariable('allow_range','true');so.addVariable('offline',OFFLINE);so.addVariable('token',PLAYER_TOKEN);so.addVariable('server_timestamp',SERVER_TIMESTAMP);so.addParam('wmode','transparent');so.addParam('allowScriptAccess','always');so.addParam('menu','false');so.addParam('hasPriority','true');so.write(div_id);return true;}catch(e){error.log(e);}},initRestriction:function(){try{dzPlayer.setOffline(OFFLINE);return true;}catch(e){error.log(e);}},setUserLogged:function(userId,md5,blogName,sid,gender,age,player_token){try{dzPlayer.trigger('audioPlayer_setToken',[player_token]);return true;}catch(e){error.log(e);}},setUserUnlogged:function(){try{dzPlayer.trigger('audioPlayer_setToken',['']);return true;}catch(e){error.log(e);}},setEmptyPlayer:function(){try{if(dzPlayer.getPlayerType()=='ads'||dzPlayer.getPlayerType()=='jingle'){return false;}
_dzPlayer.trackList=[];_dzPlayer.trackListOriginal=[];_dzPlayer.trackListIndex=0;dzPlayer.trigger('audioPlayer_playTracks',[[],0,false]);_dzPlayerEvents.trigger(Events.player.displayEmptyPlayer);return false;}catch(e){error.log(e);}},play:function(options){try{if(dzPlayer.getPlayerType()==='chromecast'){if(typeof options.data==='undefined'||options.data.length===0){return dzPlayer.loadTracks(options);}
if(options.context.TYPE==='suggest_track'||options.context.TYPE.length===0){options.context.TYPE='album_page';options.context.ID=parseInt(options.data[0].ALB_ID,10);}
return chromecast.doAction('playFromList',{track_id:parseInt(options.id||0,10),type:(options.type||'').toString(),data:(options.data||[]),context:options.context,index:options.index});}
options=$.extend(true,{},{type:'',id:0,radio:false,index:0,autoplay:true,context:{ID:'',TYPE:'',CONTEXT_ID:''},data:[],offset:0,addNext:false,addQueue:false,saveCurrentTrackList:true,callbackTrack:function(){}},options);if(dzPlayer.getPlayerType()=='ads'||dzPlayer.getPlayerType()=='jingle'){return false;}
if(options.data.length===0){dzPlayer.loadTracks(options);return false;}
if(options.saveCurrentTrackList){_trackList.save(options);}
if(options.index>options.data.length){options.index=0;}
dzPlayer.setPlayerType(options.radio?'radio':'mod');if(options.radio===true&&options.addQueue===false){dzPlayer.radioStartListen(options.id,options.type);}
dzPlayer.radioSkipSetTimer();dzPlayer.setTrackList(options,options.addQueue,options.addNext);}catch(e){error.log(e);}},loadTracks:function(options){try{if(options.id===0){throw new dzError({name:'DZPLAYER',message:'Player error - dzplayer.loadTracks: play without id (=== 0)'});}
if(options.type===''){throw new dzError({name:'DZPLAYER',message:'Player error - dzplayer.loadTracks: play without type (=== "")'});}
if(options.type==='track'&&!$.isArray(options.id)){options.id=[options.id];}
var loader={playlist:{api_method:'playlist.getSongs',api_param:{playlist_id:options.id,start:0,nb:1000}},album:{api_method:'song.getListByAlbum',api_param:{alb_id:options.id,start:0,nb:500}},track:{api_method:'song.getListData',api_param:{sng_ids:options.id}},radio:{api_method:'radio.getSongs',api_param:{radio_id:options.id}},artist:{api_method:options.radio===true?'smart.getSmartRadio':'song.getTopArtist',api_param:{art_id:options.id}},user:{api_method:'radio.getUserRadio',api_param:{user_id:options.id}},show:{api_method:'episode.getListByShow',api_param:{show_id:options.id}},episode:{api_method:'episode.getData',api_param:{episode_id:options.id}}};if(typeof loader[options.type]==='object'){api.call(loader[options.type].api_method,loader[options.type].api_param,dzPlayer.onLoadedTracks,options);}}catch(e){error.log(e);}},onLoadedTracks:function(result,options){try{options.data=result.data||[result];if(options.offset>0&&options.data.length>0){options.data[0].OFFSET=options.offset;}
dzPlayer.play(options);}catch(e){error.log(e);}},playTrackAtIndex:function(index){try{_trackList.setIndex(index);dzPlayer._play(true);}catch(e){error.log(e);}},setIndexSong:function(index){try{_trackList.setIndex(index);}catch(e){error.log(e);}},restoreTrackList:function(){_trackList.restore();},setTrackList:function(options,addQueue,addNext){try{addQueue=addQueue||false;addNext=addNext||false;var futur_index=(options.index===-1)?0:options.index;if(options.chromecast===true){_trackList.set(options.data);_trackList.setIndex(0);return true;}
var filteredTrack=[];for(var d=0;d<options.data.length;d++){if(typeof options.data[d]!=='object'){continue;}
if(dzPlayer.getMediaType(options.data[d])===dzPlayer.MEDIA_TYPE_TALK){options.data[d].OFFSET=parseInt(bookmark.getEpisodeBookmark(options.data[d].EPISODE_ID).OFFSET,10);filteredTrack.push({data:options.data[d],context:options.context});continue;}
var is_readable=false;var songAvailable=right.checkSongAvailable(options.data[d]);if(songAvailable==right.READABLE||(dzPlayer.isRadio()&&songAvailable!=right.EXPLICIT_LYRICS)){filteredTrack.push({data:options.data[d],context:options.context});is_readable=true;}else if(typeof options.data[d].FALLBACK==='object'&&right.checkSongAvailable(options.data[d].FALLBACK)==right.READABLE){options.data[d].SNG_ID_ORIGIN=options.data[d].SNG_ID;filteredTrack.push({data:$.extend({},options.data[d],options.data[d].FALLBACK),context:options.context});is_readable=true;}
if(d==futur_index){futur_index=is_readable?(filteredTrack.length-1):filteredTrack.length;}}
if(typeof options.callbackTrack==='function'){options.callbackTrack(filteredTrack);}
if(filteredTrack.length===0){return false;}
if(addQueue||addNext){_trackList.set(filteredTrack,{addQueue:addQueue,addNext:addNext});return true;}
_trackList.set(filteredTrack);_trackList.setIndex(futur_index);options.index=futur_index;if(options.offset>0){options.data[options.index].OFFSET=options.offset;}
if(dzPlayer.isShuffle()&&dzPlayer.getPlayerType()==='mod'){var index_first_track=options.index;if(index_first_track===-1){index_first_track=Math.round(Math.random()*(_dzPlayer.trackList.length-1));_trackList.setIndex(index_first_track);}
_trackList.shuffle(index_first_track);}
if(dzPlayer.isMuted()){dzPlayer.control.mute(false);}
dzPlayer._play(options.autoplay);return true;}catch(e){error.log(e);}},getTrackList:function(with_ctx){try{if(with_ctx===true){return _dzPlayer.trackList;}
var data=[];for(var t=0;t<_dzPlayer.trackList.length;t++){data.push(_dzPlayer.trackList[t].data);}
return data;}catch(e){error.log(e);}},getTrackListIndex:function(){return _dzPlayer.trackListIndex;},getTrackListDuration:function(){return _dzPlayer.trackListDuration;},enqueueTracks:function(songs,context){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
dzPlayer.setTrackList({data:songs,context:context},true,false);}catch(e){error.log(e);}},addNextTracks:function(songs,context){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
dzPlayer.setTrackList({data:songs,context:context},false,true);}catch(e){error.log(e);}},setAudioAds:function(data){try{dzPlayer.audioAds=data;}catch(e){error.log(e);}},getAudioAds:function(){try{if(typeof ads!=='undefined'&&ads.allow_audio===false){return null;}
return dzPlayer.audioAds;}catch(e){error.log(e);}},isStoreTrack:function(isrc){try{if(typeof userData==='object'&&typeof userData.dataStore==='object'){return(typeof userData.dataStore[isrc]==='boolean'&&isrc!='');}
return false;}catch(e){error.log(e);}},isRadio:function(){return(dzPlayer.getPlayerType()==='radio');},getIndexSong:function(){return _dzPlayer.trackListIndex;},getNbSongs:function(){return _dzPlayer.trackList.length;},isLastSong:function(){if(dzPlayer.getRepeat()>0){return false;}
if(_dzPlayer.trackListIndex>=dzPlayer.getNbSongs()-1){return true;}
return false;},getTotalDuration:function(){var totalDuration=0;for(var j=0;j<_dzPlayer.trackList.length;j++){if(!isNaN(_dzPlayer.trackList[j].data.DURATION)){totalDuration+=parseInt(_dzPlayer.trackList[j].data.DURATION,10);}}
return totalDuration;},getNextSong:function(){if(dzPlayer.repeat==0||dzPlayer.isRadio()){return(_dzPlayer.trackListIndex+1<dzPlayer.getNbSongs())?_dzPlayer.trackList[_dzPlayer.trackListIndex+1].data:null;}else if(dzPlayer.repeat==1){var index=(_dzPlayer.trackListIndex==_dzPlayer.trackList.length-1)?0:_dzPlayer.trackListIndex+1;return _dzPlayer.trackList[index].data;}else if(dzPlayer.repeat==2){return dzPlayer.getCurrentSong();}},getPrevSong:function(){if(dzPlayer.getRepeat()==0||dzPlayer.isRadio()){return _dzPlayer.trackListIndex!=0?_dzPlayer.trackList[_dzPlayer.trackListIndex-1].data:null;}else if(dzPlayer.getRepeat()==1){var index=(_dzPlayer.trackListIndex==0)?_dzPlayer.trackList.length-1:_dzPlayer.trackListIndex-1;return _dzPlayer.trackList[index].data;}else if(dzPlayer.getRepeat()==2){return dzPlayer.getCurrentSong();}},getCurrentSong:function(prop){try{if(typeof prop==='string'&&prop==='MEDIA_ID'){prop=(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_SONG?'SNG_ID':'EPISODE_ID');}
var trackList=_dzPlayer.trackList[_dzPlayer.trackListIndex];var playerType=dzPlayer.getPlayerType();if(typeof trackList!=='undefined'&&typeof trackList.data!=='undefined'&&playerType!=='ads'&&playerType!=='jingle'){return(typeof prop!=='string')?trackList.data:trackList.data[prop];}
var defaut={SNG_ID:0,ART_ID:0,ALB_ID:0,ALB_PICTURE:'',URL:'',DURATION:0};return(typeof prop!=='string')?null:defaut[prop];}catch(e){error.log(e);}},isAdvertisingAllowed:function(){if(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK&&!Number(dzPlayer.getCurrentSong('SHOW_IS_ADVERTISING_ALLOWED'))){return false;}
return true;},getMediaType:function(data){data=data||dzPlayer.getCurrentSong();if(data===null){return false;}
if(typeof data.EPISODE_ID!=='undefined'){return dzPlayer.MEDIA_TYPE_TALK;}
return dzPlayer.MEDIA_TYPE_SONG;},getContext:function(prop){try{if(typeof _dzPlayer.trackList[_dzPlayer.trackListIndex]!='undefined'&&typeof _dzPlayer.trackList[_dzPlayer.trackListIndex].context!='undefined'&&dzPlayer.getPlayerType()!=='ads'&&dzPlayer.getPlayerType()!=='jingle'){return(typeof prop!=='string')?_dzPlayer.trackList[_dzPlayer.trackListIndex].context:_dzPlayer.trackList[_dzPlayer.trackListIndex].context[prop];}
var defaut={ID:'',TYPE:'',CONTEXT_ID:''};return(typeof prop!=='string')?null:defaut[prop];}catch(e){error.log(e);}},getRepeat:function(){if(dzPlayer.isRadio()||dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){return 0;}
if(typeof dzPlayer.repeat==='string'&&dzPlayer.repeat.length>1){dzPlayer.repeat=0;}
return parseInt(dzPlayer.repeat,10);},getPosition:function(){return dzPlayer.position;},getExactPosition:function(){return dzPlayer.trigger('audioPlayer_getPosition',[]);},getDuration:function(){return dzPlayer.duration;},getVolume:function(){return dzPlayer.volume;},isShuffle:function(){if(dzPlayer.isRadio()||dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){return false;}
return dzPlayer.shuffle;},removeTracks:function(index){if(dzPlayer.getIndexSong()==index){if(_dzPlayer.trackList.length===1){return false;}
dzPlayer.playTrackAtIndex(index+((_dzPlayer.trackList.length-1==index)?-1:1));}
return _trackList.remove(index);},orderTracks:function(order){return _trackList.order(order);},isMuted:function(){return dzPlayer.muted;},isPlaying:function(){return dzPlayer.playing;},isPaused:function(){return dzPlayer.paused;},getArtistName:function(){return dzPlayer.getCurrentSong('ART_NAME');},getAlbumTitle:function(){return dzPlayer.getCurrentSong('ALB_TITLE');},getSongTitle:function(){return dzPlayer.getCurrentSong('SNG_TITLE');},getPlayerType:function(){return dzPlayer.playerType;},getPlayerTypeId:function(){if(dzPlayer.playerType=='radio'){return 1;}
return 0;},setPlayerType:function(type){if(dzPlayer.getPlayerType()!=type){dzPlayer.playerType=type;dzPlayer.trigger('audioPlayer_setType',[type]);}
_dzPlayerEvents.trigger(Events.player.changePlayerType,dzPlayer.playerType);},getSongId:function(){return dzPlayer.getCurrentSong('MEDIA_ID');},isLoading:function(){return dzPlayer.loading;},getCover:function(){return dzPlayer.getCurrentSong('ALB_PICTURE');},isFadeInProgress:function(){return dzPlayer.fadeInProgress;},isFadeOutProgress:function(){return dzPlayer.fadeOutProgress;},isHq:function(){return dzPlayer.hq;},setOffline:function(status){dzPlayer.trigger('audioPlayer_setOffline',[status]);},sendFile:function(file){dzPlayer.trigger('audioPlayer_sendFile',[file]);},isLimited:function(){if(countObject(dzPlayer.user_status)>0){return dzPlayer.user_status.limited;}
return false;},getRadioType:function(){return dzPlayer.radioType;},skipRadioAllowed:function(){if(dzPlayer.user_status.radio_skips===0){return true;}
if(dzPlayer.helper.isPlayingFlow()&&USER.OPTIONS.web_hq){return true;}
return(dzPlayer.radioSkipCounter<dzPlayer.user_status.radio_skips);},radioStartListen:function(id,type){dzPlayer.radioType=type;_dzPlayerEvents.trigger(Events.radio.start,{type:type,id:id});},radioSkipSetTimer:function(){clearTimeout(dzPlayer.radioSkipIntervalId);dzPlayer.radioSkipIntervalId=0;dzPlayer.radioSkipCounter=0;if(dzPlayer.isRadio()){dzPlayer.radioSkipIntervalId=window.setTimeout(dzPlayer.radioSkipSetTimer,dzPlayer.radioSkipInterval);}},helper:{isPlayingFlow:function(){var context=dzPlayer.getContext();return(context!==null)&&(context.TYPE==='feed_user_radio'||context.TYPE==='profile_user_radio');},isPlayingUserFlow:function(){var context=dzPlayer.getContext();return(context!==null)&&((context.TYPE==='feed_user_radio'||context.TYPE==='profile_user_radio')&&(context.ID==USER.USER_ID));}},control:{canSeek:function(){if(dzPlayer.isRadio()&&USER.OPTIONS.web_hq){return true;}
if(dzPlayer.getPlayerType()==='chromecast'&&!chromecast.isRadio()){return true;}
if(dzPlayer.getPlayerType()==='mod'){return true;}
return false;},play:function(){try{if(dzPlayer.isPlaying()===false&&dzPlayer.isPaused()===false){if(dzPlayer.getCurrentSong('SNG_ID')!==0){dzPlayer._play(true);}}else{_dzPlayerEvents.trigger(Events.player.resume,{value:dzPlayer.getCurrentSong()});dzPlayer.trigger('audioPlayer_play');}}catch(e){error.log(e);}},pause:function(){try{if(dzPlayer.getPlayerType()==='ads'){return false;}
dzPlayer.trigger('audioPlayer_pause');if(dzPlayer.getPlayerType()==='chromecast'){return false;}
if(countObject(dzPlayer.logTrack)>0&&dzPlayer.logTrack.stat){dzPlayer.logTrack.stat.pause++;}}catch(e){error.log(e);}},nextSong:function(naturalEnd){try{if(dzPlayer.getPlayerType()==='ads'){return false;}
if(typeof naturalEnd==='undefined'){naturalEnd=false;}
if(dzPlayer.getPlayerType()==='chromecast'){return chromecast.doAction('next');}
if(dzPlayer.isRadio()&&!dzPlayer.skipRadioAllowed()&&!naturalEnd){return false;}
if(!naturalEnd){if(countObject(dzPlayer.logTrack)===0){dzPlayer.logManager(false);}
dzPlayer.logTrack.stat.next=true;if(dzPlayer.isRadio()){dzPlayer.radioSkipCounter++;}}
dzPlayer.previousSkipAction='next';if(dzPlayer.getRepeat()==0&&_dzPlayer.trackListIndex<_dzPlayer.trackList.length-1){_dzPlayer.trackListIndex++;}else if(dzPlayer.getRepeat()==1&&_dzPlayer.trackListIndex<_dzPlayer.trackList.length-1){_dzPlayer.trackListIndex++;}else if(dzPlayer.getRepeat()==1&&_dzPlayer.trackListIndex==_dzPlayer.trackList.length-1){_dzPlayer.trackListIndex=0;}else if(dzPlayer.getRepeat()!=2){dzPlayer.playing=false;dzPlayer.logManager(false);_dzPlayer.trackListIndex=0;dzPlayer._play(false,true);_dzPlayerEvents.trigger(Events.player.finishTrackList);return false;}
var autoPlay=true;if(naturalEnd&&dzPlayer.playerType=='mod'){autoPlay=!dzPlayer.isLimited();}
dzPlayer._play(autoPlay,naturalEnd);}catch(e){error.log(e);}},prevSong:function(){try{if(dzPlayer.getPlayerType()==='ads'){return false;}
if(dzPlayer.getPlayerType()==='chromecast'){return chromecast.isRadio()?false:chromecast.doAction('prev');}
if(dzPlayer.isRadio()){return false;}
if(typeof dzPlayer.logTrack.stat!=='undefined'){dzPlayer.logTrack.stat.prev=true;}
dzPlayer.previousSkipAction='prev';if(dzPlayer.getRepeat()==0&&_dzPlayer.trackListIndex>0){_dzPlayer.trackListIndex--;}else if(dzPlayer.getRepeat()==1&&_dzPlayer.trackListIndex>0){_dzPlayer.trackListIndex--;}else if(dzPlayer.getRepeat()==1&&_dzPlayer.trackListIndex==0){_dzPlayer.trackListIndex=_dzPlayer.trackList.length-1;}else if(dzPlayer.getRepeat()==2){_dzPlayer.trackListIndex=_dzPlayer.trackListIndex;}else{return false;}
dzPlayer._play(true);}catch(e){error.log(e);}},togglePause:function(){try{if(dzPlayer.isPlaying()){dzPlayer.control.pause();}else{dzPlayer.control.play();}}catch(e){error.log(e);}},setRepeat:function(repeat){try{if(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){return false;}
dzPlayer.repeat=repeat;Events.trigger(Events.player.repeat_changed,dzPlayer.repeat);if(dzPlayer.getPlayerType()==='chromecast'){return chromecast.doAction('setRepeat',{value:dzPlayer.repeat});}
userSetting.set({site:{player_repeat:dzPlayer.repeat}});}catch(e){error.log(e);}},setVolume:function(volume,save){try{if(dzPlayer.getPlayerType()=='ads'){return false;}
if(dzPlayer.isMuted()&&volume>0){dzPlayer.control.mute(false);}
save=save||false;dzPlayer.volume=volume;dzPlayer.trigger('audioPlayer_setVolume',[volume]);Events.trigger(Events.player.volume_changed,Math.round(volume*100));if(dzPlayer.getPlayerType()==='chromecast'&&chromecast.isOwner()===false){save=false;}
if(save){storage.set('volume',dzPlayer.volume);}}catch(e){error.log(e);}},setShuffle:function(status){try{if(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){return false;}
if(_dzPlayer.trackList.length===0){return false;}
dzPlayer.shuffle=status;var save=true;if(dzPlayer.getPlayerType()==='chromecast'){chromecast.doAction('setShuffle',{value:dzPlayer.isShuffle()});if(!chromecast.isOwner()){save=false;}}else{if(dzPlayer.shuffle){_trackList.shuffle();}else{_trackList.unShuffle();}}
if(save){userSetting.set({site:{player_shuffle:dzPlayer.shuffle}});}
_dzPlayerEvents.trigger(Events.player.shuffle_changed,dzPlayer.shuffle);}catch(e){error.log(e);}},mute:function(bMute){try{if(dzPlayer.getPlayerType()=='ads'){return false;}
dzPlayer.muted=!dzPlayer.muted;dzPlayer.trigger('audioPlayer_mute',[bMute]);Events.trigger(Events.player.mute_changed,dzPlayer.muted);}catch(e){error.log(e);}},setSmartNotLike:function(){try{api.call('smart_notLikeSong',{sng_id:dzPlayer.getCurrentSong('SNG_ID')});dzPlayer.control.nextSong();}catch(e){error.log(e);}},seek:function(position){try{if(!dzPlayer.control.canSeek()){return false;}
dzPlayer.trigger('audioPlayer_seek',[position]);if(dzPlayer.getPlayerType()==='chromecast'){return false;}
if(countObject(dzPlayer.logTrack)>0){dzPlayer.logTrack.stat.seek++;}
Events.trigger(Events.player.seek,position);}catch(e){error.log(e);}},changeFadeValue:function(fade){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
dzPlayer.trigger('audioPlayer_changeFadeValue',[fade]);dzPlayer.fade=fade;userSetting.set({site:{player_fade:dzPlayer.fade}});Events.trigger(Events.player.fade,dzPlayer.fade);return true;}catch(e){error.log(e);}},setHq:function(status){try{dzPlayer.hq=status;dzPlayer.trigger('audioPlayer_setHq',[status]);userSetting.set({site:{player_hq:dzPlayer.hq}});Events.trigger(Events.player.hq,dzPlayer.hq);}catch(e){error.log(e);}},loadLyrics:function(){if(!dzPlayer.hasLyrics()){return;}
if(dzPlayer.hasLoadedLyrics()){Events.trigger(Events.lyrics.load);}else{var sngID=dzPlayer.getCurrentSong('SNG_ID');var lyricsID=dzPlayer.getCurrentSong('LYRICS_ID');api.call({method:'song.getLyrics',data:{SNG_ID:sngID},success:function(data){if(data.LYRICS_TEXT){data.LYRICS_TEXT=data.LYRICS_TEXT.split(/\r\n|\r|\n/g);}
_dzPlayer.lyrics['LYRICS_'+lyricsID]=data;Events.trigger(Events.lyrics.load);}});}}},getLyrics:function(){if(dzPlayer.hasLoadedLyrics()){var key='LYRICS_'+dzPlayer.getCurrentSong('LYRICS_ID');if(dzPlayer.hasSyncLyrics()){return _dzPlayer.lyrics[key].LYRICS_SYNC_JSON;}
var textLyrics=_dzPlayer.lyrics[key].LYRICS_TEXT;if(textLyrics&&textLyrics.length){return textLyrics;}}
return null;},getLyricsMetadata:function(){if(dzPlayer.hasLoadedLyrics()){var key='LYRICS_'+dzPlayer.getCurrentSong('LYRICS_ID');return{copyrights:_dzPlayer.lyrics[key].LYRICS_COPYRIGHTS,writers:_dzPlayer.lyrics[key].LYRICS_WRITERS};}
return null;},hasLyrics:function(){var lyricsID=dzPlayer.getCurrentSong('LYRICS_ID');return typeof lyricsID!=='undefined'&&lyricsID!==0;},hasLoadedLyrics:function(){if(!dzPlayer.hasLyrics()){return false;}
var key='LYRICS_'+dzPlayer.getCurrentSong('LYRICS_ID');return(typeof _dzPlayer.lyrics[key]!=='undefined');},hasSyncLyrics:function(){if(!dzPlayer.hasLoadedLyrics()){return false;}
var key='LYRICS_'+dzPlayer.getCurrentSong('LYRICS_ID');var syncLyrics=_dzPlayer.lyrics[key].LYRICS_SYNC_JSON;return(typeof syncLyrics!=='undefined'&&syncLyrics.length!==0);},logManager:function(sendNextSong){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
if(typeof sendNextSong=='undefined'){sendNextSong=true;}
if(countObject(dzPlayer.logTrack)>0){if(OFFLINE){dzPlayer.logTrack.force_timestamp=SERVER_TIMESTAMP;Events.trigger(Events.player.log_offline,dzPlayer.logTrack);}else{var logNextSong={};if(sendNextSong&&countObject(dzPlayer.logStartedTrack())>0){logNextSong=dzPlayer.logStartedTrack();}
if(typeof dzPlayer.user_status.timestamp!='undefined'){dzPlayer.logTrack.timestamp=dzPlayer.user_status.timestamp;}
if(dzPlayer.logTrack.sng_id>0&&dzPlayer.getPlayerType()=='mod'){Events.trigger(Events.player.updateRestrictTime,dzPlayer.logTrack.lt);}
dzPlayer.sendLog(dzPlayer.logTrack,logNextSong);if(!sendNextSong){dzPlayer.logTrack={};return false;}}}else{if(countObject(dzPlayer.logStartedTrack())&&sendNextSong){dzPlayer.sendLog(dzPlayer.logTrack,dzPlayer.logStartedTrack());}}
dzPlayer.logTrack=$.extend(true,{},dzPlayer.logTrackTemplate);if(dzPlayer.isLimited()){dzPlayer.logTrack.l_30sec=1;}
dzPlayer.logTrack.media.id=dzPlayer.getCurrentSong('MEDIA_ID');dzPlayer.logTrack.media.type=dzPlayer.getMediaType();if(dzPlayer.appId!=0){dzPlayer.logTrack.app={id:dzPlayer.appId,t:dzPlayer.appType};}
if(dzPlayer.getContext('TYPE')!=''){dzPlayer.logTrack.ctxt.t=dzPlayer.getContext('TYPE');}else if(dzPlayer.appId!=0){dzPlayer.logTrack.ctxt.t='inapp';}
if(dzPlayer.getContext('ID')!=''){dzPlayer.logTrack.ctxt.id=dzPlayer.getContext('ID');}else if(dzPlayer.appId!=0){dzPlayer.logTrack.ctxt.id=dzPlayer.appId;}
if(dzPlayer.getContext('CONTEXT_ID')!=''){dzPlayer.logTrack.ctxt.c=dzPlayer.getContext('CONTEXT_ID');}
dzPlayer.logTrack.type=dzPlayer.getPlayerTypeId();}catch(e){error.log(e);}},logStartedTrack:function(){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
var liveTrack={};if(dzPlayer.getCurrentSong()!==null&&USER.USER_ID>0){liveTrack={id:dzPlayer.getCurrentSong('MEDIA_ID'),type:dzPlayer.getMediaType()};}
return liveTrack;}catch(e){error.log(e);}},sendLog:function(logSong,logNextSong){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
Events.trigger(Events.player.setBookmark,$.extend(false,logSong,{offset:dzPlayer.getPosition(),duration:dzPlayer.getDuration()}));var songsParams={};if(countObject(logSong)>0){songsParams.params=logSong;}
if(countObject(logNextSong)>0){songsParams.next_media={media:logNextSong};}
api.call('log.listen',songsParams,function(result){dzPlayer.token=result;if(dzPlayer.token!==false){dzPlayer.trigger('audioPlayer_setToken',[dzPlayer.token]);}});return true;}catch(e){error.log(e);}},restoreSetting:function(settings){try{if(countObject(settings)==0){return false;}
dzPlayer.hq=(typeof settings.site.player_hq=='undefined'||settings.site.player_hq==null)?(typeof USER!='undefined'&&USER.OPTIONS.web_hq):(settings.site.player_hq&&DZPS);dzPlayer.volume=storage.get('volume',0.5);if(typeof settings.site.player_fade!=='undefined'){dzPlayer.fade=settings.site.player_fade;}
if(typeof settings.site.player_repeat!=='undefined'){dzPlayer.repeat=settings.site.player_repeat;}
if(typeof settings.site.player_shuffle!=='undefined'){dzPlayer.shuffle=(typeof settings.site.player_shuffle==='string')?Boolean(parseInt(settings.site.player_shuffle,10)):settings.site.player_shuffle;}
Events.trigger(Events.player.hq,dzPlayer.hq);Events.trigger(Events.player.volume,dzPlayer.volume);Events.trigger(Events.player.shuffle_changed,dzPlayer.shuffle);Events.trigger(Events.player.repeat_changed,dzPlayer.repeat);dzPlayer.control.changeFadeValue(dzPlayer.fade);dzPlayer.control.setVolume(dzPlayer.volume);dzPlayer.control.setHq(dzPlayer.hq);return true;}catch(e){error.log(e);}},setAppId:function(app_id){try{dzPlayer.appId=app_id;}catch(e){error.log(e);}},setApp:function(app){try{dzPlayer.appId=app.id;dzPlayer.appType=app.type;}catch(e){error.log(e);}},setPropValue:function(propName,value){try{if(dzPlayer.getPlayerType()==='chromecast'){if(propName=='trackList'){return dzPlayer.setTrackList({index:0,data:value,chromecast:true});}}
if(propName=='loadError'){return false;}
if(propName==='preloadComplete'||propName==='preloadAborted'){Events.trigger(Events.player[propName],value);if(propName==='preloadComplete'){dzPlayer.cached[value]=true;}else{delete dzPlayer.cached[value];}
return false;}
if(propName=='duration'&&value==0){return false;}
if(propName=='loadingStats'){if(value.partIndex<=2&&value.sngId>0&&value.sngId==dzPlayer.getCurrentSong('SNG_ID')){dzPlayer.logTrack.ls[value.partIndex]={duration:value.loadingTime,size:value.size,host:value.hostname};}
return false;}
if(dzPlayer.getPlayerType()!=='chromecast'&&propName=='position'&&value>0){if(dzPlayer.lastPosition!=Math.floor(value)){dzPlayer.logTrack.lt+=1;}
dzPlayer.lastPosition=Math.floor(value);if(dzPlayer.getPlayerType()=='ads'){Events.trigger(Events.player.adsVastPlaying,{position:value});}
if(Math.floor(value)==dzPlayer.getDuration()-20&&!dzPlayer.isLimited()&&dzPlayer.getPlayerType()!='ads'&&dzPlayer.getPlayerType()!='jingle'){var nextSong=dzPlayer.getNextSong();if(nextSong!=null&&nextSong.DURATION>60&&typeof dzPlayer.cached[nextSong.SNG_ID]==='undefined'){dzPlayer.cached[nextSong.SNG_ID]=false;dzPlayer.trigger('audioPlayer_preloadTrack',[[dzPlayer.getNextSong()]]);}}}
if(propName=='finish'){Events.trigger(Events.player.track_end,value);}
dzPlayer[propName]=value;if(propName==='user_status'&&dzPlayer.user_status.limited&&USER.USER_ID>0){error.log({description:'user_status limited',stack:{token:dzPlayer.token}});}
if(dzPlayer.getPlayerType()==='chromecast'){if(propName=='repeat'){propName='repeat_changed';}
if(propName==='shuffle'){propName='shuffle_changed';}
if(propName==='volume'){propName='volume_changed';value=Math.round(value*100);}}
Events.trigger(Events.player[propName],value);}catch(e){error.log(e);}},trigger:function(methodName,params){try{if(dzPlayer.user_status.preview===false){return false;}
if(params==null){params=[];}
if(dzPlayer.playerLoaded){if(dzPlayer.getPlayerType()==='chromecast'){return chromecast.doAction(methodName,params);}
executeActionscriptMethod('audioPlayerSWF',methodName,params);}}catch(e){error.log(e);}}};window.dzPlayer=dzPlayer;})();function setDzPlayerProp(prop,value){try{dzPlayer.setPropValue(prop,value);}catch(e){error.log(e);}}
function setDzPlayerProps(keyValueObject){try{for(var key in keyValueObject){if(!keyValueObject.hasOwnProperty(key)){continue;}
dzPlayer.setPropValue(key,keyValueObject[key]);}}catch(e){error.log(e);}}
function executeActionscriptMethod(swfId,method,params){try{if(document.getElementById(swfId)===null||typeof document.getElementById(swfId).callAS!=='function'){error.log({message:'swf not accessible',description:'executeActionscriptMethod: / swfId '+swfId});return false;}
document.getElementById(swfId).callAS(method,params);}catch(e){error.log(e);}};;
(function($){facebox_interval_id=0;$.facebox=function(data,klass){$.facebox.loading();if(data.ajax)fillFaceboxFromAjax(data.ajax)
else if(data.image)fillFaceboxFromImage(data.image)
else if(data.div)fillFaceboxFromHref(data.div)
else if($.isFunction(data))data.call($)
else $.facebox.reveal(data,klass)}
$.extend($.facebox,{settings:{opacity:0.7,overlay:true,loadingImage:SETTING_STATIC+'/img/popin/loading.gif',imageTypes:['png','jpg','jpeg','gif'],faceboxHtml:' <div id="facebox" style="display:none;" class="absolute"> <div class="popup relative"> <table> <tbody> <tr> <td class="tl main"/><td class="b_t"/><td class="tr main"/> </tr> <tr> <td class="b_l"/><td class="body"> <a href="#" class="close_popin sprite_others"> </a> <div class="content"> </div> </td> <td class="b_r"/> </tr> <tr> <td class="bl main"/><td class="b_b"/><td class="br main"/> </tr> </tbody> </table> </div> </div>'},loading:function(){init();if($('#facebox .loading').length==1){return true;}
showOverlay();$('#facebox').addClass('lightbox_old');$('#facebox .content').empty();facebox_interval_id=setTimeout(function(){$('#facebox').show();$('#facebox .body').children().hide().end().append('<div class="loading"><br /><br /><img src="'+$.facebox.settings.loadingImage+'"/><br /><br /><br /></div>');facebox_interval_id=0;},200);$('#facebox').stop();$('#facebox').css({top:getPageScroll()[1]+50,left:$(window).width()/2-186});$(document).trigger('loading.facebox');},reveal:function(data,klass){clearInterval(facebox_interval_id);$(document).trigger('beforeReveal.facebox');if(klass)$('#facebox .content').addClass(klass);$('#facebox').show();$('#facebox .content').html(data);$('#facebox .loading').remove();$('#facebox .body').children().fadeIn('normal');$('#facebox').css('left',$(window).width()/2-($('#facebox table').width()/2))
$(document).trigger('reveal.facebox').trigger('afterReveal.facebox');},close:function(arg){if(typeof arg=='undefined'){arg=false;}
$(document).trigger('close.facebox',arg);return false;},showOverlay:function(){showOverlay();},hideOverlay:function(){hideOverlay();}})
$.fn.facebox=function(settings){init(settings);function clickHandler(){$.facebox.loading(true)
var klass=this.rel.match(/facebox\[?\.(\w+)\]?/)
if(klass)klass=klass[1]
fillFaceboxFromHref(this.href,klass)
return false}
return this.click(clickHandler)}
function init(settings){clearInterval(facebox_interval_id);if($.facebox.settings.inited)return true
else $.facebox.settings.inited=true
$(document).trigger('init.facebox')
makeCompatible()
var imageTypes=$.facebox.settings.imageTypes.join('|')
$.facebox.settings.imageTypesRegexp=new RegExp('\.'+imageTypes+'$','i')
if(settings)$.extend($.facebox.settings,settings)
$('body').append($.facebox.settings.faceboxHtml)
var preload=[new Image(),new Image()]
preload[0].src=$.facebox.settings.loadingImage
$('#facebox').find('.b:first, .bl, .br, .tl, .tr').each(function(){preload.push(new Image())
preload.slice(-1).src=$(this).css('background-image').replace(/url\((.+)\)/,'$1')})
$('#facebox .close_popin').click($.facebox.close);}
function getPageScroll(){var xScroll,yScroll;if(self.pageYOffset){yScroll=self.pageYOffset;xScroll=self.pageXOffset;}else if(document.documentElement&&document.documentElement.scrollTop){yScroll=document.documentElement.scrollTop;xScroll=document.documentElement.scrollLeft;}else if(document.body){yScroll=document.body.scrollTop;xScroll=document.body.scrollLeft;}
return new Array(xScroll,yScroll)}
function getPageHeight(){var windowHeight
if(self.innerHeight){windowHeight=self.innerHeight;}else if(document.documentElement&&document.documentElement.clientHeight){windowHeight=document.documentElement.clientHeight;}else if(document.body){windowHeight=document.body.clientHeight;}
return windowHeight}
function makeCompatible(){var $s=$.facebox.settings
$s.loadingImage=$s.loading_image||$s.loadingImage
$s.closeImage=$s.close_image
$s.imageTypes=$s.image_types||$s.imageTypes
$s.faceboxHtml=$s.facebox_html||$s.faceboxHtml}
function fillFaceboxFromHref(href,klass){if(href.match(/#/)){var url=window.location.href.split('#')[0]
var target=href.replace(url,'')
$.facebox.reveal($(target).clone().show(),klass)}else if(href.match($.facebox.settings.imageTypesRegexp)){fillFaceboxFromImage(href,klass)}else{fillFaceboxFromAjax(href,klass)}}
function fillFaceboxFromImage(href,klass){var image=new Image()
image.onload=function(){$.facebox.reveal('<div class="image"><img src="'+image.src+'" /></div>',klass)}
image.src=href}
function fillFaceboxFromAjax(href,klass){$.get(href,function(data){$.facebox.reveal(data,klass)})}
function skipOverlay(){return $.facebox.settings.overlay==false||$.facebox.settings.opacity===null}
function showOverlay(){if(skipOverlay()){return;}
if($('#facebox_overlay').length==0){$("body").append('<div id="facebox_overlay" class="facebox_hide"></div>');$('#facebox_overlay').hide().addClass("facebox_overlayBG").css('opacity',$.facebox.settings.opacity);}
$('#facebox_overlay').stop();$('#facebox_overlay').fadeIn(200);return false}
function hideOverlay(){if(skipOverlay()){return;}
$('#facebox_overlay').fadeOut(function(){})
return false}
$(document).bind('close.facebox',function(evt,arg){clearInterval(facebox_interval_id);Events.trigger(Events.lightbox.close+'_'+$("#facebox").data('uniqid'),arg);$('#facebox').hide();$('#facebox .content').removeClass().addClass('content').html('');$('#facebox .loading').remove();hideOverlay();})})(jQuery);;
var hovercard={loading:false,template:false,timeout:null,delayIn:800,delayOut:100,cacheCard:new Array(),current:null,mouseX:null,cache:true,gravity:'',offset:0,arrow:12,init:function(div,delayIn,cache,gravity,callback){try{if(typeof callback!='function'){callback=function(){};}
hovercard.callback=callback;if(OFFLINE){return false;}
if(typeof delayIn!='undefined'||delayIn!=null){hovercard.delayIn=delayIn;}else{hovercard.delayIn=800;}
if(hovercard.current!=null){hovercard.delayIn=0;}
if(typeof cache!='undefined'||delayIn!=null){hovercard.cache=cache;}else{hovercard.cache=true;}
if(typeof gravity!='undefined'||gravity!=null){hovercard.gravity=gravity;}else{hovercard.gravity='';}
div.mousemove(function(event){hovercard.mouseX=event.pageX;hovercard.mouseY=event.pageY;})
clearInterval(hovercard.timeout);if(!hovercard.loading&&hovercard.template==false){hovercard.loading=true;$("body").append('<div id="load_temp"></div>');$('#load_temp').load('/ajax/hovercard/page.php?card=template',function(response,status,xhr){hovercard.template=true;if($('#hovercard #content').length===0){$('#hovercard').append('<div id="content" class="box-shadow"></div>');}
$("body").append($("#hovercard"));hovercard.$hovercard=$("#hovercard");hovercard.$hovercard_arrow=$("#hovercard #arrow");$('#load_temp').remove();hovercard.timeout=setTimeout(function(){hovercard.load(div)},hovercard.delayIn);});}else{if(hovercard.delayIn>0){hovercard.timeout=setTimeout(function(){hovercard.load(div);},hovercard.delayIn);}else{hovercard.load(div);}}
return true;}catch(e){error.log(e);}},load:function(div){try{data=div.attr('data-hovercard');if(data==null||data==""){return false;}
if(hovercard.current==data){hovercard.display(div);return false;}
hovercard.current=data;if(hovercard.cacheCard[data]){$("#content",hovercard.$hovercard).html(hovercard.cacheCard[data]);hovercard.display(div);hovercard.callback(div);}else{$('#content',hovercard.$hovercard).load(data,function(response,status,xhr){hovercard.display(div);hovercard.callback(div);if(hovercard.cache==true){hovercard.cacheCard[data]=response;}});}
return true;}catch(e){error.log(e);}},display:function(div){try{if(div.attr("id")==undefined){div.attr("id","tmp_for_hovercard");}
var hc_width=hovercard.$hovercard.width();var hc_height=hovercard.$hovercard.height()
obj=document.getElementById(div.attr("id"));coord=util.findPos(obj);objParent=obj.parentNode;coordParent=util.findPos(objParent);objNext=obj.nextSibling;coordNext=util.findPos(objNext);div_offset=div.offset();div_width=div.width();div_height=div.height();divTop=div_offset.top;posLeft=coord[0];sectionWidth=coordNext[0]-coord[0];sectionWidth=0;if(div.attr("id")=="tmp_for_hovercard"){div.removeAttr('id');}
if(sectionWidth<0){sectionWidth=div.width();}
if(hovercard.gravity==''){if(div.css("line-height").indexOf('px')>-1){lineHeight=div.css("line-height").replace("px","");if(div.height()>lineHeight){if((hovercard.mouseY-coord[1])>14){divTop=divTop+14;posLeft=div_offset.left;sectionWidth=coordNext[0]-div_offset.left;}else{sectionWidth=obj.offsetWidth-(coord[0]-coordParent[0]);}}}else{lineHeight=0;}
var arrowPos={};if(hc_width>(client_width-hovercard.mouseX)){arrowPos.right='25px';arrowPos.left='';paddingLeft=-hc_width+sectionWidth;if(sectionWidth>0&&sectionWidth<60){posLeft-=-30+(sectionWidth/2);}}else{arrowPos.left='25px';arrowPos.right='';paddingLeft=0;if(sectionWidth>0&&sectionWidth<60){posLeft+=-30+(sectionWidth/2);}}
posLeft+=paddingLeft;if(hc_height>(div_offset.top-$(window).scrollTop())){posTop=parseInt(divTop)+parseInt(lineHeight);hovercard.$hovercard_arrow.removeClass().addClass("hovercard_arrow arrow_n");arrowPos.top='-10px';arrowPos.bottom='';}else{posTop=divTop-$("#hovercard").height()-14;hovercard.$hovercard_arrow.removeClass().addClass("hovercard_arrow arrow_s");arrowPos.bottom='-5px';arrowPos.top='';}
hovercard.$hovercard.css('margin-top','11px');hovercard.$hovercard_arrow.css(arrowPos)}
if(DIRECTION==='rtl'&&hovercard.gravity==='e'){hovercard.gravity='w';}
switch(hovercard.gravity.charAt(0)){case'n':break;case's':break;case'e':if(hc_height>(client_height-(div_offset.top-$(window).scrollTop()))){posTop=divTop-(hc_height-(client_height-(div_offset.top-$(window).scrollTop())))-10;arrowTop=(hc_height-(client_height-(div_offset.top-$(window).scrollTop())))+(div_height/2)+hovercard.arrow;}else{posTop=divTop;arrowTop=(div_height/2-hovercard.arrow/2);}
posLeft=div_offset.left-hc_width-hovercard.offset-hovercard.arrow;hovercard.$hovercard.css('margin-top','0px');hovercard.$hovercard_arrow.removeClass().addClass("hovercard_arrow arrow_e");hovercard.$hovercard_arrow.css({'left':hc_width,'top':arrowTop+'px'});break;case'w':if(hc_height>(client_height-(div_offset.top-$(window).scrollTop()))){posTop=divTop-(hc_height-(client_height-(div_offset.top-$(window).scrollTop())))-10;arrowTop=(hc_height-(client_height-(div_offset.top-$(window).scrollTop())))+(div_height/2)+hovercard.arrow;}else{posTop=divTop;arrowTop=(div_height/2-hovercard.arrow/2);}
posLeft=div.width()+hovercard.arrow;hc_width=-hovercard.$hovercard_arrow.width();hovercard.$hovercard.css('margin-top','0px');hovercard.$hovercard_arrow.removeClass().addClass("hovercard_arrow arrow_w");hovercard.$hovercard_arrow.css({'left':hc_width,'top':arrowTop+'px'});break;}
if(hovercard.gravity.length==2){if(hovercard.gravity.charAt(1)=='w'){}else{}}
hovercard.$hovercard.show().css({"top":posTop,"left":posLeft}).mouseenter(function(){div.off('mouseleave');clearInterval(hovercard.timeout);});hovercard.$hovercard.mouseleave(function(){hovercard.remove();});return true;}catch(e){error.log(e);}},remove:function(){try{clearInterval(hovercard.timeout);if(hovercard.current!=null){hovercard.timeout=setTimeout(function(){hovercard.hide()},hovercard.delayOut);}
return true;}catch(e){error.log(e);}},hide:function(){try{hovercard.current=null;$('#hovercard').hide();return true;}catch(e){error.log(e);}}};
var notification={delayTimeOut:0,delayDefault:5000,content:null,notifyTrad:{no_log:gettext('L\'écoute est limitée à 30 secondes. Pour écouter en illimité, connectez-vous ou inscrivez-vous gratuitement.'),discovery_used_tb:gettext('Il vous reste moins d\'1 heure d\'écoute gratuite. Abonnez-vous ! '),discovery_with_tb:gettext('Offre spéciale : la musique illimitée gratuite. Essayez ! '),expired_cc:gettext('Votre carte est sur le point d\'expirer. Modifiez vos coordonnées bancaires dès aujourd\'hui pour continuer à profiter de votre abonnement.'),flash_update:gettext('Téléchargez la dernière version de Flash Player pour pouvoir utiliser Deezer.'),limit30sec:gettext('L\'écoute est limitée à 30 secondes. Découvrez Deezer Premium !'),mobile_only:gettext('Votre offre Deezer Mobile ne vous donne pas accès à l\'écoute illimité à la demande sur le site Deezer.'),facebook_publish_action:gettext('Cliquez ici pour partager vos découvertes musicales avec vos amis !'),ie8_support:gettext('Votre navigateur internet est trop ancien pour profiter pleinement de l\'experience Deezer. Cliquez ici pour le mettre à jour.'),ie_warning:gettext('Deezer n\'est pas compatible avec Internet Explorer 7. Cliquez ici pour mettre à jour votre navigateur.'),win8_push:gettext('Téléchargez l\'appli Deezer pour Windows 8 et accédez directement à votre musique !'),flow_skip_push:gettext('Abonnez-vous à Premium+ pour pouvoir zapper en illimité.'),limit0s_free:gettext('Vous ne profitez pas de cette fonctionnalité, abonnez-vous pour en profiter'),flash_not_installed:gettext('Flash Player n\'est pas installé ou désactivé. Veuillez installer puis activer la version la plus récente de Flash Player pour pouvoir utiliser Deezer.'),flash_blocked:gettext('Il semble qu\'un paramètre ou une extension bloque Flash Player. Veuillez le ou la désactiver pour pouvoir utiliser Deezer.')},init:function(){Events.subscribe(Events.playlist.addSong,function(evt,data){if(data.notify===true){notification.display(evt,data);}});Events.subscribe(Events.user.settingChanged,function(evt,data){if(data.notify===true){notification.display(evt,data);}});Events.subscribe(Events.player.tracklist_changed,function(evt,data){if(data.type==='addNext'||data.type==='addToQueue'){notification.display(evt,data);}});Events.subscribe(Events.copy.after,function(evt,data){notification.display(evt,data);});Events.subscribe(Events.user.shareClick,function(evt,data){notification.display(evt,data);});Events.subscribe(Events.playlist.created,notification.display);Events.subscribe(Events.playlist.assistantSuggestFinish,notification.display);},display:function(evt,data){if(notification.content===null){notification.content=$('#notification');}
evt=evt||{};var delay=data.delay||notification.delayDefault;var wording=data.message;switch(evt.namespace){case'USER.settingChanged':wording=gettext('Sauvegardé');break;case'PLAYLIST.addSong':wording=ngettext('Le titre a bien été ajouté à la playlist.','Les titres ont bien été ajoutés à la playlist.',{count:data.song.length});break;case'PLAYER.tracklist_changed':wording=ngettext('Le titre a bien été ajouté à la file d\'attente.','Les titres ont bien été ajoutés à la file d\'attente.',{count:data.song.length});break;case'PLAYLIST.assistantSuggestFinish':wording=ngettext('Le titre a bien été ajouté à la playlist.','Les titres ont bien été ajoutés à la playlist.',{count:data.count});break;case'PLAYLIST.created':wording=gettext('La playlist "%s" a bien été créée.',{sprintf:[data.TITLE]});break;}
$('h2',notification.content).text(wording);notification.content.show();setTimeout(function(){$('> div',notification.content).addClass('active');},0);if(notification.delayTimeOut>0){window.clearTimeout(notification.delayTimeOut);}
notification.delayTimeOut=setTimeout(notification.hide,delay);},hide:function(){notification.content.hide().children('div').removeClass('active');}};var notificationBar={init:function(){Events.subscribe(Events.player.notify,function(){notificationBar.check('start');});Events.subscribe(Events.player.finish,function(){notificationBar.check('end');});Events.subscribe(Events.offline.reminder,function(){notificationBar.display('drive_download_push',{replaceText:BrowserDetect.OS});});},check:function(type){try{if(typeof USER==='undefined'||dzPlayer.getPlayerType()!=='mod'){return false;}
if(www.getCurrentPageType()==='landing'){return false;}
if(type==='start'){if(USER.USER_ID===0){notificationBar.display('no_log',{origin:'no_log'});}
if(USER.USER_ID>0&&!DZPS){if(USER.OPTIONS.web_streaming===false){notificationBar.display('limit30sec',{origin:'limit30sec'});}
if(dzPlayer.isLimited()){if(dzPlayer.user_status.preview===false){notificationBar.display('limit0s_free',{origin:'headband_30sec'});}else{notificationBar.display('discovery_limited',{origin:'headband_30sec',replaceText:(restrict.object.time_left+restrict.object.time_used)/3600});}}}}
if(type==='end'){if(USER.USER_ID===0){if(USER.OPTIONS.web_streaming===true){if(dzPlayer.isLimited()&&$('#facebox:visible').length===0){www.goToConnection();}}else if($('#facebox:visible').length===0){www.goToConnection();}}}}catch(e){error.log(e);}},notifyAllreadyDisplayed:{},display:function(msg,param){param=param||{};try{if(typeof notificationBar.notifyAllreadyDisplayed[msg]!=='undefined'){return false;}
if(storage.isset('NOTIFY_'+msg)){return false;}
var message;if(msg==='discovery_limited'){message=gettext('Vous avez écouté vos %s heures gratuites ce mois-ci. L\'écoute est limitée à 30 secondes.',{sprintf:[param.replaceText]});}else if(msg==='drive_download_push'){message=gettext('Maintenant que vous êtes de retour, cliquez ici pour télécharger Deezer pour %s.',{sprintf:[param.replaceText]});}else{message=notification.notifyTrad[msg];}
var link='';var save_already_displayed=true;switch(msg){case'expired_cc':return false;case'facebook_publish_action':link='facebook.login("publish_actions");';break;case'ie_warning':tracking.track('header_dld_ie7_display');link='modal.open("/lightbox/browser_update.php");tracking.track("header_dld_ie7_click");';break;case'ie8_support':tracking.track('header_dld_ie8_display');link='modal.open("/lightbox/browser_update.php");tracking.track("header_dld_ie8_click");';break;case'no_log':link='www.goToConnection();';break;case'win8_push':link='window.open("http://apps.microsoft.com/windows/app/deezer/e48b595e-b20a-4eb3-968c-c20b2cadaa1e");';storage.set('NOTIFY_'+msg,true);break;case'flow_skip_push':link='window.open("/offers");';save_already_displayed=false;break;case'drive_download_push':link='window.location.href = "'+(BrowserDetect.OS==='Windows'?WIN8_APP_DOWNLOAD:DEEZER_DRIVE_DOWNLOAD)+'";';storage.set('offline_reminder',false);break;default:link='window.open("/offers"); tracking.track("offers_subscribe_click", {origin: "'+(param.origin||1)+'"});';}
$('#notify').show().children('.message').attr('onClick',link+'notificationBar.hide(); return false;').text(message);if(save_already_displayed){notificationBar.notifyAllreadyDisplayed[msg]=true;}
return true;}catch(e){error.log(e);}},hide:function(){$('#notify').hide();}};;
var premium={drawPlaylistInapp:function(obj){try{if(typeof obj.country==='undefined'||typeof obj.offer_id==='undefined'){return false;}
api.call('operator.getPlaylistInappsData',{COUNTRY:obj.country,OFFER_ID:obj.offer_id},function(result){if(result===false){return false;}
if(result.playlist_id!=0){api.call('playlist.getData',{PLAYLIST_ID:result.playlist_id},function(result){userData.addFavorite({type:'playlist',id:result.PLAYLIST_ID,PLAYLIST_ID:result.PLAYLIST_ID,TITLE:result.TITLE,PARENT_USERNAME:result.PARENT_USERNAME});});}
$.each(result.inapps,function(idx){api.call('application.getData',{APP_ID:result.inapps[idx]},function(result){userData.addFavorite({type:'application',id:result.APP_ID,APP_ID:result.APP_ID,NAME:result.NAME,INAPP_ALIAS:result.INAPP_ALIAS,APP_PICTURE_16x16:result.APP_PICTURE_16x16});});});});}catch(e){error.log(e);}},checkCodeValidity:function(){try{$('#input_subscribe_confirm').hide();$('#href_register_submit > .img_loading').show();var errorMsg=gettext('Votre code n\'est pas reconnu. Merci de réessayer ou contacter le fournisseur du code.');var gift_code=$('#gift_code').val();if(gift_code==''){$('#gift_error').html(errorMsg).show();return false;}
var gift_previous_store=$('#gift_previous_store').val();if(gift_previous_store!=null&&gift_previous_store!=''){gift_previous_store_url='&previous_store='+gift_previous_store;}else{var gift_previous_store_url='';}
api.call({method:'premium.checkCodeValidity',data:{CODE:gift_code},success:function(result){var pathname=document.location.pathname;if(pathname.match(/\/gift/gi)===null){pathname='/gift';}
var link=pathname+'?screen=connect&connect='+$('#gift_connect').val()+'&code='+gift_code+gift_previous_store_url;if(USER.USER_ID>0){window.location.href=link;}else{modal.open(link,true);}
return true;},error:function(error){if('GIFT_CODE_ERROR'in error.payload){errorMsg=error.payload['GIFT_CODE_ERROR'];}
$('#gift_error').html(errorMsg).show();$('#input_subscribe_confirm').show();$('#href_register_submit > .img_loading').hide();return true;}});}catch(e){error.log(e);}},test_phone:function(tracking_params,successCallback,errorCallback){var errorMsg=gettext('Une erreur est survenue. Merci de vous assurer de la validité de votre numéro avant de réitérer votre demande.');try{var trackingTag='senttomobile_lb_click';var tracking_params=tracking_params||{type:'smssubmit'};if(typeof tracking_params.type==='undefined'){tracking_params.type='smssubmit';}
$input=$('#tester_phone_number');if(typeof $input=='undefined'||$input.length==0){return false;}
phone_number=$input.val().trim();if(phone_number==''){if(typeof errorCallback==='function'){errorCallback({text:errorMsg,status:'empty_phone'});}else{premium.displayMobileMessage(errorMsg,'error');}
return false;}
$input.val('');api.call({method:'sms.sendAppUrl',data:{PHONE:phone_number},success:function(){if(USER.USER_ID===0){premium.testPhoneSuccess(trackingTag,tracking_params,successCallback);return true;}
api.call({method:'user.update',data:{USER_DATA:{PHONE:phone_number}},success:function(){premium.testPhoneSuccess(trackingTag,tracking_params,successCallback);},error:function(error){if(typeof errorCallback==='function'){errorCallback({text:errorMsg,status:'error'});}else{premium.displayMobileMessage(errorMsg,'error');}
return true;}});},error:function(error){var error_status='error';var type='error';if(error.message=='already_send'){errorMsg=gettext('Un SMS vous a déjà été envoyé à ce numéro. Vous pouvez néanmoins vous rendre via le navigateur de votre mobile sur %s pour tester la compatibilité de votre mobile.',{sprintf:['http://www.deezer.com']});error_status='already_send';type='';}
if(typeof errorCallback==='function'){errorCallback({text:errorMsg,status:error_status});}else{premium.displayMobileMessage(errorMsg,type);}
if(typeof tracking_params==='object'){tracking_params.status=error_status;tracking.track(trackingTag,tracking_params);}
return true;}});}catch(e){error.log(e);}},displayMobileMessage:function(text,type){var type=type||false;$('#tester_phone_msg').removeClass('alert-danger').addClass('alert-success').html(text).fadeIn();if(type=='error'){$('#tester_phone_msg').removeClass('alert-success').addClass('alert-danger');}},testPhoneSuccess:function(trackingTag,tracking_params,successCallback){try{if(typeof successCallback==='function'){successCallback();}else{premium.displayMobileMessage(gettext('Le SMS a bien été envoyé. Vous allez le recevoir d\'ici quelques instants.'));}
if(typeof tracking_params==='object'){tracking_params.status='success';tracking.track(trackingTag,tracking_params);}
return true;}catch(e){error.log(e);}}};
(function(){'use strict';var _types={song:0,album:1,artist:2,playlist:3,radio:4,smart_radio:6,smartradio:6,sradio:6,show:7,episode:8};var Sharebox=function(){this.type=-1;this.id=0;this.data={};this.options={};};Sharebox.prototype.render=function(type,id,data,options){this.type=Math.abs(parseInt(type||0,10));this.id=Math.abs(parseInt(id||0,10));this.data=data||{};this.options=options||{};try{this._checkCtorData();}catch(e){error.log(e.message);return;}
modal.setReactElement('sharebox');var ShareBox=React.createFactory(window.DzrComponents.Modal.ShareBox);React.render(ShareBox({id:this.id,type:this.type,data:this.data,options:this.options}),document.getElementById('modal_sharebox'));};Sharebox.prototype.close=function(standalone){if(Boolean(standalone)===true){window.location.href='dzr://share?action=close';return;}
modal.close();};Sharebox.prototype.typeToId=function(type){type=String(type||'');return _types[type];};Sharebox.prototype.idToType=function(id){for(var key in _types){if(_types.hasOwnProperty(key)&&_types[key]!==id){return _types[key];}}
error.log(new Error('Sharebox :: idToType - Can not match the specified id with a type'));return'';};Sharebox.prototype._checkCtorData=function(){if(this.type<0){throw new Error('Sharebox :: _validateCtorData - type is missing');}
if(this.id<=0){throw new Error('Sharebox :: _validateCtorData - id is missing');}
if(this.data!==Object(this.data)||Array.isArray(this.data)){throw new Error('Sharebox :: _validateCtorData - data is not a valid object');}
if(this.options!==Object(this.options)||Array.isArray(this.options)){throw new Error('Sharebox :: _validateCtorData - options is not a valid object');}};var _shareboxCtor=new Sharebox();window.sharebox={load:function(type,id,context){if(typeof type==='string'){type=sharebox.typeToId(type);}
type=parseInt(type||0,10);id=parseInt(id||0,10);context=String(context||'');var url='/lightbox/sharebox?type='+type+'&id='+id;if(context.length){url+='&context='+context;}
if(!USER.USER_ID){return www.goToConnection({redirect_type:'modal',redirect_link:encodeURIComponent(url)});}
return modal.open(url);},render:function(type,id,data,options){return _shareboxCtor.render(type,id,data,options);},close:function(standalone){return _shareboxCtor.close(standalone);},typeToId:function(type){return _shareboxCtor.typeToId(type);},idToType:function(id){return _shareboxCtor.idToType(id);}};window.clipboard={getUrl:function(type,id,callback){if(typeof type==='string'){type=sharebox.typeToId(type);}
callback=typeof callback==='function'?callback:function(){return;};api.call('share.getClipboardUrl',{type:type,id:id},callback);}};})();;
tokenizer.prototype.hideHint=function(){this.dom_hint.style.display='none';this.dom_hint.className='hint hint_help';this.dom_input.value='';this.dom_input.focus();}
tokenizer.prototype.selectToken=function(){var in_array=false;for(var i=0;i<this.list_token_selected.length;i++){if(this.list_token_selected[i]==this.list_token[this.dom_hint.firstChild.childNodes[this.token_active].token_pointer]['id'])in_array=true;}
if(this.token_active!='none'&&!in_array){this.addToken();this.list_token_selected[this.list_token_selected.length]=this.list_token[this.dom_hint.firstChild.childNodes[this.token_active].token_pointer]['id'];this.dom_input_hidden.value=this.list_token_selected.join('|');this.input_old_value=0;this.hideHint();}}
tokenizer.prototype.highlightToken=function(direction){var old_position=this.token_active;if(direction=='down'){if(old_position=='none')position=0;else if(old_position==this.nb_proposition-1)position=this.token_active;else position=old_position+1;if(old_position!='none')this.dom_hint.firstChild.childNodes[old_position].className='';this.dom_hint.firstChild.childNodes[position].className='selected';this.token_active=position;}else if(direction=='up'){if(old_position==0)position=0;else if(old_position!='none')position=old_position-1;else position=this.nb_proposition-1;if(old_position!='none')this.dom_hint.firstChild.childNodes[old_position].className='';this.dom_hint.firstChild.childNodes[position].className='selected';this.token_active=position;}}
tokenizer.prototype.contactSearch=function(){var that=this;var ul=document.createElement('ul');var out=0;for(var i=0;i<this.list_token.length;i++){var rg=new RegExp('^'+this.dom_input.value,'gi');if(this.list_token[i]['data'].search(rg)!=-1){var li=document.createElement('li');var texte=document.createTextNode(this.list_token[i]['data']);li.token_pointer=i;li.onmouseover=function(){if(that.token_active!='none'){that.dom_hint.firstChild.childNodes[that.token_active].className='';}
this.className='selected';for(var i=0;i<that.dom_hint.firstChild.childNodes.length;i++){if(that.dom_hint.firstChild.childNodes[i].className=='selected'){that.token_active=i;}}}
li.onmouseout=function(){that.token_active='none';this.className='';}
li.onclick=function(){that.selectToken();}
li.appendChild(texte);ul.appendChild(li);out=out+1;}}
this.nb_proposition=out;this.dom_hint.removeChild(this.dom_hint.firstChild);this.dom_hint.appendChild(ul);if(this.nb_proposition>0){this.dom_hint.className='hint hint_overflow';this.dom_hint.style.display='block';this.token_active=0;this.dom_hint.firstChild.firstChild.className='selected';}else this.dom_hint.style.display='none';}
tokenizer.prototype.addToken=function(){var that=this;var img=document.createElement('img');img.src='http://cdn-files.deezer.com/img/common/delete.png';var p=document.createElement('p');var texte=document.createTextNode(this.list_token[this.dom_hint.firstChild.childNodes[this.token_active].token_pointer]['data']);p.appendChild(texte);var li=document.createElement('li');li.className='token';li.token_id=this.list_token[this.dom_hint.firstChild.childNodes[this.token_active].token_pointer]['id'];li.appendChild(p);li.appendChild(img);img.onclick=function(){for(var i=0;i<that.dom_ul_token.childNodes.length-1;i++){if(that.dom_ul_token.childNodes[i].token_id==this.parentNode.token_id)node=i;}
that.deleteToken(node);}
this.dom_input.parentNode.parentNode.insertBefore(li,this.dom_input.parentNode.parentNode.lastChild);}
tokenizer.prototype.deleteToken=function(node){var array=new Array();for(var i=0;i<this.list_token_selected.length;i++){if(this.list_token_selected[i]!=this.dom_ul_token.childNodes[node].token_id)array[array.length]=this.list_token_selected[i];}
this.dom_ul_token.removeChild(this.dom_ul_token.childNodes[node]);this.list_token_selected=array;this.dom_input_hidden.value=this.list_token_selected.join('|');}
tokenizer.prototype.press=function(ns){if(document.all)keycode=event.keyCode;else keycode=ns.which;if(keycode==8&&this.input_old_value==0){if(this.dom_ul_token.childNodes.length>=2){this.deleteToken(this.dom_ul_token.childNodes.length-2);}}
else if(keycode==38&&this.nb_proposition>0)this.highlightToken('up');else if(keycode==40&&this.nb_proposition>0)this.highlightToken('down');else if(keycode==13&&this.nb_proposition>0){if(this.token_active!='none')this.selectToken();}
else if(keycode==27)this.hideHint();else{this.contactSearch();}
this.input_old_value=this.dom_input.value.length;}
function tokenizer(id,list_token,hint,token){var that=this;this.token_active='none';this.nb_proposition=0;this.input_old_value=0;this.list_token=eval(list_token);this.list_token_selected=new Array();var width=document.getElementById(id).style.width;var div_general=document.createElement('div');div_general.className='tokenizer';var input_hidden=document.createElement('input');input_hidden.type='hidden';input_hidden.id=id;input_hidden.name=id;var div_hint=document.createElement('div');div_hint.className='hint hint_help';div_hint.style.width=width;var input=document.createElement('input');input.onkeyup=function(ns){that.press(ns);}
var ul_token_list=document.createElement('ul');ul_token_list.className='token_list';ul_token_list.style.width=width;ul_token_list.onclick=function(){this.lastChild.firstChild.focus();div_hint.innerHTML=hint;div_hint.className='hint hint_help';div_hint.style.display='block';}
var li_for_input=document.createElement('li');li_for_input.appendChild(input);ul_token_list.appendChild(li_for_input);div_general.appendChild(ul_token_list);div_general.appendChild(div_hint);div_general.appendChild(input_hidden);var node=document.getElementById(id);insertAfter(node,div_general);node.parentNode.removeChild(node);this.dom_node=div_general;this.dom_hint=div_hint;this.dom_input=input;this.dom_input_hidden=input_hidden;this.dom_ul_token=ul_token_list;if(token){var img=document.createElement('img');img.src='http://cdn-files.deezer.com/img/common/delete.png';var p=document.createElement('p');var texte=document.createTextNode(token['data']);p.appendChild(texte);var li=document.createElement('li');li.className='token';li.token_id=token['id'];li.appendChild(p);li.appendChild(img);img.onclick=function(){for(var i=0;i<that.dom_ul_token.childNodes.length-1;i++){if(that.dom_ul_token.childNodes[i].token_id==this.parentNode.token_id)node=i;}
that.deleteToken(node);}
this.dom_input.parentNode.parentNode.insertBefore(li,this.dom_input.parentNode.parentNode.lastChild);this.list_token_selected[this.list_token_selected.length]=token['id'];this.dom_input_hidden.value=this.list_token_selected.join('|');}};
(function(){'use strict';var favorite={init:function(){Events.subscribe(Events.user.addFavorite,favorite.onChangeStatus,'favorite');Events.subscribe(Events.user.deleteFavorite,favorite.onChangeStatus,'favorite');},action:function($div,data){try{if(USER.USER_ID==0){www.goToConnection();return false;}
Events.ready(Events.user.userReady,function(){if(userData.isFavorite(data.type,data.id)){favorite.remove(data,$div);}else{favorite.add(data,$div);}});return true;}catch(e){error.log(e);}},add:function(data,$div){try{if(USER.USER_ID===0){www.goToConnection();return false;}
$div=$div||null;if(userData.isFavorite(data.type,data.id)){return false;}
var data_callback={type:data.type,id:data.id,context:data.context||'',additionnal_actions:typeof data.additionnal_actions!=='undefined'?data.additionnal_actions:null};switch(data.type){case'artist':api.call('artist.getData',{ART_ID:data.id},function(result){$.extend(data_callback,result);favorite.addCallback($div,'artist.addFavorite',{art_id:data.id},data_callback);});break;case'radio':api.call('radio.getData',{RADIO_ID:data.id,COUNTRY:COUNTRY},function(result){$.extend(data_callback,result);favorite.addCallback($div,'radio.addFavorite',{radio_id:data.id},data_callback);});break;case'album':api.call('album.getData',{ALB_ID:data.id,COUNTRY:COUNTRY},function(result){$.extend(data_callback,result);favorite.addCallback($div,'album.addFavorite',{ALB_ID:data.id},data_callback);});break;case'show':api.call('show.getData',{SHOW_ID:data.id,COUNTRY:COUNTRY},function(result){$.extend(data_callback,result);favorite.addCallback($div,'show.addFavorite',{SHOW_ID:data.id},data_callback);});break;case'application':api.call('application.getPublicData',{APP_ID:data.id},function(result){$.extend(data_callback,result);favorite.addCallback($div,'application.addFavorite',{APP_ID:data.id},data_callback);});break;case'playlist':api.call('playlist.getData',{PLAYLIST_ID:data.id},function(result){$.extend(data_callback,result);favorite.addCallback($div,'playlist.addFavorite',{parent_playlist_id:data.id,title:data_callback.TITLE,parent_user_id:data_callback.PARENT_USER_ID,parent_username:data_callback.PARENT_USERNAME},data_callback);});break;case'song':api.call('song.getData',{SNG_ID:data.id},function(result){$.extend(data_callback,result);favorite.addCallback($div,'favorite_song.add',{SNG_ID:data.id},data_callback);});break;case'disliked_song':api.call('song.getData',{SNG_ID:data.id},function(result){$.extend(data_callback,result);favorite.addCallback($div,'favorite_dislike.add',{SNG_ID:data.id},data_callback);});break;case'friend':api.call('user.getData',{USER_ID:data.id},function(result){$.extend(data_callback,result);favorite.addCallback($div,'friend.follow',{friend_id:data.id},data_callback);});break;case'genre':api.call('genre_getData',{GENRE_ID:data.id},function(result){$.extend(data_callback,result);favorite.addCallback($div,'favorite_genre.add',{GENRE_ID:data.id},data_callback);});break;default:return false;}
if(typeof window.dataLayer!=='undefined'){window.dataLayer.push({event:'favorite.add='+data.id});}
return true;}catch(e){error.log(e);}},addCallback:function($div,api_method,api_params,data){try{var api_call_options=[{method:api_method,data:api_params,success:function(result){if(result===false){switch(data.type){case'playlist':alert(gettext('Impossible d\'ajouter cette playlist à votre bibliothèque. Vous avez atteint le nombre maximum de playlists dans votre bibliothèque.'));break;case'album':alert(gettext('Impossible d\'ajouter cet album à votre bibliothèque. Vous avez atteint le nombre maximum d\'albums dans votre bibliothèque.'));break;case'artist':alert(gettext('Impossible d\'ajouter cet artiste à vos favoris. Vous avez atteint le nombre maximum d\'artistes favoris.'));break;case'radio':alert(gettext('Impossible d\'ajouter ce mix à votre bibliothèque. Vous avez atteint le nombre maximum de mix dans votre bibliothèque.'));break;}
return false;}
if($div!=null){if($div.is('a')){favorite.setRemoveState($div,data);}else if($div.is('button')){$div.data('cancel_hover',true);}}
userData.addFavorite(data);if(data.type=='song'){favorite.remove({type:'disliked_song',id:data.SNG_ID});}
if(data.type=='disliked_song'){favorite.remove({type:'song',id:data.SNG_ID});}}}];if(data.additionnal_actions!==null){api_call_options=api_call_options.concat(data.additionnal_actions);}
api.call(api_call_options);return true;}catch(e){error.log(e);}},remove:function(data,$div){try{if(!userData.isFavorite(data.type,data.id)){return false;}
$div=$div||null;var api_method;var api_params;switch(data.type){case'artist':api_method='artist.deleteFavorite';api_params={art_id:data.id};break;case'radio':api_method='radio.deleteFavorite';api_params={radio_id:data.id};break;case'album':api_method='album.deleteFavorite';api_params={ALB_ID:data.id};break;case'show':api_method='show.deleteFavorite';api_params={SHOW_ID:data.id};break;case'playlist':api_method='playlist.deleteFavorite';api_params={playlist_id:data.id};break;case'application':api_method='application.deleteFavorite';api_params={APP_ID:(data.id)};break;case'song':api_method='favorite_song.remove';api_params={SNG_ID:data.id};break;case'disliked_song':api_method='favorite_dislike.remove';api_params={SNG_ID:(data.id)};break;case'friend':api_method='friend.unfollow';api_params={FRIEND_ID:(data.id)};break;case'genre':api_method='favorite_genre.remove';api_params={GENRE_ID:data.id};break;default:return false;}
if(typeof data.additionnal_actions!=='undefined'){api.call(data.additionnal_actions);}
api.call(api_method,api_params,function(result){if(result===true){if($div!=null&&$div.is('a')){favorite.setAddState($div,data);}
userData.deleteFavorite(data);}});}catch(e){error.log(e);}},drawButton:function($div,params){try{if(USER.USER_ID===0){favorite.setAddState($div,params);}else{var data=$div.data();var tag;Events.ready(Events.user.userReady,function(){if(userData.isFavorite(params.type,params.id)){tag='click_item';favorite.setRemoveState($div,params);}else{tag='add_to_favorite';favorite.setAddState($div,params);}
if(data.tracking==='feed'){data.trackingTag=tag;}});}}catch(e){error.log(e);}},setAddState:function($div,params){try{$div.data({favorite:1,type:params.type,id:params.id}).addClass('evt-click').removeClass('selected');if($('.label',$div).length===1){var label=button_multi_state.getWording($.extend({action:'favorite'},params),'add','full');$('.label',$div).text(label);}
return true;}catch(e){error.log(e);}},setRemoveState:function($div,params){try{$div.data({favorite:1,type:params.type,id:params.id}).addClass('selected evt-click');if($('.label',$div).length===1){var label=button_multi_state.getWording($.extend({action:'favorite'},params),'hover','full');$('.label',$div).text(label);}
return true;}catch(e){error.log(e);}},display:function(){console.log('deprecated');},onChangeStatus:function(evt,data){try{var $btn=$('body button[data-favorite="1"][data-type="'+data.type+'"][data-id="'+data.id+'"]');$btn.each(function(){$(this).replaceWith(button_multi_state.draw($(this).data()));});var $thumbnailoptions=$('.thumbnail .options[data-type="'+data.type+'"][data-id="'+data.id+'"] .options-favorite');$thumbnailoptions.each(function(){var thumbnail=$(this).find('.icon-love');thumbnail.toggleClass('active');var wording=(evt.namespace==='USER.addFavorite')?gettext('Retirer de ma bibliothèque'):gettext('Ajouter à ma bibliothèque');if(data.type==='song'){wording=(evt.namespace==='USER.addFavorite')?gettext('Retirer des Coups de cœur'):gettext('Ajouter aux Coups de cœur');}
thumbnail.attr('title',wording);});return true;}catch(e){error.log(e);}}};window.favorite=favorite;})();;
var util={findPos:function(obj){try{var curleft=curtop=0;if(obj.offsetParent){do{curleft+=obj.offsetLeft;curtop+=obj.offsetTop;}while(obj=obj.offsetParent);}
return[curleft,curtop];}catch(e){return[0,0];}},getPageScroll:function(){try{var xScroll,yScroll;if(self.pageYOffset){yScroll=self.pageYOffset;xScroll=self.pageXOffset;}else if(document.documentElement&&document.documentElement.scrollTop){yScroll=document.documentElement.scrollTop;xScroll=document.documentElement.scrollLeft;}else if(document.body){yScroll=document.body.scrollTop;xScroll=document.body.scrollLeft;}
return[xScroll,yScroll];}catch(e){error.log(e);}},findPosRelativeToViewport:function(obj){try{var objPos=this.findPos(obj);var scroll=this.getPageScroll()
return[objPos[0]-scroll[0],objPos[1]-scroll[1]]}catch(e){error.log(e);}},range:function(vmin,vmax){try{range=vmax-vmin+1;return Math.floor(Math.random()*range+vmin);}catch(e){error.log(e);}},getOuterHTML:function(div){try{var get=div.attr('outerHTML');if(typeof get=='undefined'){$div=$('<p></p>');$div.append(div.clone());get=$div.html();$div.remove();}
return get;}catch(e){error.log(e);}},uniqid:function(length){try{var retId;if(typeof length=='undefined'){length=7;}
length=Math.max(7,Math.floor(length));var length2=Math.min(7,Math.floor(length/2));var length1=length-length2;var formatSeed=function(seed,reqWidth){seed=parseInt(seed,10).toString(16);if(reqWidth<seed.length){return seed.slice(seed.length-reqWidth);}
if(reqWidth>seed.length){return Array(1+(reqWidth-seed.length)).join('0')+seed;}
return seed;};if(!this.php_js){this.php_js={};}
if(!this.php_js.uniqidSeed){this.php_js.uniqidSeed=Math.floor(Math.random()*0x75bcd15);}
this.php_js.uniqidSeed+=3;retId=formatSeed(parseInt(new Date().getTime()/1000,10),10);retId+=formatSeed(this.php_js.uniqidSeed,7);return retId;}catch(e){error.log(e);}},detectFlash:function(player,next){var flashVersion;var hasFlash;var activex;var error;var NOT_INSTALLED_ERROR='not_installed';var BLOCKING_ERROR='blocking';var TOO_OLD_ERROR='too_old';try{activex='ActiveXObject'in window&&'Pan'in new window.ActiveXObject('ShockwaveFlash.ShockwaveFlash');}catch(e){}
hasFlash=('plugins'in window.navigator&&'Shockwave Flash'in window.navigator.plugins)||activex;if(!hasFlash){return next(NOT_INSTALLED_ERROR);}
if(!player||(!('Pan'in player)&&!activex)){return next(BLOCKING_ERROR);}
var playerStyle=player.style.cssText;var docElement=document.documentElement;var blockedDetect=function(){if(!docElement.contains(player)){error=BLOCKING_ERROR;}else{if(player.style.cssText!==playerStyle){error=BLOCKING_ERROR;}}
if(!error){flashVersion=deconcept.SWFObjectUtil.getPlayerVersion();flashVersion=parseFloat(flashVersion.major+'.'+flashVersion.minor);if(!flashVersion||flashVersion<dzPlayer.minimumFlashVersion){error=TOO_OLD_ERROR;}}
return next(error,flashVersion);};setTimeout(blockedDetect,10);}};
if(typeof userData==='undefined'){var userData={data:{},dataStore:{},isLoaded:false,isLoadedRadio:false,checksums:{},searchHistoryLimit:10,conf:{FAVORITES_ARTISTS:{primary_key:'ART_ID',hash:true},FAVORITES_ALBUMS:{primary_key:'ALB_ID',hash:true},FAVORITES_PLAYLISTS:{primary_key:'PLAYLIST_ID',hash:true},FAVORITES_APPLICATIONS:{primary_key:'APP_ID',hash:true},FAVORITES_RADIOS:{primary_key:'RADIO_ID',hash:true},FAVORITES_SONGS:{primary_key:'SNG_ID',hash:true},FAVORITES_DISLIKED_SONGS:{primary_key:'SNG_ID',hash:true},FAVORITES_GENRES:{primary_key:'GENRE_ID',hash:true},PLAYLISTS:{primary_key:'PLAYLIST_ID',hash:false,clear:true},FAVORITES_SHOWS:{primary_key:'SHOW_ID',hash:true},EPISODE_BOOKMARKS:{primary_key:'EPISODE_ID',hash:true},TOP_PLAYLISTS:{primary_key:'PLAYLIST_ID',hash:true},TOP_ALBUMS:{primary_key:'ALB_ID',hash:true},TOP_TAGS:{skip:false,hash:false},USER_TAGS:{skip:false,hash:false},FRIENDS:{primary_key:'USER_ID',hash:true},MESSAGE_UNREAD:{primary_key:'AUTHOR',hash:true},TOTAL_STORE_TRACKS:{skip:true,hash:false},MARKETING_PUSH:{skip:false,hash:false},SEARCH_HISTORY:{skip:false,hash:false},DEFAULT_APPLICATIONS:{skip:false,primary_key:'APP_ID',hash:true}},init:function(){try{if(USER.USER_ID===0){Events.ready(Events.user.loaded,userData.init);return false;}
try{if(storage.isset('USER_CHECKSUMS')){userData.checksums=storage.get('USER_CHECKSUMS');for(var c in userData.checksums){if(!userData.checksums.hasOwnProperty(c)){continue;}
if(!storage.isset(c)){console.log(c,' : localStorage not found');delete userData.checksums[c];}}}}catch(e){error.log(e);}
api.call({method:'deezer.userMenu',data:{checksum:true,checksums:userData.checksums},success:userData.loadCallbackInit});return true;}catch(e){error.log(e);}},fillData:function(key,result,conf){if(typeof result==='undefined'){result={data:[],total:0,count:0};}
if(result==='Not modified'){if(storage.isset(key)){result=storage.get(key);}}
if(conf.clear){for(var j=result.count;j>=0;j--){if(typeof result.data[j]==='object'&&parseInt(result.data[j].TYPE,10)===4){result.data.splice(j,1);}}
result.count=result.total=result.data.length;}
return result;},fillDataHashes:function(result,conf){var hashes={};if(conf.hash!==false){for(var j=0;j<result.count;j++){var id=result.data[j][conf.primary_key];hashes[id]=j;}}
return hashes;},store:function(key,data){storage.set(key,data,false);},refreshData:function(key,result){var conf=userData.conf[key];var data=userData.fillData(key,result,conf);var hashes=userData.fillDataHashes(data,conf);userData.data[key]=data;userData.data[key+'_HASH']=hashes;if(typeof userData.data[key].checksum!=='undefined'){userData.store(key,userData.data[key]);userData.checksums[key]=userData.data[key].checksum;}},loadCallbackInit:function(result){try{for(var key in userData.conf){if(!userData.conf.hasOwnProperty(key)||userData.conf[key].skip){continue;}
userData.refreshData(key,result[key]);}
if(typeof result.TOTAL_STORE_TRACKS!=='undefined'){userData.dataStore={};if(storage.isset('storeTrack')){userData.dataStore=storage.get('storeTrack');}
if(countObject(userData.dataStore)<result.TOTAL_STORE_TRACKS){api.call('store.getList',{start:countObject(userData.dataStore),nb:result.TOTAL_STORE_TRACKS-countObject(userData.dataStore)},userData.storeListCallback);}else{Events.resolve(Events.user.dataStoreReady);}}
if(typeof result.MARKETING_PUSH!=='undefined'&&typeof result.MARKETING_PUSH==='string'&&result.MARKETING_PUSH!==''){setTimeout(function(){modal.open(result.MARKETING_PUSH);},500);}
userData.isLoaded=true;userData.saveChecksums(userData.checksums);Events.resolve(Events.user.userReady);return true;}catch(e){error.log(e);}},saveChecksums:function(checksums){userData.store('USER_CHECKSUMS',checksums);},loadData:function(type){try{var key=(type==='friend')?'FRIENDS_HASH':'FAVORITES_'+type.toUpperCase()+'S';if(typeof userData.conf[key]==='undefined'){return;}
api.call({method:'favorite.'+type+'_getList',success:function(results){if(results.count===0){return false;}
userData.refreshData(key,results);userData.saveChecksums(userData.checksums);Events.trigger(Events.user.userLoadData,{type:type});}});}catch(e){error.log(e);}},isFavorite:function(type,id){try{if(!userData.isLoaded){return false;}
var key=(type==='friend')?'FRIENDS_HASH':'FAVORITES_'+type.toUpperCase()+'S_HASH';return typeof userData.data[key]!=='undefined'&&typeof userData.data[key][id]!=='undefined';}catch(e){error.log(e);}},isDisliked:function(id){try{return userData.isFavorite('disliked_song',id);}catch(e){error.log(e);}},addFavorite:function(data){try{if(typeof data!=='object'){return false;}
var key=(data.type==='friend')?'FRIENDS':'FAVORITES_'+data.type.toUpperCase()+'S';userData.data[key+'_HASH'][data.id]=true;if(countObject(userData.data[key])===0){userData.data[key]={data:[],total:0,count:0};}
data.DATE_ADD=timestampToDate(SERVER_TIMESTAMP,true,'-',true);data.DATE_FAVORITE=timestampToDate(SERVER_TIMESTAMP,true,'-',true);userData.data[key].data.push(data);userData.data[key].count++;userData.data[key].total++;Events.trigger(Events.user.addFavorite,data);return true;}catch(e){error.log(e);}},deleteFavorite:function(data){try{if(typeof data!=='object'){return false;}
var id_name={album:'ALB_ID',playlist:'PLAYLIST_ID',artist:'ART_ID',radio:'RADIO_ID',friend:'USER_ID',application:'APP_ID',song:'SNG_ID',disliked_song:'SNG_ID'};var id=id_name[data.type];var key=(data.type==='friend')?'FRIENDS':'FAVORITES_'+data.type.toUpperCase()+'S';delete userData.data[key+'_HASH'][data.id];for(var a=0;a<userData.data[key].count;a++){if(userData.data[key].data[a][id]==data.id){userData.data[key].data.splice(a,1);userData.data[key].total-=1;userData.data[key].count-=1;break;}}
Events.trigger(Events.user.deleteFavorite,data);return true;}catch(e){error.log(e);}},createPlaylist:function(data,callback){try{data=$.extend(true,{},{title:'',description:'',status:0,songs:false,tags:[]},data);api.call({method:'playlist.create',data:data,success:function(id){if(typeof id==='number'){var current_date=timestampToDate(SERVER_TIMESTAMP,true,'-',true);var newPlaylist={CHECKSUM:'',PARENT_USER_ID:USER.USER_ID.toString(),PLAYLIST_ID:id.toString(),STATUS:data.status,TITLE:data.title,PLAYLIST_PICTURE:'',PICTURE_TYPE:'cover',NB_SONG:Array.isArray(data.songs)?data.songs.length:0,DATE_ADD:current_date,DATE_CREATE:current_date,GENRE:[]};if(countObject(userData.data.PLAYLISTS.data)===0){userData.data.PLAYLISTS={count:0,total:0,data:[]};}
userData.data.PLAYLISTS.data.push(newPlaylist);userData.data.PLAYLISTS.count+=1;userData.data.PLAYLISTS.total+=1;if(typeof callback==='function'){callback(newPlaylist.PLAYLIST_ID);}
Events.trigger(Events.playlist.created,newPlaylist);}}});}catch(e){error.log(e);}},updatePlaylist:function(data,callback){api.call({method:'playlist.update',data:data,success:function(){userData.refreshPlaylistData(data.playlist_id,{TITLE:data.title,STATUS:data.status,DATE_ADD:timestampToDate(SERVER_TIMESTAMP,true,'-',true)});Events.trigger(Events.playlist.updated,data);if(typeof callback==='function'){callback(data);}}});},refreshPlaylistData:function(playlist_id,data){for(var p=0;p<userData.data.PLAYLISTS.count;p++){if(userData.data.PLAYLISTS.data[p].PLAYLIST_ID==playlist_id){for(var key in data){userData.data.PLAYLISTS.data[p][key]=data[key];}
break;}}},removePlaylist:function(data){try{if(confirm(gettext('Êtes-vous sur de vouloir supprimer la playlist "%s" ?',{sprintf:[data.title]}))){api.call({method:'playlist.delete',data:{playlist_id:data.id},success:function(result){if(result){for(var p=0;p<userData.data.PLAYLISTS.count;p++){if(userData.data.PLAYLISTS.data[p].PLAYLIST_ID==data.id){userData.data.PLAYLISTS.data.splice(p,1);userData.data.PLAYLISTS.count-=1;userData.data.PLAYLISTS.total-=1;break;}}
if(naboo.getCurrentPath()==='/playlist/'+data.id){loadBox('/');}
Events.trigger(Events.playlist.removed,{type:'playlist',id:data.id});}}});}}catch(e){error.log(e);}},addPlaylistSong:function(playlist_id,song_list,data){try{api.call({method:'playlist.addSongs',data:{playlist_id:playlist_id,songs:song_list},success:function(result){if(result===true){var all_playlist=$.merge($.merge([],userData.data.PLAYLISTS.data),userData.data.FAVORITES_PLAYLISTS.data);for(var p=0;p<all_playlist.length;p++){if(all_playlist[p].PLAYLIST_ID==playlist_id){all_playlist[p].DATE_ADD=timestampToDate(SERVER_TIMESTAMP,true,'-',true);all_playlist[p].NB_SONG+=song_list.length;break;}}
Events.trigger(Events.playlist.addSong,{playlist_id:playlist_id,song:song_list,context:data.context,position:data.position,notify:typeof data.notify==='boolean'?data.notify:true});}}});}catch(e){error.log(e);}},removePlaylistSong:function(playlist_id,song_list){try{for(var p=0;p<userData.data.PLAYLISTS.count;p++){if(userData.data.PLAYLISTS.data[p].PLAYLIST_ID==playlist_id){userData.data.PLAYLISTS.data[p].NB_SONG-=song_list.length;break;}}
Events.trigger(Events.playlist.removeSong,{playlist_id:playlist_id,song:song_list});}catch(e){error.log(e);}},storeListCallback:function(result){try{for(var j=0;j<result.count;j++){userData.dataStore[result.data[j].ISRC]=true;}
storage.set('storeTrack',userData.dataStore,false);Events.resolve(Events.user.dataStoreReady);}catch(e){error.log(e);}},storeList:function(isrcList){try{if(typeof isrcList!=='object'){return false;}
for(var j=0;j<isrcList.length;j++){userData.dataStore[isrcList[j]]=true;}}catch(e){error.log(e);}},addEpisodeBookmark:function(bookmark){if(typeof bookmark!=='object'||USER.USER_ID===0){return false;}
try{if(countObject(userData.data.EPISODE_BOOKMARKS)===0){userData.data.EPISODE_BOOKMARKS={data:[],total:0,count:0};}
bookmark={EPISODE_ID:bookmark.EPISODE_ID,OFFSET:bookmark.OFFSET.toString(),IS_HEARD:bookmark.ISHEARD};userData.data.EPISODE_BOOKMARKS.data.push(bookmark);userData.data.EPISODE_BOOKMARKS_HASH[bookmark.EPISODE_ID]=userData.data.EPISODE_BOOKMARKS.count;userData.data.EPISODE_BOOKMARKS.count++;userData.data.EPISODE_BOOKMARKS.total++;Events.trigger(Events.user.updateEpisodeBookmark,bookmark);}catch(e){error.log(e);}},addSearchHistory:function(query,result,index){var types={song:'SNG_ID',album:'ALB_ID',artist:'ART_ID',playlist:'PLAYLIST_ID'};if(query===''){return;}
var entry={query:query,result:result||null};api.call({method:'user.addEntryInSearchHistory',data:{ENTRY:{query:query,type:result?result.__TYPE__:'query',id:result?result[types[result.__TYPE__]]:null,rank:(typeof index!=='undefined')?index:null}}});userData._insertSearchHistoryEntry(userData.data.SEARCH_HISTORY,entry);Events.trigger(Events.user.updateSearchHistory);},clearSearchHistory:function(){api.call({method:'user.clearSearchHistory',data:{USER_ID:USER.USER_ID}});userData.data.SEARCH_HISTORY.data.length=0;userData.data.SEARCH_HISTORY.total=0;Events.trigger(Events.user.updateSearchHistory);return true;},_insertSearchHistoryEntry:function(searchHistory,entry){var types={song:'SNG_ID',album:'ALB_ID',artist:'ART_ID',playlist:'PLAYLIST_ID'};var i;var storedEntry;var storedResult;var result=entry.result;for(i=0;i<searchHistory.data.length;i++){storedEntry=searchHistory.data[i];storedResult=storedEntry.result;if((result&&storedResult&&result.__TYPE__===storedResult.__TYPE__&&result[types[result.__TYPE__]]===storedResult[types[result.__TYPE__]])||(entry.query===storedEntry.query&&!storedResult)){searchHistory.data.splice(i,1);break;}}
searchHistory.data.unshift(entry);searchHistory.data.splice(userData.searchHistoryLimit);searchHistory.total=searchHistory.data.length;}};};
(function($){$.tiny=$.tiny||{};$.tiny.scrollbar={options:{axis:'y',wheel:40,scroll:true,size:'auto',sizethumb:'auto',extremePosition:false,extremePreventDefault:true}};$.fn.tinyscrollbar=function(options){var options=$.extend({},$.tiny.scrollbar.options,options);this.each(function(){$(this).data('tsb',new Scrollbar($(this),options));});return this;};$.fn.scrollPosition=function(){return $(this).data('tsb').scrollPosition();};$.fn.tinyscrollbar_update=function(sScroll){if(typeof $(this).data('tsb')=='undefined'){return false;}
return $(this).data('tsb').update(sScroll);};$.fn.scrollTo=function(arg){return $(this).data('tsb').scrollTo(arg);};function Scrollbar(root,options){var oSelf=this;var oWrapper=root;var oViewport={obj:$('.tinyscroll_viewport',root)};var oContent={obj:$('.tinyscroll_overview',root)};var oScrollbar={obj:$('.tinyscroll_scrollbar',root)};var oTrack={obj:$('.tinyscroll_track',oScrollbar.obj)};var oThumb={obj:$('.tinyscroll_thumb',oScrollbar.obj)};var sAxis=options.axis=='x',sDirection=sAxis?'left':'top',sSize=sAxis?'Width':'Height';var iScroll,iPosition={start:0,now:0},iMouse={};function initialize(){oSelf.update();setEvents();return oSelf;}
this.scrollPosition=function(){return iScroll;};this.update=function(sScroll){oViewport[options.axis]=oViewport.obj[0]['offset'+sSize];oContent[options.axis]=oContent.obj[0]['scroll'+sSize];oContent.ratio=oViewport[options.axis]/oContent[options.axis];oScrollbar.obj.toggleClass('tinyscroll_disabled',oContent.ratio>=1);oTrack[options.axis]=options.size=='auto'?oViewport[options.axis]:options.size;oThumb[options.axis]=Math.min(oTrack[options.axis],Math.max(0,(options.sizethumb=='auto'?(oTrack[options.axis]*oContent.ratio):options.sizethumb)));oScrollbar.ratio=options.sizethumb=='auto'?(oContent[options.axis]/oTrack[options.axis]):(oContent[options.axis]-oViewport[options.axis])/(oTrack[options.axis]-oThumb[options.axis]);iScroll=(sScroll=='relative'&&oContent.ratio<=1)?Math.min((oContent[options.axis]-oViewport[options.axis]),Math.max(0,iScroll)):0;iScroll=(sScroll=='bottom'&&oContent.ratio<=1)?(oContent[options.axis]-oViewport[options.axis]):isNaN(parseInt(sScroll))?iScroll:parseInt(sScroll);setSize();if(options.extremePosition)isExtremePosition(iScroll);};this.scrollTo=function(position){iScroll=position;var oThumbAnimate={};oThumbAnimate[sDirection]=iScroll/oScrollbar.ratio;var oContentAnimate={};oContentAnimate[sDirection]=-iScroll;oThumb.obj.stop(true).animate(oThumbAnimate);oContent.obj.stop(true).animate(oContentAnimate);if(options.extremePosition)isExtremePosition(iScroll);};function setSize(){oThumb.obj.css(sDirection,iScroll/oScrollbar.ratio);oContent.obj.css(sDirection,-iScroll);iMouse['start']=oThumb.obj.offset()[sDirection];var sCssSize=sSize.toLowerCase();oScrollbar.obj.css(sCssSize,oTrack[options.axis]);oTrack.obj.css(sCssSize,oTrack[options.axis]);oThumb.obj.css(sCssSize,oThumb[options.axis]);};function setEvents(){oThumb.obj.bind('mousedown',start);oThumb.obj[0].ontouchstart=function(oEvent){oEvent.preventDefault();oThumb.obj.unbind('mousedown');start(oEvent.touches[0]);return false;};oTrack.obj.bind('mouseup',drag);if((options.scroll)&&this.addEventListener){oWrapper[0].addEventListener('DOMMouseScroll',wheel,false);oWrapper[0].addEventListener('mousewheel',wheel,false);}
else if(options.scroll){oWrapper[0].onmousewheel=wheel;}};function start(oEvent){iMouse.start=sAxis?oEvent.pageX:oEvent.pageY;var oThumbDir=parseInt(oThumb.obj.css(sDirection));iPosition.start=oThumbDir=='auto'?0:oThumbDir;$(document).bind('mousemove',drag);document.ontouchmove=function(oEvent){$(document).unbind('mousemove');drag(oEvent.touches[0]);};$(document).bind('mouseup',end);oThumb.obj.bind('mouseup',end);oThumb.obj[0].ontouchend=document.ontouchend=function(oEvent){$(document).unbind('mouseup');oThumb.obj.unbind('mouseup');oTrack.obj.unbind('mouseup');end(oEvent.touches[0]);};oTrack.obj.bind('mouseup',end);oTrack.obj[0].ontouchend=document.ontouchend=function(oEvent){$(document).unbind('mouseup');oThumb.obj.unbind('mouseup');oTrack.obj.unbind('mouseup');end(oEvent.touches[0]);};return false;};function wheel(oEvent){if(!(oContent.ratio>=1)){var oEvent=oEvent||window.event;var iDelta=oEvent.wheelDelta?oEvent.wheelDelta/120:-oEvent.detail/3;iScroll-=iDelta*options.wheel;iScroll=Math.min((oContent[options.axis]-oViewport[options.axis]),Math.max(0,iScroll));oThumb.obj.css(sDirection,iScroll/oScrollbar.ratio);oContent.obj.css(sDirection,-iScroll);root.trigger('jsp-scrolling',iScroll);var is_extreme_position=false;if(parseInt(iScroll)==(oContent[options.axis]-oViewport[options.axis])||parseInt(iScroll)==0){is_extreme_position=true;}
if(options.extremePreventDefault||!is_extreme_position){oEvent=$.event.fix(oEvent);oEvent.preventDefault();}
if(options.extremePosition)isExtremePosition(iScroll);};};function end(oEvent){$(document).unbind('mousemove',drag);$(document).unbind('mouseup',end);oThumb.obj.unbind('mouseup',end);oTrack.obj.unbind('mouseup',end);document.ontouchmove=oThumb.obj[0].ontouchend=oTrack.obj[0].ontouchend=document.ontouchend=null;return false;};function drag(oEvent){if(!(oContent.ratio>=1)){iPosition.now=Math.min((oTrack[options.axis]-oThumb[options.axis]),Math.max(0,(iPosition.start+((sAxis?oEvent.pageX:oEvent.pageY)-iMouse.start))));iScroll=iPosition.now*oScrollbar.ratio;oContent.obj.css(sDirection,-iScroll);oThumb.obj.css(sDirection,iPosition.now);if(options.extremePosition)isExtremePosition(iScroll);}
return false;};function isExtremePosition(iScroll){if(parseInt(iScroll)==(oContent[options.axis]-oViewport[options.axis])){root.trigger('jsp-scroll-y',['bottom']).trigger('scroll');}else if(parseInt(iScroll)==0){root.trigger('jsp-scroll-y',['top']).trigger('scroll');}};return initialize();};})(jQuery);;
(function($){$.fn.searchBar=function(method){var params={suggest_id:'',instance:'header',types:{'ARTIST':true,'ALBUM':true,'TRACK':true},result_ids:{'ARTIST':[],'ALBUM':[],'TRACK':[]},nb_suggestion:4,label:gettext('Rechercher un titre, un album, un artiste'),tracking_event:'search_trigger',tracking:true,timer:null,query:null,div:null,selected:0,block:false,autofocus:false,cache_expire:(3600*1000),add_to_favorite:false,add_to_favorite_delegate:null,hide_artist:false,hide_album:false,hide_track:false,submit_disable:false,tracking_params_extend:false,href_enabled:true}
var suggest={cache:new Object()}
var methods={init:function(options){params=$.extend(params,options);params.div=this;params.div_suggest=$('.suggest',this);params.div_input=$('input:first',this);params.div_submit_container=$('.search_button_container',this);params.div_submit=$('[type="submit"]',params.div_submit_container);params.suggestion_type=0;params.suggestion_index=0;params.suggestion_id=0;params.suggestion_label='';$('.cross',params.div).unbind('click').click(function(){params.query='';params.div_input.val('');params.div_input.focus();$(this).hide();helpers.hideLoading();}).hide();params.div_submit.unbind('click').click(function(){if(params.div_input.val()!=params.label&&params.div_input.val()!=''){methods.search(params.div_input.val(),'click');}else{params.div_input.val('');};});if(params.autofocus){params.div_input.focus();}else{params.div_input.val(params.label);}
params.div_input.attr('placeholder',params.label);params.div_input.unbind('blur').blur(function(){helpers.hideSuggest();});params.div_input.unbind('click').click(function(){params.div_input.focus();});params.div_input.unbind('focus').focus(function(){if(this.value==params.label){this.value='';}
if(this.value!=''&&params.query!=this.value){params.query=this.value;}
helpers.over($('#search_link',params.div_suggest));params.timer=setTimeout(function(){methods.completion();},200);});params.div_suggest.unbind('mouseover').mouseover(function(e){params.block=true;});params.div_suggest.unbind('mouseout').mouseout(function(e){params.block=false;});params.div_input.unbind('keyup').keyup(function(event){if(params.timer!=null){clearTimeout(params.timer);}
if(event.keyCode!=38&&event.keyCode!=40&&event.keyCode!=13){params.query=this.value;$('#search_link',params.div_suggest).addClass('selected');params.timer=setTimeout(function(){methods.completion();},200);}
var first=$('.suggestion',params.div_suggest).first();var last=$('.suggestion',params.div_suggest).last();var selected=$('.suggestion.selected',params.div_suggest);var first_id=$(first).attr('data-i');var last_id=$(last).attr('data-i');var selected_id=0;if($(selected).length>0){var selected_id=parseInt($(selected).attr('data-i'));}
if(event.keyCode==38){if(selected_id==1){params.div_input.focus();return true;}
var prev_id=last_id;if(selected_id>0){prev_id=parseInt(selected_id)-1;if(prev_id<first_id){prev_id=last_id;}}
helpers.over($('[class~="suggestion"][data-i="'+prev_id+'"]',params.div_suggest));}
if(event.keyCode==40){if(selected_id==last_id){params.div_input.focus();return true;}
var next_id=first_id;if(selected_id>0){next_id=parseInt(selected_id)+1;if(next_id>last_id){next_id=first_id;}}
helpers.over($('li[class~="suggestion"][data-i="'+next_id+'"]',params.div_suggest));}
if(event.keyCode==13){if(params.submit_disable===true){if($(selected).length>0){$('a.result_link',selected).click();}
return false;}
params.block=false;params.div_input.val(params.query).blur();if($(selected).length>0){methods.trackingSuggestion('enter',selected);$('a.result_link',selected).click();}else{params.timer=setTimeout(function(){methods.search(params.div_input.val(),'enter');},200);}}});$(document).click(function(event){if($(event.target).attr('id')!=$(params.div_input).attr('id')){params.block=false;helpers.hideSuggest();}});methods.registerHandlebarsHelpers();},registerHandlebarsHelpers:function(){Handlebars.registerHelper('addslashes',function(str){return addslashes(str);});Handlebars.registerHelper('highlight',function(str,substr){var query_filter=substr.replace(/([^a-zA-Z0-9])/g,'\\$1');return new Handlebars.SafeString(str.replace(new RegExp("("+query_filter+")","gi"),function(matched){return"<strong class=\"highlight\">"+matched+"</strong>";}));});Handlebars.registerHelper('formatTime',function(seconds){return formatDuration(seconds);});Handlebars.registerHelper('getDay',function(_date){var d=new Date(dateToTimestamp(_date)*1000);return d.getDate();});Handlebars.registerHelper('getMonthLabel',function(_date){var d=new Date(dateToTimestamp(_date)*1000);var month=d.getMonth();var months=[gettext('JAN'),gettext('FEV'),gettext('MAR'),gettext('AVR'),gettext('MAI'),gettext('JUIN'),gettext('JUIL'),gettext('AOU'),gettext('SEP'),gettext('OCT'),gettext('NOV'),gettext('DEC')];if(typeof months[month]==='undefined'){return'';}
return months[month];});Handlebars.registerHelper('ifDateFuture',function(_date,options){return(dateToTimestamp(_date)>SERVER_TIMESTAMP)?options.fn(this):options.inverse(this);});Handlebars.registerHelper('add',function(num1,num2){return parseFloat(num1+num2);});return true;},completion:function(){if(params.query!=params.div_input.val()){params.query=params.div_input.val();}
if(params.query==null||params.query==''||params.query==params.label){$('.cross',params.div).hide();}else if($('.cross',params.div).css('display')=='none'){$('.cross',params.div).show();}
if(params.query==null||params.query==''){params.block=false;helpers.hideSuggest();helpers.hideLoading();return false;}
helpers.showLoading();params.query=$.trim(params.query);if(suggest.cache[params.query]!=null){methods.completionCallBack(suggest.cache[params.query]);}else{sendRequest('/suggest?q='+encodeURIComponent(addslashes(params.query))+'&c='+encodeURIComponent(COUNTRY)+'&limit='+params.nb_suggestion,'text','',true,methods.completionCallBack,false,'suggest_request');}},completionCallBack:function(request){helpers.hideLoading();params.selected=0;suggest.cache[params.query]=request;setTimeout(function(){suggest.cache[params.query]=null;},params.cache_expire);if(typeof request.responseText=='undefined'){return false;}
request=request.responseText;if(request==false||request.length==0||request=='error'){return false;}
request=eval('('+request+')');if(addslashes(params.query)!=request.query){return false;}
if((params.hide_artist===true||(typeof request['ARTIST']=='undefined'||request['ARTIST'].length==0))&&(params.hide_album===true||(typeof request['ALBUM']=='undefined'||request['ALBUM'].length==0))&&(params.hide_track===true||(typeof request['TRACK']=='undefined'||request['TRACK'].length==0))){helpers.hideSuggest();return false;}
if(params.hide_artist===true){request['ARTIST']=false;}
if(params.hide_album===true){request['ALBUM']=false;}
if(params.hide_track===true){request['TRACK']=false;}
params.result_ids={'ARTIST':[],'ALBUM':[],'TRACK':[]};for(var i in request){if(!request.hasOwnProperty(i)){continue;}
for(var j in request[i]){if(!request[i].hasOwnProperty(j)){continue;}
if(i=='ARTIST'&&typeof request[i][j].ART_ID!='undefined'){params.result_ids[i].push(request[i][j].ART_ID);}
if(i=='ALBUM'&&typeof request[i][j].ALB_ID!='undefined'){params.result_ids[i].push(request[i][j].ALB_ID);}
if(i=='TRACK'&&typeof request[i][j].SNG_ID!='undefined'){params.result_ids[i].push(request[i][j].SNG_ID);}}}
if(params.add_to_favorite==true){request['ARTIST']=request['ARTIST'].filter(function(result){return!userData.isFavorite('artist',result.ART_ID);});}
var template=Handlebars.templates['suggest'];$(params.div_suggest).html(template({suggest_id:params.suggest_id,query:params.query,artist:request['ARTIST'],album:request['ALBUM'],track:request['TRACK'],context:params.instance,href_enabled:params.href_enabled,add_to_favorite:params.add_to_favorite,add_to_favorite_delegate:params.add_to_favorite_delegate}));helpers.showSuggest();helpers.over($('#search_link',params.div_suggest));$('.suggestion',params.div_suggest).unbind('click').click(function(){methods.trackingSuggestion('click',this);params.block=false;helpers.hideSuggest();Events.trigger(Events.search.suggestClicked);});$('.suggestion',params.div_suggest).unbind('mouseover').mouseover(function(){helpers.over($(this));});$('#search_link',params.div_suggest).unbind('click').click(function(){methods.trackingSuggestion('click');params.block=false;helpers.hideSuggest();});$('#search_link',params.div_suggest).unbind('mouseover').mouseover(function(){helpers.over($(this));});helpers.tipsy();return true;},search:function(query,event_type){if(params.timer!=null){clearTimeout(params.timer);}
if(query==''){return false;}
params.block=false;helpers.hideSuggest();query=query.replace(/\//g,' ');if(params.tracking){methods.trackingSuggestion(event_type);}
loadBox('/search/'+addslashes(query));return true;},trackingSuggestion:function(){if(params.query==params.label||params.query==''){return false;}
var event_type='';if(arguments[0]!='undefined'){event_type=arguments[0];}
if(typeof arguments[1]=='undefined'){params.suggestion_index=0;params.suggestion_id=0;params.suggestion_type='all';params.suggestion_label='';}else{var obj=arguments[1];params.suggestion_index=$(obj).attr('data-i');params.suggestion_id=$(obj).attr('data-id');params.suggestion_type=$(obj).attr('type');params.suggestion_label=$(obj).attr('label');}
if(params.tracking){var tracking_params={'instance':params.instance,'event_type':event_type,'suggestion_index':params.suggestion_index,'suggestion_type':params.suggestion_type,'suggestion_id':params.suggestion_id,'suggestion_label':params.suggestion_label,'query':addslashes(params.query)};if(params.tracking_params_extend!==false&&typeof params.tracking_params_extend==='object'){$.extend(tracking_params,params.tracking_params_extend);}
tracking.track(params.tracking_event,tracking_params);tracking_params.syslog='search_suggest';tracking_params.user_id=USER.USER_ID;tracking_params.result_ids=params.result_ids;tracking_params.version=params.version;api.call('search.suggest_log',tracking_params);return true;}
return false;}}
var helpers={showSuggest:function(){params.div_suggest.show();Events.trigger(Events.search.suggestDisplayed);return true;},hideSuggest:function(){if(!params.block){params.div_suggest.hide();}
return true;},showLoading:function(){$('.search_button',params.div_submit_container).hide();$('.loading',params.div_submit_container).show();},hideLoading:function(){$('.search_button',params.div_submit_container).show();$('.loading',params.div_submit_container).hide();},over:function(obj){params.selected=0;if(typeof $(obj).attr('data-i')!='undefined'){params.selected=parseInt($(obj).attr('data-i'));}
$('.suggestion',params.div_suggest).removeClass('selected');$('#search_link',params.div_suggest).removeClass('selected');$(obj).addClass('selected');return true;},tipsy:function(){$('a.result_link.soon',params.div_suggest).each(function(index){$(this).tipsy({trigger:'hover',gravity:'s',fallback:gettext('Ce titre n\'est pas encore disponible.'),force_top:true});});}}
if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method "'+method+'" does not exist in DeezerSearch plugin!');}}})(jQuery);;
(function($){var params={type:0,nb:10,start:0,element_id:0,content_id:0,limit_comment:true,infinite_scroll:false,display:true,facebook_share:false,twitter_share:false,publish_on_enter:false,publish_on_progress:false,publish_button:null,adjust_onscroll:false,show_more:null,min_comment_char:10,max_comment_char:250,counter:null,loadComplete:false,limit_comment:true,addCallback:false,displayCallback:false,events_group:'comment'};var flagged=[];var Comment=function(root,options){var div=root;var self=this;var init=function(){if(options.type===0||options.element_id===0){return false;}
options.list=$('.comment-list',div);options.input=($('input',div).length>0)?$('input',div):$('textarea',div);options.error=$('.alert',div);options.show_more=$('.show-comments',div);options.count=$('.comment-count',options.counter);$(options.list).on('click','.trash',function(){deleteComment($(this));});$(options.list).on('click','.abuse',function(){flag($(this));});if(options.limit_comment===true){$(options.input).on('keyup keydown',function(){limitComment(options.min_comment_char,options.max_comment_char);});}
if(options.publish_on_enter===true){$(options.input).on('keypress',function(e){if(e.which===13){postComment();}});}
if(options.twitter_share===true){options.twitter_share_element=$('#tw_perms_comment');options.twitter_share_element.on('click',function(e){try{if(typeof USER.TWITTER.TOKEN=='undefined'){twitter.link();}else{userSetting.set({twitter:{share_comment:$(this).toggleClass('active').is('.active')}},true);}
return true;}catch(e){error.log(e);}});}
if(options.facebook_share===true){options.facebook_share_element=$('#fb_perms_comment');options.facebook_share_element.on('click',function(e){try{var $this=$(this);var data=$this.data();if(data.type==='comment-share-set'){userSetting.set({facebook:{share_comment:$this.toggleClass('active').is('.active')}},true);}else if(data.type==='comment-share-init'){facebook.login({scope_mandatory:true});}
return true;}catch(e){error.log(e);}});}
if(options.publish_button!==null){$(options.publish_button).on('click',function(e){postComment();});}
if(options.show_more!=null){$(options.show_more).on('click',function(){display();});if(options.adjust_onscroll===true){Events.subscribe(Events.navigation.tab_displayed,adjustScroll);}}
$(options.input).on('focus',function(e){self.getInstance();});if(options.display===true){display();};};var adjustScroll=function(evt,param){try{if(param.id!=options.element_id){return false;}
var added_content_height=options.list.outerHeight()-(options.show_more.offset().top-options.list.offset().top);var comment_div_height=added_content_height+options.show_more.offset().top+options.show_more.parent().prev().outerHeight();if(comment_div_height>client_height){$('#page_content').animate({'scrollTop':feed.current_yscroll+comment_div_height-client_height+(feed.is_webview?160:30)},'slow',function(){if(typeof options.displayCallback==='function'){options.displayCallback(options.content_id);}});}
if(options.loadComplete===true){options.show_more.remove();}
options.start+=options.nb;return true;}catch(e){error.log(e);}}
var display=function(){try{comment.display({element_id:options.element_id,type:options.type,start:options.start,nb:options.nb},displayCallback);return true;}catch(e){error.log(e);}};var displayCallback=function(result){try{if(typeof USER.USER_ID!=='undefined'&&USER.USER_ID>0&&typeof USER.BLOG_NAME!=='undefined'&&USER.BLOG_NAME!==null&&typeof USER.USER_PICTURE!=='undefined'&&USER.USER_PICTURE!==null){$('#naboo_comment_new').show();$('#naboo_comment_new_not_logged').hide();}else{$('#naboo_comment_new').hide();$('#naboo_comment_new_not_logged').show();}
if(result.data!=null&&result.count!=null&&result.count>0){var length=result.data.length;var html='';for(var i=0;i<length;i++){html+=createBlockComment(result.data[i]);}
options.list.append(html);options.start+=result.count;options.loadComplete=options.start>=result.total;}
if(options.loadComplete===true){options.show_more.remove();}
if(result.total>result.count){activeScroll();}
calculeTime();if(USER.FACEBOOK.UID&&options.facebook_share===true){if(facebook.isScopeAllowed('publish_actions')){if(facebook.isActionEnabled('comment')){options.facebook_share_element.addClass('active');}
options.facebook_share_element.data('type','comment-share-set');}else{options.facebook_share_element.data('type','comment-share-init');}}
if(options.twitter_share===true&&twitter.commentEnable()){options.twitter_share_element.addClass('active');}
Events.trigger(Events.navigation.tab_displayed,{type:options.type,id:options.id});return true;}catch(e){error.log(e);}};var postComment=function(){try{var comment_txt=$.trim(options.input.val());if(comment_txt==''||!isValid(options.min_comment_char,options.max_comment_char)||options.publish_on_progress){return false;}
options.publish_on_progress=true;comment.post({comment_txt:comment_txt,element_id:options.element_id,type:options.type},postCommentCallback);return true;}catch(e){error.log(e);}};var postCommentCallback=function(result){try{options.input.blur().val('');options.publish_on_progress=false;comment.getData({comment_id:result},function(result){try{var comment_data={BLOG_NAME:USER.BLOG_NAME,DISPLAY:0,USER_PICTURE:USER.USER_PICTURE,COMMENT_ID:result.COMMENT_ID,USER_ID:USER.USER_ID,SETTING_LANG:SETTING_LANG,DATE:dateToTimestamp(result.DATE),COMMENT:result.COMMENT};options.list.prepend(createBlockComment(comment_data));var added_comment=$('[data-target="comment-row"]:first',options.list);var highlighted_comment=(options.template==='feed')?added_comment:$('.message',added_comment);added_comment.fadeIn(function(){highlighted_comment.removeClass('user-publish',{duration:2000})});if(typeof options.addCallback==='function'){options.addCallback(options.content_id,comment_data);}
updateCount(1);calculeTime();tracking.track('comment_publish_click',{'context':((options.template==='feed')?'card':'page'),'content':options.type,'id':options.element_id});}catch(e){error.log(e);}});return true;}catch(e){error.log(e);}};var deleteComment=function(element){try{var data=element.data();if(typeof data.id==='undefined'||typeof data.type==='undefined'||typeof data.elementId==='undefined'){return false;}
if(confirm(gettext('Souhaitez-vous définitivement supprimer votre commentaire ?'))){comment.remove(data,function(result){try{element.parents('[data-target="comment-row"]').fadeOut('slow',function(){updateCount(-1);$(this).remove();});return true;}catch(e){error.log(e);}});}
return true;}catch(e){error.log(e);}};var flag=function(element){try{var data=element.data();if(data.id==''||typeof data.id==='undefined'||jQuery.inArray(data.id,flagged)>-1){return false;}
comment.flag(data,function(result){try{alert(gettext('Merci, ce commentaire sera vérifié dans les plus brefs délais.'));flagged.push(data.id);return true;}catch(e){error.log(e);}});return true;}catch(e){error.log(e);}};var activeScroll=function(){try{if(!options.infinite_scroll){return true;}
if(options.loadComplete){infinite_scroll.disable();return true;}
Events.subscribeOnce(Events.layout.infiniteScroll,function(){display();},options.events_group);infinite_scroll.active($('#tab_comment_content'));return true;}catch(e){error.log(e);}};var createBlockComment=function(item){try{item.FLAG_BUTTON=(options.template==='feed'&&item.USER_ID!=USER.USER_ID);item.TYPE=options.type;item.ELEMENT_ID=(item.USER_ID==USER.USER_ID)?options.element_id:false;item.COMMENT=$('<div/>').text(item.COMMENT).html();var template;if(options.template==='feed'){template=Handlebars.partials[(feed.is_webview)?'webview_feed_partial_comment_block':'feed_partial_comment_block'];}else if(options.template==='catalog'){template=Handlebars.templates['catalog_components_comment'];}else{template=Handlebars.templates['comment'];}
return template(item);}catch(e){error.log(e);}};var isValid=function(min,max){try{if(trim(options.input.val()).length<min){if(!options.error.is(":visible")){options.error.fadeIn();}
return false;}
return true;}catch(e){error.log(e);}};var updateCount=function(val){try{if(options.count==null){return false;}
options.count.text(parseInt(options.count.text())+val);return true;}catch(e){error.log(e);}};var limitComment=function(min,max){try{var comment_length=options.input.val().length;$("#naboo_comment_new .nb").text(max-comment_length);if(comment_length>=min&&options.error.is(":visible")){options.error.fadeOut();return true;}
return true;}catch(e){error.log(e);}};this.getInstance=function(){return self;};return init();};$.fn.commentbox=function(param){if(typeof param==='object'&&typeof $(this).data('cmt')==='undefined'){var options=$.extend({},params,param);this.each(function(){$(this).data('cmt',new Comment($(this),options));});return this;}else if(typeof param==='string'){var comment_div_inst=$(this).data('cmt').getInstance();if(comment_div_inst[param]){return comment_div_inst[param]();}else{$.error('Method "'+param+'" does not exist on jQuery.commentbox');}}}})(jQuery);;
var js_init={init:function(){if(typeof window.JS_INIT==='undefined'){return false;}
var index_of_jqueryaddress=window.JS_INIT.indexOf('_jqueryAddress');if(index_of_jqueryaddress!==-1){js_init.initLibs(['_jqueryAddress']);window.JS_INIT.splice(index_of_jqueryaddress,1);}
$(document).ready(function(){if(typeof window.JS_INIT==='object'){js_init.initLibs(window.JS_INIT);}});return true;},initLibs:function(js_init){if(typeof js_init!=='object'){return false;}
for(var i=0;i<js_init.length;i++){var _f=js_init[i];if(typeof window[_f]==='undefined'){continue;}
if(typeof window[_f].init==='function'){window[_f].init();continue;}
if(typeof window[_f]==='function'){window[_f]();}}
return true;}};;
var dzform={blogname_min_length:2,blogname_max_length:50,password_min_length:6,password_max_length:50,checkEmail:function($key,callback){callback=callback||function(){}
var str=$key.val();str=str.trim();if(!str.match(/^[_\.0-9a-z-+]+@([0-9a-z-]+\.)+[a-z]{2,13}$/i)||(!Modernizr.input.placeholder&&str===$key.attr('placeholder'))){throw new dzError({name:'FORM_ERROR_EMAIL_NOT_VALID',message:gettext('Le format de votre adresse email n\'est pas valide.'),payload:{evt:(str.length===0)?'over':''}});}
callback(true);},checkEmailuniq:function($key,callback){callback=callback||function(){};dzform.checkEmail($key);var str=$key.val();str=str.trim();api.call('deezer.emailCheck',{EMAIL:str},function(result){var arg=true;if(result.domain_validity===false){arg=new dzError({message:gettext('Le nom de domaine \'%s\' n\'est pas autorisé.',{sprintf:[result.domain]}),name:'FORM_ERROR_EMAIL_DOMAIN_NOT_VALID'});callback(arg);return;}
if(result.availability===false){arg=new dzError({message:gettext('Cette adresse email est déjà associée à un compte.'),name:'FORM_ERROR_EMAIL_ALREADY_USED'});}
callback(arg);});},checkEmailuniqAndSuggest:function($key,onSuccess,onError,onSuggest,onNoSuggest){try{dzform.checkEmail($key);}catch(error){onError($key,error);onNoSuggest($key);return;}
var str=$key.val();str=str.trim();api.call({method:'deezer.emailCheck',data:{EMAIL:str},success:function(result){if($key.val()!==str){return;}
if(result.availability===true){onSuccess($key);if(result.suggestion!==''){onSuggest($key,gettext('Vous vouliez sans doute dire %s ?',{sprintf:[result.suggestion]}),result.suggestion);}else{onNoSuggest($key);}}else if(result.domain_validity===false){onError($key,{message:gettext('Le nom de domaine \'%s\' n\'est pas autorisé.',{sprintf:[result.domain]}),name:'FORM_ERROR_EMAIL_DOMAIN_NOT_VALID'});onNoSuggest($key);}else{onError($key,{message:gettext('Cette adresse email est déjà associée à un compte.'),name:'FORM_ERROR_EMAIL_ALREADY_USED'});onNoSuggest($key);}}});},checkPassword:function($key,callback){var str=$key.val();str=str.trim();if(str.length<dzform.password_min_length||(!Modernizr.input.placeholder&&str===$key.attr('placeholder'))){throw new dzError({name:'FORM_ERROR_PASSWORD_TOO_SHORT',message:gettext('Votre mot de passe doit comporter au moins 6 caractères.'),payload:{evt:(str.length===0)?'over':''}});}
if(str.length>dzform.password_max_length){throw new dzError({name:'FORM_ERROR_PASSWORD_TOO_LONG',message:gettext('Votre mot de passe ne doit pas dépasser 50 caractères.'),payload:{evt:''}});}
callback(true);},checkBlogname:function($key,callback){var str=$key.val();str=str.trim();if(str.length<dzform.blogname_min_length||(!Modernizr.input.placeholder&&str===$key.attr('placeholder'))){throw new dzError({name:'FORM_ERROR_BLOGNAME_TOO_SHORT',message:gettext('Votre pseudo doit comporter au moins 2 caractères.'),payload:{evt:(str.length===0)?'over':''}});}
if(str.length>dzform.blogname_max_length){throw new dzError({name:'FORM_ERROR_BLOGNAME_TOO_LONG',message:gettext('Votre pseudo ne doit pas dépasser 50 caractères.'),payload:{evt:''}});}
callback(true);},checkGender:function($key,callback){if($key.val()==0){throw new dzError({name:'FORM_ERROR_SEX_NOT_VALID',message:gettext('Merci de préciser votre sexe.'),payload:{evt:'over'}});}
callback(true);},checkAge:function($key,callback){if(parseInt($key.val(),10)<MIN_LEGAL_AGE){throw new dzError({name:'FORM_ERROR_AGE_NOT_VALID',message:gettext('Vous devez avoir au moins %s ans pour créer un compte.',{sprintf:[MIN_LEGAL_AGE]}),payload:{evt:'over'}});}
callback(true);},canSubmit:function($form,datas,onError,onSuccess,event){var error=false;onError=Array.isArray(onError)?onError:[onError];datas.each(function(index){if(typeof $(this).data('val')==='undefined'||$(this).data('val')===false){error=new dzError({message:'',name:'form_input_empty'});if($form.children('form').data('type')==='form-page'){dzform.checkField($(this),onError,onSuccess);}else{for(var i=0;i<onError.length;i++){onError[i]($(this),error,event);}}}});if(error){return false;}
return true;},checkField:function($key,onError,onSuccess,event){var check=$key.data('check');onError=Array.isArray(onError)?onError:[onError];onSuccess=Array.isArray(onSuccess)?onSuccess:[onSuccess];if($key.data('insert-value')===true){var optionSelected=$('option:selected',$key);var optionLabel=$key.prev('.form-control');optionLabel.text(optionSelected.text());optionLabel.toggleClass('active',(optionSelected.val()!=='0'));}
try{window.dzform['check'+ucfirst(check)]($key,function(check){if(check===true){for(var i=0;i<onSuccess.length;i++){onSuccess[i]($key,check,event);}
return check;}
for(var j=0;j<onError.length;j++){onError[j]($key,check,event);}
return check;});}catch(error){for(var i=0;i<onError.length;i++){onError[i]($key,error,event,error.payload.evt);}}},placeholder:function($key){if(Modernizr.input.placeholder){return true;}
$key.each(function(index){if($(this).is('input')&&$(this).val().length===0){$(this).val($(this).attr('placeholder')).addClass('has-placeholder');}});$key.focus(function(){if($(this).attr('placeholder')!==''&&$(this).val()===$(this).attr('placeholder')){$(this).val('').removeClass('has-placeholder');}}).blur(function(){if(($(this).attr('placeholder')!==''&&($(this).val()===''||$(this).val()===$(this).attr('placeholder')))){$(this).val($(this).attr('placeholder')).addClass('has-placeholder');}});}};;
var infinite_scroll={state:false,status:false,div:'',percent:95,active:function(div,percent){try{infinite_scroll.state=true;infinite_scroll.status=false;infinite_scroll.percent=95;if(typeof percent=='number'){infinite_scroll.percent=percent;}
if(BrowserDetect.browser==='Explorer'&&BrowserDetect.version===8){return false;}
infinite_scroll.checkPosition();return;}catch(e){error.log(e);}},disable:function(){try{infinite_scroll.state=false;infinite_scroll.status=false;}catch(e){error.log(e);}},checkPosition:function(evt){try{if(!infinite_scroll.state){return;}
if(infinite_scroll.status){return;}
var $page_content=$('#page_content');var content_height=$page_content.height();var content_scroll_height=$page_content.get(0).scrollHeight;var current_percent=(yscroll+content_height)*100/content_scroll_height;if(current_percent>=infinite_scroll.percent){infinite_scroll.status=true;Events.trigger(Events.layout.infiniteScroll,Math.min(100,Math.round(current_percent)));}
return;}catch(e){error.log(e);}}};
(function(){'use strict';var naboo={initialized:false,current_config:null,pages:{'':{class_name:'feed',regex:/^\/?/i,args:{},need_login:true},feed:{class_name:'feed',regex:/^\/feed\/?/i,args:{},need_login:true},album:{class_name:'album',regex:/^\/album\/([0-9]+)/i,args:{alb_id:1}},app:{class_name:'app',regex:/^\/app\/(login)?([a-z0-9_-]+)?(\/(.+)?)?/i,root:/^\/app\/[a-z0-9_-]+/i,args:{action:1,app_id:2,deep_link:3}},appstudio:{class_name:'appstudio',regex:/^\/appstudio/i,args:{}},artist:{class_name:'artist',regex:/^\/artist\/([0-9]+)/i,args:{art_id:1}},explore:{class_name:'explore',regex:/^\/explore(\/([a-z_]+)?)?(\/([a-z0-9\-]+)?)?/i,args:{tab:2,id:4},root:/^\/explore?/i,need_login:true},pro:{class_name:'pro',regex:/^\/pro/i,args:{},root:/^\/pro?/i,need_login:true},offline:{class_name:'offline',regex:/^\/offline/i,args:{}},playlist:{class_name:'playlist',regex:/^\/playlist\/([0-9]+)/i,args:{playlist_id:1}},profile:{class_name:'profile',regex:/^\/profile\/([0-9a-z]+)(\/([a-z_]+)?)?/i,args:{user_id:1,tab:3},root:/^\/profile\/([0-9a-z]+)/i},mixes:{class_name:'radio',regex:/^\/mixes(\/([a-z]+)?)?(\/([0-9]+)?)?/i,args:{type:2,id:4}},search:{class_name:'search',regex:/^\/search(\/(.+)?)?/i,args:{query:2}},tags:{class_name:'search',regex:/^\/tags(\/(.+)?)?/i,args:{query:2,tags:2}},shows:{class_name:'talk',regex:/^\/shows(\/([a-z_]+)?)?(\/([a-z0-9\-]+)?)?/i,args:{tab:2,id:4},root:/^\/shows?/i,need_login:true},show:{class_name:'talkshow',regex:/^\/show\/([0-9]+)/i,args:{show_id:1}},charts:{class_name:'tops',regex:/^\/charts(\/([a-z]+)?)?(\/([^-]+)\/([0-9]+)?)?/i,args:{type:2,genre_id:5}},track:{class_name:'track',regex:/^\/track\/([0-9]+)/i,args:{sng_id:1}},episode:{class_name:'episode',regex:/^\/episode\/([0-9]+)/i,args:{episode_id:1}}},init:function(){menu.load();Events.subscribe(Events.navigation.page_loaded,www.updateContentBackground);naboo.initialized=true;Events.resolve(Events.navigation.page_initialized);return true;},getCurrentClass:function(){if(naboo.current_config===null){return null;}
return naboo.current_config.class_name;},getCurrentPath:function(){if(naboo.current_config===null){return null;}
return naboo.current_config.full_path;},dispatchPath:function(path){var path_splitted=naboo.splitPath(path);var base=path_splitted.base;if(typeof naboo.pages[base]==='undefined'){return null;}
var class_config=naboo.pages[base];var dispatch={base:base,class_name:class_config.class_name,path_name:path_splitted.path_name,full_path:path_splitted.full_path,args:{},root:null};if(path_splitted.query_string!==null){var get_params=path_splitted.query_string.split('&');get_params.map(function(a){a=a.split('=');dispatch.args[a[0]]=a[1];});}
var regex=class_config.regex;var regex_args=regex.exec(path_splitted.path_name);for(var key in class_config.args){if(!class_config.args.hasOwnProperty(key)){continue;}
dispatch.args[key]=regex_args[class_config.args[key]]||null;}
if(typeof class_config.root!=='undefined'){var root=class_config.root.exec(path_splitted.path_name);if(root!==null){dispatch.root=root[0];}}
return dispatch;},splitPath:function(path){var splitted={base:null,path_name:null,full_path:path,query_string:null,hash:null};path=path.split('#');if(path.length>1){splitted.hash=path[1];}
path=path[0];path=path.split('?');if(path.length>1){splitted.query_string=path[1];}
path=path[0];splitted.path_name=path;path=path.split('/');splitted.base=path[1];return splitted;},getClass:function(path){var base_path=path.split('/')[1];return(naboo.isAllowed(base_path)?naboo.pages[base_path].class_name:null);},isAllowed:function(class_name){return(typeof naboo.pages[class_name]!=='undefined');},needLogin:function(base){return naboo.pages[base].need_login===true;},display:function(path,seo_data,options){try{options=options||{};if(path.charAt(0)!=='/'){error.log({message:'path not valid',description:'naboo.display: / is missing in your path '+path});path='/'+path;}
if(naboo.initialized===false){Events.ready(Events.navigation.page_initialized,function(){naboo.display(path,seo_data);});return false;}
if(!options.force&&naboo.current_config!==null&&naboo.current_config.full_path===path){Events.trigger(Events.navigation.page_displayed,{path:path});return false;}
var path_config=naboo.dispatchPath(path);if(path_config===null){error.log({message:'path not valid',description:'naboo.display: wrong path '+path});return false;}
if(USER.USER_ID===0&&naboo.needLogin(path_config.base)){www.goToConnection();return false;}
var internal_change=false;if(naboo.current_config!==null){if(path_config.root!==null&&path_config.root===naboo.current_config.root){internal_change=true;}
if(!internal_change){naboo.leave();}}
if(naboo.current_config===null){$('body').attr('data-layout','naboo');}
if(typeof seo_data==='object'){path_config.args.data=seo_data;}
path_config.class_name=path_config.path_name==='/'&&gatekeeper.isAllowed('new_home')?'home':path_config.class_name;naboo.current_config=path_config;infinite_scroll.disable();var current_class_name=naboo.current_config.class_name;if(internal_change){if(typeof window[current_class_name].onPageChanged==='function'){window[current_class_name].onPageChanged(naboo.current_config.args);}}else{window[current_class_name].display(naboo.current_config.args);}
return true;}catch(e){error.log(e);}},leave:function(){var leaveClass=naboo.getCurrentClass();if(leaveClass===null){return false;}
Events.unsubscribeAll(leaveClass);window[leaveClass].initialized=false;if(typeof window[leaveClass].leave==='function'){window[leaveClass].leave();}
tabs.destroy();naboo.current_config=null;return true;},afterLoad:function(scrolling){try{if(typeof scrolling==='undefined'||scrolling===null){scrolling=false;}
if(scrolling===true){$('#page_content').scrollTop(0);yscroll=0;}
var current_class=naboo.getCurrentClass();if(typeof window[current_class].getLiveFeed==='function'){live.deleteChannel(live.lastFeed);window.clearTimeout(live.timeoutConnect);live.lastFeed=window[current_class].getLiveFeed();live.timeoutConnect=window.setTimeout(function(){live.addChannel(live.lastFeed);},3000);}
var adsClass=current_class==='home'&&gatekeeper.isAllowed('new_home')?'feed':current_class;if(typeof window[adsClass].getAdsArgs==='function'){advertising.call(adsClass,window[adsClass].getAdsArgs());}else{advertising.call(adsClass,{element_id:window[adsClass].id});}
Events.trigger(Events.navigation.page_displayed,{path:naboo.getCurrentPath()});return true;}catch(e){error.log(e);}},liveEvent:function(data){try{var currentNumber=1;switch(data.ACTION){case'ALBUM_COMMENT':case'ARTIST_COMMENT':case'PLAYLIST_COMMENT':if($('#tab_comment_content').is(':hidden')){if(!isNaN(parseInt($('#tab_comment_link .badge').text(),10))){currentNumber=parseInt($('#tab_comment_link .badge').text(),10)+1;}
$('#tab_comment_link .badge').text('+'+currentNumber).show();}
break;case'ARTIST_FAN':case'PLAYLIST_FAN':if($('#tab_fan_content').is(':hidden')){if(!isNaN(parseInt($('#tab_fan_link .badge').text(),10))){currentNumber=parseInt($('#tab_fan_link .badge').text(),10)+1;}
$('#tab_fan_link .badge').text('+'+currentNumber).show();}else{window.fan.liveFan();}
break;default:break;}
return true;}catch(e){error.log(e);}}};Events.subscribe(Events.live.pagefeed,function(evt,params){naboo.liveEvent(params[0]);});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=naboo;}else{window.naboo=naboo;}})();;
var orange={unlink:function(){var unlinkConfirmText=gettext('Êtes-vous certain de vouloir dissocier votre compte Orange de votre compte Deezer ?');try{if(confirm(unlinkConfirmText)){var unlinkIntroText=gettext('Afin de dissocier vos comptes, veuillez saisir votre mot de passe et soumettre le formulaire suivant :');$('#init_disable_orange_password').html(unlinkIntroText);$('#span_disable_orange_password').show();$('#div_disable_orange_password').show();}}catch(e){error.log(e);}},unlinkConfirm:function(){try{var password='';if($('#disable_orange_password').length==1){password=$('#disable_orange_password').val();}
var checkForm='';if($('#checkForm').length==1){checkForm=$('#checkForm').val();}
var data='password='+encodeURIComponent(password)+'&checkForm='+encodeURIComponent(checkForm);request=sendRequest('/ajax/action.php','text','type=orange_unlink&'+data);if(request==false){return;}
var result=eval('('+request+')');if(result.error.length>0){www.drawFormResult('disable_orange_result','form_error',gettext('Veuillez vérifier votre mot de passe.'));$('#disable_orange_result').delay(3000).fadeOut();}else{www.drawFormResult('disable_orange_result','form_success',gettext('Les comptes ont bien été dissociés.'));$('#disable_orange_result').delay(3000).fadeOut();setTimeout(function(){user.refreshPageAfterLogin({type:'page',link:'account/subscription'});},3000);}}catch(e){error.log(e);}},checkPremium4Orange:function(){try{window.location.href='/orange/login.php';}catch(e){error.log(e);}},uk_test_number:function(){try{if(($('#ouk_test_phone')!=null)&&($('#ouk_test_phone').val().length>0)){var request=sendRequest('/ajax/action.php','text','type=orange_uk_test_number&phone='+encodeURIComponent($('#ouk_test_phone').val()));if(request=='error'){$('#ouk_error').html(gettext('Numéro invalide. Merci de vérifier.')).show();}else if(request=='fail'){modal.open('/orange_uk/fail.php?phone='+encodeURIComponent($('#ouk_test_phone').val()),true);return true;}else if(request=='error_soap'){$('#ouk_error').html(gettext('Une erreur est survenue, merci de réitérer dans quelques instants.')).show();}else{modal.open('/orange_uk/final.php',true);}}else{$('#ouk_error').html(gettext('Une erreur est survenue, merci de réitérer dans quelques instants.'));}}catch(e){error.log(e);}},uk_check_code:function(){try{if(($('#ouk_code')!=null)&&($('#ouk_code').val().length>0)){var request=sendRequest('/ajax/action.php','text','type=orange_uk_check_code&code='+encodeURIComponent($('#ouk_code').val()));if(request=='error'){$('#ouk_error').html(gettext('Une erreur est survenue, merci de réitérer dans quelques instants.')).show();}else if(request=='error_check'){$('#ouk_error').html(gettext('Votre code est erroné. Merci de vérifier le SMS que vous avez reçu.')).show();}else{modal.open('/orange_uk/confirm.php',true);return true;}}else{$('#ouk_error').html(gettext('Une erreur est survenue, merci de réitérer dans quelques instants.'));}}catch(e){error.log(e);}},uk_check_code_promo:function(){try{var code_promo='';if($('#code_promo').length==1)code_promo=$('#code_promo').val();check=sendRequest('/ajax/action.php','text','type=orange_uk_check_code_promo&code='+encodeURIComponent(code_promo));if((check===false)||(check=='error')){$('#orange_code_promo_error').css('display','block');return false;}
modal.open('/orange_uk/confirm.php',true);}catch(e){error.log(e);}}};
var operatorAutolinker={autolink_url:null,subscriber:null,cookie_name:'auto_linked_subscriber',cookie_value:'1',cookie_life:30,init:function(autolink_url){if(operatorAutolinker._subscriberHasAlreadyChosenToLink()){return false;}
operatorAutolinker.autolink_url=autolink_url;var scriptEl=document.createElement('script');scriptEl.src=operatorAutolinker.autolink_url;document.body.appendChild(scriptEl);},process:function(json){if(!operatorAutolinker._isValidJson(json)){return null;}
operator.findSubscriber(json.userInfos.ise2,operatorAutolinker._findValidSubscriberCallback);},doLink:function(){api.call('operator_linkAccount',operatorAutolinker.subscriber,operatorAutolinker._afterLink);},doNotLink:function(){operatorAutolinker._afterLink();},_afterLink:function(){storage.set(operatorAutolinker.cookie_name,operatorAutolinker.cookie_value,operatorAutolinker.cookie_life);window.location.reload(true);},_isValidJson:function(json){return typeof json.status!='undefined'&&typeof json.status.code!='undefined'&&json.status.code==200&&typeof json.userInfos.ise2!='undefined'&&json.userInfos.accountStatus==0;},_findValidSubscriberCallback:function(subscriber){if(typeof subscriber!='undefined'&&subscriber!==null&&typeof subscriber.result_code!='undefined'&&subscriber.result_code==1&&subscriber.linked==0){operatorAutolinker.subscriber=subscriber;}
if(operatorAutolinker.subscriber==null){return null;}
modal.open('/operator/autolink.php',true,operatorAutolinker.subscriber);},_subscriberHasAlreadyChosenToLink:function(){return storage.get(operatorAutolinker.cookie_name)==operatorAutolinker.cookie_value;}};
var operator={errorCodes:{'-1':'error','-2':'error_msisdn','-3':'error_email','-4':'error_code','-5':'error_provisionning','-6':'error_quota_security_code','-7':'error_quota_sms','-8':'error_quota_email','-12':'error_invalid_security_code','-53':'error_subscriber_code'},translation:{error:gettext('Une erreur est survenue, merci de réessayer plus tard.'),error_msisdn:gettext('Numéro de téléphone invalide'),error_email:gettext('Adresse email invalide'),error_code:gettext('Code invalide'),error_subscriber_code:gettext('Code invalide'),error_invalid_security_code:gettext('Code erroné'),error_provisionning:gettext('Votre numéro n\'est pas reconnu'),error_quota_sms:gettext('Une erreur est survenue, merci de réessayer plus tard.'),error_quota_email:gettext('Une erreur est survenue, merci de réessayer plus tard.'),error_quota_security_code:gettext('Une erreur est survenue, merci de réessayer plus tard.'),error_password:gettext('Veuillez vérifier votre mot de passe.'),association_type_enter_msisdn:gettext('Entrez votre numéro de téléphone '),association_type_enter_email:gettext('Entrez votre adresse email'),association_type_msisdn_placeholder:gettext('Mon numéro de téléphone'),association_type_email_placeholder:gettext('E-mail')},findSubscriber:function(subscriber_id,callback){sendRequest('/operator/ws/find_subscriber.php','json','subscriber_id='+encodeURIComponent(subscriber_id),true,function(response){callback(JSON.parse(response.responseText));});},unlinkSubscriber:function(subscriber_id,callback){operator.findSubscriber(subscriber_id,function(subscriber){api.call({method:'operator_unlinkAccount',data:subscriber,success:callback});});},unlinkSubscriberFromAccount:function(subscriber_id){if($('#password_field_container').data('display')==='off'){$('#password_field_container').show();$('#password_field_container').data('display','on');return true;}
var password=$('#password').val();if(password.length<1){www.drawFormResult('unlink_user_flash_message','form_error',operator.translation.error_password);return true;}
user.checkPassword(password,function(response){if(response!==true){www.drawFormResult('unlink_user_flash_message','form_error',operator.translation.error_password);return true;}
operator.unlinkSubscriber(subscriber_id,function(response){var flashMessage;var flashStyle;if(response!==true){flashMessage=gettext('Les comptes ont bien été dissociés.');flashStyle='form_error';}else{flashMessage=gettext('Une erreur est survenue, merci de réessayer plus tard.');flashStyle='form_success';}
www.drawFormResult('unlink_user_flash_message',flashStyle,flashMessage);$('#unlink_button').hide();$('#unlink_user_flash_message').delay(3000).fadeOut(function(){setTimeout(function(){window.location.reload(true);},1000);});});});},checkSubscriber:function(){try{var subscriberError=$('#subscriber_error');var subscriberId=$('#subscriber_id').val();if(typeof subscriberId==='string'&&subscriberId.length>0){sendRequest('/ajax/action.php','text','type=operator_check_subscriber&subscriber_id='+encodeURIComponent(subscriberId),true,function(xhr){var request=false;if(typeof xhr.responseText!=='undefined'){request=xhr.responseText;}
if(request===false){subscriberError.html(operator.translation.error).show();return false;}
var redirect='';switch(request){case'fail':redirect='/operator/fail.php?phone='+encodeURIComponent(subscriberId);break;case'success_service':if(USER.USER_ID!==0){redirect='/operator/confirm.php';}else{redirect='/operator/login_register.php';}
break;case'success_msisdn':case'success_email':redirect='/operator/code.php';break;default:var error_message=operator.translation.error;if(typeof operator.translation[request]==='string'){error_message=operator.translation[request];}else if(request.indexOf('error_')===-1){error_message=request;}
subscriberError.html(error_message).show();return true;}
modal.open(redirect,true);return true;});}}catch(e){if(typeof console!=='undefined'){error.log(e);}}},checkCode:function(){try{var activationError=$('#activation_error');var securityCode=$('#security_code').val();if(typeof securityCode==='string'&&securityCode.length>0){sendRequest('/ajax/action.php','text','type=operator_check_activation_code&code='+encodeURIComponent(securityCode),true,function(xhr){var request=false;if(typeof xhr.responseText!=='undefined'){request=xhr.responseText;}
if(request===false){activationError.html(operator.translation.error).show();return false;}
if(request==='success'){if(USER.USER_ID>0){var redirect='/operator/confirm.php';}else{var redirect='/operator/login_register.php';}
modal.open(redirect,true);}else if(request.indexOf('tnb_subscribe_force')>=0){var tmp=request.split('_');var operator_name=tmp[tmp.length-1];redirect='/operator/subscribe/'+operator_name+'/billing?force=1';window.location=SETTING_HOST_SITE+redirect;}else if(request.indexOf('tnb_subscribe_link')>=0){var tmp=request.split('_');var operator_name=tmp[tmp.length-1];redirect='/operator/subscribe/'+operator_name+'/billing?link=1';window.location=SETTING_HOST_SITE+redirect;}else{var error_message=operator.translation.error;if(typeof operator.translation[request]==='string'){error_message=operator.translation[request];}
activationError.html(error_message).show();}
return true;});}}catch(e){if(typeof console!=='undefined'){error.log(e);}}},initAssociationJourney:function(operatorId,associationType,subscriberId,code,insideApp){try{if(operatorId>0){ReactComponent.require('operator/associationjourney/index',function(AssociationJourneyIndex){React.renderComponent(AssociationJourneyIndex({operatorId:operatorId,associationType:associationType,subscriberId:subscriberId,code:code,insideApp:insideApp}),document.getElementById('operator_association'));});}}catch(e){if(typeof console!=='undefined'){error.log(e);}}}};(function(){function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:null};var evt=document.createEvent('CustomEvent');evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt;}
CustomEvent.prototype=window.Event.prototype;window.CustomEvent=CustomEvent;})();;
if(typeof(right)=='undefined'){var right={READABLE:0,NOT_ENCODED:1,LOCALITY:2,MP3_FRIEND:3,PREMIUM_ONLY:4,NOT_RELEASE_FREE:5,NOT_RELEASE_PREMIUM:6,EXPLICIT_LYRICS:7,FAN_ONLY:8,checkSongAvailable:function(currentData){try{if(typeof(currentData)!=='object'){return right.READABLE;}
if(typeof(currentData.ISRC)!='undefined'&&currentData.ISRC!=''&&userData.dataStore[currentData.ISRC]==true){return right.READABLE;}
if(typeof(currentData.EXTERNAL)!='undefined'){return right.READABLE;}
if(typeof(currentData.RIGHTS)=='undefined'){currentData.RIGHTS={};}
if(parseInt(currentData.SNG_ID,10)<0){if(countObject(currentData.RIGHTS)==0){return(parseInt(currentData.ART_ID,10)==0)?right.MP3_FRIEND:right.LOCALITY;}
if(parseInt(currentData.FAN_ONLY,10)==1&&(!userData.isLoaded||!userData.isFavorite('artist',currentData.ART_ID))){return right.FAN_ONLY;}}
if(USER.USER_ID>0&&typeof(USER.SETTING.global.filter_explicit_lyrics)!=='undefined'&&typeof(currentData.RIGHTS.EXPLICIT_LYRICS)==='boolean'&&currentData.RIGHTS.EXPLICIT_LYRICS===true){return right.EXPLICIT_LYRICS;}else if(!DZPS&&typeof(currentData.RIGHTS.STREAM_ADS)=='undefined'&&typeof(currentData.RIGHTS.STREAM_SUB)=='string'){return right.PREMIUM_ONLY;}else if(typeof(currentData.RIGHTS.STREAM_ADS)=='undefined'&&typeof(currentData.RIGHTS.STREAM_SUB)=='undefined'){return right.LOCALITY;}else if(!DZPS&&(dateToTimestamp(currentData.RIGHTS.STREAM_ADS)>SERVER_TIMESTAMP)){return right.NOT_RELEASE_FREE;}else if(DZPS&&(dateToTimestamp(currentData.RIGHTS.STREAM_SUB)>SERVER_TIMESTAMP)){return right.NOT_RELEASE_PREMIUM;}else if(currentData.MD5_ORIGIN==''||(parseInt(currentData.FILESIZE_MP3_128,10)===0&&!DZPS&&parseInt(currentData.SNG_ID,10)>0)||(parseInt(currentData.FILESIZE_MP3_128,10)===0&&DZPS&&parseInt(currentData.SNG_ID,10)>0&&USER.SETTING.site.player_hq==false)||(parseInt(currentData.FILESIZE_MP3_128,10)===0&&parseInt(currentData.FILESIZE_MP3_256,10)===0&&parseInt(currentData.FILESIZE_MP3_320,10)===0&&DZPS&&parseInt(currentData.SNG_ID,10)>0)||(parseInt(currentData.SNG_ID,10)===0&&parseInt(currentData.FILESIZE_MP3_MISC,10)===0)){return right.NOT_ENCODED;}
return right.READABLE;}catch(e){error.log(e);}},getMessage:function(unavailable_code){try{switch(unavailable_code){case right.NOT_ENCODED:return gettext('Ce titre n\'est pas encore encodé');case right.LOCALITY:return gettext('Ce titre n\'est pas disponible dans votre pays.');case right.MP3_FRIEND:return gettext('Ce titre est un mp3 perso d\'un autre utilisateur');case right.PREMIUM_ONLY:return gettext('A la demande des ayants droit, ce titre est disponible uniquement pour les abonnés Premium et Premium+.');case right.NOT_RELEASE_FREE:return gettext('Ce titre n\'est pas encore disponible.');case right.NOT_RELEASE_PREMIUM:return gettext('Ce titre n\'est pas encore disponible.');case right.EXPLICIT_LYRICS:return gettext('Ce titre contient des paroles pouvant choquer.');case right.FAN_ONLY:return gettext('Ajoutez l\'artiste à vos favoris pour écouter ce titre');default:return'';}}catch(e){error.log(e);}}};};
if(typeof restrict=='undefined'){var restrict={statusExclamationMark:80,object:null,type:'no_restriction',init:function(){try{if(USER.USER_ID<=0||DZPS){return false;}
if(USER.OPTIONS.web_streaming&&USER.OPTIONS.web_streaming_duration===0){return false;}
api.call('restriction.get',{},function(result){if(result==false){return;}
restrict.object=result;var now=Math.round(new Date().getTime()/1000);if(now<restrict.object.date_end_discover){restrict.type='discovery_unlimited';}else{restrict.type='discovery';Events.subscribe(Events.player.updateRestrictTime,restrict.updateRestrictTime);}});return true;}catch(e){error.log(e);}},updateRestrictTime:function(e,time){try{restrict.object.time_left-=time;restrict.object.time_used+=time;restrict.object.percent=((restrict.object.time_used*100)/(restrict.object.time_used+restrict.object.time_left));restrict.object.percent=Math.min(restrict.object.percent,100);restrict.gaugeUpdatePercent(restrict.object.percent);return true;}catch(e){error.log(e);}},gaugeUpdatePercent:function(percent){try{percent=parseFloat(percent).toFixed(3);percent=Math.min(percent,100);if(percent>=restrict.statusExclamationMark){$('#header_content_restriction > a > .warning').css('display','inline-block');}
$('#header_content_restriction > a > .progress > .bar').css('width',percent+'%');return true;}catch(e){error.log(e);}},gaugeEnable:function(){try{$('#push_abo').hide();$('#header_content_profil_user_data').removeClass('limit_off').addClass('limit_on');$('#header_content_restriction').show().bind('mouseover',restrict.gaugeMouseOver).bind('mouseout',restrict.gaugeMouseOut);}catch(e){error.log(e);}},gaugeDisable:function(){try{$('#push_abo').show();$('#header_content_profil_user_data').removeClass('limit_on').addClass('limit_off');$('#header_content_restriction').hide().unbind('mouseover',restrict.gaugeMouseOver).unbind('mouseout',restrict.gaugeMouseOut);}catch(e){error.log(e);}},gaugeMouseOver:function(){try{if($('#header_content_restriction_hovercard').is(':visible')==false){sendRequest('/lightbox/hovercard_restriction.php','text','type='+restrict.type+'&time_used='+restrict.object.time_used+'&time_left='+restrict.object.time_left,true,restrict.gaugeMouseOverCallback);}}catch(e){error.log(e);}},gaugeMouseOverCallback:function(response){try{response=response.responseText;$('#header_content_restriction_hovercard').html(response).show();}catch(e){error.log(e);}},gaugeMouseOut:function(e){try{if($(e.relatedTarget).parents('#header_content_restriction').length==1){return false;}
$('#header_content_restriction_hovercard').hide();}catch(e){error.log(e);}}}};
if(typeof user=='undefined'){var user={check_username_active:false,login:function(email,password){var response={success:0,instant_auth:0};try{if(typeof email!=='string'||typeof password!=='string'){return response;}
email=email.trim();password=password.trim();if(email===''||password===''){return response;}
var res=sendRequest('/ajax/action.php','text','type=login&mail='+encodeURIComponent(email)+'&password='+encodeURIComponent(password));if(res==='error_and_instant_auth'){response.instant_auth=1;}else if(res==='success'){response.success=1;}}catch(e){error.log(e);}
return response;},current:function(){var user_id=Number(USER.USER_ID);return user_id>0?user_id:0;},getLogType:function(){return LOG_TYPE;},setLogType:function(type){LOG_TYPE=String(type||'internal');},ping:function(){try{api.call('deezer.ping',{},function(result){if(typeof result.CHECKFORM!=='undefined'){if(USER.USER_ID>0&&result.USER_ID===0){modal.open('/lightbox/no_session.php');}else{USER.USER_ID=result.USER_ID;}
SESSION_ID=result.SESSION;checkForm=result.CHECKFORM;}});return true;}catch(e){error.log(e);}},refreshSession:function(){return sendRequest('/ajax/action.php','text','type=refresh_session');},refreshPageAfterLogin:function(redirect){try{if(Object(redirect)!==redirect){window.location.reload();return true;}
var url=document.location.protocol+'//'+SETTING_HOST;if(redirect.link.charAt(0)!=='/'&&redirect.link.substr(0,4)!=='http'){error.log({message:'path not valid',description:'user.refreshPageAfterLogin: / is missing in your path'+redirect.link});redirect.link='/'+redirect.link;}
if(redirect.type=='refresh'){return document.location.href=redirect.link;}
if(redirect.type=='modal'){return document.location.href=url+www.getCurrentPath()+'?lb='+encodeURIComponent(redirect.link);}
if(redirect.type=='facebox'){return document.location.href=url+www.getCurrentPath()+'?lb='+encodeURIComponent(redirect.link);}
if(redirect.type=='page'){return document.location.href=url+unescape(redirect.link);}
if(redirect.type=='link'){return document.location.href='/?lb='+encodeURIComponent(redirect.link);}
return false;}catch(e){error.log(e);}},logout:function(redirect){try{redirect=redirect||null;if(typeof dzPlayer!=='undefined'&&dzPlayer.getPlayerType()==='chromecast'){chromecast.stopReceiver();}
Events.trigger(Events.user.logout);window.location='//'+SETTING_HOST+'/logout.php'+(redirect?'?redirect='+encodeURIComponent(redirect):'');return true;}catch(e){error.log(e);}
return false;},register:function(redirect,data){try{if(typeof data.tracking_data==='undefined'){data.tracking_data={};}
if(typeof data.validButton!='undefined'&&data.validButton!==''){$(data.validButton).hide();$(data.validButton).next().show();}
var blogname='';if(typeof data.blogname!='undefined'&&data.blogname!==''){blogname=data.blogname;}
var email='';if(typeof data.email!='undefined'&&data.email.trim()!==''){email=data.email.trim();}
var password='';if(typeof data.password!='undefined'&&data.password!==''){password=data.password;}
var birthday_day='';if(typeof data.birthday_day!='undefined'&&data.birthday_day!==''){birthday_day=data.birthday_day;}
var birthday_month='';if(typeof data.birthday_month!='undefined'&&data.birthday_month!==''){birthday_month=data.birthday_month;}
var birthday_year='';if(typeof data.birthday_year!='undefined'&&data.birthday_year!==''){birthday_year=data.birthday_year;}
var gender='';if(typeof data.gender!='undefined'){gender=data.gender;}
var checkForm='';if($('#checkForm').val()){checkForm=$('#checkForm').val();}else if(typeof window.checkForm!=='undefined'){checkForm=window.checkForm;}
var request=sendRequest('/ajax/action.php','text','type=register&email='+encodeURIComponent(email)+'&password='+encodeURIComponent(password)+'&blogname='+encodeURIComponent(blogname)+'&gender='+encodeURIComponent(gender)+'&birthday_day='+encodeURIComponent(birthday_day)+'&birthday_month='+encodeURIComponent(birthday_month)+'&birthday_year='+encodeURIComponent(birthday_year)+'&checkForm='+encodeURIComponent(checkForm));if(request=='error'){register.track(data.tracking_data,'error_checkform');user.ping();return false;}
var result=JSON.parse(request);if(typeof result[0]=='number'||result[0]>0){var login_result=user.login(email,password);if(login_result.success==true){register.track(data.tracking_data,'success',function(){user.refreshPageAfterLogin(redirect);});}
return true;}else{register.track(data.tracking_data,'error_input');}
if(typeof data.callBackError!='undefined'&&data.callBackError!==''){data.callBackError(result);}
if(typeof data.validButton!='undefined'&&data.validButton!==''){$(data.validButton).show();$(data.validButton).next().hide();}
return false;}catch(e){error.log(e);}},checkPassword:function(password,callback){api.call({method:'user_checkPassword',data:{password:password},success:callback});},resetPassword:function(email){try{if(typeof email!=='string'||email.trim()===''){return false;}
email=email.trim();var request=sendRequest('/ajax/action.php','text','type=reset_password&reset_mail='+encodeURIComponent(email));if(request=='success'){$('#reset_error').hide();$('#reset_first').hide();$('#reset_second').show();$('#reset_second_mail').html(email);$('#foot_step3').show();$('#foot_step2').hide();return true;}else if(request=='error'){$('#reset_error').html(gettext('<b>Adresse e-mail invalide</b><br />Merci de vérifier le format de votre adresse e-mail.'));$('#reset_error').show();return false;}else{$('#reset_error').html(gettext('<b>Adresse email inconnue</b><br />Cette adresse email ne correspond à aucun compte.<br />Merci de saisir votre email à nouveau.'));$('#reset_error').show();return false;}}catch(e){error.log(e);}},resetPasswordConfirm:function(){try{var password='';if($('#reset_new_password').length==1){password=$('#reset_new_password').val();password=password.trim();}
var password_confirm='';if($('#reset_new_confirm').length==1){password_confirm=$('#reset_new_confirm').val();password_confirm=password_confirm.trim();}
var key='';if($('#key').length==1){key=$('#key').val();}
var email='';if($('#email').length==1){email=$('#email').val();email=email.trim();}
var request=sendRequest('/ajax/action.php','text','type=reset_passwordConfirm&password='+encodeURIComponent(password)+'&password_confirm='+encodeURIComponent(password_confirm)+'&key='+encodeURIComponent(key)+'&email='+encodeURIComponent(email)+'&checkForm='+encodeURIComponent(checkForm));if(request!=='success'){$('#reset_error').show();return false;}
$('#reset_error').hide();$('#reset_first').hide();$('#foot_step2').hide();$('#reset_confirm').show();$('#foot_step2_login').show();return true;}catch(e){error.log(e);}},deleteAccountConfirm:function(md5){try{var password='';if($('#delete_account_password').length==1){password=$('#delete_account_password').val();password=password.trim();}
var checkForm='';if($('#checkForm').length==1){checkForm=$('#checkForm').val();}
var data='&password='+encodeURIComponent(password)+'&md5='+encodeURIComponent(md5)+'&checkForm='+encodeURIComponent(checkForm);var request=sendRequest('/ajax/action.php','text','type=user_deleteConfirm'+data);var result=JSON.parse(request);if(result.error.length>0){www.drawFormResult('delete_result','form_error',gettext('Veuillez vérifier votre mot de passe.'));}else{www.drawFormResult('delete_result','form_success',gettext('Votre compte vient d\'être supprimé.'));user.logout();}
return true;}catch(e){error.log(e);}},block:function($div,friend_id,data){if(USER.USER_ID===0){modal.open('/lightbox/login.php');}
api.call('friend.block',{friend_id:friend_id},function(result){if(result===true){if($div){$div.data('blocked',1).text(gettext('Débloquer'));}
Events.trigger(Events.user.blockFriend,{id:friend_id});}});return true;},unblock:function($div,friend_id,data){api.call('friend.unblock',{friend_id:friend_id},function(result){if(result===true){if($div){$div.data('blocked',0).text(gettext('Bloquer'));}
Events.trigger(Events.user.unblockFriend,{id:friend_id});}});return true;}};};
if(typeof userSetting=="undefined"){var userSetting={set:function(data,notify){try{if(USER.USER_ID==0){return false;}
var newSetting=$.extend(true,{},USER.SETTING,data);if(JSON.stringify(newSetting)!=JSON.stringify(USER.SETTING)){var notify=notify||false;USER.SETTING=newSetting;api.call({method:'user.setSettings',data:{settings:data},success:function(){Events.trigger(Events.user.settingChanged,{notify:notify});}});}
return true;}catch(e){error.log(e);}}}};
var twitter={isLinked:function(){if(typeof USER.TWITTER.TOKEN!='undefined'&&USER.TWITTER.TOKEN!=''){return true;}
return false;},link:function(redirect){redirect=redirect||'';document.location.href='http://'+SETTING_HOST+'/twitter.php?callback_url='+encodeURIComponent('http://'+SETTING_HOST+'/'+redirect);return true;},unlink:function(){if(confirm(gettext('Êtes-vous sûr de vouloir dissocier vos comptes Deezer et %1$s ?',{sprintf:['Twitter']}))){api.call('twitterapi.unlinkAccount',{},function(result){if(result==true){delete USER.TWITTER.TOKEN;if(www.getCurrentPageType()=='account'){$('#page_account_share_twitter').removeClass('active');$('#page_account_share_twitter_title > div > span').removeClass('active');$('#page_account_share_twitter_title > div > a').css('display','none');}}});}
return true;},shareEnable:function(){if(USER.USER_ID==0)return false;if(typeof USER.TWITTER.TOKEN=='undefined'||USER.TWITTER.TOKEN=='')return false;if(typeof USER.SETTING.twitter=='undefined')return true;if(typeof USER.SETTING.twitter.share_share=='undefined')return true;if(!USER.SETTING.twitter.share_share)return false;return true;},commentEnable:function(){if(USER.USER_ID==0)return false;if(typeof USER.TWITTER.TOKEN=='undefined'||USER.TWITTER.TOKEN=='')return false;if(typeof USER.SETTING.twitter=='undefined')return true;if(typeof USER.SETTING.twitter.share_comment=='undefined')return true;if(!USER.SETTING.twitter.share_comment)return false;return true;}};
var lastfm={isLinked:function(){if(typeof USER.LASTFM.TOKEN!='undefined'&&USER.LASTFM.TOKEN!=''){return true;}
return false;},link:function(){document.location.href='http://www.last.fm/api/auth/?api_key=049131564a8f161381fc0da711a69a16';return true;},unlink:function(){try{api.call('lastfm.unlinkAccount',{},function(result){if(result==true){delete USER.LASTFM.TOKEN;if(www.getCurrentPageType()=='account'){$('#page_account_share_lastfm').removeClass('active');$('#page_account_share_lastfm_title > div > span').removeClass('active');$('#page_account_share_lastfm_title > div > a').css('display','none');}}});return true;}catch(e){error.log(e);}}};
if(typeof im=='undefined'){var im={isInit:false,loading:false,start:0,nb:10,allLoaded:false,last:false,init:function(){im.isInit=true;im.$modele_message=$('#tpl_instant_messenger');Events.subscribe(Events.live.newMessage,function(evt,params){var data=new Array();data.push({'MESSAGE_ID':params.MESSAGE_ID,'AUTHOR':{'USER_ID':params.USER_ID_FROM,'USER_PICTURE':params.USER_PICTURE_FROM,'BLOG_NAME':params.USER_NAME_FROM},'MESSAGE':params.MESSAGE,'READ':0,'DATE':Math.floor(new Date().getTime()/1000)});if(im.friend_id==params.USER_ID_FROM){im.drawMessage(data,false);}});return true;},chat:function(friend_id){if(USER.USER_ID===0){www.goToConnection();return false;}
if(!im.isInit){im.init();}
im.friend_id=friend_id;im.start=0;im.nb=25;im.allLoaded=false;im.last=false;im.$modal=$('#modal_instant_messenger');im.$form=$('#form_instant_messenger');im.$panel=$('.tinyscroll_container',im.$modal);im.$list_messenger=$('.list-messages',im.$modal);im.$input=$('#instant_messenger_input');im.$panel.bind('jsp-scrolling',function(event,pos){if(pos==0&&!im.loading&&!im.allLoaded){im.start+=10;im.loadMessage(im.start,im.nb)}}).tinyscrollbar();im.loadMessage(im.start,im.nb);im.$input.focus();return true;},loadMessage:function(start,nb){im.loading=true;api.call('message.getList',{'friend_id':im.friend_id,'start':start,'nb':nb},function(result){if((im.start+im.nb)>result.total){im.allLoaded=true;}
im.drawMessage(result.data.reverse(),true);});return true;},drawMessage:function(data,prepend){var $display_line=$('<div></div>');for(var i=0;i<data.length;i++){if((i>0&&(data[i].DATE-data[(i-1)].DATE)<1000&&data[i].AUTHOR.USER_ID==data[(i-1)].AUTHOR.USER_ID)||(!prepend&&(data[i].DATE-im.last.DATE)<1000&&data[i].AUTHOR.USER_ID==im.last.AUTHOR.USER_ID)){if(prepend){$('.message',$display_line).last().html($('.message',$display_line).last().html()+'<br>'+data[i].MESSAGE);}else{$('.message',im.$list_messenger).last().html($('.message',im.$list_messenger).last().html()+'<br>'+data[i].MESSAGE);}}else{$display_line.append(im.appendMessage(data[i]));}
im.last=data[i];}
var $line=$display_line.clone().children();if(prepend){im.$list_messenger.prepend($line);}else{im.$list_messenger.append($line);}
setTimeout(function(){im.$panel.tinyscrollbar_update('bottom');},300);im.loading=false;api.call('message.markAsRead',{'friend_id':im.friend_id});im.$input.focus();return true;},appendMessage:function(message){$item=im.$modele_message.clone().attr('id','im_'+message.MESSAGE_ID).show();if(message.AUTHOR.USER_ID!=USER.USER_ID){$item.removeClass('author').addClass('friend');}
$('img',$item).attr('src',SETTING_DOMAIN_IMG+'/user/'+message.AUTHOR.USER_PICTURE+'/80x80-000000-80-0-0.jpg');$('.message',$item).text(message.MESSAGE);return $item;},post:function(message){if(USER.USER_ID==0){return false;}
if(message==''){return false;}
api.call('message.post',{'friend_id':im.friend_id,'message':message},function(result){var data=[];data.push({'MESSAGE_ID':result,'AUTHOR':{'USER_ID':USER.USER_ID,'USER_PICTURE':USER.USER_PICTURE,'BLOG_NAME':USER.BLOG_NAME},'MESSAGE':message,'READ':0,'DATE':Math.floor(new Date().getTime()/1000)});im.drawMessage(data,false);});return true;}}};
(function($){$.cover=$.cover||{};$.cover.pane={options:{cover_size:null,ratio:1,padding:5,between:10,max_line:null,onresize:function(){}}}
$.fn.coverPane_resize=function(){return $(this).data('cpane').onResize();};$.fn.coverPane_update=function(){return $(this).data('cpane').refresh();};$.fn.coverPane_destroy=function(){return $(this).data('cpane').destroy();}
$.fn.coverPane=function(options){var options=$.extend({},$.cover.pane.options,options);this.each(function(){$(this).data('cpane',new coverPane($(this),options));});return this;}
function coverPane(root,options){var oSelf=this;function init(){oSelf.refresh();Events.subscribe(Events.layout.resize,oSelf.onResize);return true;}
this.onResize=function(){if(!root.is(':visible')){return;}
if(root.closest('body').length==0){Events.unsubscribe(Events.layout.resize,oSelf.onResize);return false;}
var content_w=root.width();nb=Math.ceil(content_w/options.cover_size);if(nb>options.covers.length){nb=options.covers.length;}
size=Math.floor(content_w/nb)-(((nb-1)*options.between)/nb)-((2*options.padding)/nb);if(size>options.cover_size){size=options.cover_size;}
size=Math.floor(size);var size_h=Math.floor(size*options.ratio);options.img.css({'width':size,'height':size_h,'box-sizing':'border-box'});var top=options.padding;var left=options.padding;var line=0;options.covers.each(function(i,item){i=i+1;if(line==options.max_line){$(item).hide();return;}
$(item).css({'top':top,'left':left,'width':size}).show();left+=size+options.between;if(((i)%nb)==0&&i<options.covers.length){line+=1;if(line==options.max_line){return;}
left=options.padding;top+=size_h+options.between+options.label_size;}});root.css('height',top+size_h+options.padding+options.label_size);options.onresize();}
this.refresh=function(){options.covers=$('.block_cover',root);options.img=$('.block_cover .img_main',root);oSelf.onResize();return true;}
this.destroy=function(){Events.unsubscribe(Events.layout.resize,oSelf.onResize);return true;}
return init();}})(jQuery);;
(function($){$.responsiveCover=$.responsiveCover||{};$.responsiveCover={options:{cover_width:null,cover_height:null,ratio:1,gap:5,max_line:null,full_last_line:false,onresize:function(){}}}
$.fn.responsiveCover_resize=function(){return($(this).data('cpane')!=null)?$(this).data('cpane').onResize():false;};$.fn.responsiveCover_update=function(){return($(this).data('cpane')!=null)?$(this).data('cpane').refresh():false;};$.fn.responsiveCover_destroy=function(){return($(this).data('cpane')!=null)?$(this).data('cpane').destroy():false;}
$.fn.responsiveCover_display_status=function(){return($(this).data('cpane')!=null)?$(this).data('cpane').displayStatus():false;}
$.fn.responsiveCover=function(options){var options=$.extend({},$.responsiveCover.options,options);this.each(function(){$(this).data('cpane',new responsiveCover($(this),options));});return this;}
function responsiveCover(root,options){var oSelf=this;function init(){root.css({'margin-left':'-'+options.gap+'px','margin-top':'-'+options.gap+'px','height':'auto','overflow':'visible'});if(options.cover_width>options.cover_height){options.ratio=options.cover_width/options.cover_height;}
if(options.cover_height>options.cover_width){options.ratio=options.cover_height/options.cover_width;}
if(typeof options.max_line==='number'){root.css('overflow','hidden');}
oSelf.refresh();Events.subscribe(Events.layout.resize,oSelf.onResize);return true;}
this.onResize=function(){if(!root.is(':visible')){return;}
if(root.closest('body').length==0){Events.unsubscribe(Events.layout.resize,oSelf.onResize);return false;}
var root_w=root.width();var nb_per_row=Math.ceil(root_w/options.cover_width);var cover_w=root_w/nb_per_row;var columns_width=null;if(cover_w>options.cover_width){cover_w=options.cover_width;}
if(typeof oSelf.nb_per_row==='undefined'||oSelf.nb_per_row!==nb_per_row){oSelf.nb_per_row=nb_per_row;columns_width=(cover_w/root_w)*100;options.covers.css('width',columns_width+'%');}
if(options.ratio>0){options.covers.each(function(){$(this).find('.thumbnail').first().css({'height':Math.round(((cover_w-options.gap)*options.ratio)-2)});});if(typeof options.max_line==='number'){root.css({'height':options.covers.last().outerHeight()*options.max_line+'px'});}}
if(options.full_last_line&&options.max_line===null){var crop_height='auto';var overflow='visible';if(options.covers.length%nb_per_row>0&&options.covers.length>nb_per_row){crop_height=(options.covers.last().outerHeight()*Math.floor(options.covers.length/nb_per_row))+'px';overflow='hidden';}
root.css({'height':crop_height,'overflow':overflow});}
options.onresize({'columns':options.covers,'columnsWidth':columns_width});}
this.displayStatus=function(){var data={};data.overflow=root.css('overflow');data.hiddenCover=0;if(data.overflow=='hidden'){if(options.max_line!==null){data.hiddenCover=options.covers.length-(oSelf.nb_per_row*options.max_line);}else if(options.full_last_line){data.hiddenCover=options.covers.length%oSelf.nb_per_row;}}
return data;}
this.refresh=function(){options.covers=root.children(':visible');options.covers.css({'padding-left':options.gap+'px','padding-top':options.gap+'px','max-width':options.cover_width+'px'});oSelf.nb_per_row=0;oSelf.onResize();return true;}
this.destroy=function(){root.css({'margin-left':'','margin-top':'','overflow':'','height':''}).empty();Events.unsubscribe(Events.layout.resize,oSelf.onResize);return true;}
return init();}})(jQuery);;
if(typeof hotkeys=="undefined"){var hotkeys={shortcuts:{},settings:{type:'keydown',propagate:false,disable_input:true,target:document,keycode:false,template:null,dom:{container:'#hotkeys',mapping:'#hotkeys_mapping',template:'#hotkeys_template'}},shift_nums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":"\"",",":"<",".":">","/":"?","\\":"|"},special_keys:{'esc':27,'escape':27,'tab':9,'space':32,'return':13,'enter':13,'backspace':8,'scrolllock':145,'scroll_lock':145,'scroll':145,'capslock':20,'caps_lock':20,'caps':20,'numlock':144,'num_lock':144,'num':144,'pause':19,'break':19,'insert':45,'home':36,'delete':46,'end':35,'pageup':33,'page_up':33,'pu':33,'pagedown':34,'page_down':34,'pd':34,'left':37,'up':38,'right':39,'down':40,'f1':112,'f2':113,'f3':114,'f4':115,'f5':116,'f6':117,'f7':118,'f8':119,'f9':120,'f10':121,'f11':122,'f12':123},icons:{"up":"↑","down":"↓","left":"←","right":"→","shift":"⇧","enter":"⏎"},handleSeekPosition:function(position){if(typeof inc!='float'){position=parseFloat(position);}
if(position<=0.0||position>=1.0){return false;}
dzPlayer.control.seek(position);return true;},init:function(){hotkeys.add("Space",function(){dzPlayer.control.togglePause();},{label:gettext('Lecture/Pause'),size:2});hotkeys.add("Enter",function(){var current_datagrid=$('.datagrid_master');if(current_datagrid.length>0){datagrid.action(current_datagrid,['play',$('')]);}
return false;},{label:gettext('Lire les titres présents sur la page'),size:2});hotkeys.add("S",function(){$('#menu_search').focus();},{label:gettext('Rechercher')});for(var _key=0;_key<=9;_key++){hotkeys.add(_key.toString(),function(e,key){var position=parseFloat(key)/10;if(position==0.0){position=0.00001;}
return hotkeys.handleSeekPosition(position);},{label:gettext('Aller à la position'),size:2,shortcut:"0...9"});}
hotkeys.add("Left",function(){if(!dzPlayer.isPlaying()){dzPlayer.control.play();}
var position=((dzPlayer.getPosition()/dzPlayer.getDuration())-0.05).toFixed(3);hotkeys.handleSeekPosition(position);},{label:gettext('Reculer')});hotkeys.add("Right",function(){if(!dzPlayer.isPlaying()){dzPlayer.control.play();}
var position=((dzPlayer.getPosition()/dzPlayer.getDuration())+0.05).toFixed(3);hotkeys.handleSeekPosition(position);},{label:gettext('Avancer')});hotkeys.add("R",function(){hotkeys.handleSeekPosition(0.00001);return true;},{label:gettext('Rejouer le titre')});hotkeys.add("Shift+Left",function(){dzPlayer.control.prevSong();},{label:gettext('Lire le titre précédent')});hotkeys.add("Shift+Right",function(){dzPlayer.control.nextSong();},{label:gettext('Lire le titre suivant')});hotkeys.add("M",function(){dzPlayer.control.mute(!dzPlayer.isMuted())},{label:gettext('Silence')});hotkeys.add("Shift+Up",function(){var current_volume=dzPlayer.getVolume();var volume=(parseFloat(dzPlayer.getVolume())+0.1).toFixed(2);if(volume>1.0){volume=1.0;}
dzPlayer.control.setVolume(volume);},{label:gettext('Augmenter le volume')});hotkeys.add("Shift+Down",function(){var volume=(parseFloat(dzPlayer.getVolume())-0.1).toFixed(2);if(volume<=0.0){dzPlayer.control.mute();volume=0.0;}
dzPlayer.control.setVolume(volume);},{label:gettext('Baisser le volume')});hotkeys.add("L",function(){if(dzPlayer.getPlayerType()!=='ads'&&dzPlayer.getPlayerType()!=='jingle'&&dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_SONG){if(userData.isFavorite('song',dzPlayer.getCurrentSong('SNG_ID'))){favorite.remove({type:'song',id:dzPlayer.getCurrentSong('SNG_ID')});}else{favorite.add({type:'song',id:dzPlayer.getCurrentSong('SNG_ID')});}}
return true;},{label:gettext('Ajouter le titre aux Coups de cœur')});hotkeys.add("Shift+R",function(){dzPlayer.control.setRepeat((dzPlayer.getRepeat()==2?0:dzPlayer.getRepeat()+1));return true;},{label:gettext('Mode de répétition')});hotkeys.add("H",function(){hotkeys.buildKeyMapping();},{label:gettext('Afficher les raccourcis clavier')});},add:function(_keys,callback,options){settings=$.extend(hotkeys.settings,options);var target=settings.target;if(typeof settings.target=='string'){target=document.getElementById(settings.target);}
_keys=_keys.toLowerCase();var func=function(e){e=e||window.event;if(e.keyCode){code=e.keyCode;}else if(e.which){code=e.which;}
if(settings.disable_input){var element;if(e.target)element=e.target;else if(e.srcElement)element=e.srcElement;if(element.nodeType==3)element=element.parentNode;if(element.tagName=='INPUT'||element.tagName=='TEXTAREA'){if(code==27){element.blur();}
return;}}
var ch=String.fromCharCode(code).toLowerCase();if(code==188)ch=",";if(code==190)ch=".";if(code==224)ch="0";if(code==38)ch="1";if(code==233)ch="2";if(code==34)ch="3";if(code==39)ch="4";if(code==40)ch="5";if(code==45||code==167)ch="6";if(code==232)ch="7";if(code==95||code==33)ch="8";if(code==231)ch="9";var keys=_keys.split("+");var kp=0;var modifiers={shift:{required:false,pressed:false},ctrl:{required:false,pressed:false},alt:{required:false,pressed:false},meta:{required:false,pressed:false}};if(e.ctrlKey)modifiers.ctrl.pressed=true;if(e.shiftKey)modifiers.shift.pressed=true;if(e.altKey)modifiers.alt.pressed=true;if(e.metaKey)modifiers.meta.pressed=true;for(var i=0;k=keys[i],i<keys.length;i++){if(k=='ctrl'||k=='control'){kp++;modifiers.ctrl.required=true;}else if(k=='shift'){kp++;modifiers.shift.required=true;}else if(k=='alt'){kp++;modifiers.alt.required=true;}else if(k=='meta'){kp++;modifiers.meta.required=true;}else if(k.length>1){if(hotkeys.special_keys[k]==code)kp++;}else if(settings.keycode){if(settings.keycode==code)kp++;}else{if(ch==k)kp++;else{if(hotkeys.shift_nums[ch]&&e.shiftKey){ch=hotkeys.shift_nums[ch];if(ch==k)kp++;}}}}
if(kp==keys.length&&modifiers.ctrl.pressed==modifiers.ctrl.required&&modifiers.shift.pressed==modifiers.shift.required&&modifiers.alt.pressed==modifiers.alt.required&&modifiers.meta.pressed==modifiers.meta.required){callback(e,_keys);if(!settings.propagate){e.cancelBubble=true;e.returnValue=false;if(e.stopPropagation){e.stopPropagation();e.preventDefault();}
return false;}}}
var event_type=settings.type;if(parseInt(_keys)>=0){event_type='keypress';}
hotkeys.shortcuts[_keys]={keys:_keys,callback:func,target:target,event:event_type,data:options};if(target.addEventListener)target.addEventListener(event_type,func,false);else if(target.attachEvent)target.attachEvent('on'+event_type,func);else target['on'+event_type]=func;},remove:function(keys){keys=keys.toLowerCase();var binding=hotkeys.shortcuts[keys];delete(hotkeys.shortcuts[keys]);if(!binding)return;var type=binding.event;var target=binding.target;var callback=binding.callback;if(target.detachEvent)target.detachEvent('on'+type,callback);else if(target.removeEventListener)target.removeEventListener(type,callback,false);else target['on'+type]=false;},getKeyIcon:function(key){if(typeof hotkeys.icons[key]!=='undefined'){return hotkeys.icons[key];}
if(key==='space'){return gettext('Espace');}
return ucfirst(key);},buildKeyMapping:function(){if(this.settings.template===null){this.settings.template=Handlebars.templates['hotkeys'];}else{hotkeys.showHideKeyMapping();return false;}
var data=[];var numeric_keys=false;for(var hotkey in hotkeys.shortcuts){if(!hotkeys.shortcuts.hasOwnProperty(hotkey)){continue;}
var shortcut=hotkeys.shortcuts[hotkey];if(parseInt(hotkey)>=0&&parseInt(hotkey)<=9){if(numeric_keys){continue;}
numeric_keys=true;}
var hotkey_shortcut=(typeof shortcut.data.shortcut!='undefined'?shortcut.data.shortcut:'');var icon_size=(typeof shortcut.data.size!='undefined'?shortcut.data.size:1);var hotkey_shortcut_keys=hotkey.split("+");var shortcut_icon=[];if(hotkey_shortcut_keys.length==1){var shortcut_key=hotkey_shortcut!=''?hotkey_shortcut:hotkey;shortcut_icon.push({'text':hotkeys.getKeyIcon(shortcut_key),'className':icon_size==2?'double':'single'});}else{if(hotkey_shortcut_keys.length>0){for(var shortcut_key in hotkey_shortcut_keys){if(!hotkey_shortcut_keys.hasOwnProperty(shortcut_key)){continue;}
shortcut_icon.push({'text':hotkeys.getKeyIcon(hotkey_shortcut_keys[shortcut_key]),'className':''});}}}
data.push({'shortcut':hotkey_shortcut,'icon':shortcut_icon,'label':shortcut.data.label});}
var template=hotkeys.settings.template(data);$.when($(this.settings.dom.mapping).append(template)).then(hotkeys.showHideKeyMapping());return true;},showHideKeyMapping:function(){var container=$(this.settings.dom.container);var isOpened=container.hasClass('opened');container.toggleClass('opened',!isOpened);return false;}}};
if(typeof gigs=='undefined'){var gigs={init:function(){try{if(USER.USER_ID===0){Events.ready(Events.user.userReady,gigs.init);return false;}
Events.subscribe(Events.navigation.page_displayed,function(evt,params){if(params.path.substring(0,7)!=='/artist'){return;}
gigs.checkOnTour('artist_page');});return true;}catch(e){error.log(e);}},load:function(callback){try{api.call('songkick.getGeoEvents',{USER_ID:USER.USER_ID},function(data){USER.ON_TOUR=data;callback();});}catch(e){error.log(e);}},checkOnTour:function(){try{if(typeof USER.ON_TOUR==='undefined'){gigs.load(function(){gigs.checkOnTour();});return false;}
var art_id=artist.id;if(typeof USER.ON_TOUR[art_id]==='undefined'){return false;}
Events.trigger(Events.gigs.display,{art_id:art_id});return true;}catch(e){error.log(e);}},goToEvents:function(art_id){try{if(typeof art_id==='undefined'){return false;}
var context='artist_page';tracking.track('ontour_click',{art_id:art_id,type:context});window.open('/events/'+art_id);return true;}catch(e){error.log(e);}}};};
if(typeof preview==='undefined'){var preview={timer:0,active:false,naturalFinish:false,$el:null,init:function($el){try{var data=$el.data();var type;var id;if(typeof data.type==='undefined'||typeof data.id==='undefined'){return false;}
if(dzPlayer.getPlayerType()==='ads'||dzPlayer.getPlayerType()==='jingle'){return false;}
if(OFFLINE){return false;}
preview.$el=$el.addClass('preview');type=data.type;id=data.id;if(typeof data.preview!=='undefined'&&data.preview!=1){preview.play(data.preview,id);return true;}
switch(type){case'album':api.call('song.getListByAlbum',{ALB_ID:id,NB:1},function(result){if(typeof result.data==='undefined'||result.data.length==0||typeof result.data[0].MD5_ORIGIN==='undefined'){preview.$el.removeClass('preview');return false;}
preview.play(result.data[0],id);});break;case'song':api.call('song.getData',{SNG_ID:id,COUNTRY:COUNTRY},function(result){if(result.MD5_ORIGIN==='undefined'){preview.$el.removeClass('preview');return false;}
preview.play(result,id);});break;case'playlist':api.call('playlist.getSongs',{PLAYLIST_ID:id,COUNTRY:COUNTRY,NB:1},function(result){if(typeof result.data==='undefined'||result.data.length==0||typeof result.data[0].MD5_ORIGIN==='undefined'){preview.$el.removeClass('preview');return false;}
preview.play(result.data[0],id);});break;case'radio':api.call('radio.getSongs',{RADIO_ID:id,NB:1},function(result){if(typeof result.data==='undefined'||result.data.length==0||typeof result.data[0].MD5_ORIGIN==='undefined'){preview.$el.removeClass('preview');return false;}
preview.play(result.data[0],id);});break;case'artist':api.call('smart.getSmartRadio',{ART_ID:id,LIMIT:1},function(result){if(typeof result.data==='undefined'||typeof result.data.length==='undefined'||result.data.length==0||typeof result.data[0].MD5_ORIGIN==='undefined'){preview.$el.removeClass('preview');return false;}
preview.play(result.data[0],id);});break;case'show':api.call('episode.getListByShow',{SHOW_ID:id,LIMIT:1},function(result){if(typeof result.data==='undefined'||typeof result.data.length==='undefined'||result.data.length==0||typeof result.data[0].MD5_ORIGIN==='undefined'){preview.$el.removeClass('preview');return false;}
preview.play(result.data[0],id);});break;}
return true;}catch(e){error.log(e);}},play:function(data,context_id){try{var md5=data;if(typeof data==='object'){if(right.checkSongAvailable(data)!=right.READABLE&&dzPlayer.getMediaType(data)===dzPlayer.MEDIA_TYPE_SONG){preview.$el.removeClass('preview');return false;}
md5=data.MD5_ORIGIN;}
preview.$el.data('preview',md5);if(dzPlayer.isPlaying()&&thumbnails.current_context_id===context_id){preview.stop();return false;}
dzPlayer.trigger('audioPlayer_startPreview',[md5]);preview.active=true;return true;}catch(e){error.log(e);}},finish:function(){try{if(preview.$el!==null){preview.active=false;preview.naturalFinish=true;preview.$el.removeClass('preview');}
return true;}catch(e){error.log(e);}},stop:function(){try{dzPlayer.trigger('audioPlayer_endPreview');preview.active=false;preview.$el.removeClass('preview');return true;}catch(e){error.log(e);}}};Events.subscribe(Events.player.finishPreview,preview.finish);};
(function(){'use strict';function _getContextName(type){var contextName={playlist:'playlist_page',search:'search_page',personal_song:'personalsong_page',downloads:'downloads_page',album:'album_page',artist_top:'artist_top',artist_exclu:'artist_exclu',discography_album:'artist_discography',loved:'loved_page',lovedpersonal:'loved_page',history:'history_page',radio:'radio_page',show:'show_page',episode:'episode_page'};if(typeof contextName[type]!=='undefined'){return contextName[type];}
return type;}
var thumbnails={push_mobile:0,init:function(){try{$(document).on('click','.thumbnail .options',function(e){if($(e.currentTarget).hasClass('options-react')){return;}
var data=$(e.currentTarget).data();var targetData=$(e.target).data();switch(targetData.action){case'options':var figure=$(e.currentTarget).parents('figure');figure.addClass('has-contextmenu');window.context_menu.open({target:e.target,id:data.id,type:data.type,is_thumbnail:true,position:data.position||'bottom',cover_type:targetData.cover_type,image:targetData.image,private_status:targetData.private_status,zoom_on_cover:targetData.zoom_on_cover,excludes:(targetData.excludes)?targetData.excludes.split(','):'',data:{PARENT_USER_ID:targetData.parent_user_id,ART_ID:targetData.art_id,SHOW_ID:targetData.show_id,SONG:{ART_ID:targetData.art_id,ALB_ID:(data.type==='album')?data.id:targetData.alb_id,LYRICS_ID:targetData.lyrics_id}},listen_context:{TYPE:_getContextName(data.type),ID:data.id}});break;case'playlist':window.context_menu.open({target:e.target,position:'bottom',type:data.type,view:'playlist',is_thumbnail:true,id:data.id});break;case'favorite':var action=(userData.isFavorite(data.type,data.id))?'remove':'add';favorite[action](data);break;case'lyrics':Events.subscribeOnce(Events.player.tracklist_changed,function(){dzPlayer.control.nextSong();menu.togglePanel('lyrics');});var params={type:'track',id:data.id,radio:false,context:{TYPE:_getContextName(data.type),ID:data.id}};if(dzPlayer.getPlayerType()!=='radio'){params.addNext=true;}
dzPlayer.play(params);break;default:break;}});return true;}catch(e){error.log(e);}},sentToMobileTracking:function($elt){try{if(typeof $elt!=='object'||$elt.children('.sent-to-mobile.active').length===0){return false;}
tracking.track('senttomobile_banner_display',{type:www.getCurrentPageType()});}catch(e){error.log(e);}},draw:function(options){if(typeof options!=='object'){return false;}
var returnFormat='object';if(typeof options.hash==='undefined'){returnFormat='string';options={hash:options};}
if(typeof options.hash.play!=='undefined'&&(typeof options.hash.id==='undefined'||typeof options.hash.type==='undefined')){return false;}
var data={id:options.hash.id||false,art_id:options.hash.art_id||false,alb_id:options.hash.alb_id||false,show_id:options.hash.show_id||false,lyrics_id:(typeof options.hash.lyrics_id!=='undefined')?options.hash.lyrics_id:0,parent_user_id:(typeof options.hash.parent_user_id!=='undefined')?Number(options.hash.parent_user_id):false,user_id:USER.USER_ID,type:options.hash.type||false,cover_play:options.hash.cover_play||false,play_context_id:options.hash.play_context_id||false,height:options.hash.height||false,height_img:options.hash.height_img||false,width:options.hash.width||false,width_img:options.hash.width_img||false,card:options.hash.card||false,pic_id:options.hash.pic_id,smartradio:options.hash.smartradio||'0',radio:options.hash.radio||false,stack_covers:options.hash.stack_covers||false,rights:options.hash.rights||false,play:options.hash.play||false,preview:options.hash.preview||false,play_context:options.hash.play_context||false,dropdown_align:options.hash.dropdown_align||'right',tracking:options.hash.tracking||false,tracking_tag:options.hash.tracking_tag||false,tracking_params:options.hash.tracking_params||false,border:options.hash.border||false,rounded:options.hash.rounded||false,responsive:options.hash.responsive||false,shadow:options.hash.shadow||false,ribbon:options.hash.ribbon||false,release_date:options.hash.release_date||false,play_force:options.hash.play_force||false,edit:options.hash.edit||false,unavailable:false,unavailable_message:false,closed:options.hash.closed||false,blocked:options.hash.blocked||'0',sent_to_mobile_banner:false,tooltip:options.hash.tooltip||false,eventClick:options.hash.eventClick||false,private_status:options.hash.private_status||'0',enable_preview:(typeof options.hash.enable_preview!=='undefined')?options.hash.enable_preview:true,available:(typeof options.hash.available!=='undefined')?options.hash.available:true,cover_link:(typeof options.hash.cover_link!=='undefined')?options.hash.cover_link:true,context_menu_excludes:[],context_menu_hide:options.hash.context_menu_hide||false,favorite_hide:options.hash.favorite_hide||false,image:options.hash.image||false,zoom_on_cover:options.hash.zoom_on_cover||false};var cover={smartradio:{cover_path:'artist',url_type:'radio',url_id:'artist/'+data.id},user:{url_type:'profile'},song:{cover_path:'cover',url_type:'track',url_id:data.id},album:{cover_path:'cover'},radio:{cover_path:'misc',url_type:'radio',url_id:'genre/'+data.id},show:{cover_path:'talk',url_type:'show',url_id:data.pic_id}};if(data.id&&data.type){data.is_favorite=userData.isFavorite(data.type,data.id);}
if(typeof options.hash.context_menu_excludes!=='undefined'){data.context_menu_excludes=(typeof options.hash.context_menu_excludes==='string')?JSON.parse((options.hash.context_menu_excludes).replace(/'/g,'"')):options.hash.context_menu_excludes;}
if(options.hash.cover_type){if(options.hash.cover_type==='cover'&&options.hash.pic_id===''){data.cover_type='playlist';}else{data.cover_type=options.hash.cover_type;}}else{data.cover_type=(typeof cover[data.type]!=='undefined'&&typeof cover[data.type].cover_path!=='undefined')?cover[data.type].cover_path:data.type;}
if(data.cover_play===true||data.cover_link===true){data.href_id=(typeof cover[data.type]!=='undefined'&&typeof cover[data.type].url_id!=='undefined')?cover[data.type].url_id:data.id;data.href_type=(typeof cover[data.type]!=='undefined'&&typeof cover[data.type].url_type!=='undefined')?cover[data.type].url_type:data.type;}
if(data.type==='show'){data.href_id=data.id;}
if(USER.DEVICES_COUNT===0){data.sent_to_mobile_banner=options.hash.sent_to_mobile_banner||false;}
if(data.release_date!==false){var releaseDate=new Date(data.release_date);data.ribbon=((releaseDate.getTime()/1000)+(30*86400)>SERVER_TIMESTAMP);}
if(data.rights){data.rights.RIGHTS=data.rights.DATA.RIGHTS||data.rights.RIGHTS;if(right.checkSongAvailable(data.rights)!==right.READABLE){data.play=false;data.unavailable=true;data.unavailable_message=right.getMessage(right.checkSongAvailable(data.rights));}}
if(data.available===false){data.play=false;data.unavailable=true;}
var img_size=(data.height_img===false?data.height:data.height_img)+'x'+(data.width_img===false?data.width:data.width_img);data.img_url=SETTING_DOMAIN_IMG+'/'+(data.stack_covers?data.cover:data.cover_type)+'/'+data.pic_id+'/'+img_size+'-000000-80-0-0.jpg';var generateThumbnail=new Handlebars.SafeString(Handlebars.templates.thumbnail(data));return(returnFormat==='string')?generateThumbnail.string:generateThumbnail;}};window.thumbnails=thumbnails;})();;
(function($){$.selectbox=$.selectbox||{};$.selectbox.options={data:[],label:'NAME',id:'ID',selectedIndex:-1,selectedId:-1,defaultLabel:'',align:'left',useHandlebarTemplate:true};$.fn.createSelectbox=function(opt){if($(this).prop('id')===''){return false;}
var options=$.extend({},$.selectbox.options,opt);if(options.data.length===0&&options.useHandlebarTemplate){return false;}
this.each(function(){$(this).data('stb',new Select($(this),options));});return this;};$.fn.selectItem=function(id){if(!$(this).data('stb')){return false;}
$(this).data('stb').selectItem(id);return this;};function Select(root,options){var oRoot=root;var label='';var item='';var list='';var currentSelectedId='';function create(){oRoot.addClass('selectbox dropdown');Handlebars.registerHelper('getSelectboxData',function(item_data,type){return item_data[options[type]];});if(options.selectedIndex>-1&&typeof options.data[options.selectedIndex]!='undefined'){options.defaultLabel=options.data[options.selectedIndex][options.label];currentSelectedId=options.data[options.selectedIndex][options.id];}
if(options.selectedId>-1){for(var d in options.data){if(!options.data.hasOwnProperty(d)){continue;}
if(options.data[d][options.id]==options.selectedId){options.defaultLabel=options.data[d][options.label];currentSelectedId=options.data[d][options.id];break;}}}
if(options.defaultLabel===''){options.defaultLabel=options.data[0][options.label];currentSelectedId=options.data[0][options.id];}
if(options.useHandlebarTemplate){var hbTemplate=Handlebars.templates['selectbox'];var content=hbTemplate(options);oRoot.html(content);}
toggle=$('> .dropdown-toggle',oRoot);list=$('> .dropdown-menu',oRoot);label=toggle.find('> .label');item=list.find('> li > a');if(options.align==='right'){list.addClass('pull-right');}
toggle.on('mousedown',openSelect);toggle.on('mouseup',clickBox);item.on('mousedown',clickSelect);}
function openSelect(){try{if(!list.is(':visible')){oRoot.addClass('opened');list.bind("mouseup",clickBox);$('body').trigger("mouseup");$('body').bind("mouseup",clickSelect);}else{closeSelect();}}catch(e){error.log(e);}}
function closeSelect(){try{if(list.is(':visible')){oRoot.removeClass('opened');list.unbind("mouseup",clickBox);$('body').unbind("mouseup",clickSelect);}}catch(e){error.log(e);}}
function clickBox(){return false;}
function clickSelect(btn){try{var elt=$(btn.currentTarget);if(elt.parents('#'+oRoot.prop('id')).length===0){closeSelect();return false;}
if(currentSelectedId!=elt.data('id')){var data=options.data[elt.data('index')];if(typeof data==='object'){label.text(data[options.label]);currentSelectedId=data[options.id];}else{data=elt.data();}
if(typeof options.callback==='string'){Event.trigger(options.callback,data);}
if(typeof options.callback==='function'){options.callback(data);}}
closeSelect();}catch(e){error.log(e);}}
this.selectItem=function(id){for(var d=0;d<options.data.length;d++){if(options.data[d][options.id]==id){label.text(options.data[d][options.label]);currentSelectedId=id;break;}}}
return create();}})(jQuery);;
(function(){'use strict';var register={init:function($form,redirect,tracking){try{if(typeof $form!=='object'){return false;}
redirect=redirect||false;tracking=tracking||{};var $register_form_age_input=$('#register_form_age_input',$form);var $register_form_gender_input=$('#register_form_gender_input',$form);var $input_to_check=$('[data-check]',$form);dzform.placeholder($input_to_check);$('#register_form_submit',$form).on('click',function(e){e.preventDefault();$('#register_form_submit',$form).attr('disabled','disabled');_register.onSubmit($form);if(dzform.canSubmit($form,$input_to_check,[_register.trackError,_register.showError],e)===false){_register.callbackError($form);return;}
user.register(redirect,{blogname:$('#register_form_username_input',$form).val(),email:$('#register_form_mail_input',$form).val(),password:$('#register_form_password_input',$form).val(),gender:$register_form_gender_input.val(),birthday_day:'01',birthday_month:'01',birthday_year:new Date().getFullYear()-$register_form_age_input.val(),callBackError:function(){_register.callbackError($form);},tracking_data:tracking});});$input_to_check.on('focus blur',function(e){dzform.checkField($(this),[_register.trackError,_register.showError],[_register.trackSuccess,_register.hideError],e);});var checkEmailDebounce=(window.debounce(function($key){dzform.checkEmailuniqAndSuggest($key,_register.hideError,_register.showError,_register.addSuggestion,_register.hideTipster);},50));$input_to_check.on('change input',function(){if($(this).data('check')==='emailuniq'){var $key=$(this);checkEmailDebounce($key);}else{dzform.checkField($(this),_register.showError,_register.hideError);}});$input_to_check.each(function(){var val=$(this).val().trim();if(!$(this).hasClass('has-placeholder')&&($(this).is('select')&&parseInt(val,10)!==0||!$(this).is('select')&&val.length!==0)){dzform.checkField($(this),_register.showError,_register.hideError);}});auth.init_register({register_options:{tracking:{tracking_data:{registration_type:tracking.registration_type||'deezer',platform:PLATFORM,context:'deezer'}}}},$form);Events.ready(Events.googleplus.ready,function(){googleplus.renderGGPlus('home_account_gp');});$('#home_account_fb').data('registerFacebook',1);}catch(e){error.log(e);}},track:function(data,status,callback){try{if(typeof callback!=='function'){callback=function(){};}
if(typeof data.tag!=='undefined'&&typeof data.properties!=='undefined'){data.properties.result=status;tracking.track(data.tag,data.properties,callback);return true;}}catch(e){error.log(e);}
return false;}};var _register={callbackError:function($form){try{$('#register_form_global_error',$form).show();$('#register_form_submit',$form).removeAttr('disabled').addClass('shake').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend',function(){$(this).removeClass('shake');});}catch(e){error.log(e.message,e.stack);}},onSubmit:function($form){$('#register_form_global_error',$form).hide();},trackError:function($key,error,event){var eventType=event?event.type:'unknown';tracking.trackFormEvent($key,eventType,error);},showError:function($key,error,evt,action){var message=error.message||'';action=action||'';evt=evt||{};if(evt.type==='focus'||evt.type==='blur'){return false;}
$key.data('val',false).off('mouseout mouseover');$key.parent().removeClass('has-success').addClass('has-error has-feedback');if($key.parents('form').data('type')==='form-page'){if(action==='over'){$('.form-control-error',$key.parent()).remove();$key.on('mouseover',function(){_register.showError($key,error,evt,'out');});return;}
if(action==='out'){$key.on('mouseout',function(){_register.showError($key,error,evt,'over');});}}
if($('.form-control-error',$key.parent()).length===1){$('.form-control-error',$key.parent()).text(message);}else{$key.parent().append('<div class="form-control-error">'+message+'</div>');}},trackSuccess:function($key,check,event){var eventType=event?event.type:'unknown';tracking.trackFormEvent($key,eventType);},hideError:function($key){$key.data('val',true).off('mouseout mouseover');$key.parent().removeClass('has-error').addClass('has-success');$('.form-control-error',$key.parent()).remove();},showTipster:function($key,message,action){if(message===''){return;}
if($('.form-control-tipster',$key.parent()).length===1){$('.form-control-tipster',$key.parent()).text(message);}else{$key.parent().append('<div class="form-control-tipster">'+message+'</div>');}
if(action){$('.form-control-tipster',$key.parent()).off('click').on('click',action);}},hideTipster:function($key){$('.form-control-tipster',$key.parent()).remove();},addSuggestion:function($key,message,suggestion){var action=function(){this.val(suggestion);_register.hideTipster(this);dzform.checkField(this,_register.showError,_register.hideError);};_register.showTipster($key,message,action.bind($key));}};window.register=register;})();;
(function(){'use strict';var login={init:function($form,redirect,isModal){try{if(typeof $form!=='object'){return false;}
redirect=redirect||false;var $input_to_check=$('[data-check]',$form);$input_to_check.each(function(){if($(this).val()!==''){dzform.checkField($(this),_login.showError,_login.hideError);}});dzform.placeholder($input_to_check);$('#login_form_submit',$form).on('click',function(e){e.preventDefault();$('#login_form_submit',$form).attr('disabled','disabled');_login.onSubmit();if(dzform.canSubmit($form,$input_to_check,_login.showError,_login.hideError)===false){_login.callbackGenericError($form);return;}
var email=$('#login_mail',$form).val();var login_result=user.login(email,$('#login_password',$form).val());if(login_result.success){window.storage.set('last_login_used',email,true,30);user.refreshPageAfterLogin(redirect);return true;}
var error=new dzError({name:'login_failed'});tracking.trackFormEvent($form,e.type,error);if(login_result.instant_auth){if(!isModal){modal.open('/lightbox/instant_auth?email='+encodeURIComponent(email));}else{_login.callbackInstantAuthError($form);return true;}}
_login.callbackGenericError($form);});$input_to_check.on('focus blur',function(e){dzform.checkField($(this),[_login.trackError,_login.showError],[_login.trackSuccess,_login.hideError],e);});$input_to_check.on('change input',function(e){dzform.checkField($(this),_login.showError,_login.hideError,e);});var lastLogin=window.storage.get('last_login_used');if(lastLogin){$('#login_mail',$form).val(lastLogin).trigger('change');;}
if(!isModal){$('#login_forgot_password').on('click',_login.forgetPassword);}
Events.ready(Events.googleplus.ready,function(){googleplus.renderGGPlus('home_account_gp');});$('#home_account_fb').data('loginFacebook',1);$('#home_account_fb').data('loginOnly',0);}catch(e){error.log(e);}}};var _login={onSubmit:function($form){$('#login_error',$form).hide();},callbackError:function($form){$('#login_form_submit',$form).removeAttr('disabled').addClass('shake').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend',function(){$(this).removeClass('shake');});$('#login_error',$form).show();$('#login_password',$form).val('');$('#login_error, #login_error_and_instant_auth',$form).hide();},callbackGenericError:function($form){_login.callbackError($form);$('#login_error',$form).show();},callbackInstantAuthError:function($form){_login.callbackError($form);$('#login_error_and_instant_auth',$form).show();},trackError:function($key,error,event){var eventType=event?event.type:'unknown';tracking.trackFormEvent($key,eventType,error);},showError:function($key,error,evt,action){var message=error.message||'';evt=evt||{};action=action||'';if(evt.type==='focus'||evt.type==='blur'){return false;}
$key.data('val',false).off('mouseout mouseover');$key.parent().removeClass('has-success').addClass('has-error');if($key.parents('form').data('type')==='form-page'){if(action==='over'){$('.form-control-error',$key.parent()).remove();$key.on('mouseover',function(){_login.showError($key,error,evt,'out');});return;}
if(action==='out'){$key.on('mouseout',function(){_login.showError($key,error,evt,'over');});}}
if($('.form-control-error',$key.parent()).length===1){$('.form-control-error',$key.parent()).text(message);}else{$key.parent().append('<span class="form-control-error '+(typeof $key.data('class-error')==='string'?$key.data('class-error'):'')+'">'+message+'</span>');}},trackSuccess:function($key,check,event){var eventType=event?event.type:'unknown';tracking.trackFormEvent($key,eventType);},hideError:function($key){$key.data('val',true).off('mouseout mouseover');$key.parent().removeClass('has-error').addClass('has-success');$('.form-control-error',$key.parent()).remove();},forgetPassword:function(){var email=$('#login_mail').data('val')===true?encodeURIComponent($('#login_mail').val()):'';modal.open('/password/reset?default_email='+email,true);tracking.track('unlogged_home_click',{type:'forgot_password'});}};window.login=login;})();;
(function(){'use strict';var signout={init:function($form){try{if(typeof $form!=='object'){return false;}
$('#signout_form_submit',$form).on('click',function(e){e.preventDefault();e.stopPropagation();$('#signout_form_submit',$form).attr('disabled','disabled');if($('#tester_phone_number').val()===''){return _signout.showError({text:gettext('Une erreur est survenue. Merci de vous assurer de la validité de votre numéro avant de réitérer votre demande.')});}
premium.test_phone({context:'loggedout'},_signout.showSuccess,_signout.showError);});}catch(e){error.log(e);}}};var _signout={showError:function(error){$('#signout_form_submit').removeAttr('disabled');var $key=$('#tester_phone_number');$key.parent().addClass('has-error').children('.form-control-error').remove();if(error.text!==''){$key.parent().append('<span id="tester_phone_number_msg" class="form-control-error">'+error.text+'</span>');}
return false;},showSuccess:function(result){$('#index_form').toggleClass('hidden');$('#index_confirm').toggleClass('hidden');setTimeout(function(){window.location.href='/login';},10000);}}
window.signout=signout;})();;
(function(){'use strict';var landing={init:function(){var info=document.getElementById('track');var page_bg=document.getElementById('page-bg');var img_big=SETTING_DOMAIN_IMG+'/cover/'+info.getAttribute('data-img')+'/1200x1200-000000-80-0-0.jpg';if(PLATFORM===false){new window.Blurred(page_bg).setUrl(img_big).setBlurStrength(7).render();}else{page_bg.style.backgroundImage='url('+img_big+')';page_bg.classList.add('blur-bg');}
var thumbnail=React.createFactory(window.DzrComponents.Thumbnail);React.render(thumbnail({id:Number(info.getAttribute('data-track-id')),play:true,type:'track',picture_type:'cover',md5:info.getAttribute('data-img'),display_size:false,width:250,height:250}),info);var fb_btn=document.getElementById('home_account_fb');fb_btn.addEventListener('click',function(){facebook.login({skip_onboarding:true});tracking.track('landing_click',{track_id:info.getAttribute('data-track-id'),name:info.getAttribute('data-track-name'),instance:'button'});});playercontrol.init();info.addEventListener('click',function(){tracking.track('landing_click',{track_id:info.getAttribute('data-track-id'),name:info.getAttribute('data-track-name'),instance:'track_cover'});});var header=document.getElementById('index-header');header.addEventListener('click',function(e){if(e.target.id==='login_button'||e.target.id==='signup_button'){tracking.track('landing_click',{track_id:info.getAttribute('data-track-id'),name:info.getAttribute('data-track-name'),instance:(e.target.id==='login_button'?'login':'register')});}});}};window.landing=landing;})();;
(function(){'use strict';var soon={init:function($form){try{if(typeof $form!=='object'){return false;}
var $input_to_check=$('[data-check]',$form);$input_to_check.each(function(){if($(this).val()!==''){dzform.checkField($(this),_soon.showError,_soon.hideError);}});dzform.placeholder($input_to_check);$('#soon_form_submit',$form).on('click',function(e){e.preventDefault();e.stopPropagation();$('#soon_form_submit',$form).attr('disabled','disabled');if(dzform.canSubmit($form,$input_to_check,_soon.showError,_soon.hideError)===false){_soon.callbackError($form);return false;}
$('#soon_form_post').submit();});$input_to_check.on('change input',function(){dzform.checkField($(this),_soon.showError,_soon.hideError);});}catch(e){error.log(e);}}};var _soon={callbackError:function($form){$('#soon_form_submit',$form).removeAttr('disabled');},showError:function($key,message,evt){message=message||'';evt=evt||'';$key.data('val',false).off('mouseout mouseover');$key.parent().removeClass('has-success').addClass('has-error');if($key.parents('form').data('type')==='form-page'){if(evt==='over'){$('.form-control-error',$key.parent()).remove();$key.on('mouseover',function(){_soon.showError($key,message,'out');});return;}
if(evt==='out'){$key.on('mouseout',function(){_soon.showError($key,message,'over');});}}
if($('.form-control-error',$key.parent()).length===1){$('.form-control-error',$key.parent()).text(message);}else{$key.parent().append('<span class="form-control-error '+(typeof $key.data('class-error')==='string'?$key.data('class-error'):'')+'">'+message+'</span>');}},hideError:function($key){$key.data('val',true).off('mouseout mouseover');$key.parent().removeClass('has-error').addClass('has-success');$('.form-control-error',$key.parent()).remove();}};window.soon=soon;})();;
(function(){'use strict';var button_multi_state={trad:{full:{active:gettext('Ajouté à ma bibliothèque'),active_favorite_friend:gettext('Suivi'),active_favorite_song:gettext('Ajouté aux Coups de cœur'),active_play:gettext('À l\'écoute'),active_play_artist:gettext('Mix'),active_play_user:gettext('FLOW'),add:gettext('Ajouter à ma bibliothèque'),add_favorite_friend:gettext('Suivre'),add_favorite_song:gettext('Ajouter aux Coups de cœur'),add_play:gettext('Écouter'),add_play_artist:gettext('Mix'),add_play_user:gettext('FLOW'),'default':gettext('Ajouter à ma bibliothèque'),default_favorite_friend:gettext('Suivre'),default_favorite_song:gettext('Ajouter aux Coups de cœur'),default_play:gettext('Écouter'),default_play_artist:gettext('Mix'),default_play_user:gettext('FLOW'),hover:gettext('Retirer de ma bibliothèque'),hover_favorite_friend:gettext('Ne plus suivre'),hover_favorite_song:gettext('Retirer des Coups de cœur'),hover_play:gettext('Pause'),hover_play_artist:gettext('Mix'),hover_play_user:gettext('FLOW'),paused_play:gettext('Pause'),paused_play_artist:gettext('Mix'),paused_play_user:gettext('FLOW'),resume_play:gettext('Reprendre'),resume_play_artist:gettext('Mix'),resume_play_user:gettext('FLOW')},standard:{active:gettext('Ajouté'),add:gettext('Ajouter'),'default':gettext('Ajouter'),hover:gettext('Retirer')}},draw:function(options){try{if(typeof options!=='object'){return false;}
var returnFormat='object';if(typeof options.hash==='undefined'){returnFormat='string';options={hash:options};}
var generatedButton=false;var data={status:'',icon:'favorite',icon_align:options.hash.icon_align||'left',elId:options.hash.elId||false,type:options.hash.type||'',action:options.hash.action||'favorite',display:options.hash.display||'',color:options.hash.color||'default',color_equalizer:options.hash.color_equalizer||'default',id:options.hash.id||'',size:options.hash.size||'',wording:options.hash.wording||'standard',play_context:options.hash.play_context||false,cancel_hover:options.hash.cancel_hover||false,radio:options.hash.radio||false,context:options.hash.context||false,tracking:options.hash.tracking||false,tracking_tag:options.hash.tracking_tag||options.hash.trackingTag||false,tracking_id:options.hash.tracking_card_id||options.hash.trackingId||false,tracking_params:options.hash.tracking_params||options.hash.trackingParams||false,enable_delegation:(typeof options.hash.enable_delegation==='boolean')?options.hash.enable_delegation:true};data.txtDefault=button_multi_state.getWording(data,'add');data.txtActive=button_multi_state.getWording(data,'active');data.txtHover=button_multi_state.getWording(data,'hover');data.txtPaused=button_multi_state.getWording(data,'paused');data.txtResume=button_multi_state.getWording(data,'resume');data.txtTooltip=button_multi_state.getWording(data,'add','full');data.tooltip=(data.wording==='standard'||data.wording==='none');if(data.action==='favorite'){var icon_custom={friend:'follow',song:'favorite'};if(typeof icon_custom[data.type]!=='undefined'){data.icon=icon_custom[data.type];}}else{data.icon=data.action;}
if(data.action==='play'&&data.color===false){data.icon_align='right';}
Events.ready(Events.user.userReady,function(){if(data.action!=='favorite'){return false;}
data.tracking_tag=(data.tracking==='feed')?'add_to_favorite':data.tracking_tag;if(userData.isFavorite(data.type,data.id)){data.tracking_tag=(data.tracking==='feed')?'click_item':data.tracking_tag;data.status='active';if(data.tooltip){data.txtTooltip=button_multi_state.getWording(data,'hover','full');}
if(generatedButton===false){return true;}
var updateButton=$('button[data-id="'+data.id+'"][data-type="'+data.type+'"][data-action="'+data.action+'"]');if(updateButton.length>0){updateButton.addClass('active');if(data.tooltip){updateButton.prop('title',button_multi_state.getWording(data,'hover','full'));}}}});generatedButton=new Handlebars.SafeString(Handlebars.templates.button_multi_state(data));return(returnFormat==='string')?generatedButton.string:generatedButton;}catch(e){error.log(e);}},getWording:function(data,state,force_wording){try{var wording=force_wording||data.wording;if(wording==='none'){return'';}
if(button_multi_state.trad[wording][state+'_'+data.action+'_'+data.type]){return button_multi_state.trad[wording][state+'_'+data.action+'_'+data.type];}
if(button_multi_state.trad[wording][state+'_'+data.action]){return button_multi_state.trad[wording][state+'_'+data.action];}
return button_multi_state.trad[wording][state];}catch(e){error.log(e);}}};window.button_multi_state=button_multi_state;})();;
var onair={current_context_type:'track',current_context_id:0,push_mobile:0,init:function(){try{onair.$naboo_content=$('#naboo_content');onair.$selected_elements=[];Events.subscribe(Events.player.displayCurrentSong,onair.onTrackOnAir);Events.subscribe(Events.player.finish,onair.onFinish);Events.subscribe(Events.player.playing,onair.onPlay);Events.subscribe(Events.player.paused,onair.onPaused);Events.subscribe(Events.navigation.page_displayed,onair.onPageUpdate);Events.subscribe(Events.navigation.page_updated,onair.onPageUpdate);}catch(e){error.log(e);}},onFinish:function(){try{var nextSongInfo=dzPlayer.getNextSong();if(nextSongInfo==null){$.each(onair.$selected_elements,function(){if($(this).is('figure')){$('.play, .sent-to-mobile',$(this)).removeClass('active');}
if($(this).is('button')){$(this).removeClass('active resume cancel-hover evt-out');}});}
return true;}catch(e){error.log(e);}},onTrackOnAir:function(){try{if(dzPlayer.getContext()==null){return false;}
onair.current_context_type=dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK?'talkShow':'track';onair.current_context_id=dzPlayer.getContext('ID');if(dzPlayer.getContext('TYPE')!==''){onair.current_context_type=LOG_CONTEXT[dzPlayer.getContext('TYPE')];}
return true;}catch(e){error.log(e);}},onPlay:function(evt,playing){try{var currentSong=dzPlayer.getCurrentSong();if(!dzPlayer.isPaused()&&!dzPlayer.isPlaying()){playing=false;}
$.each(onair.$selected_elements,function(){if($(this).is('figure')){$('.play, .sent-to-mobile',$(this)).removeClass('active');}
if($(this).is('button')){$(this).removeClass('active paused cancel-hover evt-out');if(!playing){$(this).data('cancelHover',false);}else if($(this).is('[data-type="'+onair.current_context_type+'"][data-id="'+onair.current_context_id+'"]')&&$(this).data('cancelHover')){$(this).addClass('cancel-hover evt-out').data('cancelHover',false);}}});if(playing===false||currentSong===null||(typeof currentSong.SNG_ID==='undefined'&&typeof currentSong.EPISODE_ID==='undefined')||(Number(currentSong.SNG_ID)===0&&Number(currentSong.EPISODE_ID)===0)||dzPlayer.getPlayerType()==='ads'||dzPlayer.getPlayerType()==='jingle'){return false;}
var media_id=(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK?currentSong.EPISODE_ID:currentSong.SNG_ID);var media_parent_id=(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK?currentSong.SHOW_ID:currentSong.ALB_ID);var selector='.thumbnail[data-type="'+onair.current_context_type+'"][data-id="'+onair.current_context_id+'"]';if(onair.current_context_type==='album'||onair.current_context_type==='track'){selector='.thumbnail[data-type="song"][data-id="'+media_id+'"], .thumbnail[data-type="album"][data-id="'+media_parent_id+'"]';}
if(onair.current_context_type==='show'||onair.current_context_type==='episode'){selector='.thumbnail[data-type="episode"][data-id="'+media_id+'"], .thumbnail[data-type="show"][data-id="'+media_parent_id+'"]';}
onair.$selected_elements=$(selector,onair.$naboo_content);$('.play',onair.$selected_elements).removeClass('paused').addClass('active');var $btn_play=$('button[data-play="1"][data-type="'+onair.current_context_type+'"][data-id="'+onair.current_context_id+'"]',onair.$naboo_content);if($btn_play.length===1){onair.$selected_elements.push($btn_play.removeClass('paused').addClass('active'+(($btn_play.data('cancelHover'))?' cancel-hover evt-out':'')));}
thumbnails.sentToMobileTracking(onair.$selected_elements);return true;}catch(e){error.log(e);}},onPaused:function(){$.each(onair.$selected_elements,function(){if($(this).is('button')){if(dzPlayer.isPaused()){$(this).addClass('paused');}}});},onPageUpdate:function(){try{if(dzPlayer.isPlaying()){onair.onPlay(null,true);}
return true;}catch(e){error.log(e);}}};;
var ReactComponent=(function(console){'use strict';var console_copy=console;var _ReactComponent={files_loaded:{},files_currently_loading:{},setFileLoaded:function(component_path){var file_path=_ReactComponent.getFilePath(component_path);console.log('[ReactComponent] FILE LOADED',file_path);_ReactComponent.files_loaded[file_path]=true;if(typeof _ReactComponent.files_currently_loading[file_path]!=='undefined'){delete _ReactComponent.files_currently_loading[file_path];}},isFileLoaded:function(component_path){return typeof _ReactComponent.files_loaded[_ReactComponent.getFilePath(component_path)]==='boolean';},getFilePath:function(component_path){if(ENV==='DEV'){return SETTING_HOST_SITE+'/js/react/'+component_path+'.jsx';}
var package_name=component_path.split('/')[0];return SETTING_STATIC+'/js/min/react/'+package_name+'-v'+STATIC_VERSION+'.js';},load:function(url){var xhr;xhr=window.ActiveXObject?new window.ActiveXObject('Microsoft.XMLHTTP'):new XMLHttpRequest();xhr.open('GET',url,false);if('overrideMimeType'in xhr){xhr.overrideMimeType('text/plain');}
xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===0||xhr.status===200){JSXTransformer.exec(xhr.responseText);}else{throw new Error('Could not load '+url);}}};return xhr.send(null);},loadComponentFile:function(component_path){var file_path=_ReactComponent.getFilePath(component_path);if(typeof _ReactComponent.files_currently_loading[file_path]!=='undefined'){return false;}
if(_ReactComponent.isFileLoaded(component_path)){return false;}
console.log('[ReactComponent] [FILE] load component_path in file : '+file_path);_ReactComponent.files_currently_loading[file_path]=true;if(ENV==='DEV'){this.load(file_path);return true;}
var head=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.type='text/javascript';script.src=file_path;head.appendChild(script);return true;}};return{components:{},componentsToConstruct:{},componentsToInitialize:{},setDebug:function(active){if(active){console=console_copy;}else{console={log:function(){}};}},testLog:function(){console.log('Testing log display');},isComponentAvailable:function(component_path){return typeof ReactComponent.components[component_path]!=='undefined';},loadComponent:function(component_path,callback){console.log('[ReactComponent] try to load '+component_path);if(typeof ReactComponent.componentsToInitialize[component_path]!=='undefined'){console.log('[ReactComponent] '+component_path+' is here and needs to be initialized');var component_to_initialize=ReactComponent.componentsToInitialize[component_path];ReactComponent.exportComponent(component_path);var components_to_load=[];var i;for(i=0;i<component_to_initialize.requires.length;i++){var require_component_path=component_to_initialize.requires[i];if(ReactComponent.isComponentAvailable(require_component_path)){continue;}
components_to_load.push(require_component_path);}
console.log('[ReactComponent] '+component_path+' needs dependencies ? ',(components_to_load.length>0)?'yes':'no',components_to_load);if(components_to_load.length===0){callback();return true;}
var components_left=components_to_load.length;for(i=0;i<components_to_load.length;i++){ReactComponent._require(components_to_load[i],function(){components_left--;if(components_left===0){callback();}});}
return true;}
Events.ready('ReactComponent_load_'+component_path,callback);_ReactComponent.loadComponentFile(component_path);},exportComponent:function(component_path){console.log('[ReactComponent] Export Component',component_path);ReactComponent.componentsToConstruct[component_path]=true;ReactComponent.components[component_path]=(function(comp_path,comp_factory){return function(){var react_args=arguments;if(typeof ReactComponent.componentsToConstruct[comp_path]!=='undefined'){ReactComponent.constructComponent(comp_path,comp_factory,react_args);}
return ReactComponent.components[comp_path].apply(ReactComponent.components[comp_path],react_args);};})(component_path,ReactComponent.componentsToInitialize[component_path]);delete ReactComponent.componentsToInitialize[component_path];},constructComponent:function(component_path,component_factory){console.log('[ReactComponent] construct component',component_path);var dependencies=[];for(var i=0;i<component_factory.requires.length;i++){dependencies.push(ReactComponent.components[component_factory.requires[i]]);}
ReactComponent.components[component_path]=component_factory.factory.apply(component_factory.factory,dependencies);delete ReactComponent.componentsToConstruct[component_path];return true;},_require:function(component_path,callback){if(ReactComponent.isComponentAvailable(component_path)){callback.apply(window,[ReactComponent.components[component_path]]);return;}
ReactComponent.loadComponent(component_path,function(){ReactComponent._require(component_path,callback);});},require:function(component_path,callback){console.log('[ReactComponent] REQUIRE ',component_path);ReactComponent._require(component_path,callback);},define:function(component_path,requires,factory){if(!_ReactComponent.isFileLoaded(component_path)){_ReactComponent.setFileLoaded(component_path);}
console.log('[ReactComponent] '+component_path+' is defined !');ReactComponent.componentsToInitialize[component_path]={component_path:component_path,requires:requires,factory:factory};window.setZeroTimeout(function(){Events.resolve('ReactComponent_load_'+component_path);});},defineMixin:function(mixin_path,factory){if(!_ReactComponent.isFileLoaded(mixin_path)){console.log('[ReactComponent] FILE LOADED'+_ReactComponent.getFilePath(mixin_path));}
_ReactComponent.setFileLoaded(mixin_path);ReactComponent.components[mixin_path]=factory();console.log('[ReactComponent] mixin '+mixin_path+'is READY');window.setZeroTimeout(function(){Events.resolve('ReactComponent_load_'+mixin_path);});}};}(console));ReactComponent.setDebug(false);;
var chromecast={initialize:function(){if(typeof chrome==='undefined'||!chrome.cast||!chrome.cast.extensionId){return false;}
Events.ready(Events.user.loaded,function(){if(!chromecast.canCast()){return false;}
chromecast._positionType='prcPosition';var request=new chrome.cast.SessionRequest(CHROMECAST.ID);var config=new chrome.cast.ApiConfig(request,function(session){return chromecast.setSession(session);},function(status){if(status===chrome.cast.ReceiverAvailability.AVAILABLE){chromecast.setStatus('show');}else{chromecast.setStatus('hide');}});chrome.cast.initialize(config,function(){},function(err){return;});});},launch:function(){if(!chromecast.canCast()){return false;}
var status=chromecast.getStatus();if(status==='connected'||status==='disconnected'){window.tracking.track('chromecast_open_menu_click',{chromecast_status:status==='connected'?1:0});}
Events.trigger(Events.chromecast.closeIntro,true);chrome.cast.requestSession(function(session){return chromecast.setSession(session);},function(err){return;});},setSession:function(session,reset){chromecast._session=session;if(reset===true){return false;}
chromecast.setStatus('loading');chromecast._session.addUpdateListener(function(alive){return!alive&&!OFFLINE?chromecast.stopReceiver(true):true;});Events.ready(Events.player.playerReady,function(){return chromecast.startReceiver();});},startReceiver:function(){if(chromecast._session===null){return false;}
window.tracking.track('chromecast_menu_choice_click',{type:'connect'});var current_ctx=dzPlayer.getContext();chromecast._dzPlayer.ctx=countObject(current_ctx)?current_ctx:{ID:PLAYLIST_WELCOME_ID,TYPE:'player_default_playlist',CONTEXT_ID:''};chromecast.setCCPlayer();chromecast._session.addMessageListener(CHROMECAST.NAMESPACE,function(namespace,message){var message=JSON.parse(message);if(message['status']){var type=message['status']['type'];var parameters=message['status']['parameters'];if(parameters.hasOwnProperty('owner_id')&&parameters['owner_id']!==chromecast._ownerId){chromecast.setOwner(parameters['owner_id']);}
if(!chromecast._ping){return false;}
if(!chromecast._initialized){chromecast._initialized=true;chromecast.setStatus('connected');if(type==='idle'){return chromecast.doAction('playHello',{media_time:chromecast._dzPlayer.position});}}
if(type==='idle'){chromecast.setLoading(false);return chromecast.resetAutoSeek();}
if(type==='queue_changed'&&countObject(parameters['tracks'])){var tracks=[];var current_track;var context=parameters['context']||{};var dzr_ctx_id=parseInt(context['properties'][chromecast.getContextIndexByType(context['type'])]);var dzr_ctx_type=chromecast.getOriginalContextType(context['type']);if(chromecast._ccPlayer.ctx.ID!==dzr_ctx_id){chromecast.resetAutoSeek();}
for(var i=0;i<countObject(parameters['tracks']);++i){current_track={data:parameters['tracks'][i],context:{ID:context['type']==='top_charts'?parameters['tracks'][i]['ALB_ID']:dzr_ctx_id,TYPE:dzr_ctx_type==='track_page'?'album_page':dzr_ctx_type,CONTEXT_ID:context['type']==='top_charts'?dzr_ctx_id:''}};if(context['type']==='search_results'&&www.getCurrentPageType()==='search'){var path=www.getCurrentPath().split('/');current_track['context']['ID']=path.length===2?path[1]:'';}else if(context['type']==='track'){current_track['context']['ID']=parameters['tracks'][i]['ALB_ID'];}else if(context['type']==='playlist'&&parseInt(getObjDeepKey(profile,'data.TAB.loved.favorite_playlist_id'),10)===dzr_ctx_id){current_track['context']['TYPE']='loved_page';}
if(!current_track['data'].hasOwnProperty('ALB_ID')){current_track['data']['ALB_ID']=context['properties']['ALB_ID'];}
if(i===0){current_track['LOCAL_AVAILABLE']=false;chromecast._ccPlayer.ctx={ID:current_track['context']['ID'],TYPE:current_track['context']['TYPE'],CONTEXT_ID:current_track['context']['CONTEXT_ID']};}
tracks.push(current_track);}
chromecast._ccPlayer.list=tracks;setDzPlayerProp('trackList',tracks);if(chromecast.isRadioContextType(context['type'])){setDzPlayerProp('shuffle',false);setDzPlayerProp('repeat',0);chromecast.setRadio(true);}else{setDzPlayerProp('shuffle',parameters['shuffle']);setDzPlayerProp('repeat',parameters['repeat']);chromecast.setRadio(false);}
return false;}
if(!countObject(chromecast._ccPlayer.list)){return false;}
var current_track=parameters['current_track']||{};var context=parameters['context']||{};var media_time=~~(current_track['media_time']/1000);if(!current_track.hasOwnProperty('properties')){current_track['properties']={SNG_ID:current_track['id']}}
if(type==='track_changed'){chromecast.resetAutoSeek();var tracks=dzPlayer.getTrackList();for(var i=0;i<tracks.length;++i){if(parseInt(tracks[i]['SNG_ID'])===parseInt(current_track['properties']['SNG_ID'])){dzPlayer.setIndexSong(i);}}
setDzPlayerProp('duration',dzPlayer.getCurrentSong('DURATION'));setDzPlayerProp('pourcentLoaded',100);Events.trigger(Events.player.play,{value:dzPlayer.getCurrentSong()});Events.trigger(Events.player.displayCurrentSong,dzPlayer.getCurrentSong());return false;}else if(type==='playing'||type==='paused'){chromecast.setLoading(false);setDzPlayerProp('playing',(type==='playing'));setDzPlayerProp('paused',(type==='paused'));chromecast._ccPlayer.position=media_time;setDzPlayerProp(chromecast._positionType,chromecast._ccPlayer.position);return type==='playing'?chromecast.startAutoSeek():chromecast.resetAutoSeek(false);}else if(type==='time_updated'){chromecast.setLoading(false);if(dzPlayer.getDuration()===0){setDzPlayerProp('duration',dzPlayer.getCurrentSong('DURATION'));}
chromecast._ccPlayer.position=media_time;chromecast._autoSeek===null?chromecast.startAutoSeek():setDzPlayerProp(chromecast._positionType,chromecast._ccPlayer.position);setDzPlayerProp('volume',parseFloat(chromecast._session.receiver.volume.level).toFixed(2));}else if(type==='loading'){chromecast.setLoading(true);var reset=parseInt(dzPlayer.getCurrentSong('SNG_ID'))===parameters['track_id'];return chromecast.resetAutoSeek(!reset);}else if(type==='goodbye'){return chromecast.stopReceiver();}else if(type==='repeat_changed'){return setDzPlayerProp('repeat',parameters['repeat']||0);}}});return chromecast.doAction('sayHello');},stopReceiver:function(skip){if(skip===false){chromecast._session.removeUpdateListener(CHROMECAST.NAMESPACE);chromecast._session.removeMessageListener(CHROMECAST.NAMESPACE);return chromecast._session.stop(function(){chromecast.setDZPlayer();});}
return chromecast.setDZPlayer();},setRadio:function(bool){return chromecast._radio=bool;},isRadio:function(){return chromecast._radio?true:false;},isRadioContextType:function(type){return type==='user_flow'||type==='sradio'||type==='radio'?true:false;},setLoading:function(bool){return chromecast._loading=bool;},isLoading:function(){return chromecast._loading;},setOwner:function(id){return chromecast._ownerId=parseInt(id);},isOwner:function(){return chromecast._ownerId===parseInt(USER.USER_ID)?true:false;},isCasting:function(){return dzPlayer.getPlayerType()==='chromecast'?true:false;},canCast:function(){if(BrowserDetect.browser!=='Chrome'){return false;}
if(OFFLINE||typeof CHROMECAST!=='object'){return false;}
return USER.OPTIONS.mobile_offline&&USER.OPTIONS.mobile_streaming?true:false;},doAction:function(method,parameters){if(chromecast.isLoading()){return false;}
var parameters=parameters===Object(parameters)?parameters:{};var action=method.split('_').length===2?method.split('_')[1]:method;var allowed_actions=['play','seek','pause','prev','next','sayHello','playHello','playFromList','setVolume','mute','setRepeat','setShuffle'];if(!~allowed_actions.indexOf(action)){return false;}
if(action==='setVolume'||action==='mute'||action==='playHello'){var level=dzPlayer.getVolume();if(action==='mute'){if(parameters[0]===true){level=0;}}
chromecast._session.setReceiverVolumeLevel(parseFloat(level));if(action!=='playHello'){return false;}}
if(action==='sayHello'){chromecast._ping=true;return chromecast.setMessage('hello');}
if(action==='playHello'||action==='play'){if(chromecast._ping===false){return false;}
var current_track=dzPlayer.getCurrentSong();var context=chromecast.getParsedContext();return chromecast.setMessage('play',{context:context,current_track:{id:parseInt(current_track['SNG_ID']),isrc:(current_track['ISRC']||'').toString(),media_time:~~(parameters['media_time']*1000)}});}
if(action==='playFromList'){var index=isNaN(parameters['index'])||parameters['index']===-1?0:parameters['index'];var context=chromecast.getParsedContext(parameters['context']);var action='play';if(countObject(parameters['data'])===0){parameters['data']=[{SNG_ID:0}];}
chromecast._ccPlayer.ctx.ID=context['type']==='top_charts'?parseInt(parameters['context']['ID']):context['id'];if(context['type']==='top_charts'&&chromecast._ccPlayer.ctx.TYPE==='tops_track'||context['id']===chromecast._ccPlayer.ctx.ID&&chromecast._ccPlayer.ctx.ID===parseInt(dzPlayer.getContext()['ID'])){action='skip_to';}
if(context['type']==='search_results'){context['id']=~~(Math.random()*1000);context['name']=parameters['context']['ID'];}
if(context['type']==='track'){context['type']==='album';}
chromecast._ccPlayer.ctx.TYPE=parameters['context']['TYPE'];return chromecast.setMessage(action,{context:context,current_track:{id:parseInt(parameters['data'][index]['SNG_ID']),isrc:(parameters['data'][index]['ISRC']||'').toString(),media_time:0}});}
if(action==='prev'||action==='next'||action==='pause'){return chromecast.setMessage(action);}
if(action==='seek'){var position=parameters[0];var duration=dzPlayer.getCurrentSong('DURATION');position=duration*position;return chromecast.setMessage(action,{media_time:~~(position*1000)});}
if(action==='setRepeat'||action==='setShuffle'){action=action==='setRepeat'?'toggle_repeat':'toggle_shuffle';return chromecast.setMessage(action,{value:parameters['value']});}},setMessage:function(type,obj,callback){if(typeof type!=='string'){return false;}
if(typeof obj==='function'){callback=obj;obj={};}else{callback=typeof callback==='function'?callback:false;obj=obj===Object(obj)?obj:{};}
chromecast.getUserAccessToken(function(response){var message={session:{user_id:USER.USER_ID,live_token:USER_TOKEN,access_token:response},command:{type:type}};if(type==='play'){chromecast.setLoading(true);var shuffle=dzPlayer.isShuffle();var repeat=dzPlayer.getRepeat();if(chromecast.isRadioContextType(obj['context']['type'])){shuffle=false;repeat=0;}
message['command']['parameters']={current_track:{id:obj['current_track']['id'],media_time:obj['current_track']['media_time'],isrc:obj['current_track']['isrc']},context:obj['context'],shuffle:shuffle,repeat:repeat,hq:dzPlayer.isHq()};}else if(type==='skip_to'){chromecast.setLoading(true);message['command']['parameters']={track_id:obj['current_track']['id']};}else if(type==='toggle_repeat'||type==='toggle_shuffle'){message['command']['parameters']={value:obj['value']};}else if(type==='seek'){chromecast.setLoading(true);message['command']['parameters']={media_time:obj['media_time']};}else if(type==='prev'||type==='next'){chromecast.setLoading(true);}
return chromecast._session.sendMessage(CHROMECAST.NAMESPACE,message);});},getContextIndexByType:function(type){var index=type;var format_keys={'ART_ID':['top_artist','sradio'],'GENRE_ID':['top_charts'],'RADIO_ID':['radio'],'ALB_ID':['album','track','search_results'],'PLAYLIST_ID':['playlist'],'USER_ID':['top_user','user_history','user_personal_tracks','user_flow']};for(var key in format_keys){for(var i=0;i<format_keys[key].length;++i){if(format_keys[key][i]!==type){continue;}
index=key;}}
return index;},getOriginalContextType:function(type){var format_keys={sradio:'smartradio_page',radio:'radio_page',top_artist:'artist_top',top_user:'profile_top_tracks',top_charts:'tops_track',user_history:'history_page',user_personal_tracks:'personalsong_page',user_flow:'profile_user_radio',playlist:'playlist_page',album:'album_page',search_results:'search_page',track:'track_page'};return format_keys[type];},getParsedContext:function(ctx){var dz_context=ctx===Object(ctx)?ctx:dzPlayer.getContext();var cb_context;var context_type=dz_context['TYPE'];var context_id=dz_context['ID'];if(!context_type||!context_id){return false;}
var format_keys={'sradio':['smartradio_page','feed_smartradio','artist_smartradio'],'radio':['profile_radios','radio_page','feed_radio','unknown'],'top_artist':['artist_top'],'top_user':['profile_top_tracks'],'top_charts':['tops_track'],'user_history':['history_page'],'user_personal_tracks':['personalsong_page'],'user_flow':['profile_user_radio','feed_user_radio'],'playlist':['playlist_page','feed_playlist','tops_playlist','profile_playlists','player_default_playlist','loved_page','ticker_playlist','menu_panel_playlist','suggest_playlist'],'album':['album_page','explore_picks_album','explore_region_album','tops_album','feed_album','profile_top_albums','artist_discography','profile_albums','ticker_album','menu_panel_album','suggest_album'],'search_results':['search_page'],'track':['feed_track','track_page','ticker_track','suggest_track']};for(var key in format_keys){for(var i=0;i<format_keys[key].length;++i){if(key!==context_type&&format_keys[key][i]!==context_type){continue;}
if(format_keys[key][i]==='loved_page'){context_id=chromecast._page.lpid;if(www.getCurrentTab()==='loved'){context_id=profile.data.TAB.loved.favorite_playlist_id
chromecast._page.lpid=context_id;}}else if(format_keys[key][i]==='history_page'){context_id=chromecast._page.hpid;if(www.getCurrentTab()==='history'){context_id=www.getCurrentPath().split('/')[1];chromecast._page.hpid=context_id;}}else if(format_keys[key][i]==='tops_track'){context_id=dz_context['CONTEXT_ID'];}
cb_context=key;}}
if(context_type==='personalsong_page'){context_id=USER.USER_ID;}
var context={type:cb_context,id:isNaN(context_id)?context_id:parseInt(context_id)};return context;},setCCPlayer:function(){if(dzPlayer.getPlayerType()==='chromecast'){return false;}
chromecast._dzPlayer.position=dzPlayer.getPosition();dzPlayer.trigger('audioPlayer_stop',null);dzPlayer.setPlayerType('chromecast');},setDZPlayer:function(){if(dzPlayer.getPlayerType()!=='chromecast'){return false;}
dzPlayer.setPlayerType('mod');chromecast.setStatus('disconnected');window.tracking.track('chromecast_menu_choice_click',{type:'disconnect'});if(chromecast.isOwner()===false){chromecast.setDefaultTrackList();}else{if(countObject(chromecast._ccPlayer.ctx)){dzPlayer.play({type:LOG_CONTEXT[chromecast._ccPlayer.ctx.TYPE],id:chromecast._ccPlayer.ctx.ID,autoplay:false,radio:chromecast.isRadio(),index:dzPlayer.getTrackListIndex(),context:{ID:chromecast._ccPlayer.ctx.ID,TYPE:chromecast._ccPlayer.ctx.TYPE,CONTEXT_ID:chromecast._ccPlayer.ctx.CONTEXT_ID}});}else{chromecast.setDefaultTrackList();}}
Events.trigger(Events.player.displayCurrentSong,dzPlayer.getCurrentSong());dzPlayer.trigger('audioPlayer_stop',null);chromecast._dzPlayer={ctx:{},list:{},position:0};chromecast._ccPlayer={ctx:{},list:{},position:0};chromecast._page={lpid:0,hpid:0};chromecast._initialized=false;chromecast._ping=false;chromecast.setOwner(null);chromecast.setRadio(false);chromecast.setLoading(false);chromecast.setSession(null,true);chromecast.resetAutoSeek();},setDefaultTrackList:function(){dzPlayer.play({type:'playlist',id:PLAYLIST_WELCOME_ID,autoplay:false,context:{ID:PLAYLIST_WELCOME_ID,TYPE:'player_default_playlist',CONTEXT_ID:''}});},getUserAccessToken:function(callback){var access_token=sessionStorage.getItem('CCToken_'+USER.USER_ID);if(access_token){return callback(access_token);}
api.call('application.authChromecast',{},function(response){if(!response){return false;}
sessionStorage.setItem('CCToken_'+USER.USER_ID,response);return callback(response);});},startAutoSeek:function(){chromecast._autoSeek=setInterval(function(){setDzPlayerProp(chromecast._positionType,++chromecast._ccPlayer.position);},1000);},resetAutoSeek:function(trigger){if(typeof trigger==='undefined'||trigger!==false){trigger=true;}
clearInterval(chromecast._autoSeek);if(trigger){chromecast._ccPlayer.position=0;setDzPlayerProp(chromecast._positionType,chromecast._ccPlayer.position);}
chromecast._autoSeek=null;},getStatus:function(){return chromecast._status;},setStatus:function(status){chromecast._status=status;Events.trigger(Events.chromecast.status,chromecast._status);},_positionType:'position',_dzPlayer:{ctx:{},list:{},position:0},_ccPlayer:{ctx:{},list:{},position:0},_page:{lpid:0,hpid:0},_autoSeek:null,_ownerId:null,_session:null,_status:'hide',_initialized:false,_loading:false,_radio:false,_ping:false};window.__onGCastApiAvailable=function(ready,error){return ready?chromecast.initialize():false;};;
(function(){function toDashed(name){return name.replace(/([A-Z])/g,function(u){return'-'+u.toLowerCase();});}
function toCamelCase(input){return input.toLowerCase().replace(/-(.)/g,function(match,group1){return group1.toUpperCase();});}
var fn;if(document.head&&document.head.dataset){fn={set:function(node,attr,value){node.dataset[attr]=value;},get:function(node,attr){return node.dataset[attr];},del:function(node,attr){delete node.dataset[attr];},getAll:function(node){return node.dataset;}};}else{fn={set:function(node,attr,value){node.setAttribute('data-'+toDashed(attr),value);return value;},get:function(node,attr){var value=node.getAttribute('data-'+toDashed(attr));return value===null?undefined:value;},del:function(node,attr){node.removeAttribute('data-'+toDashed(attr));return true;},getAll:function(node){var dataset={};var attr_name;for(var i=0;i<node.attributes.length;i++){attr_name=node.attributes[i].name;if(attr_name.substr(0,5)!=='data-'){continue;}
dataset[toCamelCase(attr_name.substr(5))]=node.attributes[i].value;}
return dataset;}};}
function dataset(node,attr,value){var self={set:set,get:get,del:del};function set(attr,value){fn.set(node,attr,value);return self;}
function del(attr){fn.del(node,attr);return self;}
function get(attr){return fn.get(node,attr);}
function getAll(){return fn.getAll(node);}
if(arguments.length===3){return set(attr,value);}
if(arguments.length==2){return get(attr);}
return getAll();}
window.dom={addEventListener:function(html_element,event_name,event_function,use_capture){if(typeof use_capture!=='boolean'){use_capture=false;}
if(html_element.addEventListener){html_element.addEventListener(event_name,event_function,use_capture);}else if(html_element.attachEvent){html_element.attachEvent('on'+event_name,event_function);}},removeEventListener:function(html_element,event_name,event_function,use_capture){if(typeof use_capture!=='boolean'){use_capture=false;}
if(html_element.removeEventListener){html_element.removeEventListener(event_name,event_function,use_capture);}else if(html_element.detachEvent){html_element.detachEvent('on'+event_name,event_function);}},dataset:dataset};})();;
(function(){'use strict';var timeouts=[];var timeouts_cleared={};var nextHandle=1;var unshiftAllTimeouts=function(){if(timeouts.length===0){return;}
var i;var cb_to_call;cb_to_call=timeouts.slice(0);timeouts=[];for(i=0;i<cb_to_call.length;i++){if(typeof timeouts_cleared[cb_to_call[i][1]]!=='undefined'){delete timeouts_cleared[cb_to_call[i][1]];continue;}
cb_to_call[i][0].apply();}};var _clearZeroTimeout=function(handle){timeouts_cleared[handle]=true;};var timeout_received=true;var _setZeroTimeoutOne=function(cb){var thisHandle=nextHandle++;timeouts.push([cb,thisHandle]);if(!timeout_received){return thisHandle;}
timeout_received=false;function addTimeout(){window.setTimeout(function(){timeout_received=true;unshiftAllTimeouts();},0);}
addTimeout();addTimeout();return thisHandle;};window.setZeroTimeout=_setZeroTimeoutOne;window.clearZeroTimeout=_clearZeroTimeout;var hasPostmessage=typeof window.postMessage==='function';if(!hasPostmessage||(BrowserDetect.browser==='Explorer'&&BrowserDetect.version<=8)){return;}
var messageName='zero-timeout-message';var postmessage_received=true;var _setZeroTimeoutPostMessage=function(cb){var thisHandle=nextHandle++;timeouts.push([cb,thisHandle]);if(!postmessage_received){return thisHandle;}
postmessage_received=false;window.postMessage(messageName,'*');return thisHandle;};var handleMessage=function(event){if(event.source==window&&event.data==='defineSetZeroTimeoutPostMessage'){window.setZeroTimeout=_setZeroTimeoutPostMessage;return;}
if(event.source==window&&event.data===messageName){event.stopPropagation();postmessage_received=true;unshiftAllTimeouts();}};window.dom.addEventListener(window,'message',handleMessage,true);window.postMessage('defineSetZeroTimeoutPostMessage','*');})();;
if(typeof bookmark==='undefined'){var bookmark={init:function(){try{Events.subscribe(Events.player.paused,this._onPlayerChange,'bookmark');Events.subscribe(Events.player.seekCompleted,this._onPlayerChange,'bookmark');Events.subscribe(Events.player.track_end,this._onPlayerChange,'bookmark');Events.subscribe(Events.player.setBookmark,this._onPlayerChange,'bookmark');}catch(e){error.log(e);}},setEpisodeBookmark:function(mark,eventNamespace){try{if(typeof mark!=='object'||mark.OFFSET>mark.DURATION){return false;}
var heard=bookmark.calculateIsHeard(mark.EPISODE_ID,mark.OFFSET,mark.duration,eventNamespace);if((mark.OFFSET>(mark.DURATION*0.9)&&(mark.DURATION-mark.OFFSET)<=120)||eventNamespace==='PLAYER.track_end'){mark.OFFSET='0';heard='1';}
mark.ISHEARD=heard;userData.addEpisodeBookmark(mark);Events.trigger(Events.talk.bookmarkSet,mark);if((mark.OFFSET+5)>=mark.DURATION){mark.OFFSET='0';}
mark.ISHEARD=Math.floor(heard).toString();api.call({method:'episode.bookmarkSet',data:mark,success:function(){}});return true;}catch(e){error.log(e);}},calculateIsHeard:function(eid,offset,duration,eventNamespace){var heard=bookmark.getEpisodeBookmark(eid).IS_HEARD;if(heard!=='1'){if((offset>(duration*0.9)&&(duration-offset)<=120)||eventNamespace==='PLAYER.track_end'){return'1';}else if(offset>9){return'0.5';}}
return heard;},getEpisodeBookmark:function(episode_id,duration){if(USER.USER_ID===0||typeof userData.data.EPISODE_BOOKMARKS_HASH==='undefined'){return{OFFSET:'0',IS_HEARD:'0'};}
var index=(typeof userData.data.EPISODE_BOOKMARKS_HASH[episode_id]!=='undefined')?userData.data.EPISODE_BOOKMARKS_HASH[episode_id]:false;if(index!==false){var obj=userData.data.EPISODE_BOOKMARKS.data[index];var result={OFFSET:obj.OFFSET,IS_HEARD:obj.IS_HEARD};if(duration){result.IS_HEARD=bookmark.calculateIsHeard(episode_id,obj.OFFSET,obj.duration);}
return result;}
return{OFFSET:'0',IS_HEARD:'0'};},_onPlayerChange:function(e,d){var offset;var eid;if(dzPlayer.getMediaType()!==dzPlayer.MEDIA_TYPE_TALK&&(d.media&&d.media.type!=='talk')){return false;}
if(dzPlayer.getPosition()<10&&e.namespace!=='PLAYER.track_end'){return false;}
var currentEpisode=dzPlayer.getCurrentSong();var duration=currentEpisode.DURATION;if(d.media){offset=d.offset;eid=d.media.id;}else if(dzPlayer.getMediaType(currentEpisode)===dzPlayer.MEDIA_TYPE_TALK){offset=dzPlayer.getPosition();eid=currentEpisode.EPISODE_ID;}else{return false;}
if(e.namespace==='PLAYER.seekCompleted'){offset=d;}
var mark={OFFSET:offset,DURATION:duration,EPISODE_ID:eid};mark.OFFSET=parseInt(mark.OFFSET,10);bookmark.setEpisodeBookmark(mark,e.namespace);}};};
if(typeof live==='undefined'){var live={initialized:false,socket:null,channels:[],connected:false,ticker_nb:0,server_timestamp:0,online_count:0,lastFeed:'',ws_close_codes:{normal:1000},ws_ready_state:{connecting:0,open:1,closing:2,closed:3},init:function(){if(Modernizr.websockets===false){return true;}
live.initialized=true;live.checkConnectionScheduler();limitation.init();live.log.init();return true;},checkConnectionScheduler:function(){live.checkConnection();window.setTimeout(live.checkConnectionScheduler,1000);},checkConnection:function(){if(typeof USER_TOKEN==='undefined'){return;}
if(live.socket!==null&&live.socket.readyState!=live.ws_ready_state.closed){return;}
live.connect();},connect:function(){if(live.socket!==null){live.close();delete live.socket;}
live.socket=new WebSocket(PROTOCOL_WS+SETTING_HOST_LIVE+'/ws/'+USER_TOKEN+'?version='+STATIC_VERSION);live.socket.onopen=function(evt){live.connected=true;for(var channel in live.channels){if(!live.channels.hasOwnProperty(channel)){continue;}
live.subscribe(channel);}
Events.trigger(Events.live.connected);};live.socket.onclose=function(evt){live.connected=false;};live.socket.onmessage=function(evt){live.onMsg(evt.data);};live.socket.onerror=function(evt){};return true;},disconnect:function(){if(!live.connected){return true;}
live.channels=[];live.connected=false;live.close();return true;},close:function(){try{live.socket.close(live.ws_close_codes.normal);}catch(e){error.log(e);}},addChannel:function(channel){if(typeof channel==='undefined'||channel===''){return false;}
live.addInternalChannel(channel);live.subscribe(channel);return true;},addInternalChannel:function(channel){if(typeof channel==='undefined'||channel===''){return false;}
live.channels[channel]=true;return true;},deleteChannel:function(channel){if(typeof channel==='undefined'||channel===''){return false;}
if(typeof live.channels[channel]==='undefined'){return false;}
delete live.channels[channel];return live.unsubscribe(channel);},subscribe:function(channel){if(!live.initialized){return false;}
if(!live.connected){return false;}
return live.socket.send(JSON.stringify(['sub',channel]));},unsubscribe:function(channel){if(!live.initialized){return false;}
if(!live.connected){return false;}
return live.socket.send(JSON.stringify(['unsub',channel]));},publish:function(channel,data){if(!live.initialized){return false;}
if(!live.connected){return false;}
return live.socket.send(JSON.stringify(['send',channel,data]));},sendlog:function(data){if(!live.initialized){return false;}
if(!live.connected){return false;}
return live.socket.send(JSON.stringify(['sendlog',data]));},onMsg:function(data){try{if(typeof data==='undefined'||data.length===0){return false;}
data=JSON.parse(data);if(data[0]!=='msg'){return false;}
live.dispatch([data[2],0]);return true;}catch(e){error.log(e);}},dispatch:function(message){try{if(typeof message!=='object'||message.length===0||typeof message[0].APP==='undefined'){error.log({message:'live.dispatch: Message not valid',description:message||null});return false;}
var app=message[0].APP.toLowerCase();if(typeof Events.live[app]!=='string'){return false;}
Events.trigger(Events.live[app],message);return true;}catch(e){error.log(e);}}};};
live.log={data:[],init:function(){Events.subscribe(Events.live.connected,function(){for(var line in live.log.data){if(!live.log.data.hasOwnProperty(line)){continue;}
live.sendlog(live.log.data[line]);}
live.log.data=[];});},send:function(event_name,properties){var data={event_name:event_name,properties:properties,platform:platform.get(),usr:USER.USER_ID,uniq_id:getCookie('dzr_uniq_id'),cty:COUNTRY,path:window.location.href,session_duration:typeof SESSION_DURATION==='number'?SESSION_DURATION:null};if(!live.connected){live.log.data.push(data);return true;}
try{live.sendlog(data);}catch(e){live.log.data.push(data);}
return;}};;
if(typeof limitation=="undefined"){var limitation={chan:null,uniqid:0,init:function(){Events.ready(Events.user.loaded,function(){limitation.uniqid=new Date().getTime();limitation.chan=USER.USER_ID+'_'+USER.USER_ID+'_STREAM';live.addInternalChannel(limitation.chan);Events.subscribe(Events.player.play,function(evt,params){if(typeof params.value=='undefined'){return false;}
limitation.sendAction('PLAY',params.value.SNG_ID);});Events.subscribe(Events.player.resume,function(evt,params){if(typeof params.value=='undefined'){return false;}
limitation.sendAction('PLAY',params.value.SNG_ID);});Events.subscribe(Events.player.seek,function(evt,params){limitation.sendAction('PLAY',dzPlayer.getCurrentSong('MEDIA_ID'));});Events.subscribe(Events.live.limitation,function(evt,params){limitation.execAction(params);});});},reset:function(){limitation.chan=null;limitation.uniqid=0;return true;},sendAction:function(action,value){if(USER.USER_ID===0||(typeof dzPlayer!=='undefined'&&dzPlayer.getPlayerType()==='chromecast')){return false;}
if(action!='PLAY'){return false;}
var param={APP:'LIMITATION',ACTION:action,VALUE:{USER_ID:USER.USER_ID,UNIQID:limitation.uniqid,SNG_ID:value}};live.publish(limitation.chan,param);return true;},execAction:function(message){if(typeof message!='object'||countObject(message)!=2){return false;}
var data=message[0];var time=message[1];if(data.VALUE.USER_ID===0){return false;}
if(data.VALUE.USER_ID==USER.USER_ID&&data.VALUE.UNIQID==limitation.uniqid){return false;}
if((live.server_timestamp-time)>5){return false;}
if(data.ACTION!='PLAY'){return false;}
Events.trigger(Events.live.simultaneousAccess,{});return true;}};};
var www={tabs:{},display_languages:false,layout_state_width:null,layoutDetectSize:function(){var layout_state_width;if(client_width<=1170){layout_state_width='small';}else if(client_width>1170){layout_state_width='big';}
if(www.layout_state_width!=layout_state_width){www.layout_state_width=layout_state_width;Events.trigger(Events.layout.width_type,www.layout_state_width);}
return www.layout_state_width;},drawFormResult:function(id,classname,data){try{$("#"+id).html(data).removeClass().addClass(classname).show();}catch(e){error.log(e);}},hideFormResult:function(id){try{$("#"+id).hide();}catch(e){error.log(e);}},openDemo:function(url){try{var params='width=820, height=550, resizable=no, scrollbars=no, toolbars=no, location=no, directories=no, status=no, menubar=no, copyhistory=no';var fwin=window.open(url,'demoWin',params);if(fwin&&window.focus){fwin.focus();}}catch(e){error.log(e);}},displayBackground:function(body){try{$('body').css('background',body);}catch(e){error.log(e);}},getAbsoluteTop:function(objectId){try{o=document.getElementById(objectId);oTop=o.offsetTop;return oTop;}catch(e){error.log(e);}},getAbsoluteTopParent:function(objectId){try{var o=document.getElementById(objectId);oTop=o.offsetTop;while(o.offsetParent!==null){oParent=o.offsetParent;oTop+=oParent.offsetTop;o=oParent;}
return oTop;}catch(e){error.log(e);}},displayLanguages:function(){try{if(www.display_languages===false){$('#languages-list').fadeIn("slow");www.display_languages=true;scrollTo(0,$(document).height());}else{$('#languages-list').fadeOut("slow");www.display_languages=false;}}catch(e){error.log(e);}},goto_anchor:function(id){try{$('#page_content').scrollTop(www.getAbsoluteTopParent(id));return false;}catch(e){error.log(e);}},operator_form:function(form){try{if(form=='login'){$('#operator_form_login').show();$('#operator_form_register').hide();}else if(form=='register'){$('#operator_form_login').hide();$('#operator_form_register').show();}}catch(e){error.log(e);}},orange_form:function(form){try{if(form=='login'){$('#orange_form_login').show();$('#orange_form_register').hide();}else if(form=='register'){$('#orange_form_login').hide();$('#orange_form_register').show();}}catch(e){error.log(e);}},scrollOffersPage:function($el){try{$el.parent().siblings().removeClass('active');$el.parent().addClass('active');var target_id=$el.attr('href');var $target=$(target_id);var offset_y=(PLATFORM==='web')?$target.position().top:$target.offset().top;var $scroller=(PLATFORM==='web')?$('#page_content'):$('html,body');$scroller.animate({scrollTop:offset_y},'slow');}catch(e){error.log(e);}},getCurrentPageType:function(){try{var current_path=www.getCurrentPath();var naboo_class=naboo.dispatchPath(current_path);if(naboo_class!==null){return naboo_class.class_name;}
return current_path.split('/')[1];}catch(e){error.log(e);}},getCurrentPageId:function(){try{if(typeof naboo==='object'){return window[naboo.getCurrentClass()].id;}
return 0;}catch(e){error.log(e);}},getCurrentTab:function(){try{var path='';if(www.getCurrentPath()!=''&&www.getCurrentPath()!='index.php'){var currentPath=www.getCurrentPath().split('/');if(typeof currentPath[2]!=='undefined'){path=currentPath[2];}}
return path;}catch(e){error.log(e);}},allowAutoPromo:function(data){try{if(data.FILTERS=='free'&&DZPS){return false;}
if(data.FILTERS=='premium'&&!DZPS){return false;}
if(data.LOGGED_FILTERS=='notlogged'&&USER.USER_ID>0){return false;}
if(data.LOGGED_FILTERS=='logged'&&USER.USER_ID===0){return false;}
return true;}catch(e){error.log(e);}},updateContentBackground:function(){try{var $page=$('#naboo_content').children().first();var bg=$page.attr('data-bg');if(typeof bg!=='string'){$(page_content).removeAttr('data-bg');return false;}
$(page_content).attr('data-bg',bg);return true;}catch(e){error.log(e);}},navigate:function(page,options){try{if(page.charAt(0)!=='/'){error.log(new dzError({name:'NAVIGATION',message:'path not valid',description:'loadBox: / is missing in your path'+page}));page='/'+page;}
if(typeof options!=='object'){options={};}
if(page.substr(0,10)=='/login.php'||page.substr(0,13)=='/register.php'||page=='/payment/paypal_unsubscribe.php'||page=='/confirm.php'||page=='/facebook.php'){return loadFacebox(page);}
dclk_hide();infinite_scroll.disable();$('.tipsy').remove();$('#hovercard').hide();if(options.forceFaceboxClose!==false){$('#sharebox').remove();$('#facebox_overlay').fadeOut();$.facebox.close();}
if(www.getCurrentPath()!==page){www.setCurrentPath(page,true);}
Events.trigger(Events.navigation.page_changed,{path:page});var class_name=page.split('/')[1];if(naboo.isAllowed(class_name)){return naboo.display(page,undefined,options);}
naboo.leave();var getParam=page.split('?');var get_query_param='';if(typeof getParam[1]!=='undefined'){get_query_param=getParam[1];}
sendRequest('/ajax/loader.php?checkForm='+encodeURIComponent(checkForm)+'&'+get_query_param,'text','page='+encodeURIComponent(page)+'&full=1',true,www.loadBoxCallback,{'page':page},'major_pages');return true;}catch(e){error.log(e);}},loadBoxCallback:function(request,callback_parameters){try{if(request==false||request==null||typeof request.responseText=='undefined'){return false;}
request=request.responseText;var page='';if(callback_parameters['page']!=null){page=callback_parameters['page'];}
if(DZPS||page!=''){disableAdsHabillage();}
$('#naboo_content').html(request);Events.trigger(Events.navigation.page_loaded);Events.trigger(Events.navigation.page_displayed,{path:page});$('#page_content').scrollTop(0);return true;}catch(e){error.log(e);}},goToLogin:function(redirect){window.location.href='/login'+www.parseRedirectParams(redirect);},goToRegister:function(redirect){window.location.href='/register'+www.parseRedirectParams(redirect);},goToConnection:function(redirect){window.location.href='/'+www.parseRedirectParams(redirect);},parseRedirectParams:function(options){if(window.location.search.indexOf('redirect_link')>-1&&window.location.search.indexOf('redirect_type')>-1){return window.location.search;}
var redirect='';if(typeof options==='object'){if(typeof options.redirect_type==='string'){redirect+='?redirect_type='+options.redirect_type;}
if(typeof options.redirect_link==='string'){redirect+='&redirect_link='+options.redirect_link;}}else if(www.getCurrentPath()!=='/'&&!/(login|register|signout)/.test(www.getCurrentPath())){redirect='?redirect_type=page&redirect_link='+encodeURIComponent(www.getCurrentPath());}
return redirect;},getCurrentPath:function(){if(!_jqueryAddress.initialized){return window.location.pathname;}
return $.address.value();},setCurrentPath:function(path,with_history){with_history=(typeof with_history==='boolean')?with_history:false;if(!with_history){$.address.history(false);}
$.address.value(path);if(!with_history){$.address.history(true);}}};_onScroll=function(){window.page_content=$('#page_content').get(0);if(typeof window.page_content==='undefined'){return false;}
page_content.onscroll=function(){try{yscroll=page_content.scrollTop;infinite_scroll.checkPosition();clearInterval(hovercard.timeout);if(hovercard.current!=null){hovercard.hide();}
Events.trigger(Events.layout.scroll,{yscroll:yscroll});return true;}catch(e){error.log(e);}};}
_onResize=function(){client_height=getClientHeight();client_width=getClientWidth();window.onresize=document.onresize=function(){try{var prev_client_height=client_height;var prev_client_width=client_width;client_height=getClientHeight();client_width=getClientWidth();if(prev_client_height==client_height&&prev_client_width==client_width){return false;}
www.layoutDetectSize();if(typeof menu!='undefined'){menu.adjustUserMenu();}
infinite_scroll.checkPosition();Events.trigger(Events.layout.resize,{'client_width':client_width,'client_height':client_height});return true;}catch(e){error.log(e);}};}
_onBlur=function(){window.onblur=function(){ads_focus_value=false;ads.checkAutoRefresh(true);return true;};}
_onFocus=function(){window.onfocus=function(){ads_focus_value=true;ads.checkAutoRefresh(true);return true;};}
_onBeforeUnload=function(){window.onbeforeunload=function(){if(dzPlayer.playing&&USER.USER_ID>0&&(typeof USER.SETTING.global.popup_unload=='undefined'||!USER.SETTING.global.popup_unload)&&(typeof loadPaymentProgress=='undefined')){return gettext('En quittant cette page, votre musique s\'arrêtera. Dommage.');}};window.onunload=function(){if(dzPlayer.getCurrentSong()!==null){dzPlayer.logManager(false);facebook.closeBridge();}};}
_jqueryAddress=function(){if(typeof $.address==='undefined'){return false;}
if(typeof Modernizr!='undefined'&&Modernizr.history&&typeof $.address!=='undefined'){$.address.state('/');var init_address=window.location.pathname.split('/');if(typeof init_address[1]!='undefined'&&init_address[1].length===2){$.address.history(false);$.address.value(window.location.pathname.substr(3));$.address.history(true);}}
this.initialized=true;$.address.init(function(event){}).externalChange(function(event){try{var aPaths=event.value.split('/');if(aPaths[1]!=='app'&&event.value.indexOf("?")!=-1){return false;}
loadBox(event.value);}catch(e){error.log(e);}}).internalChange(function(event){});}
try{$(document).ready(function(){document.write=function(){return false;};document.open=function(){return false;};document.close=function(){return false;};if(window.ZeroClipboard){ZeroClipboard.config({swfPath:SETTING_STATIC+'/swf/ZeroClipboard.swf'});}});js_init.init();$(document).ready(function(){var current_path=www.getCurrentPath();Events.trigger(Events.navigation.page_changed,{path:current_path});if(typeof naboo!=='undefined'&&naboo.dispatchPath(current_path)===null){Events.trigger(Events.navigation.page_loaded);Events.trigger(Events.navigation.page_displayed,{path:current_path});}});}catch(e){error.log(e);};